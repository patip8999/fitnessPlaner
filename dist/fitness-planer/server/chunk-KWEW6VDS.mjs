import './polyfills.server.mjs';
import{$ as Na,$a as vb,A as Ke,Aa as hb,B as ae,C as pe,D as sb,E as ye,F as pr,Fa as Lf,G as nn,Ga as Fc,H as ob,I as ab,Ia as Bf,J as Gi,Ja as La,K as _t,Ka as Vr,L as bt,La as fb,M as Pc,Ma as Vf,N as $e,O as Lr,Oa as Lc,P as kf,Pa as Us,Q as Vs,Qa as zs,R as j,Ra as Bc,S as mt,Sa as pb,T as Of,Ta as mb,U as Ct,V as mr,W as gr,Wa as gb,X as lb,Y as Ue,Z as Oa,_ as kt,_a as yb,a as Qt,aa as Ln,b as Mc,ba as Bn,bb as Gs,c as X0,ca as B,cb as Vc,d as Rc,da as N,db as _b,e as Z0,ea as Br,eb as qc,f as Ui,fa as rn,g as Ls,ga as ne,h as Fn,ha as be,i as Fr,ia as $,j as pt,ja as lt,k as eb,ka as St,l as tb,la as cb,m as ka,ma as Nf,n as nb,na as qt,o as rb,oa as wt,p as xc,pa as Ut,q as kc,qa as qs,r as Rf,ra as ve,s as Oc,sa as Pf,t as zi,ta as ub,u as xf,ua as Vn,v as ib,va as Pa,w as Nc,wa as Fa,x as Bs,xa as Ff,y as _n,ya as db,z as fr}from"./chunk-QQI3A2SW.mjs";import{a as bb,b as qf,c as Cb,d as Ba,e as Uf,f as Uc,g as Sb,h as wb,i as zf,j as Fe,k as ji,l as qn,m as zc,n as Va,o as Tb,p as Eb,q as qr,r as Ot}from"./chunk-B5X6FFSV.mjs";import{a as ge,b as Me,c as _e,f as M,h as J0,i as Mf,j as S}from"./chunk-EXD34EPT.mjs";var me=M(sn=>{"use strict";Object.defineProperty(sn,"__esModule",{value:!0});sn.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=sn.DEFAULT_MAX_SEND_MESSAGE_LENGTH=sn.Propagate=sn.LogVerbosity=sn.Status=void 0;var Wb=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(Wb||(sn.Status=Wb={})),Kb=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(Kb||(sn.LogVerbosity=Kb={})),$b=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}($b||(sn.Propagate=$b={}));sn.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;sn.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var sp=M((MG,dR)=>{dR.exports={name:"@grpc/grpc-js",version:"1.9.15",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var Ge=M(Nt=>{"use strict";var op,ap,lp,cp;Object.defineProperty(Nt,"__esModule",{value:!0});Nt.isTracerEnabled=Nt.trace=Nt.log=Nt.setLoggerVerbosity=Nt.setLogger=Nt.getLogger=void 0;var Gr=me(),hR=_e("process"),fR=sp().version,pR={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},Hi=pR,Ks=Gr.LogVerbosity.ERROR,mR=(ap=(op=process.env.GRPC_NODE_VERBOSITY)!==null&&op!==void 0?op:process.env.GRPC_VERBOSITY)!==null&&ap!==void 0?ap:"";switch(mR.toUpperCase()){case"DEBUG":Ks=Gr.LogVerbosity.DEBUG;break;case"INFO":Ks=Gr.LogVerbosity.INFO;break;case"ERROR":Ks=Gr.LogVerbosity.ERROR;break;case"NONE":Ks=Gr.LogVerbosity.NONE;break;default:}var gR=()=>Hi;Nt.getLogger=gR;var yR=n=>{Hi=n};Nt.setLogger=yR;var vR=n=>{Ks=n};Nt.setLoggerVerbosity=vR;var _R=(n,...e)=>{let t;if(n>=Ks){switch(n){case Gr.LogVerbosity.DEBUG:t=Hi.debug;break;case Gr.LogVerbosity.INFO:t=Hi.info;break;case Gr.LogVerbosity.ERROR:t=Hi.error;break}t||(t=Hi.error),t&&t.bind(Hi)(...e)}};Nt.log=_R;var bR=(cp=(lp=process.env.GRPC_NODE_TRACE)!==null&&lp!==void 0?lp:process.env.GRPC_TRACE)!==null&&cp!==void 0?cp:"",up=new Set,Hb=new Set;for(let n of bR.split(","))n.startsWith("-")?Hb.add(n.substring(1)):up.add(n);var CR=up.has("all");function SR(n,e,t){Qb(e)&&(0,Nt.log)(n,new Date().toISOString()+" | v"+fR+" "+hR.pid+" | "+e+" | "+t)}Nt.trace=SR;function Qb(n){return!Hb.has(n)&&(CR||up.has(n))}Nt.isTracerEnabled=Qb});var Hc=M($s=>{"use strict";Object.defineProperty($s,"__esModule",{value:!0});$s.getErrorCode=$s.getErrorMessage=void 0;function wR(n){return n instanceof Error?n.message:String(n)}$s.getErrorMessage=wR;function TR(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}$s.getErrorCode=TR});var Gt=M(Yc=>{"use strict";Object.defineProperty(Yc,"__esModule",{value:!0});Yc.Metadata=void 0;var ER=Ge(),AR=me(),IR=Hc(),DR=/^[0-9a-z_.-]+$/,MR=/^[ -~]*$/;function RR(n){return DR.test(n)}function xR(n){return MR.test(n)}function Jb(n){return n.endsWith("-bin")}function kR(n){return!n.startsWith("grpc-")}function Qc(n){return n.toLowerCase()}function Yb(n,e){if(!RR(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(Jb(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!xR(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var dp=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=Qc(e),Yb(e,t),this.internalRepr.set(e,[t])}add(e,t){e=Qc(e),Yb(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=Qc(e),this.internalRepr.delete(e)}get(e){return e=Qc(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(OR);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{Jb(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(kR(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let o=`Failed to add metadata entry ${r}: ${i}. ${(0,IR.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,ER.log)(AR.LogVerbosity.ERROR,o)}}return t}};Yc.Metadata=dp;var OR=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var gp=M(Jc=>{"use strict";Object.defineProperty(Jc,"__esModule",{value:!0});Jc.CallCredentials=void 0;var mp=Gt();function NR(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var Hs=class n{static createFromMetadataGenerator(e){return new fp(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;NR(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let o=new mp.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);r(null,o)},s=>{r(s)})})}static createEmpty(){return new pp}};Jc.CallCredentials=Hs;var hp=class n extends Hs{constructor(e){super(),this.creds=e}generateMetadata(e){return S(this,null,function*(){let t=new mp.Metadata,r=yield Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},fp=class n extends Hs{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new hp([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},pp=class n extends Hs{generateMetadata(e){return Promise.resolve(new mp.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var vp=M(Qs=>{"use strict";Object.defineProperty(Qs,"__esModule",{value:!0});Qs.getDefaultRootsData=Qs.CIPHER_SUITES=void 0;var PR=_e("fs");Qs.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var Xb=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,yp=null;function FR(){return Xb?(yp===null&&(yp=PR.readFileSync(Xb)),yp):null}Qs.getDefaultRootsData=FR});var eu=M(Zc=>{"use strict";Object.defineProperty(Zc,"__esModule",{value:!0});Zc.ChannelCredentials=void 0;var LR=_e("tls"),BR=gp(),Zb=vp();function _p(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var Ys=class{constructor(e){this.callCredentials=e||BR.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(_p(e,"Root certificate"),_p(t,"Private key"),_p(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,LR.createSecureContext)({ca:(s=e??(0,Zb.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:Zb.CIPHER_SUITES});return new Xc(o,i??{})}static createFromSecureContext(e,t){return new Xc(e,t??{})}static createInsecure(){return new bp}};Zc.ChannelCredentials=Ys;var bp=class n extends Ys{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},Xc=class n extends Ys{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new Cp(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},Cp=class n extends Ys{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var Wr=M(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.validateLoadBalancingConfig=Tt.getFirstUsableConfig=Tt.isLoadBalancerNameRegistered=Tt.createLoadBalancer=Tt.registerDefaultLoadBalancerType=Tt.registerLoadBalancerType=Tt.createChildChannelControlHelper=void 0;function VR(n,e){var t,r,i,s,o,a,l,c,u,d;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(d=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&d!==void 0?d:n.removeChannelzChild.bind(n)}}Tt.createChildChannelControlHelper=VR;var jr={},Sp=null;function qR(n,e,t){jr[n]={LoadBalancer:e,LoadBalancingConfig:t}}Tt.registerLoadBalancerType=qR;function UR(n){Sp=n}Tt.registerDefaultLoadBalancerType=UR;function zR(n,e){let t=n.getLoadBalancerName();return t in jr?new jr[t].LoadBalancer(e):null}Tt.createLoadBalancer=zR;function GR(n){return n in jr}Tt.isLoadBalancerNameRegistered=GR;function jR(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in jr)return t;return e&&Sp?new jr[Sp].LoadBalancingConfig:null}Tt.getFirstUsableConfig=jR;function WR(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in jr)return jr[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}Tt.validateLoadBalancingConfig=WR});var wp=M(Kr=>{"use strict";Object.defineProperty(Kr,"__esModule",{value:!0});Kr.extractAndSelectServiceConfig=Kr.validateServiceConfig=Kr.validateRetryThrottling=void 0;var KR=_e("os"),tu=me(),$R=Wr(),nu=/^\d+(\.\d{1,9})?s$/,HR="node";function QR(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function YR(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!nu.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!nu.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(tu.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(tu.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function JR(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!nu.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(tu.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(tu.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function XR(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push(QR(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&nu.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=YR(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=JR(n.hedgingPolicy));return t}function eC(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}Kr.validateRetryThrottling=eC;function tC(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,$R.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(XR(r));"retryThrottling"in n&&(e.retryThrottling=eC(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}Kr.validateServiceConfig=tC;function ZR(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:tC(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function ex(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=ZR(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===KR.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===HR&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function tx(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return ex(i,e)}return null}Kr.extractAndSelectServiceConfig=tx});var on=M(ru=>{"use strict";Object.defineProperty(ru,"__esModule",{value:!0});ru.ConnectivityState=void 0;var nC=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(nC||(ru.ConnectivityState=nC={}))});var Yt=M($r=>{"use strict";Object.defineProperty($r,"__esModule",{value:!0});$r.uriToString=$r.splitHostPort=$r.parseUri=void 0;var nx=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function rx(n){let e=nx.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}$r.parseUri=rx;var rC=/^\d+$/;function ix(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return rC.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?rC.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}$r.splitHostPort=ix;function sx(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}$r.uriToString=sx});var Un=M(an=>{"use strict";Object.defineProperty(an,"__esModule",{value:!0});an.mapUriDefaultScheme=an.getDefaultAuthority=an.createResolver=an.registerDefaultScheme=an.registerResolver=void 0;var Ep=Yt(),Js={},Tp=null;function ox(n,e){Js[n]=e}an.registerResolver=ox;function ax(n){Tp=n}an.registerDefaultScheme=ax;function lx(n,e,t){if(n.scheme!==void 0&&n.scheme in Js)return new Js[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,Ep.uriToString)(n)}`)}an.createResolver=lx;function cx(n){if(n.scheme!==void 0&&n.scheme in Js)return Js[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,Ep.uriToString)(n)}`)}an.getDefaultAuthority=cx;function ux(n){return n.scheme===void 0||!(n.scheme in Js)?Tp!==null?{scheme:Tp,authority:void 0,path:(0,Ep.uriToString)(n)}:null:n}an.mapUriDefaultScheme=ux});var Qr=M(Hr=>{"use strict";Object.defineProperty(Hr,"__esModule",{value:!0});Hr.QueuePicker=Hr.UnavailablePicker=Hr.PickResultType=void 0;var dx=Gt(),hx=me(),iu=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(iu||(Hr.PickResultType=iu={})),Ap=class{constructor(e){this.status=Object.assign({code:hx.Status.UNAVAILABLE,details:"No connection established",metadata:new dx.Metadata},e)}pick(e){return{pickResultType:iu.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};Hr.UnavailablePicker=Ap;var Ip=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:iu.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};Hr.QueuePicker=Ip});var za=M(su=>{"use strict";Object.defineProperty(su,"__esModule",{value:!0});su.BackoffTimeout=void 0;var fx=1e3,px=1.6,mx=12e4,gx=.2;function yx(n,e){return Math.random()*(e-n)+n}var Dp=class{constructor(e,t){this.callback=e,this.initialDelay=fx,this.multiplier=px,this.maxDelay=mx,this.jitter=gx,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+yx(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};su.BackoffTimeout=Dp});var au=M(ou=>{"use strict";Object.defineProperty(ou,"__esModule",{value:!0});ou.ChildLoadBalancerHandler=void 0;var vx=Wr(),_x=on(),bx="child_load_balancer_helper",Mp=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===_x.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,vx.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return bx}};ou.ChildLoadBalancerHandler=Mp});var sC=M(lu=>{"use strict";Object.defineProperty(lu,"__esModule",{value:!0});lu.ResolvingLoadBalancer=void 0;var Cx=Wr(),Sx=wp(),jt=on(),wx=Un(),Xs=Qr(),Tx=za(),Rp=me(),Ex=Gt(),Ax=Ge(),Ix=me(),Dx=Yt(),Mx=au(),Rx="resolving_load_balancer";function iC(n){Ax.trace(Ix.LogVerbosity.DEBUG,Rx,n)}var xx=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function kx(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function Ox(n,e,t,r){for(let i of t)if(kx(n,e,i,r))return i;return null}function Nx(n){return function(t,r){var i,s;let o=t.split("/").filter(c=>c.length>0),a=(i=o[0])!==null&&i!==void 0?i:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of xx){let u=Ox(a,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:Rp.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:Rp.Status.OK,dynamicFilterFactories:[]}}}var xp=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=jt.ConnectivityState.IDLE,this.latestChildPicker=new Xs.QueuePicker(this),this.currentState=jt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,Sx.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(jt.ConnectivityState.IDLE,new Xs.QueuePicker(this)),this.childLoadBalancer=new Mx.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(iC("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,wx.createResolver)(e,{onSuccessfulResolution:(a,l,c,u,d)=>{var f;this.backoffTimeout.stop(),this.backoffTimeout.reset();let v=null;l===null?c===null?(this.previousServiceConfig=null,v=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):v=this.previousServiceConfig:(v=l,this.previousServiceConfig=l);let T=(f=v?.loadBalancingConfig)!==null&&f!==void 0?f:[],A=(0,Cx.getFirstUsableConfig)(T,!0);if(A===null){this.handleResolutionFailure({code:Rp.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new Ex.Metadata});return}this.childLoadBalancer.updateAddressList(a,A,d);let E=v??this.defaultServiceConfig;this.onSuccessfulResolution(E,u??Nx(E))},onError:a=>{this.handleResolutionFailure(a)}},r);let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new Tx.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===jt.ConnectivityState.IDLE&&this.updateState(jt.ConnectivityState.CONNECTING,new Xs.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){iC((0,Dx.uriToString)(this.target)+" "+jt.ConnectivityState[this.currentState]+" -> "+jt.ConnectivityState[e]),e===jt.ConnectivityState.IDLE&&(t=new Xs.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===jt.ConnectivityState.IDLE&&(this.updateState(jt.ConnectivityState.TRANSIENT_FAILURE,new Xs.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===jt.ConnectivityState.IDLE||this.currentState===jt.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=jt.ConnectivityState.IDLE,this.latestChildPicker=new Xs.QueuePicker(this),this.currentState=jt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};lu.ResolvingLoadBalancer=xp});var oC=M(Zs=>{"use strict";Object.defineProperty(Zs,"__esModule",{value:!0});Zs.channelOptionsEqual=Zs.recognizedOptions=void 0;Zs.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function Px(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}Zs.channelOptionsEqual=Px});var Gn=M(zn=>{"use strict";Object.defineProperty(zn,"__esModule",{value:!0});zn.stringToSubchannelAddress=zn.subchannelAddressToString=zn.subchannelAddressEqual=zn.isTcpSubchannelAddress=void 0;var Fx=_e("net");function Ga(n){return"port"in n}zn.isTcpSubchannelAddress=Ga;function Lx(n,e){return!n&&!e?!0:!n||!e?!1:Ga(n)?Ga(e)&&n.host===e.host&&n.port===e.port:!Ga(e)&&n.path===e.path}zn.subchannelAddressEqual=Lx;function Bx(n){return Ga(n)?n.host+":"+n.port:n.path}zn.subchannelAddressToString=Bx;var Vx=443;function qx(n,e){return(0,Fx.isIP)(n)?{host:n,port:e??Vx}:{path:n}}zn.stringToSubchannelAddress=qx});var cu=M(eo=>{"use strict";Object.defineProperty(eo,"__esModule",{value:!0});eo.addAdminServicesToServer=eo.registerAdminService=void 0;var aC=[];function Ux(n,e){aC.push({getServiceDefinition:n,getHandlers:e})}eo.registerAdminService=Ux;function zx(n){for(let{getServiceDefinition:e,getHandlers:t}of aC)n.addService(e(),t())}eo.addAdminServicesToServer=zx});var lC=M(ln=>{"use strict";Object.defineProperty(ln,"__esModule",{value:!0});ln.ClientDuplexStreamImpl=ln.ClientWritableStreamImpl=ln.ClientReadableStreamImpl=ln.ClientUnaryCallImpl=ln.callErrorFromStatus=void 0;var Gx=_e("events"),Fp=_e("stream"),ja=me();function jx(n,e){let t=`${n.code} ${ja.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}ln.callErrorFromStatus=jx;var kp=class extends Gx.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(ja.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};ln.ClientUnaryCallImpl=kp;var Op=class extends Fp.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(ja.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};ln.ClientReadableStreamImpl=Op;var Np=class extends Fp.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(ja.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};ln.ClientWritableStreamImpl=Np;var Pp=class extends Fp.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(ja.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};ln.ClientDuplexStreamImpl=Pp});var cC=M(to=>{"use strict";Object.defineProperty(to,"__esModule",{value:!0});to.InterceptingListenerImpl=to.isInterceptingListener=void 0;function Wx(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}to.isInterceptingListener=Wx;var Lp=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};to.InterceptingListenerImpl=Lp});var jp=M(cn=>{"use strict";Object.defineProperty(cn,"__esModule",{value:!0});cn.getInterceptingCall=cn.InterceptingCall=cn.RequesterBuilder=cn.ListenerBuilder=cn.InterceptorConfigurationError=void 0;var Kx=Gt(),uC=cC(),dC=me(),hC=Hc(),Ka=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};cn.InterceptorConfigurationError=Ka;var Vp=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};cn.ListenerBuilder=Vp;var qp=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};cn.RequesterBuilder=qp;var Bp={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},Wa={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},Up=class{constructor(e,t){var r,i,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:Wa.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:Wa.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:Wa.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:Wa.cancel}:this.requester=Wa}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,o,a,l;let c={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,d)=>{var f,v,T;this.processingMetadata=!1;let A;if((0,uC.isInterceptingListener)(d))A=d;else{let E={onReceiveMetadata:(f=d.onReceiveMetadata)!==null&&f!==void 0?f:Bp.onReceiveMetadata,onReceiveMessage:(v=d.onReceiveMessage)!==null&&v!==void 0?v:Bp.onReceiveMessage,onReceiveStatus:(T=d.onReceiveStatus)!==null&&T!==void 0?T:Bp.onReceiveStatus};A=new uC.InterceptingListenerImpl(E,c)}this.nextCall.start(u,A),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};cn.InterceptingCall=Up;function $x(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,o=t.host,a=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,o,a,l);return c&&u.setCredentials(c),u}var uu=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(dC.Status.INTERNAL,`Request message serialization failure: ${(0,hC.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(i)}catch(a){r={code:dC.Status.INTERNAL,details:`Response message parsing error: ${(0,hC.getErrorMessage)(a)}`,metadata:new Kx.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:i=>{var s,o;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},zp=class extends uu{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,o={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,a)}};super.start(e,o),this.call.startRead()}},Gp=class extends uu{};function Hx(n,e,t){let r=$x(n,t.path,e);return t.responseStream?new Gp(r,t):new zp(r,t)}function Qx(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new Ka("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new Ka("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((a,l)=>c=>l(c,a),a=>Hx(r,a,e))(s)}cn.getInterceptingCall=Qx});var $p=M(hu=>{"use strict";Object.defineProperty(hu,"__esModule",{value:!0});hu.Client=void 0;var jn=lC(),Yx=Hp(),Jx=on(),Yr=me(),no=Gt(),du=jp(),Cn=Symbol(),ro=Symbol(),io=Symbol(),yr=Symbol();function Wp(n){return typeof n=="function"}function so(n){return n.stack.split(`
`).slice(1).join(`
`)}var Kp=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[ro]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[io]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[ro].length>0&&this[io].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[yr]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[Cn]=r.channelOverride;else if(r.channelFactoryOverride){let o=r.channelFactoryOverride;delete r.channelFactoryOverride,this[Cn]=o(e,t,r)}else this[Cn]=new Yx.ChannelImplementation(e,t,r)}close(){this[Cn].close()}getChannel(){return this[Cn]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[Cn].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===Jx.ConnectivityState.READY)t();else try{this[Cn].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(Wp(e))return{metadata:new no.Metadata,options:{},callback:e};if(Wp(t))return e instanceof no.Metadata?{metadata:e,options:{},callback:t}:{metadata:new no.Metadata,options:e,callback:t};if(!(e instanceof no.Metadata&&t instanceof Object&&Wp(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,a){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,o,a),d={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},f={argument:i,metadata:u.metadata,call:new jn.ClientUnaryCallImpl,channel:this[Cn],methodDefinition:d,callOptions:u.options,callback:u.callback};this[yr]&&(f=this[yr](f));let v=f.call,T={clientInterceptors:this[ro],clientInterceptorProviders:this[io],callInterceptors:(l=f.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=f.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},A=(0,du.getInterceptingCall)(T,f.methodDefinition,f.callOptions,f.channel);v.call=A;let E=null,P=!1,D=new Error;return A.start(f.metadata,{onReceiveMetadata:F=>{v.emit("metadata",F)},onReceiveMessage(F){E!==null&&A.cancelWithStatus(Yr.Status.INTERNAL,"Too many responses received"),E=F},onReceiveStatus(F){if(!P){if(P=!0,F.code===Yr.Status.OK)if(E===null){let L=so(D);f.callback((0,jn.callErrorFromStatus)({code:Yr.Status.INTERNAL,details:"No message received",metadata:F.metadata},L))}else f.callback(null,E);else{let L=so(D);f.callback((0,jn.callErrorFromStatus)(F,L))}D=null,v.emit("status",F)}}}),A.sendMessage(i),A.halfClose(),v}makeClientStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkOptionalUnaryResponseArguments(i,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},d={metadata:c.metadata,call:new jn.ClientWritableStreamImpl(t),channel:this[Cn],methodDefinition:u,callOptions:c.options,callback:c.callback};this[yr]&&(d=this[yr](d));let f=d.call,v={clientInterceptors:this[ro],clientInterceptorProviders:this[io],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},T=(0,du.getInterceptingCall)(v,d.methodDefinition,d.callOptions,d.channel);f.call=T;let A=null,E=!1,P=new Error;return T.start(d.metadata,{onReceiveMetadata:D=>{f.emit("metadata",D)},onReceiveMessage(D){A!==null&&T.cancelWithStatus(Yr.Status.INTERNAL,"Too many responses received"),A=D},onReceiveStatus(D){if(!E){if(E=!0,D.code===Yr.Status.OK)if(A===null){let F=so(P);d.callback((0,jn.callErrorFromStatus)({code:Yr.Status.INTERNAL,details:"No message received",metadata:D.metadata},F))}else d.callback(null,A);else{let F=so(P);d.callback((0,jn.callErrorFromStatus)(D,F))}P=null,f.emit("status",D)}}}),f}checkMetadataAndOptions(e,t){let r,i;return e instanceof no.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new no.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},d={argument:i,metadata:c.metadata,call:new jn.ClientReadableStreamImpl(r),channel:this[Cn],methodDefinition:u,callOptions:c.options};this[yr]&&(d=this[yr](d));let f=d.call,v={clientInterceptors:this[ro],clientInterceptorProviders:this[io],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},T=(0,du.getInterceptingCall)(v,d.methodDefinition,d.callOptions,d.channel);f.call=T;let A=!1,E=new Error;return T.start(d.metadata,{onReceiveMetadata(P){f.emit("metadata",P)},onReceiveMessage(P){f.push(P)},onReceiveStatus(P){if(!A){if(A=!0,f.push(null),P.code!==Yr.Status.OK){let D=so(E);f.emit("error",(0,jn.callErrorFromStatus)(P,D))}E=null,f.emit("status",P)}}}),T.sendMessage(i),T.halfClose(),f}makeBidiStreamRequest(e,t,r,i,s){var o,a;let l=this.checkMetadataAndOptions(i,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},u={metadata:l.metadata,call:new jn.ClientDuplexStreamImpl(t,r),channel:this[Cn],methodDefinition:c,callOptions:l.options};this[yr]&&(u=this[yr](u));let d=u.call,f={clientInterceptors:this[ro],clientInterceptorProviders:this[io],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},v=(0,du.getInterceptingCall)(f,u.methodDefinition,u.callOptions,u.channel);d.call=v;let T=!1,A=new Error;return v.start(u.metadata,{onReceiveMetadata(E){d.emit("metadata",E)},onReceiveMessage(E){d.push(E)},onReceiveStatus(E){if(!T){if(T=!0,d.push(null),E.code!==Yr.Status.OK){let P=so(A);d.emit("error",(0,jn.callErrorFromStatus)(E,P))}A=null,d.emit("status",E)}}}),d}};hu.Client=Kp});var Yp=M(oo=>{"use strict";Object.defineProperty(oo,"__esModule",{value:!0});oo.loadPackageDefinition=oo.makeClientConstructor=void 0;var $a=$p(),Xx={unary:$a.Client.prototype.makeUnaryRequest,server_stream:$a.Client.prototype.makeServerStreamRequest,client_stream:$a.Client.prototype.makeClientStreamRequest,bidi:$a.Client.prototype.makeBidiStreamRequest};function Qp(n){return["__proto__","prototype","constructor"].includes(n)}function fC(n,e,t){t||(t={});class r extends $a.Client{}return Object.keys(n).forEach(i=>{if(Qp(i))return;let s=n[i],o;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,c=Zx(Xx[o],s.path,a,l);r.prototype[i]=c,Object.assign(r.prototype[i],s),s.originalName&&!Qp(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}oo.makeClientConstructor=fC;function Zx(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function ek(n){return"format"in n}function tk(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(a=>Qp(a)))continue;let s=i[i.length-1],o=e;for(let a of i.slice(0,-1))o[a]||(o[a]={}),o=o[a];ek(r)?o[s]=r:o[s]=fC(r,s,{})}return e}oo.loadPackageDefinition=tk});var BC=M((tj,LC)=>{"use strict";var nk=1/0,rk="[object Symbol]",ik=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,sk=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,pu="\\ud800-\\udfff",CC="\\u0300-\\u036f\\ufe20-\\ufe23",SC="\\u20d0-\\u20f0",wC="\\u2700-\\u27bf",TC="a-z\\xdf-\\xf6\\xf8-\\xff",ok="\\xac\\xb1\\xd7\\xf7",ak="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",lk="\\u2000-\\u206f",ck=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",EC="A-Z\\xc0-\\xd6\\xd8-\\xde",AC="\\ufe0e\\ufe0f",IC=ok+ak+lk+ck,Xp="['\u2019]",uk="["+pu+"]",pC="["+IC+"]",fu="["+CC+SC+"]",DC="\\d+",dk="["+wC+"]",MC="["+TC+"]",RC="[^"+pu+IC+DC+wC+TC+EC+"]",Jp="\\ud83c[\\udffb-\\udfff]",hk="(?:"+fu+"|"+Jp+")",xC="[^"+pu+"]",Zp="(?:\\ud83c[\\udde6-\\uddff]){2}",em="[\\ud800-\\udbff][\\udc00-\\udfff]",ao="["+EC+"]",kC="\\u200d",mC="(?:"+MC+"|"+RC+")",fk="(?:"+ao+"|"+RC+")",gC="(?:"+Xp+"(?:d|ll|m|re|s|t|ve))?",yC="(?:"+Xp+"(?:D|LL|M|RE|S|T|VE))?",OC=hk+"?",NC="["+AC+"]?",pk="(?:"+kC+"(?:"+[xC,Zp,em].join("|")+")"+NC+OC+")*",PC=NC+OC+pk,mk="(?:"+[dk,Zp,em].join("|")+")"+PC,gk="(?:"+[xC+fu+"?",fu,Zp,em,uk].join("|")+")",yk=RegExp(Xp,"g"),vk=RegExp(fu,"g"),_k=RegExp(Jp+"(?="+Jp+")|"+gk+PC,"g"),bk=RegExp([ao+"?"+MC+"+"+gC+"(?="+[pC,ao,"$"].join("|")+")",fk+"+"+yC+"(?="+[pC,ao+mC,"$"].join("|")+")",ao+"?"+mC+"+"+gC,ao+"+"+yC,DC,mk].join("|"),"g"),Ck=RegExp("["+kC+pu+CC+SC+AC+"]"),Sk=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,wk={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},Tk=typeof global=="object"&&global&&global.Object===Object&&global,Ek=typeof self=="object"&&self&&self.Object===Object&&self,Ak=Tk||Ek||Function("return this")();function Ik(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function Dk(n){return n.split("")}function Mk(n){return n.match(ik)||[]}function Rk(n){return function(e){return n?.[e]}}var xk=Rk(wk);function FC(n){return Ck.test(n)}function kk(n){return Sk.test(n)}function Ok(n){return FC(n)?Nk(n):Dk(n)}function Nk(n){return n.match(_k)||[]}function Pk(n){return n.match(bk)||[]}var Fk=Object.prototype,Lk=Fk.toString,vC=Ak.Symbol,_C=vC?vC.prototype:void 0,bC=_C?_C.toString:void 0;function Bk(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function Vk(n){if(typeof n=="string")return n;if(jk(n))return bC?bC.call(n):"";var e=n+"";return e=="0"&&1/n==-nk?"-0":e}function qk(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:Bk(n,e,t)}function Uk(n){return function(e){e=mu(e);var t=FC(e)?Ok(e):void 0,r=t?t[0]:e.charAt(0),i=t?qk(t,1).join(""):e.slice(1);return r[n]()+i}}function zk(n){return function(e){return Ik(Qk($k(e).replace(yk,"")),n,"")}}function Gk(n){return!!n&&typeof n=="object"}function jk(n){return typeof n=="symbol"||Gk(n)&&Lk.call(n)==rk}function mu(n){return n==null?"":Vk(n)}var Wk=zk(function(n,e,t){return e=e.toLowerCase(),n+(t?Kk(e):e)});function Kk(n){return Hk(mu(n).toLowerCase())}function $k(n){return n=mu(n),n&&n.replace(sk,xk).replace(vk,"")}var Hk=Uk("toUpperCase");function Qk(n,e,t){return n=mu(n),e=t?void 0:e,e===void 0?kk(n)?Pk(n):Mk(n):n.match(e)||[]}LC.exports=Wk});var tm=M((nj,VC)=>{"use strict";VC.exports=Yk;function Yk(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(a,l){t[r]=function(u){if(s)if(s=!1,u)l(u);else{for(var d=new Array(arguments.length-1),f=0;f<d.length;)d[f++]=arguments[f];a.apply(null,d)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var GC=M(zC=>{"use strict";var gu=zC;gu.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var lo=new Array(64),UC=new Array(123);for(Sn=0;Sn<64;)UC[lo[Sn]=Sn<26?Sn+65:Sn<52?Sn+71:Sn<62?Sn-4:Sn-59|43]=Sn++;var Sn;gu.encode=function(e,t,r){for(var i=null,s=[],o=0,a=0,l;t<r;){var c=e[t++];switch(a){case 0:s[o++]=lo[c>>2],l=(c&3)<<4,a=1;break;case 1:s[o++]=lo[l|c>>4],l=(c&15)<<2,a=2;break;case 2:s[o++]=lo[l|c>>6],s[o++]=lo[c&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=lo[l],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var qC="invalid encoding";gu.decode=function(e,t,r){for(var i=r,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=UC[l])===void 0)throw Error(qC);switch(s){case 0:o=l,s=1;break;case 1:t[r++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[r++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[r++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(qC);return r-i};gu.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var WC=M((ij,jC)=>{"use strict";jC.exports=yu;function yu(){this._listeners={}}yu.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};yu.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};yu.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var XC=M((sj,JC)=>{"use strict";JC.exports=KC(KC);function KC(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function a(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=r?o:a,n.readFloatBE=r?a:o}():function(){function e(r,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)r(1/i>0?0:2147483648,s,o);else if(isNaN(i))r(2143289344,s,o);else if(i>34028234663852886e22)r((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)r((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|c)>>>0,s,o)}}n.writeFloatLE=e.bind(null,$C),n.writeFloatBE=e.bind(null,HC);function t(r,i,s){var o=r(i,s),a=(o>>31)*2+1,l=o>>>23&255,c=o&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,QC),n.readFloatBE=t.bind(null,YC)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function a(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=r?o:a,n.readDoubleBE=r?a:o}():function(){function e(r,i,s,o,a,l){var c=o<0?1:0;if(c&&(o=-o),o===0)r(0,a,l+i),r(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))r(0,a,l+i),r(2146959360,a,l+s);else if(o>17976931348623157e292)r(0,a,l+i),r((c<<31|2146435072)>>>0,a,l+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,r(u>>>0,a,l+i),r((c<<31|u/4294967296)>>>0,a,l+s);else{var d=Math.floor(Math.log(o)/Math.LN2);d===1024&&(d=1023),u=o*Math.pow(2,-d),r(u*4503599627370496>>>0,a,l+i),r((c<<31|d+1023<<20|u*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,$C,0,4),n.writeDoubleBE=e.bind(null,HC,4,0);function t(r,i,s,o,a){var l=r(o,a+i),c=r(o,a+s),u=(c>>31)*2+1,d=c>>>20&2047,f=4294967296*(c&1048575)+l;return d===2047?f?NaN:u*(1/0):d===0?u*5e-324*f:u*Math.pow(2,d-1075)*(f+4503599627370496)}n.readDoubleLE=t.bind(null,QC,0,4),n.readDoubleBE=t.bind(null,YC,4,0)}(),n}function $C(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function HC(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function QC(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function YC(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var nm=M((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var eS=M(ZC=>{"use strict";var rm=ZC;rm.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};rm.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,o=[],a=0,l;t<r;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};rm.write=function(e,t,r){for(var i=r,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var nS=M((aj,tS)=>{"use strict";tS.exports=Jk;function Jk(n,e,t){var r=t||8192,i=r>>>1,s=null,o=r;return function(l){if(l<1||l>i)return n(l);o+l>r&&(s=n(r),o=0);var c=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),c}}});var iS=M((lj,rS)=>{"use strict";rS.exports=ct;var Ha=Wn();function ct(n,e){this.lo=n>>>0,this.hi=e>>>0}var Qi=ct.zero=new ct(0,0);Qi.toNumber=function(){return 0};Qi.zzEncode=Qi.zzDecode=function(){return this};Qi.length=function(){return 1};var Xk=ct.zeroHash="\0\0\0\0\0\0\0\0";ct.fromNumber=function(e){if(e===0)return Qi;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new ct(r,i)};ct.from=function(e){if(typeof e=="number")return ct.fromNumber(e);if(Ha.isString(e))if(Ha.Long)e=Ha.Long.fromString(e);else return ct.fromNumber(parseInt(e,10));return e.low||e.high?new ct(e.low>>>0,e.high>>>0):Qi};ct.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};ct.prototype.toLong=function(e){return Ha.Long?new Ha.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var Jr=String.prototype.charCodeAt;ct.fromHash=function(e){return e===Xk?Qi:new ct((Jr.call(e,0)|Jr.call(e,1)<<8|Jr.call(e,2)<<16|Jr.call(e,3)<<24)>>>0,(Jr.call(e,4)|Jr.call(e,5)<<8|Jr.call(e,6)<<16|Jr.call(e,7)<<24)>>>0)};ct.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};ct.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};ct.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};ct.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var Wn=M(im=>{"use strict";var Y=im;Y.asPromise=tm();Y.base64=GC();Y.EventEmitter=WC();Y.float=XC();Y.inquire=nm();Y.utf8=eS();Y.pool=nS();Y.LongBits=iS();Y.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);Y.global=Y.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||im;Y.emptyArray=Object.freeze?Object.freeze([]):[];Y.emptyObject=Object.freeze?Object.freeze({}):{};Y.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Y.isString=function(e){return typeof e=="string"||e instanceof String};Y.isObject=function(e){return e&&typeof e=="object"};Y.isset=Y.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};Y.Buffer=function(){try{var n=Y.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();Y._Buffer_from=null;Y._Buffer_allocUnsafe=null;Y.newBuffer=function(e){return typeof e=="number"?Y.Buffer?Y._Buffer_allocUnsafe(e):new Y.Array(e):Y.Buffer?Y._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};Y.Array=typeof Uint8Array<"u"?Uint8Array:Array;Y.Long=Y.global.dcodeIO&&Y.global.dcodeIO.Long||Y.global.Long||Y.inquire("long");Y.key2Re=/^true|false|0|1$/;Y.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Y.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Y.longToHash=function(e){return e?Y.LongBits.from(e).toHash():Y.LongBits.zeroHash};Y.longFromHash=function(e,t){var r=Y.LongBits.fromHash(e);return Y.Long?Y.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function sS(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}Y.merge=sS;Y.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function oS(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&sS(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}Y.newError=oS;Y.ProtocolError=oS("ProtocolError");Y.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};Y.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};Y.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Y._configure=function(){var n=Y.Buffer;if(!n){Y._Buffer_from=Y._Buffer_allocUnsafe=null;return}Y._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},Y._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var _u=M((uj,uS)=>{"use strict";uS.exports=de;var un=Wn(),sm,vu=un.LongBits,aS=un.base64,lS=un.utf8;function Qa(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function am(){}function Zk(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function de(){this.len=0,this.head=new Qa(am,0,0),this.tail=this.head,this.states=null}var cS=function(){return un.Buffer?function(){return(de.create=function(){return new sm})()}:function(){return new de}};de.create=cS();de.alloc=function(e){return new un.Array(e)};un.Array!==Array&&(de.alloc=un.pool(de.alloc,un.Array.prototype.subarray));de.prototype._push=function(e,t,r){return this.tail=this.tail.next=new Qa(e,t,r),this.len+=t,this};function lm(n,e,t){e[t]=n&255}function eO(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function cm(n,e){this.len=n,this.next=void 0,this.val=e}cm.prototype=Object.create(Qa.prototype);cm.prototype.fn=eO;de.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new cm((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};de.prototype.int32=function(e){return e<0?this._push(um,10,vu.fromNumber(e)):this.uint32(e)};de.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function um(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}de.prototype.uint64=function(e){var t=vu.from(e);return this._push(um,t.length(),t)};de.prototype.int64=de.prototype.uint64;de.prototype.sint64=function(e){var t=vu.from(e).zzEncode();return this._push(um,t.length(),t)};de.prototype.bool=function(e){return this._push(lm,1,e?1:0)};function om(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}de.prototype.fixed32=function(e){return this._push(om,4,e>>>0)};de.prototype.sfixed32=de.prototype.fixed32;de.prototype.fixed64=function(e){var t=vu.from(e);return this._push(om,4,t.lo)._push(om,4,t.hi)};de.prototype.sfixed64=de.prototype.fixed64;de.prototype.float=function(e){return this._push(un.float.writeFloatLE,4,e)};de.prototype.double=function(e){return this._push(un.float.writeDoubleLE,8,e)};var tO=un.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};de.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(lm,1,0);if(un.isString(e)){var r=de.alloc(t=aS.length(e));aS.decode(e,r,0),e=r}return this.uint32(t)._push(tO,t,e)};de.prototype.string=function(e){var t=lS.length(e);return t?this.uint32(t)._push(lS.write,t,e):this._push(lm,1,0)};de.prototype.fork=function(){return this.states=new Zk(this),this.head=this.tail=new Qa(am,0,0),this.len=0,this};de.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Qa(am,0,0),this.len=0),this};de.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};de.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};de._configure=function(n){sm=n,de.create=cS(),sm._configure()}});var fS=M((dj,hS)=>{"use strict";hS.exports=Kn;var dS=_u();(Kn.prototype=Object.create(dS.prototype)).constructor=Kn;var Xr=Wn();function Kn(){dS.call(this)}Kn._configure=function(){Kn.alloc=Xr._Buffer_allocUnsafe,Kn.writeBytesBuffer=Xr.Buffer&&Xr.Buffer.prototype instanceof Uint8Array&&Xr.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};Kn.prototype.bytes=function(e){Xr.isString(e)&&(e=Xr._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Kn.writeBytesBuffer,t,e),this};function nO(n,e,t){n.length<40?Xr.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}Kn.prototype.string=function(e){var t=Xr.Buffer.byteLength(e);return this.uint32(t),t&&this._push(nO,t,e),this};Kn._configure()});var Cu=M((hj,vS)=>{"use strict";vS.exports=He;var wn=Wn(),hm,gS=wn.LongBits,rO=wn.utf8;function Tn(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function He(n){this.buf=n,this.pos=0,this.len=n.length}var pS=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new He(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new He(e);throw Error("illegal buffer")},yS=function(){return wn.Buffer?function(t){return(He.create=function(i){return wn.Buffer.isBuffer(i)?new hm(i):pS(i)})(t)}:pS};He.create=yS();He.prototype._slice=wn.Array.prototype.subarray||wn.Array.prototype.slice;He.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Tn(this,10);return e}}();He.prototype.int32=function(){return this.uint32()|0};He.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function dm(){var n=new gS(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Tn(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw Tn(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}He.prototype.bool=function(){return this.uint32()!==0};function bu(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}He.prototype.fixed32=function(){if(this.pos+4>this.len)throw Tn(this,4);return bu(this.buf,this.pos+=4)};He.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Tn(this,4);return bu(this.buf,this.pos+=4)|0};function mS(){if(this.pos+8>this.len)throw Tn(this,8);return new gS(bu(this.buf,this.pos+=4),bu(this.buf,this.pos+=4))}He.prototype.float=function(){if(this.pos+4>this.len)throw Tn(this,4);var e=wn.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};He.prototype.double=function(){if(this.pos+8>this.len)throw Tn(this,4);var e=wn.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};He.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw Tn(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=wn.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};He.prototype.string=function(){var e=this.bytes();return rO.read(e,0,e.length)};He.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Tn(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Tn(this);while(this.buf[this.pos++]&128);return this};He.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};He._configure=function(n){hm=n,He.create=yS(),hm._configure();var e=wn.Long?"toLong":"toNumber";wn.merge(He.prototype,{int64:function(){return dm.call(this)[e](!1)},uint64:function(){return dm.call(this)[e](!0)},sint64:function(){return dm.call(this).zzDecode()[e](!1)},fixed64:function(){return mS.call(this)[e](!0)},sfixed64:function(){return mS.call(this)[e](!1)}})}});var SS=M((fj,CS)=>{"use strict";CS.exports=Yi;var bS=Cu();(Yi.prototype=Object.create(bS.prototype)).constructor=Yi;var _S=Wn();function Yi(n){bS.call(this,n)}Yi._configure=function(){_S.Buffer&&(Yi.prototype._slice=_S.Buffer.prototype.slice)};Yi.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Yi._configure()});var TS=M((pj,wS)=>{"use strict";wS.exports=Ya;var fm=Wn();(Ya.prototype=Object.create(fm.EventEmitter.prototype)).constructor=Ya;function Ya(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");fm.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}Ya.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return fm.asPromise(n,o,e,t,r,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,c){if(l)return o.emit("error",l,e),s(l);if(c===null){o.end(!0);return}if(!(c instanceof r))try{c=r[o.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",c,e),s(null,c)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};Ya.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var pm=M(ES=>{"use strict";var iO=ES;iO.Service=TS()});var mm=M((gj,AS)=>{"use strict";AS.exports={}});var MS=M(DS=>{"use strict";var Wt=DS;Wt.build="minimal";Wt.Writer=_u();Wt.BufferWriter=fS();Wt.Reader=Cu();Wt.BufferReader=SS();Wt.util=Wn();Wt.rpc=pm();Wt.roots=mm();Wt.configure=IS;function IS(){Wt.util._configure(),Wt.Writer._configure(Wt.BufferWriter),Wt.Reader._configure(Wt.BufferReader)}IS()});var xS=M((vj,RS)=>{"use strict";RS.exports=gm;function gm(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var o=i();if(gm.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)l[u]=a[u],c[u]=s[a[u++]];return l[u]=o,Function.apply(null,l).apply(null,c)}return Function(o)()}for(var d=new Array(arguments.length-1),f=0;f<d.length;)d[f]=arguments[++f];if(f=0,s=s.replace(/%([%dfijs])/g,function(T,A){var E=d[f++];switch(A){case"d":case"f":return String(Number(E));case"i":return String(Math.floor(E));case"j":return JSON.stringify(E);case"s":return String(E)}return"%"}),f!==d.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}gm.verbose=!1});var OS=M((_j,kS)=>{"use strict";kS.exports=Ja;var sO=tm(),oO=nm(),ym=oO("fs");function Ja(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&ym&&ym.readFile?ym.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?Ja.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):Ja.xhr(n,e,t):sO(Ja,this,n,e)}Ja.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var o=i.response;if(!o){o=[];for(var a=0;a<i.responseText.length;++a)o.push(i.responseText.charCodeAt(a)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var FS=M(PS=>{"use strict";var _m=PS,NS=_m.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},vm=_m.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=NS(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};_m.resolve=function(e,t,r){return r||(t=vm(t)),NS(t)?t:(r||(e=vm(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?vm(e+"/"+t):t)}});var Ji=M(LS=>{"use strict";var Xa=LS,aO=ut(),lO=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function Za(n,e){var t=0,r={};for(e|=0;t<n.length;)r[lO[t+e]]=n[t++];return r}Xa.basic=Za([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);Xa.defaults=Za([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",aO.emptyArray,null]);Xa.long=Za([0,0,0,1,1],7);Xa.mapKey=Za([0,0,0,5,5,0,0,0,1,1,0,2],2);Xa.packed=Za([1,5,0,0,0,5,5,0,0,0,1,1,0])});var Zr=M((Sj,qS)=>{"use strict";qS.exports=dn;var Su=Xi();((dn.prototype=Object.create(Su.prototype)).constructor=dn).className="Field";var BS=En(),VS=Ji(),tt=ut(),bm,cO=/^required|optional|repeated$/;dn.fromJSON=function(e,t){return new dn(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function dn(n,e,t,r,i,s,o){if(tt.isObject(r)?(o=i,s=r,r=i=void 0):tt.isObject(i)&&(o=s,s=i,i=void 0),Su.call(this,n,s),!tt.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!tt.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!cO.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!tt.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.required=r==="required",this.optional=!this.required,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=tt.Long?VS.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}Object.defineProperty(dn.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});dn.prototype.setOption=function(e,t,r){return e==="packed"&&(this._packed=null),Su.prototype.setOption.call(this,e,t,r)};dn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return tt.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};dn.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=VS.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof bm?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof BS&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof BS))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=tt.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;tt.base64.test(this.typeDefault)?tt.base64.decode(this.typeDefault,e=tt.newBuffer(tt.base64.length(this.typeDefault)),0):tt.utf8.write(this.typeDefault,e=tt.newBuffer(tt.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=tt.emptyObject:this.repeated?this.defaultValue=tt.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof bm&&(this.parent.ctor.prototype[this.name]=this.defaultValue),Su.prototype.resolve.call(this)};dn.d=function(e,t,r,i){return typeof t=="function"?t=tt.decorateType(t).name:t&&typeof t=="object"&&(t=tt.decorateEnum(t).name),function(o,a){tt.decorateType(o.constructor).add(new dn(a,e,t,r,{default:i}))}};dn._configure=function(e){bm=e}});var co=M((wj,GS)=>{"use strict";GS.exports=hn;var Tu=Xi();((hn.prototype=Object.create(Tu.prototype)).constructor=hn).className="OneOf";var US=Zr(),wu=ut();function hn(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),Tu.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}hn.fromJSON=function(e,t){return new hn(e,t.oneof,t.options,t.comment)};hn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return wu.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function zS(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}hn.prototype.add=function(e){if(!(e instanceof US))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,zS(this),this};hn.prototype.remove=function(e){if(!(e instanceof US))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};hn.prototype.onAdd=function(e){Tu.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}zS(this)};hn.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);Tu.prototype.onRemove.call(this,e)};hn.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){wu.decorateType(i.constructor).add(new hn(s,e)),Object.defineProperty(i,s,{get:wu.oneOfGetter(e),set:wu.oneOfSetter(e)})}}});var fo=M((Tj,$S)=>{"use strict";$S.exports=fe;var Cm=Xi();((fe.prototype=Object.create(Cm.prototype)).constructor=fe).className="Namespace";var jS=Zr(),Eu=ut(),uO=co(),uo,el,ho;fe.fromJSON=function(e,t){return new fe(e,t.options).addJSON(t.nested)};function WS(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}fe.arrayToJSON=WS;fe.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};fe.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function fe(n,e){Cm.call(this,n,e),this.nested=void 0,this._nestedArray=null}function KS(n){return n._nestedArray=null,n}Object.defineProperty(fe.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=Eu.toArray(this.nested))}});fe.prototype.toJSON=function(e){return Eu.toObject(["options",this.options,"nested",WS(this.nestedArray,e)])};fe.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?uo.fromJSON:s.values!==void 0?ho.fromJSON:s.methods!==void 0?el.fromJSON:s.id!==void 0?jS.fromJSON:fe.fromJSON)(r[i],s));return this};fe.prototype.get=function(e){return this.nested&&this.nested[e]||null};fe.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof ho)return this.nested[e].values;throw Error("no such enum: "+e)};fe.prototype.add=function(e){if(!(e instanceof jS&&e.extend!==void 0||e instanceof uo||e instanceof uO||e instanceof ho||e instanceof el||e instanceof fe))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof fe&&e instanceof fe&&!(t instanceof uo||t instanceof el)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),KS(this)};fe.prototype.remove=function(e){if(!(e instanceof Cm))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),KS(this)};fe.prototype.define=function(e,t){if(Eu.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof fe))throw Error("path conflicts with non-namespace objects")}else r.add(r=new fe(i))}return t&&r.addJSON(t),r};fe.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof fe?e[t++].resolveAll():e[t++].resolve();return this.resolve()};fe.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),Eu.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(e.length===1){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof fe&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof fe&&(i=this._nestedArray[s].lookup(e,t,!0)))return i;return this.parent===null||r?null:this.parent.lookup(e,t)};fe.prototype.lookupType=function(e){var t=this.lookup(e,[uo]);if(!t)throw Error("no such type: "+e);return t};fe.prototype.lookupEnum=function(e){var t=this.lookup(e,[ho]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};fe.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[uo,ho]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};fe.prototype.lookupService=function(e){var t=this.lookup(e,[el]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};fe._configure=function(n,e,t){uo=n,el=e,ho=t}});var Au=M((Ej,HS)=>{"use strict";HS.exports=vr;var Sm=Zr();((vr.prototype=Object.create(Sm.prototype)).constructor=vr).className="MapField";var dO=Ji(),tl=ut();function vr(n,e,t,r,i,s){if(Sm.call(this,n,e,r,void 0,void 0,i,s),!tl.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}vr.fromJSON=function(e,t){return new vr(e,t.id,t.keyType,t.type,t.options,t.comment)};vr.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return tl.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};vr.prototype.resolve=function(){if(this.resolved)return this;if(dO.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return Sm.prototype.resolve.call(this)};vr.d=function(e,t,r){return typeof r=="function"?r=tl.decorateType(r).name:r&&typeof r=="object"&&(r=tl.decorateEnum(r).name),function(s,o){tl.decorateType(s.constructor).add(new vr(o,e,t,r))}}});var Iu=M((Aj,QS)=>{"use strict";QS.exports=Zi;var wm=Xi();((Zi.prototype=Object.create(wm.prototype)).constructor=Zi).className="Method";var po=ut();function Zi(n,e,t,r,i,s,o,a,l){if(po.isObject(i)?(o=i,i=s=void 0):po.isObject(s)&&(o=s,s=void 0),!(e===void 0||po.isString(e)))throw TypeError("type must be a string");if(!po.isString(t))throw TypeError("requestType must be a string");if(!po.isString(r))throw TypeError("responseType must be a string");wm.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}Zi.fromJSON=function(e,t){return new Zi(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};Zi.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return po.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};Zi.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),wm.prototype.resolve.call(this))}});var Du=M((Ij,JS)=>{"use strict";JS.exports=fn;var ei=fo();((fn.prototype=Object.create(ei.prototype)).constructor=fn).className="Service";var Tm=Iu(),nl=ut(),hO=pm();function fn(n,e){ei.call(this,n,e),this.methods={},this._methodsArray=null}fn.fromJSON=function(e,t){var r=new fn(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(Tm.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r};fn.prototype.toJSON=function(e){var t=ei.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return nl.toObject(["options",t&&t.options||void 0,"methods",ei.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(fn.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=nl.toArray(this.methods))}});function YS(n){return n._methodsArray=null,n}fn.prototype.get=function(e){return this.methods[e]||ei.prototype.get.call(this,e)};fn.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return ei.prototype.resolve.call(this)};fn.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof Tm?(this.methods[e.name]=e,e.parent=this,YS(this)):ei.prototype.add.call(this,e)};fn.prototype.remove=function(e){if(e instanceof Tm){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,YS(this)}return ei.prototype.remove.call(this,e)};fn.prototype.create=function(e,t,r){for(var i=new hO.Service(e,t,r),s=0,o;s<this.methodsArray.length;++s){var a=nl.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[a]=nl.codegen(["r","c"],nl.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return i}});var Mu=M((Dj,XS)=>{"use strict";XS.exports=$n;var fO=Wn();function $n(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}$n.create=function(e){return this.$type.create(e)};$n.encode=function(e,t){return this.$type.encode(e,t)};$n.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};$n.decode=function(e){return this.$type.decode(e)};$n.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};$n.verify=function(e){return this.$type.verify(e)};$n.fromObject=function(e){return this.$type.fromObject(e)};$n.toObject=function(e,t){return this.$type.toObject(e,t)};$n.prototype.toJSON=function(){return this.$type.toObject(this,fO.toJSONOptions)}});var Em=M((Mj,ew)=>{"use strict";ew.exports=gO;var pO=En(),_r=Ji(),ZS=ut();function mO(n){return"missing required '"+n.name+"'"}function gO(n){var e=ZS.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof pO?"int32":r.type,s="m"+ZS.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),_r.defaults[r.keyType]!==void 0?e("k=%j",_r.defaults[r.keyType]):e("k=null"),_r.defaults[i]!==void 0?e("value=%j",_r.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),_r.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),_r.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),_r.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),_r.basic[i]===void 0?e(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):_r.basic[i]===void 0?e(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",mO(o))}return e("return m")}});var Dm=M((Rj,tw)=>{"use strict";tw.exports=_O;var yO=En(),Am=ut();function pn(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function Im(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof yO){n("switch(%s){",r)("default:")("return%j",pn(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",pn(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",pn(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",pn(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",pn(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",pn(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",pn(e,"buffer"));break}return n}function vO(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",pn(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",pn(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",pn(e,"boolean key"));break}return n}function _O(n){var e=Am.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),o="m"+Am.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",pn(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),vO(e,s,"k[i]"),Im(e,s,i,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",pn(s,"array"))("for(var i=0;i<%s.length;++i){",o),Im(e,s,i,o+"[i]")("}");else{if(s.partOf){var a=Am.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",a)}Im(e,s,i,o)}s.optional&&e("}")}return e("return null")}});var xm=M(rw=>{"use strict";var nw=rw,rl=En(),Hn=ut();function Mm(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof rl){n("switch(d%s){",r);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}nw.fromObject=function(e){var t=e.fieldsArray,r=Hn.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),o=Hn.safeProp(s.name);s.map?(r("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),Mm(r,s,i,o+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),Mm(r,s,i,o+"[i]")("}")("}")):(s.resolvedType instanceof rl||r("if(d%s!=null){",o),Mm(r,s,i,o),s.resolvedType instanceof rl||r("}"))}return r("return m")};function Rm(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof rl?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}nw.toObject=function(e){var t=e.fieldsArray.slice().sort(Hn.compareFieldsById);if(!t.length)return Hn.codegen()("return {}");for(var r=Hn.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?i:t[a].map?s:o).push(t[a]);if(i.length){for(r("if(o.arrays||o.defaults){"),a=0;a<i.length;++a)r("d%s=[]",Hn.safeProp(i[a].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),a=0;a<s.length;++a)r("d%s={}",Hn.safeProp(s[a].name));r("}")}if(o.length){for(r("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],c=Hn.safeProp(l.name);if(l.resolvedType instanceof rl)r("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,l.typeDefault)}r("}")}var d=!1;for(a=0;a<t.length;++a){var l=t[a],f=e._fieldsArray.indexOf(l),c=Hn.safeProp(l.name);l.map?(d||(d=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),Rm(r,l,f,c+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),Rm(r,l,f,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),Rm(r,l,f,c),l.partOf&&r("if(o.oneofs)")("d%s=%j",Hn.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var km=M(iw=>{"use strict";var bO=iw,CO=Mu();bO[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof CO){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+a,o["@type"]=i,o}return this.toObject(n,e)}}});var ku=M((Oj,ow)=>{"use strict";ow.exports=Ae;var An=fo();((Ae.prototype=Object.create(An.prototype)).constructor=Ae).className="Type";var SO=En(),Pm=co(),Ru=Zr(),wO=Au(),TO=Du(),Om=Mu(),Nm=Cu(),EO=_u(),Et=ut(),AO=Fm(),IO=Em(),DO=Dm(),sw=xm(),MO=km();function Ae(n,e){An.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(Ae.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=Et.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=Et.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=Ae.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof Om||((n.prototype=new Om).constructor=n,Et.merge(n.prototype,e)),n.$type=n.prototype.$type=this,Et.merge(n,Om,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:Et.oneOfGetter(this._oneofsArray[t].oneof),set:Et.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});Ae.generateConstructor=function(e){for(var t=Et.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",Et.safeProp(i.name)):i.repeated&&t("this%s=[]",Et.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function xu(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}Ae.fromJSON=function(e,t){var r=new Ae(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?wO.fromJSON:Ru.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add(Pm.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var o=t.nested[i[s]];r.add((o.id!==void 0?Ru.fromJSON:o.fields!==void 0?Ae.fromJSON:o.values!==void 0?SO.fromJSON:o.methods!==void 0?TO.fromJSON:An.fromJSON)(i[s],o))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r};Ae.prototype.toJSON=function(e){var t=An.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return Et.toObject(["options",t&&t.options||void 0,"oneofs",An.arrayToJSON(this.oneofsArray,e),"fields",An.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Ae.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return An.prototype.resolveAll.call(this)};Ae.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};Ae.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof Ru&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),xu(this)}return e instanceof Pm?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),xu(this)):An.prototype.add.call(this,e)};Ae.prototype.remove=function(e){if(e instanceof Ru&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),xu(this)}if(e instanceof Pm){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),xu(this)}return An.prototype.remove.call(this,e)};Ae.prototype.isReservedId=function(e){return An.isReservedId(this.reserved,e)};Ae.prototype.isReservedName=function(e){return An.isReservedName(this.reserved,e)};Ae.prototype.create=function(e){return new this.ctor(e)};Ae.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=AO(this)({Writer:EO,types:t,util:Et}),this.decode=IO(this)({Reader:Nm,types:t,util:Et}),this.verify=DO(this)({types:t,util:Et}),this.fromObject=sw.fromObject(this)({types:t,util:Et}),this.toObject=sw.toObject(this)({types:t,util:Et});var i=MO[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};Ae.prototype.encode=function(e,t){return this.setup().encode(e,t)};Ae.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};Ae.prototype.decode=function(e,t){return this.setup().decode(e,t)};Ae.prototype.decodeDelimited=function(e){return e instanceof Nm||(e=Nm.create(e)),this.decode(e,e.uint32())};Ae.prototype.verify=function(e){return this.setup().verify(e)};Ae.prototype.fromObject=function(e){return this.setup().fromObject(e)};Ae.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};Ae.d=function(e){return function(r){Et.decorateType(r,e)}}});var Pu=M((Nj,dw)=>{"use strict";dw.exports=Jt;var Nu=fo();((Jt.prototype=Object.create(Nu.prototype)).constructor=Jt).className="Root";var Bm=Zr(),lw=En(),RO=co(),ti=ut(),cw,Lm,il;function Jt(n){Nu.call(this,"",n),this.deferred=[],this.files=[]}Jt.fromJSON=function(e,t){return t||(t=new Jt),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};Jt.prototype.resolvePath=ti.path.resolve;Jt.prototype.fetch=ti.fetch;function uw(){}Jt.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return ti.asPromise(n,i,e,t);var s=r===uw;function o(v,T){if(r){if(s)throw v;var A=r;r=null,A(v,T)}}function a(v){var T=v.lastIndexOf("google/protobuf/");if(T>-1){var A=v.substring(T);if(A in il)return A}return null}function l(v,T){try{if(ti.isString(T)&&T.charAt(0)==="{"&&(T=JSON.parse(T)),!ti.isString(T))i.setOptions(T.options).addJSON(T.nested);else{Lm.filename=v;var A=Lm(T,i,t),E,P=0;if(A.imports)for(;P<A.imports.length;++P)(E=a(A.imports[P])||i.resolvePath(v,A.imports[P]))&&c(E);if(A.weakImports)for(P=0;P<A.weakImports.length;++P)(E=a(A.weakImports[P])||i.resolvePath(v,A.weakImports[P]))&&c(E,!0)}}catch(D){o(D)}!s&&!u&&o(null,i)}function c(v,T){if(v=a(v)||v,!(i.files.indexOf(v)>-1)){if(i.files.push(v),v in il){s?l(v,il[v]):(++u,setTimeout(function(){--u,l(v,il[v])}));return}if(s){var A;try{A=ti.fs.readFileSync(v).toString("utf8")}catch(E){T||o(E);return}l(v,A)}else++u,i.fetch(v,function(E,P){if(--u,!!r){if(E){T?u||o(null,i):o(E);return}l(v,P)}})}}var u=0;ti.isString(e)&&(e=[e]);for(var d=0,f;d<e.length;++d)(f=i.resolvePath("",e[d]))&&c(f);if(s)return i;u||o(null,i)};Jt.prototype.loadSync=function(e,t){if(!ti.isNode)throw Error("not supported");return this.load(e,t,uw)};Jt.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return Nu.prototype.resolveAll.call(this)};var Ou=/^[A-Z]/;function aw(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new Bm(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}Jt.prototype._handleAdd=function(e){if(e instanceof Bm)e.extend!==void 0&&!e.extensionField&&(aw(this,e)||this.deferred.push(e));else if(e instanceof lw)Ou.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof RO)){if(e instanceof cw)for(var t=0;t<this.deferred.length;)aw(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);Ou.test(e.name)&&(e.parent[e.name]=e)}};Jt.prototype._handleRemove=function(e){if(e instanceof Bm){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof lw)Ou.test(e.name)&&delete e.parent[e.name];else if(e instanceof Nu){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);Ou.test(e.name)&&delete e.parent[e.name]}};Jt._configure=function(n,e,t){cw=n,Lm=e,il=t}});var ut=M((Pj,fw)=>{"use strict";var Qe=fw.exports=Wn(),hw=mm(),Vm,qm;Qe.codegen=xS();Qe.fetch=OS();Qe.path=FS();Qe.fs=Qe.inquire("fs");Qe.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};Qe.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var xO=/\\/g,kO=/"/g;Qe.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};Qe.safeProp=function(e){return!/^[$\w_]+$/.test(e)||Qe.isReserved(e)?'["'+e.replace(xO,"\\\\").replace(kO,'\\"')+'"]':"."+e};Qe.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var OO=/_([a-z])/g;Qe.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(OO,function(t,r){return r.toUpperCase()})};Qe.compareFieldsById=function(e,t){return e.id-t.id};Qe.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(Qe.decorateRoot.remove(e.$type),e.$type.name=t,Qe.decorateRoot.add(e.$type)),e.$type;Vm||(Vm=ku());var r=new Vm(t||e.name);return Qe.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var NO=0;Qe.decorateEnum=function(e){if(e.$type)return e.$type;qm||(qm=En());var t=new qm("Enum"+NO++,e);return Qe.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};Qe.setProperty=function(e,t,r){function i(s,o,a){var l=o.shift();if(l==="__proto__"||l==="prototype")return s;if(o.length>0)s[l]=i(s[l]||{},o,a);else{var c=s[l];c&&(a=[].concat(c).concat(a)),s[l]=a}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),i(e,t,r)};Object.defineProperty(Qe,"decorateRoot",{get:function(){return hw.decorated||(hw.decorated=new(Pu()))}})});var Xi=M((Fj,pw)=>{"use strict";pw.exports=Xt;Xt.className="ReflectionObject";var Fu=ut(),Lu;function Xt(n,e){if(!Fu.isString(n))throw TypeError("name must be a string");if(e&&!Fu.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(Xt.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});Xt.prototype.toJSON=function(){throw Error()};Xt.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Lu&&t._handleAdd(this)};Xt.prototype.onRemove=function(e){var t=e.root;t instanceof Lu&&t._handleRemove(this),this.parent=null,this.resolved=!1};Xt.prototype.resolve=function(){return this.resolved?this:(this.root instanceof Lu&&(this.resolved=!0),this)};Xt.prototype.getOption=function(e){if(this.options)return this.options[e]};Xt.prototype.setOption=function(e,t,r){return(!r||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};Xt.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];Fu.setProperty(o,r,t)}else s={},s[e]=Fu.setProperty({},r,t),i.push(s)}else{var a={};a[e]=t,i.push(a)}return this};Xt.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};Xt.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};Xt._configure=function(n){Lu=n}});var En=M((Lj,yw)=>{"use strict";yw.exports=Qn;var mw=Xi();((Qn.prototype=Object.create(mw.prototype)).constructor=Qn).className="Enum";var gw=fo(),Bu=ut();function Qn(n,e,t,r,i,s){if(mw.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}Qn.fromJSON=function(e,t){var r=new Qn(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r};Qn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Bu.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};Qn.prototype.add=function(e,t,r,i){if(!Bu.isString(e))throw TypeError("name must be a string");if(!Bu.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};Qn.prototype.remove=function(e){if(!Bu.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};Qn.prototype.isReservedId=function(e){return gw.isReservedId(this.reserved,e)};Qn.prototype.isReservedName=function(e){return gw.isReservedName(this.reserved,e)}});var Fm=M((Bj,_w)=>{"use strict";_w.exports=FO;var PO=En(),Um=Ji(),zm=ut();function vw(n,e,t,r){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function FO(n){for(var e=zm.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(zm.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof PO?"int32":s.type,l=Um.basic[a];r="m"+zm.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|Um.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&Um.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",a,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?vw(e,s,o,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?vw(e,s,o,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,r))}return e("return w")}});var Cw=M((Vj,bw)=>{"use strict";var le=bw.exports=MS();le.build="light";function LO(n,e,t){return typeof e=="function"?(t=e,e=new le.Root):e||(e=new le.Root),e.load(n,t)}le.load=LO;function BO(n,e){return e||(e=new le.Root),e.loadSync(n)}le.loadSync=BO;le.encoder=Fm();le.decoder=Em();le.verifier=Dm();le.converter=xm();le.ReflectionObject=Xi();le.Namespace=fo();le.Root=Pu();le.Enum=En();le.Type=ku();le.Field=Zr();le.OneOf=co();le.MapField=Au();le.Service=Du();le.Method=Iu();le.Message=Mu();le.wrappers=km();le.types=Ji();le.util=ut();le.ReflectionObject._configure(le.Root);le.Namespace._configure(le.Type,le.Service,le.Enum);le.Root._configure(le.Type);le.Field._configure(le.Type)});var jm=M((qj,Tw)=>{"use strict";Tw.exports=ww;var Gm=/[\s{}=;:[\],'"()<>]/g,VO=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,qO=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,UO=/^ *[*/]+ */,zO=/^\s*\*?\/*/,GO=/\n/g,jO=/\s/,WO=/\\(.?)/g,KO={0:"\0",r:"\r",n:`
`,t:"	"};function Sw(n){return n.replace(WO,function(e,t){switch(t){case"\\":case"":return t;default:return KO[t]||""}})}ww.unescape=Sw;function ww(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,o={},a=[],l=null;function c(L){return Error("illegal "+L+" (line "+i+")")}function u(){var L=l==="'"?qO:VO;L.lastIndex=t-1;var W=L.exec(n);if(!W)throw c("string");return t=L.lastIndex,E(l),l=null,Sw(W[1])}function d(L){return n.charAt(L)}function f(L,W,Z){var b={type:n.charAt(L++),lineEmpty:!1,leading:Z},g;e?g=2:g=3;var y=L-g,_;do if(--y<0||(_=n.charAt(y))===`
`){b.lineEmpty=!0;break}while(_===" "||_==="	");for(var p=n.substring(L,W).split(GO),C=0;C<p.length;++C)p[C]=p[C].replace(e?zO:UO,"").trim();b.text=p.join(`
`).trim(),o[i]=b,s=i}function v(L){var W=T(L),Z=n.substring(L,W),b=/^\s*\/\//.test(Z);return b}function T(L){for(var W=L;W<r&&d(W)!==`
`;)W++;return W}function A(){if(a.length>0)return a.shift();if(l)return u();var L,W,Z,b,g,y=t===0;do{if(t===r)return null;for(L=!1;jO.test(Z=d(t));)if(Z===`
`&&(y=!0,++i),++t===r)return null;if(d(t)==="/"){if(++t===r)throw c("comment");if(d(t)==="/")if(e){if(b=t,g=!1,v(t-1)){g=!0;do if(t=T(t),t===r||(t++,!y))break;while(v(t))}else t=Math.min(r,T(t)+1);g&&(f(b,t,y),y=!0),i++,L=!0}else{for(g=d(b=t+1)==="/";d(++t)!==`
`;)if(t===r)return null;++t,g&&(f(b,t-1,y),y=!0),++i,L=!0}else if((Z=d(t))==="*"){b=t+1,g=e||d(b)==="*";do{if(Z===`
`&&++i,++t===r)throw c("comment");W=Z,Z=d(t)}while(W!=="*"||Z!=="/");++t,g&&(f(b,t-2,y),y=!0),L=!0}else return"/"}}while(L);var _=t;Gm.lastIndex=0;var p=Gm.test(d(_++));if(!p)for(;_<r&&!Gm.test(d(_));)++_;var C=n.substring(t,t=_);return(C==='"'||C==="'")&&(l=C),C}function E(L){a.push(L)}function P(){if(!a.length){var L=A();if(L===null)return null;E(L)}return a[0]}function D(L,W){var Z=P(),b=Z===L;if(b)return A(),!0;if(!W)throw c("token '"+Z+"', '"+L+"' expected");return!1}function F(L){var W=null,Z;return L===void 0?(Z=o[i-1],delete o[i-1],Z&&(e||Z.type==="*"||Z.lineEmpty)&&(W=Z.leading?Z.text:null)):(s<L&&P(),Z=o[L],delete o[L],Z&&!Z.lineEmpty&&(e||Z.type==="/")&&(W=Z.leading?null:Z.text)),W}return Object.defineProperty({next:A,peek:P,push:E,skip:D,cmnt:F},"line",{get:function(){return i}})}});var Rw=M((Uj,Mw)=>{"use strict";Mw.exports=br;br.filename=null;br.defaults={keepCase:!1};var $O=jm(),Ew=Pu(),Aw=ku(),Iw=Zr(),HO=Au(),Dw=co(),QO=En(),YO=Du(),JO=Iu(),Wm=Ji(),Km=ut(),XO=/^[1-9][0-9]*$/,ZO=/^-?[1-9][0-9]*$/,eN=/^0[x][0-9a-fA-F]+$/,tN=/^-?0[x][0-9a-fA-F]+$/,nN=/^0[0-7]+$/,rN=/^-?0[0-7]+$/,iN=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,Yn=/^[a-zA-Z_][a-zA-Z_0-9]*$/,Jn=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,sN=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function br(n,e,t){e instanceof Ew||(t=e,e=new Ew),t||(t=br.defaults);var r=t.preferTrailingComment||!1,i=$O(n,t.alternateCommentMode||!1),s=i.next,o=i.push,a=i.peek,l=i.skip,c=i.cmnt,u=!0,d,f,v,T,A=!1,E=e,P=t.keepCase?function(x){return x}:Km.camelCase;function D(x,k,V){var X=br.filename;return V||(br.filename=null),Error("illegal "+(k||"token")+" '"+x+"' ("+(X?X+", ":"")+"line "+i.line+")")}function F(){var x=[],k;do{if((k=s())!=='"'&&k!=="'")throw D(k);x.push(s()),l(k),k=a()}while(k==='"'||k==="'");return x.join("")}function L(x){var k=s();switch(k){case"'":case'"':return o(k),F();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return Z(k,!0)}catch{if(x&&Jn.test(k))return k;throw D(k,"value")}}function W(x,k){var V,X;do k&&((V=a())==='"'||V==="'")?x.push(F()):x.push([X=b(s()),l("to",!0)?b(s()):X]);while(l(",",!0));var Q={options:void 0};Q.setOption=function(ie,Pe){this.options===void 0&&(this.options={}),this.options[ie]=Pe},C(Q,function(Pe){if(Pe==="option")Ee(Q,Pe),l(";");else throw D(Pe)},function(){ft(Q)})}function Z(x,k){var V=1;switch(x.charAt(0)==="-"&&(V=-1,x=x.substring(1)),x){case"inf":case"INF":case"Inf":return V*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(XO.test(x))return V*parseInt(x,10);if(eN.test(x))return V*parseInt(x,16);if(nN.test(x))return V*parseInt(x,8);if(iN.test(x))return V*parseFloat(x);throw D(x,"number",k)}function b(x,k){switch(x){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!k&&x.charAt(0)==="-")throw D(x,"id");if(ZO.test(x))return parseInt(x,10);if(tN.test(x))return parseInt(x,16);if(rN.test(x))return parseInt(x,8);throw D(x,"id")}function g(){if(d!==void 0)throw D("package");if(d=s(),!Jn.test(d))throw D(d,"name");E=E.define(d),l(";")}function y(){var x=a(),k;switch(x){case"weak":k=v||(v=[]),s();break;case"public":s();default:k=f||(f=[]);break}x=F(),l(";"),k.push(x)}function _(){if(l("="),T=F(),A=T==="proto3",!A&&T!=="proto2")throw D(T,"syntax");e.setOption("syntax",T),l(";")}function p(x,k){switch(k){case"option":return Ee(x,k),l(";"),!0;case"message":return h(x,k),!0;case"enum":return we(x,k),!0;case"service":return et(x,k),!0;case"extend":return Fs(x,k),!0}return!1}function C(x,k,V){var X=i.line;if(x&&(typeof x.comment!="string"&&(x.comment=c()),x.filename=br.filename),l("{",!0)){for(var Q;(Q=s())!=="}";)k(Q);l(";",!0)}else V&&V(),l(";"),x&&(typeof x.comment!="string"||r)&&(x.comment=c(X)||x.comment)}function h(x,k){if(!Yn.test(k=s()))throw D(k,"type name");var V=new Aw(k);C(V,function(Q){if(!p(V,Q))switch(Q){case"map":ue(V,Q);break;case"required":case"repeated":m(V,Q);break;case"optional":A?m(V,"proto3_optional"):m(V,"optional");break;case"oneof":ke(V,Q);break;case"extensions":W(V.extensions||(V.extensions=[]));break;case"reserved":W(V.reserved||(V.reserved=[]),!0);break;default:if(!A||!Jn.test(Q))throw D(Q);o(Q),m(V,"optional");break}}),x.add(V)}function m(x,k,V){var X=s();if(X==="group"){z(x,k);return}for(;X.endsWith(".")||a().startsWith(".");)X+=s();if(!Jn.test(X))throw D(X,"type");var Q=s();if(!Yn.test(Q))throw D(Q,"name");Q=P(Q),l("=");var ie=new Iw(Q,b(s()),X,k,V);if(C(ie,function(Ht){if(Ht==="option")Ee(ie,Ht),l(";");else throw D(Ht)},function(){ft(ie)}),k==="proto3_optional"){var Pe=new Dw("_"+Q);ie.setOption("proto3_optional",!0),Pe.add(ie),x.add(Pe)}else x.add(ie);!A&&ie.repeated&&(Wm.packed[X]!==void 0||Wm.basic[X]===void 0)&&ie.setOption("packed",!1,!0)}function z(x,k){var V=s();if(!Yn.test(V))throw D(V,"name");var X=Km.lcFirst(V);V===X&&(V=Km.ucFirst(V)),l("=");var Q=b(s()),ie=new Aw(V);ie.group=!0;var Pe=new Iw(X,Q,V,k);Pe.filename=br.filename,C(ie,function(Ht){switch(Ht){case"option":Ee(ie,Ht),l(";");break;case"required":case"repeated":m(ie,Ht);break;case"optional":A?m(ie,"proto3_optional"):m(ie,"optional");break;case"message":h(ie,Ht);break;case"enum":we(ie,Ht);break;default:throw D(Ht)}}),x.add(ie).add(Pe)}function ue(x){l("<");var k=s();if(Wm.mapKey[k]===void 0)throw D(k,"type");l(",");var V=s();if(!Jn.test(V))throw D(V,"type");l(">");var X=s();if(!Yn.test(X))throw D(X,"name");l("=");var Q=new HO(P(X),b(s()),k,V);C(Q,function(Pe){if(Pe==="option")Ee(Q,Pe),l(";");else throw D(Pe)},function(){ft(Q)}),x.add(Q)}function ke(x,k){if(!Yn.test(k=s()))throw D(k,"name");var V=new Dw(P(k));C(V,function(Q){Q==="option"?(Ee(V,Q),l(";")):(o(Q),m(V,"optional"))}),x.add(V)}function we(x,k){if(!Yn.test(k=s()))throw D(k,"name");var V=new QO(k);C(V,function(Q){switch(Q){case"option":Ee(V,Q),l(";");break;case"reserved":W(V.reserved||(V.reserved=[]),!0);break;default:We(V,Q)}}),x.add(V)}function We(x,k){if(!Yn.test(k))throw D(k,"name");l("=");var V=b(s(),!0),X={options:void 0};X.setOption=function(Q,ie){this.options===void 0&&(this.options={}),this.options[Q]=ie},C(X,function(ie){if(ie==="option")Ee(X,ie),l(";");else throw D(ie)},function(){ft(X)}),x.add(k,V,X.comment,X.options)}function Ee(x,k){var V=l("(",!0);if(!Jn.test(k=s()))throw D(k,"name");var X=k,Q=X,ie;V&&(l(")"),X="("+X+")",Q=X,k=a(),sN.test(k)&&(ie=k.slice(1),X+=k,s())),l("=");var Pe=Rt(x,X);qe(x,Q,Pe,ie)}function Rt(x,k){if(l("{",!0)){for(var V={};!l("}",!0);){if(!Yn.test(vt=s()))throw D(vt,"name");if(vt===null)throw D(vt,"end of input");var X,Q=vt;if(l(":",!0),a()==="{")X=Rt(x,k+"."+vt);else if(a()==="["){X=[];var ie;if(l("[",!0)){do ie=L(!0),X.push(ie);while(l(",",!0));l("]"),typeof ie<"u"&&Ze(x,k+"."+vt,ie)}}else X=L(!0),Ze(x,k+"."+vt,X);var Pe=V[Q];Pe&&(X=[].concat(Pe).concat(X)),V[Q]=X,l(",",!0),l(";",!0)}return V}var Pr=L(!0);return Ze(x,k,Pr),Pr}function Ze(x,k,V){x.setOption&&x.setOption(k,V)}function qe(x,k,V,X){x.setParsedOption&&x.setParsedOption(k,V,X)}function ft(x){if(l("[",!0)){do Ee(x,"option");while(l(",",!0));l("]")}return x}function et(x,k){if(!Yn.test(k=s()))throw D(k,"service name");var V=new YO(k);C(V,function(Q){if(!p(V,Q))if(Q==="rpc")xt(V,Q);else throw D(Q)}),x.add(V)}function xt(x,k){var V=c(),X=k;if(!Yn.test(k=s()))throw D(k,"name");var Q=k,ie,Pe,Pr,Ht;if(l("("),l("stream",!0)&&(Pe=!0),!Jn.test(k=s())||(ie=k,l(")"),l("returns"),l("("),l("stream",!0)&&(Ht=!0),!Jn.test(k=s())))throw D(k);Pr=k,l(")");var Dc=new JO(Q,X,ie,Pr,Pe,Ht);Dc.comment=V,C(Dc,function(Df){if(Df==="option")Ee(Dc,Df),l(";");else throw D(Df)}),x.add(Dc)}function Fs(x,k){if(!Jn.test(k=s()))throw D(k,"reference");var V=k;C(null,function(Q){switch(Q){case"required":case"repeated":m(x,Q,V);break;case"optional":A?m(x,"proto3_optional",V):m(x,"optional",V);break;default:if(!A||!Jn.test(Q))throw D(Q);o(Q),m(x,"optional",V);break}})}for(var vt;(vt=s())!==null;)switch(vt){case"package":if(!u)throw D(vt);g();break;case"import":if(!u)throw D(vt);y();break;case"syntax":if(!u)throw D(vt);_();break;case"option":Ee(E,vt),l(";");break;default:if(p(E,vt)){u=!1;continue}throw D(vt)}return br.filename=null,{package:d,imports:f,weakImports:v,syntax:T,root:e}}});var Ow=M((zj,kw)=>{"use strict";kw.exports=In;var oN=/\/|\./;function In(n,e){oN.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),In[n]=e}In("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var xw;In("duration",{Duration:xw={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});In("timestamp",{Timestamp:xw});In("empty",{Empty:{fields:{}}});In("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});In("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});In("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});In.get=function(e){return In[e]||null}});var Pw=M((Gj,Nw)=>{"use strict";var ni=Nw.exports=Cw();ni.build="full";ni.tokenize=jm();ni.parse=Rw();ni.common=Ow();ni.Root._configure(ni.Type,ni.parse,ni.common)});var Vu=M((jj,Fw)=>{"use strict";Fw.exports=Pw()});var $m=M((Wj,aN)=>{aN.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var Uw=M((se,qw)=>{"use strict";var Pt=Vu();qw.exports=se=Pt.descriptor=Pt.Root.fromJSON($m()).lookup(".google.protobuf");var Lw=Pt.Namespace,sl=Pt.Root,Cr=Pt.Enum,ri=Pt.Type,ii=Pt.Field,lN=Pt.MapField,qu=Pt.OneOf,ol=Pt.Service,Uu=Pt.Method;sl.fromDescriptor=function(e){typeof e.length=="number"&&(e=se.FileDescriptorSet.decode(e));var t=new sl;if(e.file)for(var r,i,s=0,o;s<e.file.length;++s){if(i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package)),r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(o=0;o<r.messageType.length;++o)i.add(ri.fromDescriptor(r.messageType[o],r.syntax));if(r.enumType)for(o=0;o<r.enumType.length;++o)i.add(Cr.fromDescriptor(r.enumType[o]));if(r.extension)for(o=0;o<r.extension.length;++o)i.add(ii.fromDescriptor(r.extension[o]));if(r.service)for(o=0;o<r.service.length;++o)i.add(ol.fromDescriptor(r.service[o]));var a=mo(r.options,se.FileOptions);if(a){var l=Object.keys(a);for(o=0;o<l.length;++o)i.setOption(l[o],a[l[o]])}}return t};sl.prototype.toDescriptor=function(e){var t=se.FileDescriptorSet.create();return Bw(this,t.file,e),t};function Bw(n,e,t){var r=se.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(r.syntax=t),n instanceof sl||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof ri?r.messageType.push(s.toDescriptor(t)):s instanceof Cr?r.enumType.push(s.toDescriptor()):s instanceof ii?r.extension.push(s.toDescriptor(t)):s instanceof ol?r.service.push(s.toDescriptor()):s instanceof Lw&&Bw(s,e,t);r.options=go(n.options,se.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var cN=0;ri.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=se.DescriptorProto.decode(e));var r=new ri(e.name.length?e.name:"Type"+cN++,mo(e.options,se.MessageOptions)),i;if(e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)r.add(qu.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var s=ii.fromDescriptor(e.field[i],t);r.add(s),e.field[i].hasOwnProperty("oneofIndex")&&r.oneofsArray[e.field[i].oneofIndex].add(s)}if(e.extension)for(i=0;i<e.extension.length;++i)r.add(ii.fromDescriptor(e.extension[i],t));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)r.add(ri.fromDescriptor(e.nestedType[i],t)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&r.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)r.add(Cr.fromDescriptor(e.enumType[i]));if(e.extensionRange&&e.extensionRange.length)for(r.extensions=[],i=0;i<e.extensionRange.length;++i)r.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(r.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)r.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)r.reserved.push(e.reservedName[i])}return r};ri.prototype.toDescriptor=function(e){var t=se.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof lN){var s=Hm(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),o=Hm(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),a=o===11||o===14?this._fieldsArray[r].resolvedType&&Vw(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(se.DescriptorProto.create({name:i.typeName,field:[se.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),se.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:se.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof ii?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof ri?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof Cr&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(se.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(se.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=go(this.options,se.MessageOptions),t};var uN=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;ii.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=se.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var r;e.typeName&&e.typeName.length?r=e.typeName:r=mN(e.type);var i;switch(e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new ii(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(o.options=mo(e.options,se.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var l=uN.exec(a);l&&(a=parseInt(a));break}o.setOption("default",a)}return gN(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};ii.prototype.toDescriptor=function(e){var t=se.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=Pt.util.ucFirst(this.name),t.label=3;else{switch(t.type=Hm(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?Vw(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=go(this.options,se.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=se.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=se.FieldOptions.create())).packed=!0),t};var dN=0;Cr.fromDescriptor=function(e){typeof e.length=="number"&&(e=se.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;t[i&&i.length?i:"NAME"+s]=s}return new Cr(e.name&&e.name.length?e.name:"Enum"+dN++,t,mo(e.options,se.EnumOptions))};Cr.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(se.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return se.EnumDescriptorProto.create({name:this.name,value:e,options:go(this.options,se.EnumOptions)})};var hN=0;qu.fromDescriptor=function(e){return typeof e.length=="number"&&(e=se.OneofDescriptorProto.decode(e)),new qu(e.name&&e.name.length?e.name:"oneof"+hN++)};qu.prototype.toDescriptor=function(){return se.OneofDescriptorProto.create({name:this.name})};var fN=0;ol.fromDescriptor=function(e){typeof e.length=="number"&&(e=se.ServiceDescriptorProto.decode(e));var t=new ol(e.name&&e.name.length?e.name:"Service"+fN++,mo(e.options,se.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)t.add(Uu.fromDescriptor(e.method[r]));return t};ol.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return se.ServiceDescriptorProto.create({name:this.name,method:e,options:go(this.options,se.ServiceOptions)})};var pN=0;Uu.fromDescriptor=function(e){return typeof e.length=="number"&&(e=se.MethodDescriptorProto.decode(e)),new Uu(e.name&&e.name.length?e.name:"Method"+pN++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,mo(e.options,se.MethodOptions))};Uu.prototype.toDescriptor=function(){return se.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:go(this.options,se.MethodOptions)})};function mN(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function gN(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function Hm(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof Cr)return 14;if(e instanceof ri)return e.group?10:11;throw Error("illegal type: "+n)}function mo(n,e){if(n){for(var t=[],r=0,i,s,o;r<e.fieldsArray.length;++r)(s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],i.resolvedType instanceof Cr&&typeof o=="number"&&i.resolvedType.valuesById[o]!==void 0&&(o=i.resolvedType.valuesById[o]),t.push(yN(s),o));return t.length?Pt.util.toObject(t):void 0}}function go(n,e){if(n){for(var t=[],r=0,i=Object.keys(n),s,o;r<i.length;++r)if(o=n[s=i[r]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=Pt.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(Pt.util.toObject(t)):void 0}}function Vw(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,o=r.length-1;if(!(n instanceof sl)&&e instanceof Lw)for(;i<t.length&&s<o&&t[i]===r[s];){var a=e.lookup(t[i++],!0);if(a!==null&&a!==e)break;++s}else for(;i<t.length&&s<o&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function yN(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var zw=M((Kj,vN)=>{vN.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var Gw=M(($j,_N)=>{_N.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var jw=M((Hj,bN)=>{bN.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var Hw=M(si=>{"use strict";Object.defineProperty(si,"__esModule",{value:!0});si.addCommonProtos=si.loadProtosWithOptionsSync=si.loadProtosWithOptions=void 0;var Ww=_e("fs"),Kw=_e("path"),yo=Vu();function $w(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(Kw.isAbsolute(i))return i;for(let s of e){let o=Kw.join(s,i);try{return Ww.accessSync(o,Ww.constants.R_OK),o}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}function CN(n,e){return S(this,null,function*(){let t=new yo.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));$w(t,e.includeDirs)}let r=yield t.load(n,e);return r.resolveAll(),r})}si.loadProtosWithOptions=CN;function SN(n,e){let t=new yo.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");$w(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}si.loadProtosWithOptionsSync=SN;function wN(){let n=zw(),e=$m(),t=Gw(),r=jw();yo.common("api",n.nested.google.nested.protobuf.nested),yo.common("descriptor",e.nested.google.nested.protobuf.nested),yo.common("source_context",t.nested.google.nested.protobuf.nested),yo.common("type",r.nested.google.nested.protobuf.nested)}si.addCommonProtos=wN});var Jw=M((Yw,Qm)=>{"use strict";var Qw=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(h,m,z){this.low=h|0,this.high=m|0,this.unsigned=!!z}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(h){return(h&&h.__isLong__)===!0}function i(h){var m=Math.clz32(h&-h);return h?31-m:m}t.isLong=r;var s={},o={};function a(h,m){var z,ue,ke;return m?(h>>>=0,(ke=0<=h&&h<256)&&(ue=o[h],ue)?ue:(z=c(h,0,!0),ke&&(o[h]=z),z)):(h|=0,(ke=-128<=h&&h<128)&&(ue=s[h],ue)?ue:(z=c(h,h<0?-1:0,!1),ke&&(s[h]=z),z))}t.fromInt=a;function l(h,m){if(isNaN(h))return m?L:F;if(m){if(h<0)return L;if(h>=E)return y}else{if(h<=-P)return _;if(h+1>=P)return g}return h<0?l(-h,m).neg():c(h%A|0,h/A|0,m)}t.fromNumber=l;function c(h,m,z){return new t(h,m,z)}t.fromBits=c;var u=Math.pow;function d(h,m,z){if(h.length===0)throw Error("empty string");if(typeof m=="number"?(z=m,m=!1):m=!!m,h==="NaN"||h==="Infinity"||h==="+Infinity"||h==="-Infinity")return m?L:F;if(z=z||10,z<2||36<z)throw RangeError("radix");var ue;if((ue=h.indexOf("-"))>0)throw Error("interior hyphen");if(ue===0)return d(h.substring(1),m,z).neg();for(var ke=l(u(z,8)),we=F,We=0;We<h.length;We+=8){var Ee=Math.min(8,h.length-We),Rt=parseInt(h.substring(We,We+Ee),z);if(Ee<8){var Ze=l(u(z,Ee));we=we.mul(Ze).add(l(Rt))}else we=we.mul(ke),we=we.add(l(Rt))}return we.unsigned=m,we}t.fromString=d;function f(h,m){return typeof h=="number"?l(h,m):typeof h=="string"?d(h,m):c(h.low,h.high,typeof m=="boolean"?m:h.unsigned)}t.fromValue=f;var v=65536,T=1<<24,A=v*v,E=A*A,P=E/2,D=a(T),F=a(0);t.ZERO=F;var L=a(0,!0);t.UZERO=L;var W=a(1);t.ONE=W;var Z=a(1,!0);t.UONE=Z;var b=a(-1);t.NEG_ONE=b;var g=c(-1,2147483647,!1);t.MAX_VALUE=g;var y=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=y;var _=c(0,-2147483648,!1);t.MIN_VALUE=_;var p=t.prototype;p.toInt=function(){return this.unsigned?this.low>>>0:this.low},p.toNumber=function(){return this.unsigned?(this.high>>>0)*A+(this.low>>>0):this.high*A+(this.low>>>0)},p.toString=function(m){if(m=m||10,m<2||36<m)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(_)){var z=l(m),ue=this.div(z),ke=ue.mul(z).sub(this);return ue.toString(m)+ke.toInt().toString(m)}else return"-"+this.neg().toString(m);for(var we=l(u(m,6),this.unsigned),We=this,Ee="";;){var Rt=We.div(we),Ze=We.sub(Rt.mul(we)).toInt()>>>0,qe=Ze.toString(m);if(We=Rt,We.isZero())return qe+Ee;for(;qe.length<6;)qe="0"+qe;Ee=""+qe+Ee}},p.getHighBits=function(){return this.high},p.getHighBitsUnsigned=function(){return this.high>>>0},p.getLowBits=function(){return this.low},p.getLowBitsUnsigned=function(){return this.low>>>0},p.getNumBitsAbs=function(){if(this.isNegative())return this.eq(_)?64:this.neg().getNumBitsAbs();for(var m=this.high!=0?this.high:this.low,z=31;z>0&&!(m&1<<z);z--);return this.high!=0?z+33:z+1},p.isZero=function(){return this.high===0&&this.low===0},p.eqz=p.isZero,p.isNegative=function(){return!this.unsigned&&this.high<0},p.isPositive=function(){return this.unsigned||this.high>=0},p.isOdd=function(){return(this.low&1)===1},p.isEven=function(){return(this.low&1)===0},p.equals=function(m){return r(m)||(m=f(m)),this.unsigned!==m.unsigned&&this.high>>>31===1&&m.high>>>31===1?!1:this.high===m.high&&this.low===m.low},p.eq=p.equals,p.notEquals=function(m){return!this.eq(m)},p.neq=p.notEquals,p.ne=p.notEquals,p.lessThan=function(m){return this.comp(m)<0},p.lt=p.lessThan,p.lessThanOrEqual=function(m){return this.comp(m)<=0},p.lte=p.lessThanOrEqual,p.le=p.lessThanOrEqual,p.greaterThan=function(m){return this.comp(m)>0},p.gt=p.greaterThan,p.greaterThanOrEqual=function(m){return this.comp(m)>=0},p.gte=p.greaterThanOrEqual,p.ge=p.greaterThanOrEqual,p.compare=function(m){if(r(m)||(m=f(m)),this.eq(m))return 0;var z=this.isNegative(),ue=m.isNegative();return z&&!ue?-1:!z&&ue?1:this.unsigned?m.high>>>0>this.high>>>0||m.high===this.high&&m.low>>>0>this.low>>>0?-1:1:this.sub(m).isNegative()?-1:1},p.comp=p.compare,p.negate=function(){return!this.unsigned&&this.eq(_)?_:this.not().add(W)},p.neg=p.negate,p.add=function(m){r(m)||(m=f(m));var z=this.high>>>16,ue=this.high&65535,ke=this.low>>>16,we=this.low&65535,We=m.high>>>16,Ee=m.high&65535,Rt=m.low>>>16,Ze=m.low&65535,qe=0,ft=0,et=0,xt=0;return xt+=we+Ze,et+=xt>>>16,xt&=65535,et+=ke+Rt,ft+=et>>>16,et&=65535,ft+=ue+Ee,qe+=ft>>>16,ft&=65535,qe+=z+We,qe&=65535,c(et<<16|xt,qe<<16|ft,this.unsigned)},p.subtract=function(m){return r(m)||(m=f(m)),this.add(m.neg())},p.sub=p.subtract,p.multiply=function(m){if(this.isZero())return this;if(r(m)||(m=f(m)),e){var z=e.mul(this.low,this.high,m.low,m.high);return c(z,e.get_high(),this.unsigned)}if(m.isZero())return this.unsigned?L:F;if(this.eq(_))return m.isOdd()?_:F;if(m.eq(_))return this.isOdd()?_:F;if(this.isNegative())return m.isNegative()?this.neg().mul(m.neg()):this.neg().mul(m).neg();if(m.isNegative())return this.mul(m.neg()).neg();if(this.lt(D)&&m.lt(D))return l(this.toNumber()*m.toNumber(),this.unsigned);var ue=this.high>>>16,ke=this.high&65535,we=this.low>>>16,We=this.low&65535,Ee=m.high>>>16,Rt=m.high&65535,Ze=m.low>>>16,qe=m.low&65535,ft=0,et=0,xt=0,Fs=0;return Fs+=We*qe,xt+=Fs>>>16,Fs&=65535,xt+=we*qe,et+=xt>>>16,xt&=65535,xt+=We*Ze,et+=xt>>>16,xt&=65535,et+=ke*qe,ft+=et>>>16,et&=65535,et+=we*Ze,ft+=et>>>16,et&=65535,et+=We*Rt,ft+=et>>>16,et&=65535,ft+=ue*qe+ke*Ze+we*Rt+We*Ee,ft&=65535,c(xt<<16|Fs,ft<<16|et,this.unsigned)},p.mul=p.multiply,p.divide=function(m){if(r(m)||(m=f(m)),m.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&m.low===-1&&m.high===-1)return this;var z=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,m.low,m.high);return c(z,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?L:F;var ue,ke,we;if(this.unsigned){if(m.unsigned||(m=m.toUnsigned()),m.gt(this))return L;if(m.gt(this.shru(1)))return Z;we=L}else{if(this.eq(_)){if(m.eq(W)||m.eq(b))return _;if(m.eq(_))return W;var We=this.shr(1);return ue=We.div(m).shl(1),ue.eq(F)?m.isNegative()?W:b:(ke=this.sub(m.mul(ue)),we=ue.add(ke.div(m)),we)}else if(m.eq(_))return this.unsigned?L:F;if(this.isNegative())return m.isNegative()?this.neg().div(m.neg()):this.neg().div(m).neg();if(m.isNegative())return this.div(m.neg()).neg();we=F}for(ke=this;ke.gte(m);){ue=Math.max(1,Math.floor(ke.toNumber()/m.toNumber()));for(var Ee=Math.ceil(Math.log(ue)/Math.LN2),Rt=Ee<=48?1:u(2,Ee-48),Ze=l(ue),qe=Ze.mul(m);qe.isNegative()||qe.gt(ke);)ue-=Rt,Ze=l(ue,this.unsigned),qe=Ze.mul(m);Ze.isZero()&&(Ze=W),we=we.add(Ze),ke=ke.sub(qe)}return we},p.div=p.divide,p.modulo=function(m){if(r(m)||(m=f(m)),e){var z=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,m.low,m.high);return c(z,e.get_high(),this.unsigned)}return this.sub(this.div(m).mul(m))},p.mod=p.modulo,p.rem=p.modulo,p.not=function(){return c(~this.low,~this.high,this.unsigned)},p.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},p.clz=p.countLeadingZeros,p.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},p.ctz=p.countTrailingZeros,p.and=function(m){return r(m)||(m=f(m)),c(this.low&m.low,this.high&m.high,this.unsigned)},p.or=function(m){return r(m)||(m=f(m)),c(this.low|m.low,this.high|m.high,this.unsigned)},p.xor=function(m){return r(m)||(m=f(m)),c(this.low^m.low,this.high^m.high,this.unsigned)},p.shiftLeft=function(m){return r(m)&&(m=m.toInt()),(m&=63)===0?this:m<32?c(this.low<<m,this.high<<m|this.low>>>32-m,this.unsigned):c(0,this.low<<m-32,this.unsigned)},p.shl=p.shiftLeft,p.shiftRight=function(m){return r(m)&&(m=m.toInt()),(m&=63)===0?this:m<32?c(this.low>>>m|this.high<<32-m,this.high>>m,this.unsigned):c(this.high>>m-32,this.high>=0?0:-1,this.unsigned)},p.shr=p.shiftRight,p.shiftRightUnsigned=function(m){return r(m)&&(m=m.toInt()),(m&=63)===0?this:m<32?c(this.low>>>m|this.high<<32-m,this.high>>>m,this.unsigned):m===32?c(this.high,0,this.unsigned):c(this.high>>>m-32,0,this.unsigned)},p.shru=p.shiftRightUnsigned,p.shr_u=p.shiftRightUnsigned,p.rotateLeft=function(m){var z;return r(m)&&(m=m.toInt()),(m&=63)===0?this:m===32?c(this.high,this.low,this.unsigned):m<32?(z=32-m,c(this.low<<m|this.high>>>z,this.high<<m|this.low>>>z,this.unsigned)):(m-=32,z=32-m,c(this.high<<m|this.low>>>z,this.low<<m|this.high>>>z,this.unsigned))},p.rotl=p.rotateLeft,p.rotateRight=function(m){var z;return r(m)&&(m=m.toInt()),(m&=63)===0?this:m===32?c(this.high,this.low,this.unsigned):m<32?(z=32-m,c(this.high<<z|this.low>>>m,this.low<<z|this.high>>>m,this.unsigned)):(m-=32,z=32-m,c(this.low<<z|this.high>>>m,this.high<<z|this.low>>>m,this.unsigned))},p.rotr=p.rotateRight,p.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},p.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},p.toBytes=function(m){return m?this.toBytesLE():this.toBytesBE()},p.toBytesLE=function(){var m=this.high,z=this.low;return[z&255,z>>>8&255,z>>>16&255,z>>>24,m&255,m>>>8&255,m>>>16&255,m>>>24]},p.toBytesBE=function(){var m=this.high,z=this.low;return[m>>>24,m>>>16&255,m>>>8&255,m&255,z>>>24,z>>>16&255,z>>>8&255,z&255]},t.fromBytes=function(m,z,ue){return ue?t.fromBytesLE(m,z):t.fromBytesBE(m,z)},t.fromBytesLE=function(m,z){return new t(m[0]|m[1]<<8|m[2]<<16|m[3]<<24,m[4]|m[5]<<8|m[6]<<16|m[7]<<24,z)},t.fromBytesBE=function(m,z){return new t(m[4]<<24|m[5]<<16|m[6]<<8|m[7],m[0]<<24|m[1]<<16|m[2]<<8|m[3],z)};var C=t;return n.default=C,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return Qw}):typeof Qm=="object"&&typeof Yw=="object"&&(Qm.exports=Qw)});var Zm=M(ot=>{"use strict";Object.defineProperty(ot,"__esModule",{value:!0});ot.loadFileDescriptorSetFromObject=ot.loadFileDescriptorSetFromBuffer=ot.fromJSON=ot.loadSync=ot.load=ot.IdempotencyLevel=ot.isAnyExtension=ot.Long=void 0;var TN=BC(),Xn=Vu(),Jm=Uw(),Xm=Hw(),EN=Jw();ot.Long=EN;function AN(n){return"@type"in n&&typeof n["@type"]=="string"}ot.isAnyExtension=AN;var eT;(function(n){n.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",n.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",n.IDEMPOTENT="IDEMPOTENT"})(eT=ot.IdempotencyLevel||(ot.IdempotencyLevel={}));var tT={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function IN(n,e){return n===""?e:n+"."+e}function DN(n){return n instanceof Xn.Service||n instanceof Xn.Type||n instanceof Xn.Enum}function MN(n){return n instanceof Xn.Namespace||n instanceof Xn.Root}function nT(n,e){let t=IN(e,n.name);return DN(n)?[[t,n]]:MN(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>nT(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function Xw(n,e){return function(r){return n.toObject(n.decode(r),e)}}function Zw(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function RN(n){return(n||[]).reduce((e,t)=>{for(let[r,i]of Object.entries(t))switch(r){case"uninterpreted_option":e.uninterpreted_option.push(t.uninterpreted_option);break;default:e[r]=i}return e},{deprecated:!1,idempotency_level:eT.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function xN(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:Zw(i),requestDeserialize:Xw(i,t),responseSerialize:Zw(s),responseDeserialize:Xw(s,t),originalName:TN(n.name),requestType:Ym(i,r),responseType:Ym(s,r),options:RN(n.parsedOptions)}}function kN(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=xN(s,e,t,r);return i}function Ym(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,tT),fileDescriptorProtos:e}}function ON(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,tT),fileDescriptorProtos:e}}function NN(n,e,t,r){if(n instanceof Xn.Service)return kN(n,e,t,r);if(n instanceof Xn.Type)return Ym(n,r);if(n instanceof Xn.Enum)return ON(n,r);throw new Error("Type mismatch in reflection object handling")}function zu(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from(Jm.FileDescriptorProto.encode(s).finish()));for(let[s,o]of nT(n,""))t[s]=NN(o,s,e,i);return t}function rT(n,e){e=e||{};let t=Xn.Root.fromDescriptor(n);return t.resolveAll(),zu(t,e)}function PN(n,e){return(0,Xm.loadProtosWithOptions)(n,e).then(t=>zu(t,e))}ot.load=PN;function FN(n,e){let t=(0,Xm.loadProtosWithOptionsSync)(n,e);return zu(t,e)}ot.loadSync=FN;function LN(n,e){e=e||{};let t=Xn.Root.fromJSON(n);return t.resolveAll(),zu(t,e)}ot.fromJSON=LN;function BN(n,e){let t=Jm.FileDescriptorSet.decode(n);return rT(t,e)}ot.loadFileDescriptorSetFromBuffer=BN;function VN(n,e){let t=Jm.FileDescriptorSet.fromObject(n);return rT(t,e)}ot.loadFileDescriptorSetFromObject=VN;(0,Xm.addCommonProtos)()});var es=M(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});Oe.setup=Oe.getChannelzServiceDefinition=Oe.getChannelzHandlers=Oe.unregisterChannelzRef=Oe.registerChannelzSocket=Oe.registerChannelzServer=Oe.registerChannelzSubchannel=Oe.registerChannelzChannel=Oe.ChannelzCallTracker=Oe.ChannelzChildrenTracker=Oe.ChannelzTrace=void 0;var iT=_e("net"),al=on(),cl=me(),qN=Gn(),UN=cu(),zN=Yp();function eg(n){return{channel_id:n.id,name:n.name}}function ig(n){return{subchannel_id:n.id,name:n.name}}function GN(n){return{server_id:n.id}}function ju(n){return{socket_id:n.id,name:n.name}}var sT=32,tg=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=sT*2&&(this.events=this.events.slice(sT)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:Sr(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:Sr(e.timestamp),channel_ref:e.childChannel?eg(e.childChannel):null,subchannel_ref:e.childSubchannel?ig(e.childSubchannel):null}))}}};Oe.ChannelzTrace=tg;var ng=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};Oe.ChannelzChildrenTracker=ng;var rg=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};Oe.ChannelzCallTracker=rg;var jN=1;function Wu(){return jN++}var ll=[],sg=[],oi=[],og=[];function WN(n,e,t){let r=Wu(),i={id:r,name:n,kind:"channel"};return t&&(ll[r]={ref:i,getInfo:e}),i}Oe.registerChannelzChannel=WN;function KN(n,e,t){let r=Wu(),i={id:r,name:n,kind:"subchannel"};return t&&(sg[r]={ref:i,getInfo:e}),i}Oe.registerChannelzSubchannel=KN;function $N(n,e){let t=Wu(),r={id:t,kind:"server"};return e&&(oi[t]={ref:r,getInfo:n}),r}Oe.registerChannelzServer=$N;function HN(n,e,t){let r=Wu(),i={id:r,name:n,kind:"socket"};return t&&(og[r]={ref:i,getInfo:e}),i}Oe.registerChannelzSocket=HN;function QN(n){switch(n.kind){case"channel":delete ll[n.id];return;case"subchannel":delete sg[n.id];return;case"server":delete oi[n.id];return;case"socket":delete og[n.id];return}}Oe.unregisterChannelzRef=QN;function YN(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function oT(n){if(n==="")return[];let e=n.split(":").map(r=>YN(r));return[].concat(...e)}function JN(n){if((0,iT.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,iT.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(oT(e)),s=Buffer.from(oT(t)),o=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,o,s])}else return null}function lT(n){switch(n){case al.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case al.ConnectivityState.IDLE:return{state:"IDLE"};case al.ConnectivityState.READY:return{state:"READY"};case al.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case al.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function Sr(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function cT(n){let e=n.getInfo();return{ref:eg(n.ref),data:{target:e.target,state:lT(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Sr(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>eg(t)),subchannel_ref:e.children.subchannels.map(t=>ig(t))}}function XN(n,e){let t=Number.parseInt(n.request.channel_id),r=ll[t];if(r===void 0){e({code:cl.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:cT(r)})}function ZN(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<ll.length;i++){let s=ll[i];if(s!==void 0&&(r.push(cT(s)),r.length>=t))break}e(null,{channel:r,end:i>=oi.length})}function uT(n){let e=n.getInfo();return{ref:GN(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Sr(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>ju(t))}}function eP(n,e){let t=Number.parseInt(n.request.server_id),r=oi[t];if(r===void 0){e({code:cl.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:uT(r)})}function tP(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<oi.length;i++){let s=oi[i];if(s!==void 0&&(r.push(uT(s)),r.length>=t))break}e(null,{server:r,end:i>=oi.length})}function nP(n,e){let t=Number.parseInt(n.request.subchannel_id),r=sg[t];if(r===void 0){e({code:cl.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:ig(r.ref),data:{target:i.target,state:lT(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:Sr(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(o=>ju(o))};e(null,{subchannel:s})}function aT(n){var e;return(0,qN.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=JN(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function rP(n,e){var t,r,i,s,o;let a=Number.parseInt(n.request.socket_id),l=og[a];if(l===void 0){e({code:cl.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=c.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=c.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,d={ref:ju(l.ref),local:c.localAddress?aT(c.localAddress):null,remote:c.remoteAddress?aT(c.remoteAddress):null,remote_name:(o=c.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:Sr(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:Sr(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:Sr(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:Sr(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:d})}function iP(n,e){let t=Number.parseInt(n.request.server_id),r=oi[t];if(r===void 0){e({code:cl.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=r.getInfo().sessionChildren.sockets.sort((u,d)=>u.id-d.id),l=[],c=0;for(;c<a.length&&!(a[c].id>=i&&(l.push(ju(a[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=a.length})}function dT(){return{GetChannel:XN,GetTopChannels:ZN,GetServer:eP,GetServers:tP,GetSubchannel:nP,GetSocket:rP,GetServerSockets:iP}}Oe.getChannelzHandlers=dT;var Gu=null;function hT(){if(Gu)return Gu;let n=Zm().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return Gu=(0,zN.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,Gu}Oe.getChannelzServiceDefinition=hT;function sP(){(0,UN.registerAdminService)(hT,dT)}Oe.setup=sP});var fT=M($u=>{"use strict";Object.defineProperty($u,"__esModule",{value:!0});$u.Subchannel=void 0;var Ie=on(),oP=za(),ag=Ge(),Ku=me(),aP=Yt(),lP=Gn(),vo=es(),cP="subchannel",uP=~(1<<31),lg=class{constructor(e,t,r,i,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=Ie.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new vo.ChannelzCallTracker,this.childrenTracker=new vo.ChannelzChildrenTracker,this.streamTracker=new vo.ChannelzCallTracker;let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new oP.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,lP.subchannelAddressToString)(t),this.keepaliveTime=(o=r["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new vo.ChannelzTrace,this.channelzRef=(0,vo.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){ag.trace(Ku.LogVerbosity.DEBUG,cP,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){ag.trace(Ku.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([Ie.ConnectivityState.TRANSIENT_FAILURE],Ie.ConnectivityState.CONNECTING):this.transitionToState([Ie.ConnectivityState.TRANSIENT_FAILURE],Ie.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,uP);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([Ie.ConnectivityState.CONNECTING],Ie.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([Ie.ConnectivityState.READY],Ie.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,ag.log(Ku.LogVerbosity.ERROR,`Connection to ${(0,aP.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([Ie.ConnectivityState.CONNECTING],Ie.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(Ie.ConnectivityState[this.connectivityState]+" -> "+Ie.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Ie.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case Ie.ConnectivityState.READY:this.stopBackoff();break;case Ie.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case Ie.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case Ie.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,vo.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([Ie.ConnectivityState.CONNECTING,Ie.ConnectivityState.READY],Ie.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===Ku.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([Ie.ConnectivityState.IDLE],Ie.ConnectivityState.CONNECTING)||this.connectivityState===Ie.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([Ie.ConnectivityState.TRANSIENT_FAILURE],Ie.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};$u.Subchannel=lg});var hg=M(ci=>{"use strict";Object.defineProperty(ci,"__esModule",{value:!0});ci.setup=ci.DEFAULT_PORT=void 0;var pT=Un(),gT=_e("dns"),yT=_e("util"),dP=wp(),cg=me(),ug=Gt(),hP=Ge(),fP=me(),ai=Yt(),mT=_e("net"),pP=za(),mP="dns_resolver";function li(n){hP.trace(fP.LogVerbosity.DEBUG,mP,n)}ci.DEFAULT_PORT=443;var gP=3e4,yP=yT.promisify(gT.resolveTxt),vP=yT.promisify(gT.lookup);function _P(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var dg=class{constructor(e,t,r){var i,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,li("Resolver constructed for target "+(0,ai.uriToString)(e));let a=(0,ai.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,mT.isIPv4)(a.host)||(0,mT.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(i=a.port)!==null&&i!==void 0?i:ci.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:ci.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:cg.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,ai.uriToString)(this.target)}`,metadata:new ug.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new pP.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:gP,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(li("Returning IP address for target "+(0,ai.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)li("Failed to parse DNS address "+(0,ai.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:cg.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,ai.uriToString)(this.target)}`,metadata:new ug.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;li("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=vP(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(o=>o.family===4),i=t.filter(o=>o.family===6);this.latestLookupResult=_P(i,r).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(li("Resolved addresses for target "+(0,ai.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(li("Resolution error for target "+(0,ai.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=yP(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,dP.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:cg.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new ug.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?li('resolution update delayed by "min time between resolutions" rate limit'):li("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function bP(){(0,pT.registerResolver)("dns",dg),(0,pT.registerDefaultScheme)("dns")}ci.setup=bP});var fg=M(Co=>{"use strict";Object.defineProperty(Co,"__esModule",{value:!0});Co.getProxiedConnection=Co.mapProxyName=void 0;var ul=Ge(),_o=me(),CP=Un(),SP=_e("http"),wP=_e("tls"),TP=Ge(),vT=Gn(),bo=Yt(),EP=_e("url"),AP=hg(),IP="proxy";function ui(n){TP.trace(_o.LogVerbosity.DEBUG,IP,n)}function DP(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new EP.URL(n)}catch{return(0,ul.log)(_o.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,ul.log)(_o.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,ul.log)(_o.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${i}:${s}`};return r&&(o.creds=r),ui("Proxy server "+o.address+" set by environment variable "+e),o}function MP(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(ui("No proxy server list set by environment variable "+e),n.split(",")):[]}function RP(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=DP();if(!i.address)return r;let s=(0,bo.splitHostPort)(n.path);if(!s)return r;let o=s.host;for(let l of MP())if(l===o)return ui("Not using proxy for target in no_proxy list: "+(0,bo.uriToString)(n)),r;let a={"grpc.http_connect_target":(0,bo.uriToString)(n)};return i.creds&&(a["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:a}}Co.mapProxyName=RP;function xP(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,bo.parseUri)(i);if(s===null)return Promise.resolve({});let o=(0,bo.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(r=o.port)!==null&&r!==void 0?r:AP.DEFAULT_PORT}`,l={method:"CONNECT",path:a},c={Host:a};(0,vT.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,vT.subchannelAddressToString)(n);return ui("Using proxy "+u+" to connect to "+l.path),new Promise((d,f)=>{let v=SP.request(l);v.once("connect",(T,A,E)=>{var P;if(v.removeAllListeners(),A.removeAllListeners(),T.statusCode===200)if(ui("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let D=(0,CP.getDefaultAuthority)(s),F=(0,bo.splitHostPort)(D),L=(P=F?.host)!==null&&P!==void 0?P:D,W=wP.connect(Object.assign({host:L,servername:L,socket:A},t),()=>{ui("Successfully established a TLS connection to "+l.path+" through proxy "+u),d({socket:W,realTarget:s})});W.on("error",Z=>{ui("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+Z.message),f()})}else ui("Successfully established a plaintext connection to "+l.path+" through proxy "+u),d({socket:A,realTarget:s});else(0,ul.log)(_o.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+T.statusCode),f()}),v.once("error",T=>{v.removeAllListeners(),(0,ul.log)(_o.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+T.message),f()}),v.end()})}Co.getProxiedConnection=xP});var mg=M(Hu=>{"use strict";Object.defineProperty(Hu,"__esModule",{value:!0});Hu.StreamDecoder=void 0;var wr=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(wr||{}),pg=class{constructor(e){this.maxReadMessageLength=e,this.readState=wr.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case wr.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=wr.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case wr.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.maxReadMessageLength!==-1&&this.readMessageSize>this.maxReadMessageLength)throw new Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=wr.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=wr.NO_DATA,i.push(s)}}break;case wr.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=wr.NO_DATA,i.push(o)}break;default:throw new Error("Unexpected read state")}return i}};Hu.StreamDecoder=pg});var _T=M(Qu=>{"use strict";Object.defineProperty(Qu,"__esModule",{value:!0});Qu.Http2SubchannelCall=void 0;var Tr=_e("http2"),kP=_e("os"),Ce=me(),di=Gt(),OP=mg(),NP=Ge(),PP=me(),FP="subchannel_call";function LP(n){for(let[e,t]of Object.entries(kP.constants.errno))if(t===n)return e;return"Unknown system error "+n}var gg=class{constructor(e,t,r,i,s){var o;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=Ce.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let a=(o=i.getOptions()["grpc.max_receive_message_length"])!==null&&o!==void 0?o:Ce.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new OP.StreamDecoder(a),e.on("response",(l,c)=>{let u="";for(let d of Object.keys(l))u+="		"+d+": "+l[d]+`
`;switch(this.trace(`Received server headers:
`+u),l[":status"]){case 400:this.mappedStatusCode=Ce.Status.INTERNAL;break;case 401:this.mappedStatusCode=Ce.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=Ce.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=Ce.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=Ce.Status.UNAVAILABLE;break;default:this.mappedStatusCode=Ce.Status.UNKNOWN}if(c&Tr.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(l);else{let d;try{d=di.Metadata.fromHttp2Headers(l)}catch(f){this.endCall({code:Ce.Status.UNKNOWN,details:f.message,metadata:new di.Metadata});return}this.listener.onReceiveMetadata(d)}}),e.on("trailers",l=>{this.handleTrailers(l)}),e.on("data",l=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+l.length);let c;try{c=this.decoder.write(l)}catch(u){this.cancelWithStatus(Ce.Status.RESOURCE_EXHAUSTED,u.message);return}for(let u of c)this.trace("parsed message of length "+u.length),this.callEventTracker.addMessageReceived(),this.tryPush(u)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var l;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((l=this.finalStatus)===null||l===void 0?void 0:l.code)===Ce.Status.OK)return;let c,u="";switch(e.rstCode){case Tr.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;c=Ce.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`;break;case Tr.constants.NGHTTP2_REFUSED_STREAM:c=Ce.Status.UNAVAILABLE,u="Stream refused by server";break;case Tr.constants.NGHTTP2_CANCEL:c=Ce.Status.CANCELLED,u="Call cancelled";break;case Tr.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=Ce.Status.RESOURCE_EXHAUSTED,u="Bandwidth exhausted or memory limit exceeded";break;case Tr.constants.NGHTTP2_INADEQUATE_SECURITY:c=Ce.Status.PERMISSION_DENIED,u="Protocol not secure enough";break;case Tr.constants.NGHTTP2_INTERNAL_ERROR:c=Ce.Status.INTERNAL,this.internalError===null?u=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(c=Ce.Status.UNAVAILABLE,u=this.internalError.message):u=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=Ce.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:c,details:u,metadata:new di.Metadata,rstCode:e.rstCode})})}),e.on("error",l=>{l.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+l.message+" code="+l.code+" errno="+LP(l.errno)+" syscall="+l.syscall),this.internalError=l),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:Ce.Status.UNAVAILABLE,details:"Connection dropped",metadata:new di.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){NP.trace(PP.LogVerbosity.DEBUG,FP,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===Ce.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==Ce.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=di.Metadata.fromHttp2Headers(e)}catch{r=new di.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===Ce.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in Ce.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let o="";if(typeof i["grpc-message"]=="string"){try{o=decodeURI(i["grpc-message"])}catch{o=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:r};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===Ce.Status.OK?t=Tr.constants.NGHTTP2_NO_ERROR:t=Tr.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new di.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==Ce.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let o=Ce.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=Ce.Status.INTERNAL),i&&this.cancelWithStatus(o,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:Ce.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new di.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};Qu.Http2SubchannelCall=gg});var yg=M(Yu=>{"use strict";Object.defineProperty(Yu,"__esModule",{value:!0});Yu.getNextCallNumber=void 0;var BP=0;function VP(){return BP++}Yu.getNextCallNumber=VP});var ST=M(Xu=>{"use strict";Object.defineProperty(Xu,"__esModule",{value:!0});Xu.Http2SubchannelConnector=void 0;var Sg=_e("http2"),bT=_e("tls"),vg=es(),dl=me(),qP=fg(),wo=Ge(),CT=Un(),Ju=Gn(),So=Yt(),UP=_e("net"),zP=_T(),GP=yg(),_g="transport",jP="transport_flowctrl",WP=sp().version,{HTTP2_HEADER_AUTHORITY:KP,HTTP2_HEADER_CONTENT_TYPE:$P,HTTP2_HEADER_METHOD:HP,HTTP2_HEADER_PATH:QP,HTTP2_HEADER_TE:YP,HTTP2_HEADER_USER_AGENT:JP}=Sg.constants,XP=2e4,ZP=Buffer.from("too_many_pings","ascii"),bg=class{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=XP,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new vg.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,Ju.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,vg.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${WP}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===Sg.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(ZP)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),wo.isTracerEnabled(_g)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,Ju.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,o=i.localAddress?(0,Ju.stringToSubchannelAddress)(i.localAddress,i.localPort):null,a;if(this.session.encrypted){let c=i,u=c.getCipher(),d=c.getCertificate(),f=c.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:d&&"raw"in d?d.raw:null,remoteCertificate:f&&"raw"in f?f.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){wo.trace(dl.LogVerbosity.DEBUG,_g,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){wo.trace(dl.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){wo.trace(dl.LogVerbosity.DEBUG,jP,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){wo.trace(dl.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let o=e.toHttp2Headers();o[KP]=t,o[JP]=this.userAgent,o[$P]="application/grpc",o[HP]="POST",o[QP]=r,o[YP]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}},c=new zP.Http2SubchannelCall(a,l,i,this,(0,GP.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,vg.unregisterChannelzRef)(this.channelzRef)}},Cg=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){wo.trace(dl.LogVerbosity.DEBUG,_g,(0,So.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,c;let u;i.realTarget?(u=(0,So.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,So.uriToString)(i.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,Ju.subchannelAddressToString)(e)));let d=(0,CT.getDefaultAuthority)((a=i.realTarget)!==null&&a!==void 0?a:this.channelTarget),f=t._getConnectionOptions()||{};f.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?f.maxSessionMemory=r["grpc-node.max_session_memory"]:f.maxSessionMemory=Number.MAX_SAFE_INTEGER;let v="http://";if("secureContext"in f){if(v="https://",r["grpc.ssl_target_name_override"]){let E=r["grpc.ssl_target_name_override"];f.checkServerIdentity=(P,D)=>(0,bT.checkServerIdentity)(E,D),f.servername=E}else{let E=(c=(l=(0,So.splitHostPort)(d))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";f.servername=E}i.socket&&(f.createConnection=(E,P)=>i.socket)}else f.createConnection=(E,P)=>i.socket?i.socket:UP.connect(e);f=Object.assign(Object.assign(Object.assign({},f),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let T=Sg.connect(v+d,f);this.session=T;let A="Failed to connect";T.unref(),T.once("connect",()=>{T.removeAllListeners(),s(new bg(T,e,r,u)),this.session=null}),T.once("close",()=>{this.session=null,setImmediate(()=>{o(`${A} (${new Date().toISOString()})`)})}),T.once("error",E=>{A=E.message,this.trace("connection failed with error "+A)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let a=r["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,c)=>(0,bT.checkServerIdentity)(a,c),o.servername=a}else if("grpc.http_connect_target"in r){let a=(0,CT.getDefaultAuthority)((i=(0,So.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,So.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}r["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,qP.getProxiedConnection)(e,r,o).then(a=>this.createSession(e,t,r,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};Xu.Http2SubchannelConnector=Cg});var wT=M(To=>{"use strict";Object.defineProperty(To,"__esModule",{value:!0});To.getSubchannelPool=To.SubchannelPool=void 0;var eF=oC(),tF=fT(),nF=Gn(),rF=Yt(),iF=ST(),sF=1e4,hl=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},sF),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,rF.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,nF.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,eF.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let o=new tF.Subchannel(e,t,r,i,new iF.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:o}),o.ref(),o}};To.SubchannelPool=hl;var oF=new hl;function aF(n){return n?oF:new hl}To.getSubchannelPool=aF});var Tg=M(Eo=>{"use strict";Object.defineProperty(Eo,"__esModule",{value:!0});Eo.FilterStackFactory=Eo.FilterStack=void 0;var Zu=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};Eo.FilterStack=Zu;var wg=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new Zu(this.factories.map(e=>e.createFilter()))}};Eo.FilterStackFactory=wg});var Eg=M(ed=>{"use strict";Object.defineProperty(ed,"__esModule",{value:!0});ed.CompressionAlgorithms=void 0;var TT=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(TT||(ed.CompressionAlgorithms=TT={}))});var Ig=M(td=>{"use strict";Object.defineProperty(td,"__esModule",{value:!0});td.BaseFilter=void 0;var Ag=class{sendMetadata(e){return S(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return S(this,null,function*(){return e})}receiveMessage(e){return S(this,null,function*(){return e})}receiveTrailers(e){return e}};td.BaseFilter=Ag});var IT=M(Io=>{"use strict";Object.defineProperty(Io,"__esModule",{value:!0});Io.CompressionFilterFactory=Io.CompressionFilter=void 0;var nd=_e("zlib"),AT=Eg(),rd=me(),lF=Ig(),cF=Ge(),uF=n=>typeof n=="number"&&typeof AT.CompressionAlgorithms[n]=="string",Ao=class{writeMessage(e,t){return S(this,null,function*(){let r=e;t&&(r=yield this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i})}readMessage(e){return S(this,null,function*(){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=yield this.decompressMessage(r)),r})}},ts=class extends Ao{compressMessage(e){return S(this,null,function*(){return e})}writeMessage(e,t){return S(this,null,function*(){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},Dg=class extends Ao{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{nd.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=nd.createInflate();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:rd.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},Mg=class extends Ao{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{nd.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=nd.createGunzip();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:rd.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},Rg=class extends Ao{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function ET(n,e){switch(n){case"identity":return new ts;case"deflate":return new Dg(e);case"gzip":return new Mg(e);default:return new Rg(n)}}var id=class extends lF.BaseFilter{constructor(e,t){var r,i;super(),this.sharedFilterConfig=t,this.sendCompression=new ts,this.receiveCompression=new ts,this.currentCompressionAlgorithm="identity";let s=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=(r=e["grpc.max_receive_message_length"])!==null&&r!==void 0?r:rd.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,s!==void 0)if(uF(s)){let o=AT.CompressionAlgorithms[s],a=(i=t.serverSupportedEncodingHeader)===null||i===void 0?void 0:i.split(",");(!a||a.includes(o))&&(this.currentCompressionAlgorithm=o,this.sendCompression=ET(this.currentCompressionAlgorithm,-1))}else cF.log(rd.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${s}`)}sendMetadata(e){return S(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=ET(i,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new ts,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return S(this,null,function*(){var t;let r=yield e,i;return this.sendCompression instanceof ts?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(r.message,i),flags:r.flags}})}receiveMessage(e){return S(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};Io.CompressionFilter=id;var xg=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new id(this.options,this.sharedFilterConfig)}};Io.CompressionFilterFactory=xg});var sd=M(Zn=>{"use strict";Object.defineProperty(Zn,"__esModule",{value:!0});Zn.deadlineToString=Zn.getRelativeTimeout=Zn.getDeadlineTimeoutString=Zn.minDeadline=void 0;function dF(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}Zn.minDeadline=dF;var hF=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function fF(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of hF){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}Zn.getDeadlineTimeoutString=fF;var pF=2147483647;function mF(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>pF?1/0:r}Zn.getRelativeTimeout=mF;function gF(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}Zn.deadlineToString=gF});var ad=M(od=>{"use strict";Object.defineProperty(od,"__esModule",{value:!0});od.restrictControlPlaneStatusCode=void 0;var er=me(),yF=[er.Status.OK,er.Status.INVALID_ARGUMENT,er.Status.NOT_FOUND,er.Status.ALREADY_EXISTS,er.Status.FAILED_PRECONDITION,er.Status.ABORTED,er.Status.OUT_OF_RANGE,er.Status.DATA_LOSS];function vF(n,e){return yF.includes(n)?{code:er.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${er.Status[n]} ${e}`}:{code:n,details:e}}od.restrictControlPlaneStatusCode=vF});var MT=M(ud=>{"use strict";Object.defineProperty(ud,"__esModule",{value:!0});ud.LoadBalancingCall=void 0;var DT=on(),ld=me(),_F=sd(),cd=Gt(),fl=Qr(),bF=Yt(),CF=Ge(),kg=ad(),SF=_e("http2"),wF="load_balancing_call",Og=class{constructor(e,t,r,i,s,o,a){var l,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),d="";u.length>=2&&(d=u[1]);let f=(c=(l=(0,bF.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${f}/${d}`}trace(e){CF.trace(ld.LogVerbosity.DEBUG,wF,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+fl.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case fl.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let d=this.metadata.clone();if(d.merge(a),d.get("authorization").length>1&&this.outputStatus({code:ld.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new cd.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==DT.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+DT.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&d.set("grpc-timeout",(0,_F.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(d,this.host,this.methodName,{onReceiveMetadata:f=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(f)},onReceiveMessage:f=>{this.trace("Received message"),this.listener.onReceiveMessage(f)},onReceiveStatus:f=>{this.trace("Received status"),f.rstCode===SF.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(f,"REFUSED"):this.outputStatus(f,"PROCESSED")}})}catch(f){this.trace("Failed to start call on picked subchannel "+i+" with error "+f.message),this.outputStatus({code:ld.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+f.message,metadata:new cd.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=r.onCallStarted)===null||u===void 0||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:c}=(0,kg.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:ld.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:c,metadata:new cd.Metadata},"PROCESSED")});break;case fl.PickResultType.DROP:let{code:s,details:o}=(0,kg.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:r.status.metadata},"DROP")});break;case fl.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,kg.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case fl.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new cd.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};ud.LoadBalancingCall=Og});var xT=M(hd=>{"use strict";Object.defineProperty(hd,"__esModule",{value:!0});hd.ResolvingCall=void 0;var Do=me(),dd=sd(),RT=Gt(),TF=Ge(),EF=ad(),AF="resolving_call",Ng=class{constructor(e,t,r,i,s,o){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&Do.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(Do.Status.CANCELLED,"Cancelled by parent call")}),r.flags&Do.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,dd.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){TF.trace(Do.LogVerbosity.DEBUG,AF,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,dd.deadlineToString)(this.deadline));let e=(0,dd.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(Do.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==Do.Status.OK){let{code:r,details:i}=(0,EF.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new RT.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,dd.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new RT.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};hd.ResolvingCall=Ng});var kT=M(hi=>{"use strict";Object.defineProperty(hi,"__esModule",{value:!0});hi.RetryingCall=hi.MessageBufferTracker=hi.RetryThrottler=void 0;var fd=me(),IF=Gt(),DF=Ge(),MF="retrying_call",Fg=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};hi.RetryThrottler=Fg;var Lg=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};hi.MessageBufferTracker=Lg;var Pg="grpc-previous-rpc-attempts",Bg=class{constructor(e,t,r,i,s,o,a,l,c){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){DF.trace(fd.LogVerbosity.DEBUG,MF,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new IF.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(fd.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===fd.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(r===null)a=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(r,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===fd.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set(Pg,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&o.set(Pg,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&o.metadata.set(Pg,`${r}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};hi.RetryingCall=Bg});var md=M(pd=>{"use strict";Object.defineProperty(pd,"__esModule",{value:!0});pd.BaseSubchannelWrapper=void 0;var Vg=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};pd.BaseSubchannelWrapper=Vg});var PT=M(vd=>{"use strict";Object.defineProperty(vd,"__esModule",{value:!0});vd.InternalChannel=void 0;var RF=eu(),xF=sC(),kF=wT(),OT=Qr(),pl=me(),OF=Tg(),NF=IT(),NT=Un(),qg=Ge(),PF=fg(),gd=Yt(),tr=on(),ml=es(),FF=MT(),LF=sd(),BF=xT(),Ug=yg(),VF=ad(),zg=kT(),qF=md(),UF=2147483647,zF=1e3,GF=30*60*1e3,yd=new Map,jF=1<<24,WF=1<<20,Gg=class extends qF.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},jg=class{constructor(e,t,r){var i,s,o,a,l,c,u,d;if(this.credentials=t,this.options=r,this.connectivityState=tr.ConnectivityState.IDLE,this.currentPicker=new OT.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new ml.ChannelzCallTracker,this.childrenTracker=new ml.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof RF.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let f=(0,gd.parseUri)(e);if(f===null)throw new Error(`Could not parse target name "${e}"`);let v=(0,NT.mapUriDefaultScheme)(f);if(v===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},UF),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new ml.ChannelzTrace,this.channelzRef=(0,ml.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,NT.getDefaultAuthority)(v);let T=(0,PF.mapProxyName)(v,r);this.target=T.target,this.options=Object.assign({},this.options,T.extraOptions),this.subchannelPool=(0,kF.getSubchannelPool)(((o=r["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new zg.MessageBufferTracker((a=r["grpc.retry_buffer_size"])!==null&&a!==void 0?a:jF,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:WF),this.keepaliveTime=(c=r["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=r["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:GF,zF);let A={createSubchannel:(P,D)=>{let F=this.subchannelPool.getOrCreateSubchannel(this.target,P,Object.assign({},this.options,D),this.credentials);F.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",F.getChannelzRef());let L=new Gg(F,this);return this.wrappedSubchannels.add(L),L},updateState:(P,D)=>{this.currentPicker=D;let F=this.pickQueue.slice();this.pickQueue=[],F.length>0&&this.callRefTimerUnref();for(let L of F)L.doPick();this.updateState(P)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:P=>{this.channelzEnabled&&this.childrenTracker.refChild(P)},removeChannelzChild:P=>{this.channelzEnabled&&this.childrenTracker.unrefChild(P)}};this.resolvingLoadBalancer=new xF.ResolvingLoadBalancer(this.target,A,r,(P,D)=>{P.retryThrottling?yd.set(this.getTarget(),new zg.RetryThrottler(P.retryThrottling.maxTokens,P.retryThrottling.tokenRatio,yd.get(this.getTarget()))):yd.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=D,this.currentResolutionError=null,process.nextTick(()=>{let F=this.configSelectionQueue;this.configSelectionQueue=[],F.length>0&&this.callRefTimerUnref();for(let L of F)L.getConfig()})},P=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+P.code+' and details "'+P.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,VF.restrictControlPlaneStatusCode)(P.code,P.details)),{metadata:P.metadata}));let D=this.configSelectionQueue;this.configSelectionQueue=[],D.length>0&&this.callRefTimerUnref();for(let F of D)F.reportResolverError(P)}),this.filterStackFactory=new OF.FilterStackFactory([new NF.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let E=new Error;(0,qg.trace)(pl.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((d=E.stack)===null||d===void 0?void 0:d.substring(E.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,qg.trace)(t??pl.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,gd.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,qg.trace)(pl.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,gd.uriToString)(this.target)+" "+tr.ConnectivityState[this.connectivityState]+" -> "+tr.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+tr.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==tr.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(tr.ConnectivityState.IDLE),this.currentPicker=new OT.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(r=(t=this.idleTimer).unref)===null||r===void 0||r.call(t)}maybeStartIdleTimer(){this.connectivityState!==tr.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===pl.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let o=(0,Ug.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new FF.LoadBalancingCall(this,e,t,r,i,s,o)}createRetryingCall(e,t,r,i,s){let o=(0,Ug.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new zg.RetryingCall(this,e,t,r,i,s,o,this.retryBufferTracker,yd.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let o=(0,Ug.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,LF.deadlineToString)(t));let a={deadline:t,flags:s??pl.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new BF.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(tr.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,ml.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,gd.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===tr.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===tr.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};vd.InternalChannel=jg});var Hp=M(_d=>{"use strict";Object.defineProperty(_d,"__esModule",{value:!0});_d.ChannelImplementation=void 0;var KF=eu(),$F=PT(),Wg=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof KF.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new $F.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};_d.ChannelImplementation=Wg});var jT=M(mn=>{"use strict";Object.defineProperty(mn,"__esModule",{value:!0});mn.Http2ServerCallStream=mn.ServerDuplexStreamImpl=mn.ServerWritableStreamImpl=mn.ServerReadableStreamImpl=mn.ServerUnaryCallImpl=void 0;var UT=_e("events"),Mo=_e("http2"),Hg=_e("stream"),FT=_e("zlib"),Re=me(),Qg=Gt(),HF=mg(),zT=Ge(),yl=Hc(),GT="server_call";function gl(n){zT.trace(Re.LogVerbosity.DEBUG,GT,n)}var QF="grpc-accept-encoding",YF="grpc-encoding",LT="grpc-message",BT="grpc-status",VT="grpc-timeout",JF=/(\d{1,8})\s*([HMSmun])/,XF={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},ZF={[QF]:"identity,deflate,gzip",[YF]:"identity"},qT={[Mo.constants.HTTP2_HEADER_STATUS]:Mo.constants.HTTP_STATUS_OK,[Mo.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},eL={waitForTrailers:!0},Kg=class extends UT.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};mn.ServerUnaryCallImpl=Kg;var bd=class extends Hg.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};mn.ServerReadableStreamImpl=bd;var vl=class extends Hg.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new Qg.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,yl.getErrorMessage)(i),code:Re.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:Re.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};mn.ServerWritableStreamImpl=vl;var Ro=class extends Hg.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new Qg.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};mn.ServerDuplexStreamImpl=Ro;Ro.prototype._read=bd.prototype._read;Ro.prototype._write=vl.prototype._write;Ro.prototype._final=vl.prototype._final;var $g=class extends UT.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=Re.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Re.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;gl("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:Re.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if(t==="identity")return r;if(t==="deflate"||t==="gzip"){let i;return t==="deflate"?i=FT.createInflate():i=FT.createGunzip(),new Promise((s,o)=>{let a=0,l=[];i.on("data",c=>{l.push(c),a+=c.byteLength,this.maxReceiveMessageSize!==-1&&a>this.maxReceiveMessageSize&&(i.destroy(),o({code:Re.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),i.on("end",()=>{s(Buffer.concat(l))}),i.write(r),i.end()})}else return Promise.reject({code:Re.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},qT),ZF),t);this.stream.respond(r,eL)}receiveMetadata(e){let t=Qg.Metadata.fromHttp2Headers(e);zT.isTracerEnabled(GT)&&gl("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(VT);if(r.length>0){let i=r[0].toString().match(JF);if(i===null){let a=new Error("Invalid deadline");return a.code=Re.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+i[1]*XF[i[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(tL,s,this),t.remove(VT)}return t.remove(Mo.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(Mo.constants.HTTP2_HEADER_TE),t.remove(Mo.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(d){if(s+=d.byteLength,l!==-1&&s>l){i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),r({code:Re.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(d)}function u(d){if(i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),d!==void 0){r({code:Re.Status.INTERNAL,details:d.message});return}if(s===0){r({code:Re.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let f=Buffer.concat(a,s),T=f.readUInt8(0)===1?e:"identity",A=o.getDecompressedMessage(f,T);if(Buffer.isBuffer(A)){t(o.deserializeMessageWithInternalError(A));return}A.then(E=>t(o.deserializeMessageWithInternalError(E)),E=>r(E.code?E:{code:Re.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return S(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,yl.getErrorMessage)(t),code:Re.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,r,i){return S(this,null,function*(){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:Re.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,yl.getErrorMessage)(s),code:Re.Status.INTERNAL})}}})}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===Re.Status.OK),!this.checkCancelled())if(gl("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+Re.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[BT]:e.code,[LT]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[BT]:e.code,[LT]:encodeURI(e.details)},qT),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:Re.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:Re.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new HF.StreamDecoder(this.maxReceiveMessageSize),i=!1,s=!1,o=!1,a=()=>S(this,null,function*(){!o&&i&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>S(this,null,function*(){let c;try{c=r.write(l)}catch(u){this.sendError({code:Re.Status.RESOURCE_EXHAUSTED,details:u.message});return}s=!0,this.stream.pause();for(let u of c){this.emit("receiveMessage");let f=u.readUInt8(0)===1?t:"identity",v;try{v=yield this.getDecompressedMessage(u,f)}catch(T){this.sendError(T);return}if(!v)return;yield this.pushOrBufferMessage(e,v)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>S(this,null,function*(){i=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return S(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return S(this,null,function*(){if(t===null){gl("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}gl("Received message of length "+t.length),this.isPushPending=!0;try{let r=yield this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,yl.getErrorCode)(r);(i===null||i<Re.Status.OK||i>Re.Status.UNAUTHENTICATED)&&(i=Re.Status.INTERNAL),e.emit("error",{details:(0,yl.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};mn.Http2ServerCallStream=$g;function tL(n){let e=new Error("Deadline exceeded");e.code=Re.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var Xg=M(Cd=>{"use strict";Object.defineProperty(Cd,"__esModule",{value:!0});Cd.ServerCredentials=void 0;var WT=vp(),_l=class{static createInsecure(){return new Yg}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);i.push(a.cert_chain),s.push(a.private_key)}return new Jg({ca:e||(0,WT.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:WT.CIPHER_SUITES})}};Cd.ServerCredentials=_l;var Yg=class extends _l{_isSecure(){return!1}_getSettings(){return null}},Jg=class extends _l{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var HT=M(Td=>{"use strict";Object.defineProperty(Td,"__esModule",{value:!0});Td.Server=void 0;var fi=_e("http2"),Er=me(),ns=jT(),nL=Xg(),KT=Un(),Sd=Ge(),Dn=Gn(),rL=Yt(),Kt=es(),wd=~(1<<31),iL=~(1<<31),sL=2e4,{HTTP2_HEADER_PATH:$T}=fi.constants,oL="server";function aL(){}function Zg(n){return{code:Er.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function lL(n,e){let t=Zg(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var ey=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new Kt.ChannelzTrace,this.callTracker=new Kt.ChannelzCallTracker,this.listenerChildrenTracker=new Kt.ChannelzChildrenTracker,this.sessionChildrenTracker=new Kt.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Kt.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:wd,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:wd,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:iL,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:sL,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,Dn.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,Dn.stringToSubchannelAddress)(o.localAddress,o.localPort):null,c;if(e.encrypted){let d=o,f=d.getCipher(),v=d.getCertificate(),T=d.getPeerCertificate();c={cipherSuiteStandardName:(t=f.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:f.standardName?null:f.name,localCertificate:v&&"raw"in v?v.raw:null,remoteCertificate:T&&"raw"in T?T.raw:null}}else c=null;return{remoteAddress:a,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){Sd.trace(Er.LogVerbosity.DEBUG,oL,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[i],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=lL(o,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof nL.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,rL.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,KT.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(v,T)=>{process.nextTick(()=>r(v,T))},l=()=>{let v;if(t._isSecure()){let T=Object.assign(o,t._getSettings());T.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,v=fi.createSecureServer(T),v.on("secureConnection",A=>{A.on("error",E=>{this.trace("An incoming TLS connection closed with error: "+E.message)})})}else v=fi.createServer(o);return v.setTimeout(0,aL),this._setupHandlers(v),v},c=(v,T,A)=>v.length===0?Promise.resolve({port:T,count:A}):Promise.all(v.map(E=>{this.trace("Attempting to bind "+(0,Dn.subchannelAddressToString)(E));let P;(0,Dn.isTcpSubchannelAddress)(E)?P={host:E.host,port:T}:P=E;let D=l();return new Promise((F,L)=>{let W=Z=>{this.trace("Failed to bind "+(0,Dn.subchannelAddressToString)(E)+" with error "+Z.message),F(Z)};D.once("error",W),D.listen(P,()=>{if(this.shutdown){D.close(),F(new Error("bindAsync failed because server is shutdown"));return}let Z=D.address(),b;typeof Z=="string"?b={path:Z}:b={host:Z.address,port:Z.port};let g=(0,Kt.registerChannelzSocket)((0,Dn.subchannelAddressToString)(b),()=>({localAddress:b,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(g),this.http2ServerList.push({server:D,channelzRef:g}),this.trace("Successfully bound "+(0,Dn.subchannelAddressToString)(b)),F("port"in b?b.port:T),D.removeListener("error",W)})})})).then(E=>{let P=0;for(let D of E)if(typeof D=="number"&&(P+=1,D!==T))throw new Error("Invalid state: multiple port numbers added from single address");return{port:T,count:P+A}}),u=v=>{if(v.length===0)return Promise.resolve({port:0,count:0});let T=v[0],A=l();return new Promise((E,P)=>{let D=F=>{this.trace("Failed to bind "+(0,Dn.subchannelAddressToString)(T)+" with error "+F.message),E(u(v.slice(1)))};A.once("error",D),A.listen(T,()=>{if(this.shutdown){A.close(),E({port:0,count:0});return}let F=A.address(),L={host:F.address,port:F.port},W=(0,Kt.registerChannelzSocket)((0,Dn.subchannelAddressToString)(L),()=>({localAddress:L,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(W),this.http2ServerList.push({server:A,channelzRef:W}),this.trace("Successfully bound "+(0,Dn.subchannelAddressToString)(L)),E(c(v.slice(1),F.port,1)),A.removeListener("error",D)})})},d={onSuccessfulResolution:(v,T,A)=>{if(d.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),v.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let E;(0,Dn.isTcpSubchannelAddress)(v[0])?v[0].port===0?E=u(v):E=c(v,v[0].port,0):E=c(v,1,0),E.then(P=>{if(P.count===0){let D=`No address added out of total ${v.length} resolved`;Sd.log(Er.LogVerbosity.ERROR,D),a(new Error(D),0)}else P.count<v.length&&Sd.log(Er.LogVerbosity.INFO,`WARNING Only ${P.count} addresses added out of total ${v.length} resolved`),a(null,P.port)},P=>{let D=`No address added out of total ${v.length} resolved`;Sd.log(Er.LogVerbosity.ERROR,D),a(new Error(D),0)})},onError:v=>{a(new Error(v.details),0)}};(0,KT.createResolver)(s,d,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,Kt.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(fi.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,Kt.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,Kt.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,Kt.unregisterChannelzRef)(o)),i()}));this.sessions.forEach((s,o)=>{o.closed||(r+=1,o.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[fi.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[fi.constants.HTTP2_HEADER_STATUS]:fi.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new ns.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=Er.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[$T],s=this._retrieveHandler(i);if(!s){this._respondWithError(Zg(i),e,r);return}let o=new ns.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===Er.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",a=>{a?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),o.sendError({code:Er.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[$T],i=this._retrieveHandler(r);if(!i){this._respondWithError(Zg(r),e,null);return}let s=new ns.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:Er.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),o=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")cL(e,t,s,o);else if(a==="clientStream")uL(e,t,s,o);else if(a==="serverStream")dL(e,t,s,o);else if(a==="bidi")hL(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var o,a,l,c,u;if(!this.started){s.destroy();return}let d=(0,Kt.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),f={ref:d,streamTracker:new Kt.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,f);let v=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+v),this.sessionChildrenTracker.refChild(d));let T=null,A=null,E=!1;if(this.maxConnectionAgeMs!==wd){let D=this.maxConnectionAgeMs/10,F=Math.random()*D*2-D;T=(l=(a=setTimeout(()=>{var L,W;E=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+v);try{s.goaway(fi.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==wd&&(A=(W=(L=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||W===void 0?void 0:W.call(L))},this.maxConnectionAgeMs+F)).unref)===null||l===void 0?void 0:l.call(a)}let P=(u=(c=setInterval(()=>{var D,F;let L=(F=(D=setTimeout(()=>{E=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+v),s.close()},this.keepaliveTimeoutMs)).unref)===null||F===void 0?void 0:F.call(D);try{s.ping((W,Z,b)=>{clearTimeout(L)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(E||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+v),this.sessionChildrenTracker.unrefChild(d),(0,Kt.unregisterChannelzRef)(d)),T&&clearTimeout(T),A&&clearTimeout(A),P&&clearTimeout(P),this.sessions.delete(s)})})}};Td.Server=ey;function cL(n,e,t,r){return S(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new ns.ServerUnaryCallImpl(n,t,i);e.func(s,(o,a,l,c)=>{n.sendUnaryMessage(o,a,l,c)})}catch(i){n.sendError(i)}})}function uL(n,e,t,r){let i=new ns.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(o,a,l,c){i.destroy(),n.sendUnaryMessage(o,a,l,c)}n.cancelled||(i.on("error",s),e.func(i,s))}function dL(n,e,t,r){return S(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new ns.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}})}function hL(n,e,t,r){let i=new ns.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var QT=M(Ed=>{"use strict";Object.defineProperty(Ed,"__esModule",{value:!0});Ed.StatusBuilder=void 0;var ty=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};Ed.StatusBuilder=ty});var ny=M(pi=>{"use strict";Object.defineProperty(pi,"__esModule",{value:!0});pi.isDuration=pi.durationToMs=pi.msToDuration=void 0;function fL(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}pi.msToDuration=fL;function pL(n){return n.seconds*1e3+n.nanos/1e6|0}pi.durationToMs=pL;function mL(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}pi.isDuration=mL});var uy=M(mi=>{"use strict";var ry;Object.defineProperty(mi,"__esModule",{value:!0});mi.setup=mi.OutlierDetectionLoadBalancer=mi.OutlierDetectionLoadBalancingConfig=void 0;var Id=on(),JT=me(),rs=ny(),XT=dy(),ZT=Wr(),gL=au(),yL=Qr(),YT=Gn(),vL=md(),_L=Ge(),bL="outlier_detection";function dt(n){_L.trace(JT.LogVerbosity.DEBUG,bL,n)}var cy="outlier_detection",CL=((ry=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&ry!==void 0?ry:"true")==="true",SL={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},wL={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function xo(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function iy(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,rs.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function Ad(n,e,t){let r=t?`${t}.${e}`:e;if(xo(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var bl=class n{constructor(e,t,r,i,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},SL),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},wL),o):null}getLoadBalancerName(){return cy}toJsonObject(){return{interval:(0,rs.msToDuration)(this.intervalMs),base_ejection_time:(0,rs.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,rs.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(iy(e,"interval"),iy(e,"base_ejection_time"),iy(e,"max_ejection_time"),Ad(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");xo(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),Ad(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),xo(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),xo(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");Ad(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),Ad(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),xo(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),xo(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,rs.durationToMs)(e.interval):null,e.base_ejection_time?(0,rs.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,rs.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(ZT.validateLoadBalancingConfig))}};mi.OutlierDetectionLoadBalancingConfig=bl;var oy=class extends vL.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,i,s,o)})}getConnectivityState(){return this.ejected?Id.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,Id.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,Id.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function sy(){return{success:0,failure:0}}var ay=class{constructor(){this.activeBucket=sy(),this.inactiveBucket=sy()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=sy()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},ly=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===yL.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===JT.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},Dd=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new gL.ChildLoadBalancerHandler((0,XT.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,YT.subchannelAddressToString)(t)),o=new oy(i,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,r)=>{t===Id.ConnectivityState.READY?e.updateState(t,new ly(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;dt("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[d,f]of this.addressMap){let v=f.counter.getLastSuccesses(),T=f.counter.getLastFailures();dt("Stats for "+d+": successes="+v+" failures="+T+" targetRequestVolume="+r),v+T>=r&&(i+=1,s.push(v/(v+T)))}if(dt("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let o=s.reduce((d,f)=>d+f)/s.length,a=0;for(let d of s){let f=d-o;a+=f*f}let l=a/s.length,c=Math.sqrt(l),u=o-c*(t.stdev_factor/1e3);dt("stdev="+c+" ejectionThreshold="+u);for(let[d,f]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let v=f.counter.getLastSuccesses(),T=f.counter.getLastFailures();if(v+T<r)continue;let A=v/(v+T);if(dt("Checking candidate "+d+" successRate="+A),A<u){let E=Math.random()*100;dt("Candidate "+d+" randomNumber="+E+" enforcement_percentage="+t.enforcement_percentage),E<t.enforcement_percentage&&(dt("Ejecting candidate "+d),this.eject(f,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;dt("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),o=i.counter.getLastFailures();s+o>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(dt("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let c=Math.random()*100;dt("Candidate "+i+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(dt("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(dt("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(r.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),o<new Date&&(dt("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof bl))return;let i=new Set;for(let o of e)i.add((0,YT.subchannelAddressToString)(o));for(let o of i)this.addressMap.has(o)||(dt("Adding map entry for "+o),this.addressMap.set(o,{counter:new ay,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())i.has(o)||(dt("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,ZT.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){dt("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else dt("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{dt("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return cy}};mi.OutlierDetectionLoadBalancer=Dd;function TL(){CL&&(0,XT.registerLoadBalancerType)(cy,Dd,bl)}mi.setup=TL});var dy=M(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.OutlierDetectionLoadBalancingConfig=ee.BaseSubchannelWrapper=ee.registerAdminService=ee.FilterStackFactory=ee.BaseFilter=ee.PickResultType=ee.QueuePicker=ee.UnavailablePicker=ee.ChildLoadBalancerHandler=ee.subchannelAddressToString=ee.validateLoadBalancingConfig=ee.getFirstUsableConfig=ee.registerLoadBalancerType=ee.createChildChannelControlHelper=ee.BackoffTimeout=ee.durationToMs=ee.uriToString=ee.createResolver=ee.registerResolver=ee.log=ee.trace=void 0;var eE=Ge();Object.defineProperty(ee,"trace",{enumerable:!0,get:function(){return eE.trace}});Object.defineProperty(ee,"log",{enumerable:!0,get:function(){return eE.log}});var tE=Un();Object.defineProperty(ee,"registerResolver",{enumerable:!0,get:function(){return tE.registerResolver}});Object.defineProperty(ee,"createResolver",{enumerable:!0,get:function(){return tE.createResolver}});var EL=Yt();Object.defineProperty(ee,"uriToString",{enumerable:!0,get:function(){return EL.uriToString}});var AL=ny();Object.defineProperty(ee,"durationToMs",{enumerable:!0,get:function(){return AL.durationToMs}});var IL=za();Object.defineProperty(ee,"BackoffTimeout",{enumerable:!0,get:function(){return IL.BackoffTimeout}});var Md=Wr();Object.defineProperty(ee,"createChildChannelControlHelper",{enumerable:!0,get:function(){return Md.createChildChannelControlHelper}});Object.defineProperty(ee,"registerLoadBalancerType",{enumerable:!0,get:function(){return Md.registerLoadBalancerType}});Object.defineProperty(ee,"getFirstUsableConfig",{enumerable:!0,get:function(){return Md.getFirstUsableConfig}});Object.defineProperty(ee,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return Md.validateLoadBalancingConfig}});var DL=Gn();Object.defineProperty(ee,"subchannelAddressToString",{enumerable:!0,get:function(){return DL.subchannelAddressToString}});var ML=au();Object.defineProperty(ee,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return ML.ChildLoadBalancerHandler}});var hy=Qr();Object.defineProperty(ee,"UnavailablePicker",{enumerable:!0,get:function(){return hy.UnavailablePicker}});Object.defineProperty(ee,"QueuePicker",{enumerable:!0,get:function(){return hy.QueuePicker}});Object.defineProperty(ee,"PickResultType",{enumerable:!0,get:function(){return hy.PickResultType}});var RL=Ig();Object.defineProperty(ee,"BaseFilter",{enumerable:!0,get:function(){return RL.BaseFilter}});var xL=Tg();Object.defineProperty(ee,"FilterStackFactory",{enumerable:!0,get:function(){return xL.FilterStackFactory}});var kL=cu();Object.defineProperty(ee,"registerAdminService",{enumerable:!0,get:function(){return kL.registerAdminService}});var OL=md();Object.defineProperty(ee,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return OL.BaseSubchannelWrapper}});var NL=uy();Object.defineProperty(ee,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return NL.OutlierDetectionLoadBalancingConfig}})});var nE=M(Rd=>{"use strict";Object.defineProperty(Rd,"__esModule",{value:!0});Rd.setup=void 0;var PL=Un(),fy=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function FL(){(0,PL.registerResolver)("unix",fy)}Rd.setup=FL});var aE=M(Od=>{"use strict";Object.defineProperty(Od,"__esModule",{value:!0});Od.setup=void 0;var rE=_e("net"),xd=me(),py=Gt(),iE=Un(),sE=Yt(),LL=Ge(),BL="ip_resolver";function oE(n){LL.trace(xd.LogVerbosity.DEBUG,BL,n)}var my="ipv4",gy="ipv6",VL=443,kd=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,oE("Resolver constructed for target "+(0,sE.uriToString)(e));let s=[];if(!(e.scheme===my||e.scheme===gy)){this.error={code:xd.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new py.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,sE.splitHostPort)(a);if(l===null){this.error={code:xd.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new py.Metadata};return}if(e.scheme===my&&!(0,rE.isIPv4)(l.host)||e.scheme===gy&&!(0,rE.isIPv6)(l.host)){this.error={code:xd.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new py.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:VL})}this.addresses=s,oE("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function qL(){(0,iE.registerResolver)(my,kd),(0,iE.registerResolver)(gy,kd)}Od.setup=qL});var uE=M(nr=>{"use strict";Object.defineProperty(nr,"__esModule",{value:!0});nr.setup=nr.PickFirstLoadBalancer=nr.shuffled=nr.PickFirstLoadBalancingConfig=void 0;var lE=Wr(),At=on(),Nd=Qr(),UL=Ge(),zL=me(),GL="pick_first";function yy(n){UL.trace(zL.LogVerbosity.DEBUG,GL,n)}var Cl="pick_first",jL=250,Sl=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return Cl}toJsonObject(){return{[Cl]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};nr.PickFirstLoadBalancingConfig=Sl;var vy=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:Nd.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function cE(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}nr.shuffled=cE;var Pd=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=At.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.onSubchannelStateUpdate(t,r,i,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(At.ConnectivityState.READY,new vy(this.currentPick)):this.children.length===0?this.updateState(At.ConnectivityState.IDLE,new Nd.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(At.ConnectivityState.TRANSIENT_FAILURE,new Nd.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(At.ConnectivityState.CONNECTING,new Nd.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==At.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){r===At.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),r===At.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===At.ConnectivityState.IDLE||i===At.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===At.ConnectivityState.IDLE&&(yy("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},jL)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(yy("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){yy(At.ConnectivityState[this.currentState]+" -> "+At.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===At.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===At.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof Sl&&(t.getShuffleAddressList()&&(e=cE(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===At.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return Cl}};nr.PickFirstLoadBalancer=Pd;function WL(){(0,lE.registerLoadBalancerType)(Cl,Pd,Sl),(0,lE.registerDefaultLoadBalancerType)(Cl)}nr.setup=WL});var hE=M(ko=>{"use strict";Object.defineProperty(ko,"__esModule",{value:!0});ko.setup=ko.RoundRobinLoadBalancer=void 0;var KL=Wr(),It=on(),Fd=Qr(),$L=Gn(),HL=Ge(),QL=me(),YL="round_robin";function dE(n){HL.trace(QL.LogVerbosity.DEBUG,YL,n)}var Ld="round_robin",_y=class n{getLoadBalancerName(){return Ld}constructor(){}toJsonObject(){return{[Ld]:{}}}static createFromJson(e){return new n}},by=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:Fd.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},Bd=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=It.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.calculateAndUpdateState(),(i===It.ConnectivityState.TRANSIENT_FAILURE||i===It.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(It.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===It.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(It.ConnectivityState.READY,new by(e,t))}else this.countSubchannelsWithState(It.ConnectivityState.CONNECTING)>0?this.updateState(It.ConnectivityState.CONNECTING,new Fd.QueuePicker(this)):this.countSubchannelsWithState(It.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(It.ConnectivityState.TRANSIENT_FAILURE,new Fd.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(It.ConnectivityState.IDLE,new Fd.QueuePicker(this))}updateState(e,t){dE(It.ConnectivityState[this.currentState]+" -> "+It.ConnectivityState[e]),e===It.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),dE("Connect to address list "+e.map(r=>(0,$L.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===It.ConnectivityState.IDLE||i===It.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return Ld}};ko.RoundRobinLoadBalancer=Bd;function JL(){(0,KL.registerLoadBalancerType)(Ld,Bd,_y)}ko.setup=JL});var gE=M(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.experimental=K.addAdminServicesToServer=K.getChannelzHandlers=K.getChannelzServiceDefinition=K.InterceptorConfigurationError=K.InterceptingCall=K.RequesterBuilder=K.ListenerBuilder=K.StatusBuilder=K.getClientChannel=K.ServerCredentials=K.Server=K.setLogVerbosity=K.setLogger=K.load=K.loadObject=K.CallCredentials=K.ChannelCredentials=K.waitForClientReady=K.closeClient=K.Channel=K.makeGenericClientConstructor=K.makeClientConstructor=K.loadPackageDefinition=K.Client=K.compressionAlgorithms=K.propagate=K.connectivityState=K.status=K.logVerbosity=K.Metadata=K.credentials=void 0;var Vd=gp();Object.defineProperty(K,"CallCredentials",{enumerable:!0,get:function(){return Vd.CallCredentials}});var XL=Hp();Object.defineProperty(K,"Channel",{enumerable:!0,get:function(){return XL.ChannelImplementation}});var ZL=Eg();Object.defineProperty(K,"compressionAlgorithms",{enumerable:!0,get:function(){return ZL.CompressionAlgorithms}});var e2=on();Object.defineProperty(K,"connectivityState",{enumerable:!0,get:function(){return e2.ConnectivityState}});var qd=eu();Object.defineProperty(K,"ChannelCredentials",{enumerable:!0,get:function(){return qd.ChannelCredentials}});var fE=$p();Object.defineProperty(K,"Client",{enumerable:!0,get:function(){return fE.Client}});var Cy=me();Object.defineProperty(K,"logVerbosity",{enumerable:!0,get:function(){return Cy.LogVerbosity}});Object.defineProperty(K,"status",{enumerable:!0,get:function(){return Cy.Status}});Object.defineProperty(K,"propagate",{enumerable:!0,get:function(){return Cy.Propagate}});var pE=Ge(),Sy=Yp();Object.defineProperty(K,"loadPackageDefinition",{enumerable:!0,get:function(){return Sy.loadPackageDefinition}});Object.defineProperty(K,"makeClientConstructor",{enumerable:!0,get:function(){return Sy.makeClientConstructor}});Object.defineProperty(K,"makeGenericClientConstructor",{enumerable:!0,get:function(){return Sy.makeClientConstructor}});var t2=Gt();Object.defineProperty(K,"Metadata",{enumerable:!0,get:function(){return t2.Metadata}});var n2=HT();Object.defineProperty(K,"Server",{enumerable:!0,get:function(){return n2.Server}});var r2=Xg();Object.defineProperty(K,"ServerCredentials",{enumerable:!0,get:function(){return r2.ServerCredentials}});var i2=QT();Object.defineProperty(K,"StatusBuilder",{enumerable:!0,get:function(){return i2.StatusBuilder}});K.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:qd.ChannelCredentials.createInsecure,createSsl:qd.ChannelCredentials.createSsl,createFromSecureContext:qd.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:Vd.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:Vd.CallCredentials.createFromGoogleCredential,createEmpty:Vd.CallCredentials.createEmpty};var s2=n=>n.close();K.closeClient=s2;var o2=(n,e,t)=>n.waitForReady(e,t);K.waitForClientReady=o2;var a2=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};K.loadObject=a2;var l2=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};K.load=l2;var c2=n=>{pE.setLogger(n)};K.setLogger=c2;var u2=n=>{pE.setLoggerVerbosity(n)};K.setLogVerbosity=u2;var d2=n=>fE.Client.prototype.getChannel.call(n);K.getClientChannel=d2;var Ud=jp();Object.defineProperty(K,"ListenerBuilder",{enumerable:!0,get:function(){return Ud.ListenerBuilder}});Object.defineProperty(K,"RequesterBuilder",{enumerable:!0,get:function(){return Ud.RequesterBuilder}});Object.defineProperty(K,"InterceptingCall",{enumerable:!0,get:function(){return Ud.InterceptingCall}});Object.defineProperty(K,"InterceptorConfigurationError",{enumerable:!0,get:function(){return Ud.InterceptorConfigurationError}});var mE=es();Object.defineProperty(K,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return mE.getChannelzServiceDefinition}});Object.defineProperty(K,"getChannelzHandlers",{enumerable:!0,get:function(){return mE.getChannelzHandlers}});var h2=cu();Object.defineProperty(K,"addAdminServicesToServer",{enumerable:!0,get:function(){return h2.addAdminServicesToServer}});var f2=dy();K.experimental=f2;var p2=hg(),m2=nE(),g2=aE(),y2=uE(),v2=hE(),_2=uy(),b2=es();p2.setup(),m2.setup(),g2.setup(),y2.setup(),v2.setup(),_2.setup(),b2.setup()});var wM="firebase",TM="10.14.1";qr(wM,TM,"app");var Ki=new Ff("ANGULARFIRE2_VERSION");var EM=(n,e)=>{let t=e?[e]:Eb(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Wi=class{constructor(){return EM(AM)}},AM="app-check";function Gf(){}var Gc=class{zone;delegate;constructor(e,t=Z0){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},jf=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Gf,{},Gf,Gf)),t.pipe(ib({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},jc=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Gc(Zone.current)),this.insideAngular=t.run(()=>new Gc(Zone.current,Rc)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(ae(Lr))};static \u0275prov=_n({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function IM(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function zt(n){return DM(IM())(n)}function DM(n){return function(t){return t=t.lift(new jf(n.ngZone)),t.pipe(Ls(n.outsideAngular),Ui(n.insideAngular))}}var xM=new Map,kM={activated:!1,tokenObservers:[]},OM={initialized:!1,enabled:!1};function bn(n){return xM.get(n)||Object.assign({},kM)}function xb(){return OM}var NM="https://content-firebaseappcheck.googleapis.com/v1";var PM="exchangeDebugToken",Ib={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},j9=24*60*60*1e3;var Kf=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return S(this,null,function*(){this.stop();try{this.pending=new qf,this.pending.promise.catch(t=>{}),yield FM(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new qf,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function FM(n){return new Promise(e=>{setTimeout(e,n)})}var LM={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Ur=new wb("appCheck","AppCheck",LM);function kb(n){if(!bn(n).activated)throw Ur.create("use-before-activation",{appName:n.name})}function Ob(r,i){return S(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let v=yield o.getHeartbeatsHeader();v&&(s["X-Firebase-Client"]=v)}let a={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,a)}catch(v){throw Ur.create("fetch-network-error",{originalErrorMessage:v?.message})}if(l.status!==200)throw Ur.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(v){throw Ur.create("fetch-parse-error",{originalErrorMessage:v?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw Ur.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let d=Number(u[1])*1e3,f=Date.now();return{token:c.token,expireTimeMillis:f+d,issuedAtTimeMillis:f}})}function Nb(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${NM}/projects/${t}/apps/${r}:${PM}?key=${i}`,body:{debug_token:e}}}var BM="firebase-app-check-database",VM=1,$f="firebase-app-check-store";var Wc=null;function qM(){return Wc||(Wc=new Promise((n,e)=>{try{let t=indexedDB.open(BM,VM);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Ur.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore($f,{keyPath:"compositeKey"})}}}catch(t){e(Ur.create("storage-open",{originalErrorMessage:t?.message}))}}),Wc)}function UM(n,e){return zM(GM(n),e)}function zM(n,e){return S(this,null,function*(){let r=(yield qM()).transaction($f,"readwrite"),s=r.objectStore($f).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=l=>{o()},r.onerror=l=>{var c;a(Ur.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function GM(n){return`${n.options.appId}-${n.name}`}var Hf=new zc("@firebase/app-check");function Wf(n,e){return Uc()?UM(n,e).catch(t=>{Hf.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Pb(){return xb().enabled}function Fb(){return S(this,null,function*(){let n=xb();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var jM={error:"UNKNOWN_ERROR"};function WM(n){return bb.encodeString(JSON.stringify(n),!1)}function Qf(n,e=!1){return S(this,null,function*(){let t=n.app;kb(t);let r=bn(t),i=r.token,s;if(i&&!qa(i)&&(r.token=void 0,i=void 0),!i){let l=yield r.cachedTokenPromise;l&&(qa(l)?i=l:yield Wf(t,void 0))}if(!e&&i&&qa(i))return{token:i.token};let o=!1;if(Pb()){r.exchangeTokenPromise||(r.exchangeTokenPromise=Ob(Nb(t,yield Fb()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let l=yield r.exchangeTokenPromise;return yield Wf(t,l),r.token=l,{token:l.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield bn(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?Hf.warn(l.message):Hf.error(l),s=l}let a;return i?s?qa(i)?a={token:i.token,internalError:s}:a=Mb(s):(a={token:i.token},r.token=i,yield Wf(t,i)):a=Mb(s),o&&QM(t,a),a})}function KM(n){return S(this,null,function*(){let e=n.app;kb(e);let{provider:t}=bn(e);if(Pb()){let r=yield Fb(),{token:i}=yield Ob(Nb(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function $M(n,e,t,r){let{app:i}=n,s=bn(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&qa(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),Db(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Db(n))}function Lb(n,e){let t=bn(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function Db(n){let{app:e}=n,t=bn(e),r=t.tokenRefresher;r||(r=HM(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function HM(n){let{app:e}=n;return new Kf(()=>S(this,null,function*(){let t=bn(e),r;if(t.token?r=yield Qf(n,!0):r=yield Qf(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=bn(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},Ib.RETRIAL_MIN_WAIT,Ib.RETRIAL_MAX_WAIT)}function QM(n,e){let t=bn(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function qa(n){return n.expireTimeMillis-Date.now()>0}function Mb(n){return{token:WM(jM),error:n}}var Yf=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=bn(this.app);for(let t of e)Lb(this.app,t.next);return Promise.resolve()}};function YM(n,e){return new Yf(n,e)}function JM(n){return{getToken:e=>Qf(n,e),getLimitedUseToken:()=>KM(n),addTokenListener:e=>$M(n,"INTERNAL",e),removeTokenListener:e=>Lb(n.app,e)}}var XM="@firebase/app-check",ZM="0.8.8";var eR="app-check",Rb="app-check-internal";function tR(){Va(new ji(eR,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return YM(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Rb).initialize()})),Va(new ji(Rb,n=>{let e=n.getProvider("app-check").getImmediate();return JM(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),qr(XM,ZM)}tR();var nR=["localhost","0.0.0.0","127.0.0.1"],nG=typeof window<"u"&&nR.includes(window.location.hostname);var rR="firebase",iR="10.14.1";Ot.registerVersion(rR,iR,"app-compat");var sR=["ngOnDestroy"],qb=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(sR.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[s];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,c)=>o.then(u=>{let d=u?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,d),d})})})});var Kc=class{constructor(e){return e}},js=new Ke("angularfire2.app.options"),Ws=new Ke("angularfire2.app.name");function Ua(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=Ot.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>Ot.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;oR("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Kc(o)}var oR=(n,...e)=>{Lf()&&typeof console<"u"&&console[n](...e)},aR={provide:Kc,useFactory:Ua,deps:[js,Lr,[new sb,Ws]]},Ub=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:js,useValue:t},{provide:Ws,useValue:r}]}}constructor(t){Ot.registerVersion("angularfire",Ki.full,"core"),Ot.registerVersion("angularfire",Ki.full,"app-compat"),Ot.registerVersion("angular",db.full,t.toString())}static \u0275fac=function(r){return new(r||n)(ae(Vs))};static \u0275mod=pr({type:n});static \u0275inj=fr({providers:[aR]})}return n})();function $c(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return lR(i,o)||(Vb("error",`${e} was already initialized on the ${t} Firebase App with different settings.${cR?" You may need to reload as Firebase is not HMR aware.":""}`),Vb("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function lR(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var cR=typeof module<"u"&&!!module.hot,Vb=(n,...e)=>{Lf()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Jf=new Ke("angularfire2.auth.use-emulator"),Xf=new Ke("angularfire2.auth.settings"),Zf=new Ke("angularfire2.auth.tenant-id"),ep=new Ke("angularfire2.auth.langugage-code"),tp=new Ke("angularfire2.auth.use-device-language"),np=new Ke("angularfire.auth.persistence"),rp=(n,e,t,r,i,s,o,a)=>$c(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),r&&(l.tenantId=r),l.languageCode=i,s&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,r,i,s,o,a]),$i=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,l,c,u,d,f,v){let T=new Mc,A=Fr(void 0).pipe(Ui(o.outsideAngular),zi(()=>s.runOutsideAngular(()=>import("./chunk-5EZX7N77.mjs"))),pt(()=>Ua(t,s,r)),pt(E=>rp(E,s,a,c,u,d,l,f)),Rf({bufferSize:1,refCount:!1}));if(Bc(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Fr(null);else{A.pipe(rb()).subscribe();let E=A.pipe(zi(F=>F.getRedirectResult().then(L=>L,()=>null)),zt,Rf({bufferSize:1,refCount:!1})),P=A.pipe(zi(F=>new Qt(L=>({unsubscribe:s.runOutsideAngular(()=>F.onAuthStateChanged(W=>L.next(W),W=>L.error(W),()=>L.complete()))})))),D=A.pipe(zi(F=>new Qt(L=>({unsubscribe:s.runOutsideAngular(()=>F.onIdTokenChanged(W=>L.next(W),W=>L.error(W),()=>L.complete()))}))));this.authState=E.pipe(xf(P),Ls(o.outsideAngular),Ui(o.insideAngular)),this.user=E.pipe(xf(D),Ls(o.outsideAngular),Ui(o.insideAngular)),this.idToken=this.user.pipe(zi(F=>F?Fn(F.getIdToken()):Fr(null))),this.idTokenResult=this.user.pipe(zi(F=>F?Fn(F.getIdTokenResult()):Fr(null))),this.credential=tb(E,T,this.authState.pipe(ka(F=>!F))).pipe(pt(F=>F?.user?F:null),Ls(o.outsideAngular),Ui(o.insideAngular))}return qb(this,A,s,{spy:{apply:(E,P,D)=>{(E.startsWith("signIn")||E.startsWith("createUser"))&&D.then(F=>T.next(F))}}})}static \u0275fac=function(r){return new(r||n)(ae(js),ae(Ws,8),ae(Vs),ae(Lr),ae(jc),ae(Jf,8),ae(Xf,8),ae(Zf,8),ae(ep,8),ae(tp,8),ae(np,8),ae(Wi,8))};static \u0275prov=_n({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),zb=(()=>{class n{constructor(){Ot.registerVersion("angularfire",Ki.full,"auth-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=pr({type:n});static \u0275inj=fr({providers:[$i]})}return n})();import{inspect as C2,TextEncoder as S2,TextDecoder as w2}from"util";import{randomBytes as T2}from"crypto";var Gb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},jb={};var zr,ip;(function(){var n;function e(b,g){function y(){}y.prototype=g.prototype,b.D=g.prototype,b.prototype=new y,b.prototype.constructor=b,b.C=function(_,p,C){for(var h=Array(arguments.length-2),m=2;m<arguments.length;m++)h[m-2]=arguments[m];return g.prototype[p].apply(_,h)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(b,g,y){y||(y=0);var _=Array(16);if(typeof g=="string")for(var p=0;16>p;++p)_[p]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(p=0;16>p;++p)_[p]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=b.g[0],y=b.g[1],p=b.g[2];var C=b.g[3],h=g+(C^y&(p^C))+_[0]+3614090360&4294967295;g=y+(h<<7&4294967295|h>>>25),h=C+(p^g&(y^p))+_[1]+3905402710&4294967295,C=g+(h<<12&4294967295|h>>>20),h=p+(y^C&(g^y))+_[2]+606105819&4294967295,p=C+(h<<17&4294967295|h>>>15),h=y+(g^p&(C^g))+_[3]+3250441966&4294967295,y=p+(h<<22&4294967295|h>>>10),h=g+(C^y&(p^C))+_[4]+4118548399&4294967295,g=y+(h<<7&4294967295|h>>>25),h=C+(p^g&(y^p))+_[5]+1200080426&4294967295,C=g+(h<<12&4294967295|h>>>20),h=p+(y^C&(g^y))+_[6]+2821735955&4294967295,p=C+(h<<17&4294967295|h>>>15),h=y+(g^p&(C^g))+_[7]+4249261313&4294967295,y=p+(h<<22&4294967295|h>>>10),h=g+(C^y&(p^C))+_[8]+1770035416&4294967295,g=y+(h<<7&4294967295|h>>>25),h=C+(p^g&(y^p))+_[9]+2336552879&4294967295,C=g+(h<<12&4294967295|h>>>20),h=p+(y^C&(g^y))+_[10]+4294925233&4294967295,p=C+(h<<17&4294967295|h>>>15),h=y+(g^p&(C^g))+_[11]+2304563134&4294967295,y=p+(h<<22&4294967295|h>>>10),h=g+(C^y&(p^C))+_[12]+1804603682&4294967295,g=y+(h<<7&4294967295|h>>>25),h=C+(p^g&(y^p))+_[13]+4254626195&4294967295,C=g+(h<<12&4294967295|h>>>20),h=p+(y^C&(g^y))+_[14]+2792965006&4294967295,p=C+(h<<17&4294967295|h>>>15),h=y+(g^p&(C^g))+_[15]+1236535329&4294967295,y=p+(h<<22&4294967295|h>>>10),h=g+(p^C&(y^p))+_[1]+4129170786&4294967295,g=y+(h<<5&4294967295|h>>>27),h=C+(y^p&(g^y))+_[6]+3225465664&4294967295,C=g+(h<<9&4294967295|h>>>23),h=p+(g^y&(C^g))+_[11]+643717713&4294967295,p=C+(h<<14&4294967295|h>>>18),h=y+(C^g&(p^C))+_[0]+3921069994&4294967295,y=p+(h<<20&4294967295|h>>>12),h=g+(p^C&(y^p))+_[5]+3593408605&4294967295,g=y+(h<<5&4294967295|h>>>27),h=C+(y^p&(g^y))+_[10]+38016083&4294967295,C=g+(h<<9&4294967295|h>>>23),h=p+(g^y&(C^g))+_[15]+3634488961&4294967295,p=C+(h<<14&4294967295|h>>>18),h=y+(C^g&(p^C))+_[4]+3889429448&4294967295,y=p+(h<<20&4294967295|h>>>12),h=g+(p^C&(y^p))+_[9]+568446438&4294967295,g=y+(h<<5&4294967295|h>>>27),h=C+(y^p&(g^y))+_[14]+3275163606&4294967295,C=g+(h<<9&4294967295|h>>>23),h=p+(g^y&(C^g))+_[3]+4107603335&4294967295,p=C+(h<<14&4294967295|h>>>18),h=y+(C^g&(p^C))+_[8]+1163531501&4294967295,y=p+(h<<20&4294967295|h>>>12),h=g+(p^C&(y^p))+_[13]+2850285829&4294967295,g=y+(h<<5&4294967295|h>>>27),h=C+(y^p&(g^y))+_[2]+4243563512&4294967295,C=g+(h<<9&4294967295|h>>>23),h=p+(g^y&(C^g))+_[7]+1735328473&4294967295,p=C+(h<<14&4294967295|h>>>18),h=y+(C^g&(p^C))+_[12]+2368359562&4294967295,y=p+(h<<20&4294967295|h>>>12),h=g+(y^p^C)+_[5]+4294588738&4294967295,g=y+(h<<4&4294967295|h>>>28),h=C+(g^y^p)+_[8]+2272392833&4294967295,C=g+(h<<11&4294967295|h>>>21),h=p+(C^g^y)+_[11]+1839030562&4294967295,p=C+(h<<16&4294967295|h>>>16),h=y+(p^C^g)+_[14]+4259657740&4294967295,y=p+(h<<23&4294967295|h>>>9),h=g+(y^p^C)+_[1]+2763975236&4294967295,g=y+(h<<4&4294967295|h>>>28),h=C+(g^y^p)+_[4]+1272893353&4294967295,C=g+(h<<11&4294967295|h>>>21),h=p+(C^g^y)+_[7]+4139469664&4294967295,p=C+(h<<16&4294967295|h>>>16),h=y+(p^C^g)+_[10]+3200236656&4294967295,y=p+(h<<23&4294967295|h>>>9),h=g+(y^p^C)+_[13]+681279174&4294967295,g=y+(h<<4&4294967295|h>>>28),h=C+(g^y^p)+_[0]+3936430074&4294967295,C=g+(h<<11&4294967295|h>>>21),h=p+(C^g^y)+_[3]+3572445317&4294967295,p=C+(h<<16&4294967295|h>>>16),h=y+(p^C^g)+_[6]+76029189&4294967295,y=p+(h<<23&4294967295|h>>>9),h=g+(y^p^C)+_[9]+3654602809&4294967295,g=y+(h<<4&4294967295|h>>>28),h=C+(g^y^p)+_[12]+3873151461&4294967295,C=g+(h<<11&4294967295|h>>>21),h=p+(C^g^y)+_[15]+530742520&4294967295,p=C+(h<<16&4294967295|h>>>16),h=y+(p^C^g)+_[2]+3299628645&4294967295,y=p+(h<<23&4294967295|h>>>9),h=g+(p^(y|~C))+_[0]+4096336452&4294967295,g=y+(h<<6&4294967295|h>>>26),h=C+(y^(g|~p))+_[7]+1126891415&4294967295,C=g+(h<<10&4294967295|h>>>22),h=p+(g^(C|~y))+_[14]+2878612391&4294967295,p=C+(h<<15&4294967295|h>>>17),h=y+(C^(p|~g))+_[5]+4237533241&4294967295,y=p+(h<<21&4294967295|h>>>11),h=g+(p^(y|~C))+_[12]+1700485571&4294967295,g=y+(h<<6&4294967295|h>>>26),h=C+(y^(g|~p))+_[3]+2399980690&4294967295,C=g+(h<<10&4294967295|h>>>22),h=p+(g^(C|~y))+_[10]+4293915773&4294967295,p=C+(h<<15&4294967295|h>>>17),h=y+(C^(p|~g))+_[1]+2240044497&4294967295,y=p+(h<<21&4294967295|h>>>11),h=g+(p^(y|~C))+_[8]+1873313359&4294967295,g=y+(h<<6&4294967295|h>>>26),h=C+(y^(g|~p))+_[15]+4264355552&4294967295,C=g+(h<<10&4294967295|h>>>22),h=p+(g^(C|~y))+_[6]+2734768916&4294967295,p=C+(h<<15&4294967295|h>>>17),h=y+(C^(p|~g))+_[13]+1309151649&4294967295,y=p+(h<<21&4294967295|h>>>11),h=g+(p^(y|~C))+_[4]+4149444226&4294967295,g=y+(h<<6&4294967295|h>>>26),h=C+(y^(g|~p))+_[11]+3174756917&4294967295,C=g+(h<<10&4294967295|h>>>22),h=p+(g^(C|~y))+_[2]+718787259&4294967295,p=C+(h<<15&4294967295|h>>>17),h=y+(C^(p|~g))+_[9]+3951481745&4294967295,b.g[0]=b.g[0]+g&4294967295,b.g[1]=b.g[1]+(p+(h<<21&4294967295|h>>>11))&4294967295,b.g[2]=b.g[2]+p&4294967295,b.g[3]=b.g[3]+C&4294967295}r.prototype.u=function(b,g){g===void 0&&(g=b.length);for(var y=g-this.blockSize,_=this.B,p=this.h,C=0;C<g;){if(p==0)for(;C<=y;)i(this,b,C),C+=this.blockSize;if(typeof b=="string"){for(;C<g;)if(_[p++]=b.charCodeAt(C++),p==this.blockSize){i(this,_),p=0;break}}else for(;C<g;)if(_[p++]=b[C++],p==this.blockSize){i(this,_),p=0;break}}this.h=p,this.o+=g},r.prototype.v=function(){var b=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);b[0]=128;for(var g=1;g<b.length-8;++g)b[g]=0;var y=8*this.o;for(g=b.length-8;g<b.length;++g)b[g]=y&255,y/=256;for(this.u(b),b=Array(16),g=y=0;4>g;++g)for(var _=0;32>_;_+=8)b[y++]=this.g[g]>>>_&255;return b};function s(b,g){var y=a;return Object.prototype.hasOwnProperty.call(y,b)?y[b]:y[b]=g(b)}function o(b,g){this.h=g;for(var y=[],_=!0,p=b.length-1;0<=p;p--){var C=b[p]|0;_&&C==g||(y[p]=C,_=!1)}this.g=y}var a={};function l(b){return-128<=b&&128>b?s(b,function(g){return new o([g|0],0>g?-1:0)}):new o([b|0],0>b?-1:0)}function c(b){if(isNaN(b)||!isFinite(b))return d;if(0>b)return E(c(-b));for(var g=[],y=1,_=0;b>=y;_++)g[_]=b/y|0,y*=4294967296;return new o(g,0)}function u(b,g){if(b.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(b.charAt(0)=="-")return E(u(b.substring(1),g));if(0<=b.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=c(Math.pow(g,8)),_=d,p=0;p<b.length;p+=8){var C=Math.min(8,b.length-p),h=parseInt(b.substring(p,p+C),g);8>C?(C=c(Math.pow(g,C)),_=_.j(C).add(c(h))):(_=_.j(y),_=_.add(c(h)))}return _}var d=l(0),f=l(1),v=l(16777216);n=o.prototype,n.m=function(){if(A(this))return-E(this).m();for(var b=0,g=1,y=0;y<this.g.length;y++){var _=this.i(y);b+=(0<=_?_:4294967296+_)*g,g*=4294967296}return b},n.toString=function(b){if(b=b||10,2>b||36<b)throw Error("radix out of range: "+b);if(T(this))return"0";if(A(this))return"-"+E(this).toString(b);for(var g=c(Math.pow(b,6)),y=this,_="";;){var p=L(y,g).g;y=P(y,p.j(g));var C=((0<y.g.length?y.g[0]:y.h)>>>0).toString(b);if(y=p,T(y))return C+_;for(;6>C.length;)C="0"+C;_=C+_}},n.i=function(b){return 0>b?0:b<this.g.length?this.g[b]:this.h};function T(b){if(b.h!=0)return!1;for(var g=0;g<b.g.length;g++)if(b.g[g]!=0)return!1;return!0}function A(b){return b.h==-1}n.l=function(b){return b=P(this,b),A(b)?-1:T(b)?0:1};function E(b){for(var g=b.g.length,y=[],_=0;_<g;_++)y[_]=~b.g[_];return new o(y,~b.h).add(f)}n.abs=function(){return A(this)?E(this):this},n.add=function(b){for(var g=Math.max(this.g.length,b.g.length),y=[],_=0,p=0;p<=g;p++){var C=_+(this.i(p)&65535)+(b.i(p)&65535),h=(C>>>16)+(this.i(p)>>>16)+(b.i(p)>>>16);_=h>>>16,C&=65535,h&=65535,y[p]=h<<16|C}return new o(y,y[y.length-1]&-2147483648?-1:0)};function P(b,g){return b.add(E(g))}n.j=function(b){if(T(this)||T(b))return d;if(A(this))return A(b)?E(this).j(E(b)):E(E(this).j(b));if(A(b))return E(this.j(E(b)));if(0>this.l(v)&&0>b.l(v))return c(this.m()*b.m());for(var g=this.g.length+b.g.length,y=[],_=0;_<2*g;_++)y[_]=0;for(_=0;_<this.g.length;_++)for(var p=0;p<b.g.length;p++){var C=this.i(_)>>>16,h=this.i(_)&65535,m=b.i(p)>>>16,z=b.i(p)&65535;y[2*_+2*p]+=h*z,D(y,2*_+2*p),y[2*_+2*p+1]+=C*z,D(y,2*_+2*p+1),y[2*_+2*p+1]+=h*m,D(y,2*_+2*p+1),y[2*_+2*p+2]+=C*m,D(y,2*_+2*p+2)}for(_=0;_<g;_++)y[_]=y[2*_+1]<<16|y[2*_];for(_=g;_<2*g;_++)y[_]=0;return new o(y,0)};function D(b,g){for(;(b[g]&65535)!=b[g];)b[g+1]+=b[g]>>>16,b[g]&=65535,g++}function F(b,g){this.g=b,this.h=g}function L(b,g){if(T(g))throw Error("division by zero");if(T(b))return new F(d,d);if(A(b))return g=L(E(b),g),new F(E(g.g),E(g.h));if(A(g))return g=L(b,E(g)),new F(E(g.g),g.h);if(30<b.g.length){if(A(b)||A(g))throw Error("slowDivide_ only works with positive integers.");for(var y=f,_=g;0>=_.l(b);)y=W(y),_=W(_);var p=Z(y,1),C=Z(_,1);for(_=Z(_,2),y=Z(y,2);!T(_);){var h=C.add(_);0>=h.l(b)&&(p=p.add(y),C=h),_=Z(_,1),y=Z(y,1)}return g=P(b,p.j(g)),new F(p,g)}for(p=d;0<=b.l(g);){for(y=Math.max(1,Math.floor(b.m()/g.m())),_=Math.ceil(Math.log(y)/Math.LN2),_=48>=_?1:Math.pow(2,_-48),C=c(y),h=C.j(g);A(h)||0<h.l(b);)y-=_,C=c(y),h=C.j(g);T(C)&&(C=f),p=p.add(C),b=P(b,h)}return new F(p,b)}n.A=function(b){return L(this,b).h},n.and=function(b){for(var g=Math.max(this.g.length,b.g.length),y=[],_=0;_<g;_++)y[_]=this.i(_)&b.i(_);return new o(y,this.h&b.h)},n.or=function(b){for(var g=Math.max(this.g.length,b.g.length),y=[],_=0;_<g;_++)y[_]=this.i(_)|b.i(_);return new o(y,this.h|b.h)},n.xor=function(b){for(var g=Math.max(this.g.length,b.g.length),y=[],_=0;_<g;_++)y[_]=this.i(_)^b.i(_);return new o(y,this.h^b.h)};function W(b){for(var g=b.g.length+1,y=[],_=0;_<g;_++)y[_]=b.i(_)<<1|b.i(_-1)>>>31;return new o(y,b.h)}function Z(b,g){var y=g>>5;g%=32;for(var _=b.g.length-y,p=[],C=0;C<_;C++)p[C]=0<g?b.i(C+y)>>>g|b.i(C+y+1)<<32-g:b.i(C+y);return new o(p,b.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,ip=jb.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=u,zr=jb.Integer=o}).apply(typeof Gb<"u"?Gb:typeof self<"u"?self:typeof window<"u"?window:{});var fs=J0(gE(),1),DA=J0(Zm(),1);var yE="@firebase/firestore",vE="4.7.3";var st=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};st.UNAUTHENTICATED=new st(null);st.GOOGLE_CREDENTIALS=new st("google-credentials-uid");st.FIRST_PARTY=new st("first-party-uid");st.MOCK_USER=new st("mock-user");var E2="10.14.0";var fa=E2;function A2(n){fa=n}function I2(n){return C2(n,{depth:100})}var wi=new zc("@firebase/firestore");function qo(){return wi.logLevel}function MA(n){wi.setLogLevel(n)}function O(n,...e){if(wi.logLevel<=qn.DEBUG){let t=e.map(N_);wi.debug(`Firestore (${fa}): ${n}`,...t)}}function Le(n,...e){if(wi.logLevel<=qn.ERROR){let t=e.map(N_);wi.error(`Firestore (${fa}): ${n}`,...t)}}function Rn(n,...e){if(wi.logLevel<=qn.WARN){let t=e.map(N_);wi.warn(`Firestore (${fa}): ${n}`,...t)}}function N_(n){if(typeof n=="string")return n;try{return I2(n)}catch{return n}}function G(n="Unexpected state"){let e=`FIRESTORE (${fa}) INTERNAL ASSERTION FAILED: `+n;throw Le(e),new Error(e)}function H(n,e){n||G()}function RA(n,e){n||G()}function U(n,e){return n}var I={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},R=class extends Sb{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var rt=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Jd=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Ny=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(st.UNAUTHENTICATED))}shutdown(){}},Py=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Fy=class{constructor(e){this.authProvider=e,this.currentUser=st.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){H(this.tokenListener===void 0);let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new rt;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new rt,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>S(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{O("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),o())};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new rt)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(H(typeof r.accessToken=="string"),new Jd(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return H(e===null||typeof e=="string"),new st(e)}},Ly=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=st.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},By=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new Ly(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(st.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Vy=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},qy=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){H(this.tokenListener===void 0);let r=s=>{s.error!=null&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,O("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{O("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(H(typeof t.token=="string"),this.latestAppCheckToken=t.token,new Vy(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}};function D2(n){if(!n)return new Ny;switch(n.type){case"firstParty":return new By(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new R(I.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function M2(n){return T2(n)}var Xd=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=M2(40);for(let o=0;o<s.length;++o)r.length<i&&s[o]<t&&(r+=e.charAt(s[o]%e.length))}return r}};function te(n,e){return n<e?-1:n>e?1:0}function ps(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}function xA(n){return n+"\0"}var _E=-62135596800,bE=1e6,Be=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new R(I.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new R(I.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<_E)throw new R(I.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new R(I.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*bE);return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/bE}_compareTo(e){return this.seconds===e.seconds?te(this.nanoseconds,e.nanoseconds):te(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-_E,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};var J=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new Be(0,0))}static max(){return new n(new Be(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var CE="__name__",Zd=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&G(),r===void 0?r=e.length-t:r>e.length-t&&G(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},ce=class n extends Zd{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new R(I.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},R2=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Je=class n extends Zd{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return R2.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===CE}static keyField(){return new n([CE])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new R(I.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new R(I.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new R(I.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a==="."&&!o?(s(),i++):(r+=a,i++)}if(s(),o)throw new R(I.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var q=class n{constructor(e){this.path=e}static fromPath(e){return new n(ce.fromString(e))}static fromName(e){return new n(ce.fromString(e).popFirst(5))}static empty(){return new n(ce.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ce.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ce.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new ce(e.slice()))}};var Qo=-1,x2=0,Uy=(()=>{class n{constructor(t,r,i,s){this.indexId=t,this.collectionGroup=r,this.fields=i,this.indexState=s}}return n.UNKNOWN_ID=-1,n})();function P_(n){return n.fields.find(e=>e.kind===2)}function ms(n){return n.fields.filter(e=>e.kind!==2)}function k2(n){let e=ms(n);return e.length===0?0:e[e.length-1].kind}function O2(n){return`id=${n.indexId}|cg=${n.collectionGroup}|f=${n.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}var Ko=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Pl=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(x2,yn.min())}};function kA(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=J.fromTimestamp(r===1e9?new Be(t+1,0):new Be(t,r));return new yn(i,q.empty(),e)}function OA(n){return new yn(n.readTime,n.key,Qo)}var yn=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(J.min(),q.empty(),Qo)}static max(){return new n(J.max(),q.empty(),Qo)}};function F_(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=q.comparator(n.documentKey,e.documentKey),t!==0)?t:te(n.largestBatchId,e.largestBatchId)}var NA="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",eh=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Ni(n){return S(this,null,function*(){if(n.code===I.FAILED_PRECONDITION&&n.message===NA)O("LocalStore","Unexpectedly lost primary lease");else throw n})}var w=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&G(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var Zt="SimpleDb",N2=3,th=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new rt,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new hs(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=r=>{let i=L_(r.target.error);this.completionDeferred.reject(new hs(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new hs(t,s)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(O(Zt,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;!this.aborted&&typeof e.commit=="function"&&e.commit()}store(e){let t=this.transaction.objectStore(e);return new Gy(t)}},Ti=class n{constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,n.getIOSVersion(Ba())===12.2&&Le("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return O(Zt,"Removing database:",e),ss(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!Uc())return!1;if(n.isMockPersistence())return!0;let e=Ba(),t=n.getIOSVersion(e),r=0<t&&t<10,i=PA(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static isMockPersistence(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}ensureDb(e){return S(this,null,function*(){return this.db||(O(Zt,"Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new hs(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new R(I.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new R(I.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new hs(e,o))},i.onupgradeneeded=s=>{O(Zt,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.schemaConverter.createOrUpgrade(o,i.transaction,s.oldVersion,this.version).next(()=>{O(Zt,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=t=>this.versionchangelistener(t)),this.db})}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return S(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.ensureDb(e);let a=th.open(this.db,e,s?"readonly":"readwrite",r),l=i(a).next(c=>(a.maybeCommit(),c)).catch(c=>(a.abort(c),w.reject(c))).toPromise();return l.catch(()=>{}),yield a.completionPromise,l}catch(a){let l=a,c=l.name!=="FirebaseError"&&o<N2;if(O(Zt,"Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function PA(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var zy=class{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return ss(this.dbCursor.delete())}},hs=class extends R{constructor(e,t){super(I.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Pi(n){return n.name==="IndexedDbTransactionError"}var Gy=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(O(Zt,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(O(Zt,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ss(r)}add(e){O(Zt,"ADD",this.store.name,e,e);let t=this.store.add(e);return ss(t)}get(e){let t=this.store.get(e);return ss(t).next(r=>(r===void 0&&(r=null),O(Zt,"GET",this.store.name,e,r),r))}delete(e){O(Zt,"DELETE",this.store.name,e);let t=this.store.delete(e);return ss(t)}count(){O(Zt,"COUNT",this.store.name);let e=this.store.count();return ss(e)}loadAll(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new w((o,a)=>{s.onerror=l=>{a(l.target.error)},s.onsuccess=l=>{o(l.target.result)}})}else{let s=this.cursor(r),o=[];return this.iterateCursor(s,(a,l)=>{o.push(l)}).next(()=>o)}}loadFirst(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new w((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}deleteAll(e,t){O(Zt,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let i=this.cursor(r);return this.iterateCursor(i,(s,o,a)=>a.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.iterateCursor(i,t)}iterateSerial(e){let t=this.cursor({});return new w((r,i)=>{t.onerror=s=>{let o=L_(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;if(!o){r();return}e(o.primaryKey,o.value).next(a=>{a?o.continue():r()})}})}iterateCursor(e,t){let r=[];return new w((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a){i();return}let l=new zy(a),c=t(a.primaryKey,a.value,l);if(c instanceof w){let u=c.catch(d=>(l.done(),w.reject(d)));r.push(u)}l.isDone?i():l.skipToKey===null?a.continue():a.continue(l.skipToKey)}}).next(()=>w.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}else return this.store.openCursor(e.range,t)}};function ss(n){return new w((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=L_(r.target.error);t(i)}})}var SE=!1;function L_(n){let e=Ti.getIOSVersion(Ba());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new R("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return SE||(SE=!0,setTimeout(()=>{throw r},0)),r}}return n}var Ml="IndexBackfiller",P2=15*1e3,F2=60*1e3,L2=50,jy=class{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(P2)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}schedule(e){O(Ml,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>S(this,null,function*(){this.task=null;try{let t=yield this.backfiller.backfill();O(Ml,`Documents written: ${t}`)}catch(t){Pi(t)?O(Ml,"Ignoring IndexedDB error during index backfill: ",t):yield Ni(t)}yield this.schedule(F2)}))}},Wy=class{constructor(e,t){this.localStore=e,this.persistence=t}backfill(){return S(this,arguments,function*(e=L2){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))})}writeIndexEntries(e,t){let r=new Set,i=t,s=!0;return w.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o===null||r.has(o))s=!1;else return O(Ml,`Processing collection: ${o}`),this.writeEntriesForCollectionGroup(e,o,i).next(a=>{i-=a,r.add(o)})})).next(()=>t-i)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.getNewOffset(i,s)).next(a=>(O(Ml,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=OA(s);F_(o,r)>0&&(r=o)}),new yn(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var en=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),$o="",Ky="",FA="",LA="";function Lt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=wE(e)),e=B2(n.get(t),e);return wE(e)}function B2(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+=$o+FA;break;case $o:t+=$o+LA;break;default:t+=s}}return t}function wE(n){return n+$o+Ky}function ir(n){let e=n.length;if(H(e>=2),e===2)return H(n.charAt(0)===$o&&n.charAt(1)===Ky),ce.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf($o,s);switch((o<0||o>t)&&G(),n.charAt(o+1)){case Ky:let l=n.substring(s,o),c;i.length===0?c=l:(i+=l,c=i,i=""),r.push(c);break;case FA:i+=n.substring(s,o),i+="\0";break;case LA:i+=n.substring(s,o+1);break;default:G()}s=o+2}return new ce(r)}var os="remoteDocuments";var sc="owner",Oo="owner",oc="mutationQueues",V2="userId",Mn="mutations",BA="batchId",us="userMutationsIndex",VA=["userId","batchId"];function q2(n){return[n]}function Kd(n,e){return[n,Lt(e)]}function qA(n,e,t){return[n,Lt(e),t]}var U2={},pa="documentMutations",jh="remoteDocumentsV14",z2=["prefixPath","collectionGroup","readTime","documentId"],$d="documentKeyIndex",G2=["prefixPath","collectionGroup","documentId"],UA="collectionGroupIndex",j2=["collectionGroup","readTime","prefixPath","documentId"],ac="remoteDocumentGlobal",$y="remoteDocumentGlobalKey",ma="targets",W2="targetId",zA="queryTargetsIndex",K2=["canonicalId","targetId"],ga="targetDocuments",$2=["targetId","path"],B_="documentTargetsIndex",H2=["path","targetId"],nh="targetGlobalKey",Ds="targetGlobal",Fl="collectionParents",Q2=["collectionId","parent"],Yo="clientMetadata",Y2="clientId",Wh="bundles",J2="bundleId",Kh="namedQueries",X2="name",V_="indexConfiguration",Z2="indexId",Hy="collectionGroupIndex",eB="collectionGroup",$h="indexState",tB=["indexId","uid"],GA="sequenceNumberIndex",nB=["uid","sequenceNumber"],Hh="indexEntries",rB=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],jA="documentKeyIndex",iB=["indexId","uid","orderedDocumentKey"],Qh="documentOverlays",sB=["userId","collectionPath","documentId"],Qy="collectionPathOverlayIndex",oB=["userId","collectionPath","largestBatchId"],WA="collectionGroupOverlayIndex",aB=["userId","collectionGroup","largestBatchId"],q_="globals",lB="name",cB=[oc,Mn,pa,os,ma,sc,Ds,ga],uB=cB,dB=[...uB,Yo],hB=[...dB,ac],fB=[...hB,Fl],KA=[...fB,Wh,Kh],pB=[...KA,Qh],$A=[oc,Mn,pa,jh,ma,sc,Ds,ga,Yo,ac,Fl,Wh,Kh,Qh],HA=$A,U_=[...HA,V_,$h,Hh],mB=U_,gB=[...U_,q_];function yB(n){if(n===17)return gB;if(n===16)return mB;if(n===15)return U_;if(n===14)return HA;if(n===13)return $A;if(n===12)return pB;if(n===11)return KA;G()}var Ll=class extends eh{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}};function at(n,e){let t=U(n);return Ti.getStore(t.simpleDbTransaction,e)}function TE(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ms(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function QA(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var xe=class n{constructor(e,t){this.comparator=e,this.root=t||Rl.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Rl.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Rl.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new jo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new jo(this.root,e,this.comparator,!1)}getReverseIterator(){return new jo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new jo(this.root,e,this.comparator,!0)}},jo=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Rl=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw G();let t=this.left.check();if(t!==this.right.check())throw G();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),Yy=class{constructor(){this.size=0}get key(){throw G()}get value(){throw G()}get color(){throw G()}get left(){throw G()}get right(){throw G()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Rl(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};Rl.EMPTY=new Yy;var Te=class n{constructor(e){this.comparator=e,this.data=new xe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new rh(this.data.getIterator())}getIteratorFrom(e){return new rh(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},rh=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function vB(n,e,t,r,i){let s=n.getIterator(),o=e.getIterator(),a=No(s),l=No(o);for(;a||l;){let c=!1,u=!1;if(a&&l){let d=t(a,l);d<0?u=!0:d>0&&(c=!0)}else a!=null?u=!0:c=!0;c?(r(l),l=No(o)):u?(i(a),a=No(s)):(a=No(s),l=No(o))}}function No(n){return n.hasNext()?n.getNext():void 0}var tn=class n{constructor(e){this.fields=e,e.sort(Je.comparator)}static empty(){return new n([])}unionWith(e){let t=new Te(Je.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ps(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function _B(n){return Buffer.from(n,"base64").toString("binary")}function bB(n){return Buffer.from(n,"binary").toString("base64")}function YA(){return!0}var Xe=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=_B(e);return new n(t)}static fromUint8Array(e){let t=CB(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return bB(this.binaryString)}toUint8Array(){return SB(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return te(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Xe.EMPTY_BYTE_STRING=new Xe("");function CB(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function SB(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var wB=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ir(n){if(H(!!n),typeof n=="string"){let e=0,t=wB.exec(n);if(H(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=Ne(n.seconds),t=Ne(n.nanos);return{seconds:e,nanos:t}}}function Ne(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ei(n){return typeof n=="string"?Xe.fromBase64String(n):Xe.fromUint8Array(n)}var JA="server_timestamp",XA="__type__",ZA="__previous_value__",eI="__local_write_time__";function Yh(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[XA])===null||t===void 0?void 0:t.stringValue)===JA}function TB(n,e){let t={fields:{[XA]:{stringValue:JA},[eI]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&Yh(e)&&(e=z_(e)),e&&(t.fields[ZA]=e),{mapValue:t}}function z_(n){let e=n.mapValue.fields[ZA];return Yh(e)?z_(e):e}function Bl(n){let e=Ir(n.mapValue.fields[eI].timestampValue);return new Be(e.seconds,e.nanos)}var Jy=class{constructor(e,t,r,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},EE="(default)",Ai=class n{constructor(e,t){this.projectId=e,this.database=t||EE}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===EE}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function EB(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new R(I.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ai(n.options.projectId,e)}var Si=-1;function lc(n){return n==null}function Vl(n){return n===0&&1/n===-1/0}function tI(n){return typeof n=="number"&&Number.isInteger(n)&&!Vl(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var G_="__type__",nI="__max__",bi={mapValue:{fields:{__type__:{stringValue:nI}}}},j_="__vector__",Jo="value",Hd={nullValue:"NULL_VALUE"};function gs(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Yh(n)?4:iI(n)?9007199254740991:Jh(n)?10:11:G()}function xn(n,e){if(n===e)return!0;let t=gs(n),r=gs(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Bl(n).isEqual(Bl(e));case 3:return AB(n,e);case 5:return n.stringValue===e.stringValue;case 6:return DB(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return IB(n,e);case 2:return MB(n,e);case 9:return ps(n.arrayValue.values||[],e.arrayValue.values||[],xn);case 10:case 11:return RB(n,e);case 9007199254740991:return!0;default:return G()}}function AB(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=Ir(n.timestampValue),r=Ir(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function IB(n,e){return Ne(n.geoPointValue.latitude)===Ne(e.geoPointValue.latitude)&&Ne(n.geoPointValue.longitude)===Ne(e.geoPointValue.longitude)}function DB(n,e){return Ei(n.bytesValue).isEqual(Ei(e.bytesValue))}function MB(n,e){if("integerValue"in n&&"integerValue"in e)return Ne(n.integerValue)===Ne(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=Ne(n.doubleValue),r=Ne(e.doubleValue);return t===r?Vl(t)===Vl(r):isNaN(t)&&isNaN(r)}return!1}function RB(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(TE(t)!==TE(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!xn(t[i],r[i])))return!1;return!0}function ql(n,e){return(n.values||[]).find(t=>xn(t,e))!==void 0}function Ii(n,e){if(n===e)return 0;let t=gs(n),r=gs(e);if(t!==r)return te(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return te(n.booleanValue,e.booleanValue);case 2:return xB(n,e);case 3:return AE(n.timestampValue,e.timestampValue);case 4:return AE(Bl(n),Bl(e));case 5:return te(n.stringValue,e.stringValue);case 6:return NB(n.bytesValue,e.bytesValue);case 7:return kB(n.referenceValue,e.referenceValue);case 8:return OB(n.geoPointValue,e.geoPointValue);case 9:return rI(n.arrayValue,e.arrayValue);case 10:return PB(n.mapValue,e.mapValue);case 11:return FB(n.mapValue,e.mapValue);default:throw G()}}function xB(n,e){let t=Ne(n.integerValue||n.doubleValue),r=Ne(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function AE(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return te(n,e);let t=Ir(n),r=Ir(e),i=te(t.seconds,r.seconds);return i!==0?i:te(t.nanos,r.nanos)}function kB(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=te(t[i],r[i]);if(s!==0)return s}return te(t.length,r.length)}function OB(n,e){let t=te(Ne(n.latitude),Ne(e.latitude));return t!==0?t:te(Ne(n.longitude),Ne(e.longitude))}function NB(n,e){let t=Ei(n),r=Ei(e);return t.compareTo(r)}function rI(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Ii(t[i],r[i]);if(s)return s}return te(t.length,r.length)}function PB(n,e){var t,r,i,s;let o=n.fields||{},a=e.fields||{},l=(t=o[Jo])===null||t===void 0?void 0:t.arrayValue,c=(r=a[Jo])===null||r===void 0?void 0:r.arrayValue,u=te(((i=l?.values)===null||i===void 0?void 0:i.length)||0,((s=c?.values)===null||s===void 0?void 0:s.length)||0);return u!==0?u:rI(l,c)}function FB(n,e){if(n===bi.mapValue&&e===bi.mapValue)return 0;if(n===bi.mapValue)return 1;if(e===bi.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){let a=te(r[o],s[o]);if(a!==0)return a;let l=Ii(t[r[o]],i[s[o]]);if(l!==0)return l}return te(r.length,s.length)}function Xo(n){return W_(n)}function W_(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?BB(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?LB(n.bytesValue):"referenceValue"in n?qB(n.referenceValue):"geoPointValue"in n?VB(n.geoPointValue):"arrayValue"in n?zB(n.arrayValue):"mapValue"in n?UB(n.mapValue):G()}function LB(n){return Ei(n).toBase64()}function BB(n){let e=Ir(n);return`time(${e.seconds},${e.nanos})`}function VB(n){return`geo(${n.latitude},${n.longitude})`}function qB(n){return q.fromName(n).toString()}function UB(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${W_(n.fields[i])}`;return t+"}"}function zB(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=W_(r);return e+"]"}function ys(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Xy(n){return!!n&&"integerValue"in n}function GB(n){return!!n&&"doubleValue"in n}function jB(n){return Xy(n)||GB(n)}function Ul(n){return!!n&&"arrayValue"in n}function IE(n){return!!n&&"nullValue"in n}function DE(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Qd(n){return!!n&&"mapValue"in n}function Jh(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[G_])===null||t===void 0?void 0:t.stringValue)===j_}function xl(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Ms(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=xl(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=xl(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function iI(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===nI}var sI={mapValue:{fields:{[G_]:{stringValue:j_},[Jo]:{arrayValue:{}}}}};function WB(n){return"nullValue"in n?Hd:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?ys(Ai.empty(),q.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Jh(n)?sI:{mapValue:{}}:G()}function KB(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?ys(Ai.empty(),q.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?sI:"mapValue"in n?Jh(n)?{mapValue:{}}:bi:G()}function ME(n,e){let t=Ii(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function RE(n,e){let t=Ii(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Dt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Qd(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=xl(t)}setAll(e){let t=Je.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=xl(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Qd(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return xn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!Qd(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Ms(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(xl(this.value))}};function oI(n){let e=[];return Ms(n.fields,(t,r)=>{let i=new Je([t]);if(Qd(r)){let o=oI(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new tn(e)}var it=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,J.min(),J.min(),J.min(),Dt.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,J.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,J.min(),J.min(),Dt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,J.min(),J.min(),Dt.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(J.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Dt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Dt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=J.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function $B(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?Ii(r,i):G()}var lr=class{constructor(e,t){this.position=e,this.inclusive=t}};function aI(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField())r=q.comparator(q.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);r=Ii(o,a)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function HB(n,e,t){let r=aI(n,e,t);return n.inclusive?r>=0:r>0}function QB(n,e,t){let r=aI(n,e,t);return n.inclusive?r<=0:r<0}function xE(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!xn(r,i))return!1}return!0}var vs=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function YB(n){return n.field.canonicalString()+n.dir}function JB(n){return`${n.field.canonicalString()} (${n.dir})`}function XB(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var ih=class{},oe=class n extends ih{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new tv(e,t,r):t==="array-contains"?new iv(e,r):t==="in"?new sh(e,r):t==="not-in"?new sv(e,r):t==="array-contains-any"?new ov(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new nv(e,r):new rv(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Ii(t,this.value)):t!==null&&gs(this.value)===gs(t)&&this.matchesComparison(Ii(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return G()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Se=class n extends ih{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return Zo(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function Zo(n){return n.op==="and"}function Zy(n){return n.op==="or"}function K_(n){return lI(n)&&Zo(n)}function lI(n){for(let e of n.filters)if(e instanceof Se)return!1;return!0}function ev(n){if(n instanceof oe)return n.field.canonicalString()+n.op.toString()+Xo(n.value);if(K_(n))return n.filters.map(e=>ev(e)).join(",");{let e=n.filters.map(t=>ev(t)).join(",");return`${n.op}(${e})`}}function cI(n,e){if(n instanceof oe)return ZB(n,e);if(n instanceof Se)return eV(n,e);G()}function ZB(n,e){return e instanceof oe&&n.op===e.op&&n.field.isEqual(e.field)&&xn(n.value,e.value)}function eV(n,e){return e instanceof Se&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&cI(i,e.filters[s]),!0):!1}function uI(n,e){let t=n.filters.concat(e);return Se.create(t,n.op)}function dI(n){return n instanceof oe?nV(n):n instanceof Se?tV(n):"Filter"}function tV(n){return n.op.toString()+" {"+n.getFilters().map(dI).join(" ,")+"}"}function nV(n){return`${n.field.canonicalString()} ${n.op} ${Xo(n.value)}`}var tv=class extends oe{constructor(e,t,r){super(e,t,r),this.key=q.fromName(r.referenceValue)}matches(e){let t=q.comparator(e.key,this.key);return this.matchesComparison(t)}},nv=class extends oe{constructor(e,t){super(e,"in",t),this.keys=hI("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},rv=class extends oe{constructor(e,t){super(e,"not-in",t),this.keys=hI("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function hI(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>q.fromName(r.referenceValue))}var iv=class extends oe{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Ul(t)&&ql(t.arrayValue,this.value)}},sh=class extends oe{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&ql(this.value.arrayValue,t)}},sv=class extends oe{constructor(e,t){super(e,"not-in",t)}matches(e){if(ql(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!ql(this.value.arrayValue,t)}},ov=class extends oe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!Ul(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>ql(this.value.arrayValue,r))}};var av=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function lv(n,e=null,t=[],r=[],i=null,s=null,o=null){return new av(n,e,t,r,i,s,o)}function _s(n){let e=U(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>ev(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>YB(r)).join(","),lc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Xo(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Xo(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function rV(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>dI(t)).join(", ")}]`),lc(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>JB(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>Xo(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>Xo(t)).join(",")),`Target(${e})`}function cc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!XB(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!cI(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!xE(n.startAt,e.startAt)?!1:xE(n.endAt,e.endAt)}function oh(n){return q.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Xh(n,e){return n.filters.filter(t=>t instanceof oe&&t.field.isEqual(e))}function iV(n,e){let t=P_(e);if(t===void 0)return null;for(let r of Xh(n,t.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}function sV(n,e){let t=new Map;for(let r of ms(e))for(let i of Xh(n,r.fieldPath))switch(i.op){case"==":case"in":t.set(r.fieldPath.canonicalString(),i.value);break;case"not-in":case"!=":return t.set(r.fieldPath.canonicalString(),i.value),Array.from(t.values())}return null}function oV(n,e){let t=[],r=!0;for(let i of ms(e)){let s=i.kind===0?fI(n,i.fieldPath,n.startAt):pI(n,i.fieldPath,n.startAt);t.push(s.value),r&&(r=s.inclusive)}return new lr(t,r)}function aV(n,e){let t=[],r=!0;for(let i of ms(e)){let s=i.kind===0?pI(n,i.fieldPath,n.endAt):fI(n,i.fieldPath,n.endAt);t.push(s.value),r&&(r=s.inclusive)}return new lr(t,r)}function fI(n,e,t){let r=Hd,i=!0;for(let s of Xh(n,e)){let o=Hd,a=!0;switch(s.op){case"<":case"<=":o=WB(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Hd;break}ME({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];ME({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function pI(n,e,t){let r=bi,i=!0;for(let s of Xh(n,e)){let o=bi,a=!0;switch(s.op){case">=":case">":o=KB(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=bi;break}RE({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];RE({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function lV(n){let e=new Te(Je.comparator),t=!1;for(let r of n.filters)for(let i of r.getFlattenedFilters())i.field.isKeyField()||(i.op==="array-contains"||i.op==="array-contains-any"?t=!0:e=e.add(i.field));for(let r of n.orderBy)r.field.isKeyField()||(e=e.add(r.field));return e.size+(t?1:0)}function cV(n){return n.limit!==null}var kn=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function mI(n,e,t,r,i,s,o,a){return new kn(n,e,t,r,i,s,o,a)}function ya(n){return new kn(n)}function uV(n,e){return new kn(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function kE(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function dV(n){let e=new Te(Je.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function hV(n){return new kn(ce.emptyPath(),n)}function fV(n){return q.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function $_(n){return n.collectionGroup!==null}function ea(n){let e=U(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";dV(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new vs(s,r))}),t.has(Je.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new vs(Je.keyField(),r))}return e.memoizedNormalizedOrderBy}function Bt(n){let e=U(n);return e.memoizedTarget||(e.memoizedTarget=pV(e,ea(n))),e.memoizedTarget}function pV(n,e){if(n.limitType==="F")return lv(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new vs(i.field,s)});let t=n.endAt?new lr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new lr(n.startAt.position,n.startAt.inclusive):null;return lv(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function H_(n,e){let t=n.filters.concat([e]);return new kn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function mV(n,e){let t=n.explicitOrderBy.concat([e]);return new kn(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function ah(n,e,t){return new kn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function gV(n,e){return new kn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function yV(n,e){return new kn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,e)}function uc(n,e){return cc(Bt(n),Bt(e))&&n.limitType===e.limitType}function gI(n){return`${_s(Bt(n))}|lt:${n.limitType}`}function Uo(n){return`Query(target=${rV(Bt(n))}; limitType=${n.limitType})`}function dc(n,e){return e.isFoundDocument()&&vV(n,e)&&_V(n,e)&&bV(n,e)&&CV(n,e)}function vV(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):q.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function _V(n,e){for(let t of ea(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function bV(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function CV(n,e){return!(n.startAt&&!QB(n.startAt,ea(n),e)||n.endAt&&!HB(n.endAt,ea(n),e))}function yI(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function vI(n){return(e,t)=>{let r=!1;for(let i of ea(n)){let s=SV(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function SV(n,e,t){let r=n.field.isKeyField()?q.comparator(e.key,t.key):$B(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return G()}}var cr=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ms(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return QA(this.inner)}size(){return this.innerSize}};var wV=new xe(q.comparator);function $t(){return wV}var _I=new xe(q.comparator);function Il(...n){let e=_I;for(let t of n)e=e.insert(t.key,t);return e}function TV(){return zl()}function bI(n){let e=_I;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function sr(){return zl()}function CI(){return zl()}function zl(){return new cr(n=>n.toString(),(n,e)=>n.isEqual(e))}var EV=new xe(q.comparator);function AV(){return EV}var IV=new Te(q.comparator);function re(...n){let e=IV;for(let t of n)e=e.add(t);return e}var DV=new Te(te);function Q_(){return DV}function Y_(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Vl(e)?"-0":e}}function SI(n){return{integerValue:""+n}}function wI(n,e){return tI(e)?SI(e):Y_(n,e)}var ta=class{constructor(){this._=void 0}};function MV(n,e,t){return n instanceof Di?TB(t,e):n instanceof Dr?EI(n,e):n instanceof Mr?AI(n,e):kV(n,e)}function RV(n,e,t){return n instanceof Dr?EI(n,e):n instanceof Mr?AI(n,e):t}function TI(n,e){return n instanceof Mi?jB(e)?e:{integerValue:0}:null}function xV(n,e){return n instanceof Dr&&e instanceof Dr||n instanceof Mr&&e instanceof Mr?ps(n.elements,e.elements,xn):n instanceof Mi&&e instanceof Mi?xn(n.operand,e.operand):n instanceof Di&&e instanceof Di}var Di=class extends ta{},Dr=class extends ta{constructor(e){super(),this.elements=e}};function EI(n,e){let t=II(e);for(let r of n.elements)t.some(i=>xn(i,r))||t.push(r);return{arrayValue:{values:t}}}var Mr=class extends ta{constructor(e){super(),this.elements=e}};function AI(n,e){let t=II(e);for(let r of n.elements)t=t.filter(i=>!xn(i,r));return{arrayValue:{values:t}}}var Mi=class extends ta{constructor(e,t){super(),this.serializer=e,this.operand=t}};function kV(n,e){let t=TI(n,e),r=OE(t)+OE(n.operand);return Xy(t)&&Xy(n.operand)?SI(r):Y_(n.serializer,r)}function OE(n){return Ne(n.integerValue||n.doubleValue)}function II(n){return Ul(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var bs=class{constructor(e,t){this.field=e,this.transform=t}};function OV(n,e){return n.field.isEqual(e.field)&&xV(n.transform,e.transform)}function NV(n,e){return n===void 0&&e===void 0?!0:n&&e?ps(n,e,(t,r)=>OV(t,r)):!1}var cv=class{constructor(e,t){this.version=e,this.transformResults=t}},je=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Zh(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var na=class{};function DI(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new xi(n.key,je.none()):new Ri(n.key,n.data,je.none());{let t=n.data,r=Dt.empty(),i=new Te(Je.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new On(n.key,r,new tn(i.toArray()),je.none())}}function PV(n,e,t){n instanceof Ri?LV(n,e,t):n instanceof On?VV(n,e,t):UV(n,e,t)}function kl(n,e,t,r){return n instanceof Ri?BV(n,e,t,r):n instanceof On?qV(n,e,t,r):zV(n,e,t)}function FV(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=TI(r.transform,i||null);s!=null&&(t===null&&(t=Dt.empty()),t.set(r.field,s))}return t||null}function NE(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!NV(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var Ri=class extends na{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function LV(n,e,t){let r=n.value.clone(),i=RI(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function BV(n,e,t,r){if(!Zh(n.precondition,e))return t;let i=n.value.clone(),s=xI(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var On=class extends na{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function VV(n,e,t){if(!Zh(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=RI(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(MI(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function qV(n,e,t,r){if(!Zh(n.precondition,e))return t;let i=xI(n.fieldTransforms,r,e),s=e.data;return s.setAll(MI(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function MI(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function RI(n,e,t){let r=new Map;H(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,RV(o,a,t[i]))}return r}function xI(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,MV(s,o,e))}return r}var xi=class extends na{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function UV(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function zV(n,e,t){return Zh(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var Gl=class extends na{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var jl=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let o=r[i];PV(s,e,o)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=kl(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=kl(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=CI();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=DI(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(J.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),re())}isEqual(e){return this.batchId===e.batchId&&ps(this.mutations,e.mutations,(t,r)=>NE(t,r))&&ps(this.baseMutations,e.baseMutations,(t,r)=>NE(t,r))}},uv=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){H(e.mutations.length===r.length);let i=AV(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Wl=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var dv=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var ht=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(ht||{});function kI(n){switch(n){case I.OK:return G();case I.CANCELLED:case I.UNKNOWN:case I.DEADLINE_EXCEEDED:case I.RESOURCE_EXHAUSTED:case I.INTERNAL:case I.UNAVAILABLE:case I.UNAUTHENTICATED:return!1;case I.INVALID_ARGUMENT:case I.NOT_FOUND:case I.ALREADY_EXISTS:case I.PERMISSION_DENIED:case I.FAILED_PRECONDITION:case I.ABORTED:case I.OUT_OF_RANGE:case I.UNIMPLEMENTED:case I.DATA_LOSS:return!0;default:return G()}}function GV(n){return kI(n)&&n!==I.ABORTED}function Yd(n){if(n===void 0)return Le("GRPC error has no .code"),I.UNKNOWN;switch(n){case ht.OK:return I.OK;case ht.CANCELLED:return I.CANCELLED;case ht.UNKNOWN:return I.UNKNOWN;case ht.DEADLINE_EXCEEDED:return I.DEADLINE_EXCEEDED;case ht.RESOURCE_EXHAUSTED:return I.RESOURCE_EXHAUSTED;case ht.INTERNAL:return I.INTERNAL;case ht.UNAVAILABLE:return I.UNAVAILABLE;case ht.UNAUTHENTICATED:return I.UNAUTHENTICATED;case ht.INVALID_ARGUMENT:return I.INVALID_ARGUMENT;case ht.NOT_FOUND:return I.NOT_FOUND;case ht.ALREADY_EXISTS:return I.ALREADY_EXISTS;case ht.PERMISSION_DENIED:return I.PERMISSION_DENIED;case ht.FAILED_PRECONDITION:return I.FAILED_PRECONDITION;case ht.ABORTED:return I.ABORTED;case ht.OUT_OF_RANGE:return I.OUT_OF_RANGE;case ht.UNIMPLEMENTED:return I.UNIMPLEMENTED;case ht.DATA_LOSS:return I.DATA_LOSS;default:return G()}}var hv=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var wy=null;function OI(){return new S2}function jV(){return new w2("utf-8")}var WV=new zr([4294967295,4294967295],0);function PE(n){let e=OI().encode(n),t=new ip;return t.update(e),new Uint8Array(t.digest())}function FE(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new zr([t,r],0),a=new zr([i,s],0);return[o,a]}var fv=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ds(`Invalid padding: ${t}`);if(r<0)throw new ds(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ds(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new ds(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=zr.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(zr.fromNumber(r)));return i.compare(WV)===1&&(i=new zr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=PE(e),[r,i]=FE(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=PE(e),[r,i]=FE(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},ds=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Kl=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,$l.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(J.min(),i,new xe(te),$t(),re())}},$l=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,re(),re(),re())}};var Ho=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},lh=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},ch=class{constructor(e,t,r=Xe.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},uh=class{constructor(){this.pendingResponses=0,this.documentChanges=BE(),this._resumeToken=Xe.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=re(),t=re(),r=re();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:G()}}),new $l(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=BE()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,H(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},KV="WatchChangeAggregator",pv=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=$t(),this.pendingDocumentTargetMapping=LE(),this.pendingTargetResets=new xe(te)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:G()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(oh(s))if(r===0){let o=new q(s.path);this.removeDocumentFromTarget(t,o,it.newNoDocument(o,J.min()))}else H(r===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==r){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}wy?.notifyOnExistenceFilterMismatch($V(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o;try{o=Ei(r).toUint8Array()}catch(l){if(l instanceof hv)return Rn("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new fv(o,i,s)}catch(l){return l instanceof ds?Rn("BloomFilter error: ",l):Rn("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&oh(a.target)){let l=new q(a.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,it.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let r=re();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let i=new Kl(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=$t(),this.pendingDocumentTargetMapping=LE(),this.pendingTargetResets=new xe(te),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new uh,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new Te(te),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||O(KV,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new uh),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function LE(){return new xe(q.comparator)}function BE(){return new xe(q.comparator)}function $V(n,e,t,r,i){var s,o,a,l,c,u;let d={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},f=e.unchangedNames;return f&&(d.bloomFilter={applied:i===0,hashCount:(s=f?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=f?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(u=(c=f?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:v=>{var T;return(T=r?.mightContain(v))!==null&&T!==void 0?T:!1}}),d}var HV=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),QV=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),YV=(()=>{let n={};return n.and="AND",n.or="OR",n})();var mv=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function JV(n){let e=n.code===void 0?I.UNKNOWN:Yd(n.code);return new R(e,n.message||"")}function gv(n,e){return n.useProto3Json||lc(e)?e:{value:e}}function XV(n){let e;return typeof n=="object"?e=n.value:e=n,lc(e)?null:e}function ra(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function ZV(n){let e=Ir(n);return new Be(e.seconds,e.nanos)}function NI(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function eq(n,e){return n.useProto3Json?(H(e===void 0||typeof e=="string"),Xe.fromBase64String(e||"")):(H(e===void 0||e instanceof Buffer||e instanceof Uint8Array),Xe.fromUint8Array(e||new Uint8Array))}function tq(n,e){return ra(n,e.toTimestamp())}function Ye(n){return H(!!n),J.fromTimestamp(ZV(n))}function J_(n,e){return yv(n,e).canonicalString()}function yv(n,e){let t=nq(n).child("documents");return e===void 0?t:t.child(e)}function PI(n){let e=ce.fromString(n);return H(WI(e)),e}function Hl(n,e){return J_(n.databaseId,e.path)}function or(n,e){let t=PI(e);if(t.get(1)!==n.databaseId.projectId)throw new R(I.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new R(I.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new q(BI(t))}function FI(n,e){return J_(n.databaseId,e)}function LI(n){let e=PI(n);return e.length===4?ce.emptyPath():BI(e)}function vv(n){return new ce(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function nq(n){return new ce(["projects",n.projectId,"databases",n.database])}function BI(n){return H(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function VE(n,e,t){return{name:Hl(n,e),fields:t.value.mapValue.fields}}function rq(n,e){return{name:Hl(n,e.key),fields:e.data.value.mapValue.fields,updateTime:ra(n,e.version.toTimestamp()),createTime:ra(n,e.createTime.toTimestamp())}}function VI(n,e,t){let r=or(n,e.name),i=Ye(e.updateTime),s=e.createTime?Ye(e.createTime):J.min(),o=new Dt({mapValue:{fields:e.fields}}),a=it.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function iq(n,e){H(!!e.found),e.found.name,e.found.updateTime;let t=or(n,e.found.name),r=Ye(e.found.updateTime),i=e.found.createTime?Ye(e.found.createTime):J.min(),s=new Dt({mapValue:{fields:e.found.fields}});return it.newFoundDocument(t,r,i,s)}function sq(n,e){H(!!e.missing),H(!!e.readTime);let t=or(n,e.missing),r=Ye(e.readTime);return it.newNoDocument(t,r)}function oq(n,e){return"found"in e?iq(n,e):"missing"in e?sq(n,e):G()}function aq(n,e){let t;if("targetChange"in e){e.targetChange;let r=lq(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=eq(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&JV(o);t=new ch(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=or(n,r.document.name),s=Ye(r.document.updateTime),o=r.document.createTime?Ye(r.document.createTime):J.min(),a=new Dt({mapValue:{fields:r.document.fields}}),l=it.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new Ho(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=or(n,r.document),s=r.readTime?Ye(r.readTime):J.min(),o=it.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Ho([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=or(n,r.document),s=r.removedTargetIds||[];t=new Ho([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new dv(i,s),a=r.targetId;t=new lh(a,o)}else return G();return t}function lq(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:G()}function cq(n){if(!("targetChange"in n))return J.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?J.min():Ye(e.readTime)}function Ql(n,e){let t;if(e instanceof Ri)t={update:VE(n,e.key,e.value)};else if(e instanceof xi)t={delete:Hl(n,e.key)};else if(e instanceof On)t={update:VE(n,e.key,e.data),updateMask:zq(e.fieldMask)};else if(e instanceof Gl)t={verify:Hl(n,e.key)};else return G();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>pq(n,r))),e.precondition.isNone||(t.currentDocument=uq(n,e.precondition)),t}function _v(n,e){let t=e.currentDocument?dq(e.currentDocument):je.none(),r=e.updateTransforms?e.updateTransforms.map(i=>mq(n,i)):[];if(e.update){e.update.name;let i=or(n,e.update.name),s=new Dt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=Gq(e.updateMask);return new On(i,s,o,t,r)}else return new Ri(i,s,t,r)}else if(e.delete){let i=or(n,e.delete);return new xi(i,t)}else if(e.verify){let i=or(n,e.verify);return new Gl(i,t)}else return G()}function uq(n,e){return e.updateTime!==void 0?{updateTime:tq(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:G()}function dq(n){return n.updateTime!==void 0?je.updateTime(Ye(n.updateTime)):n.exists!==void 0?je.exists(n.exists):je.none()}function hq(n,e){let t=n.updateTime?Ye(n.updateTime):Ye(e);return t.isEqual(J.min())&&(t=Ye(e)),new cv(t,n.transformResults||[])}function fq(n,e){return n&&n.length>0?(H(e!==void 0),n.map(t=>hq(t,e))):[]}function pq(n,e){let t=e.transform;if(t instanceof Di)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Dr)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof Mr)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof Mi)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw G()}function mq(n,e){let t=null;if("setToServerValue"in e)H(e.setToServerValue==="REQUEST_TIME"),t=new Di;else if("appendMissingElements"in e){let i=e.appendMissingElements.values||[];t=new Dr(i)}else if("removeAllFromArray"in e){let i=e.removeAllFromArray.values||[];t=new Mr(i)}else"increment"in e?t=new Mi(n,e.increment):G();let r=Je.fromServerFormat(e.fieldPath);return new bs(r,t)}function qI(n,e){return{documents:[FI(n,e.path)]}}function gq(n){let e=n.documents.length;H(e===1);let t=n.documents[0];return Bt(ya(LI(t)))}function UI(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=FI(n,i);let s=Cq(e.filters);s&&(t.structuredQuery.where=s);let o=wq(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=gv(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=Eq(e.startAt)),e.endAt&&(t.structuredQuery.endAt=Aq(e.endAt)),{queryTarget:t,parent:i}}function zI(n){let e=LI(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){H(r===1);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=Sq(t.where));let o=[];t.orderBy&&(o=Tq(t.orderBy));let a=null;t.limit&&(a=XV(t.limit));let l=null;t.startAt&&(l=Iq(t.startAt));let c=null;return t.endAt&&(c=Dq(t.endAt)),mI(e,i,o,s,a,"F",l,c)}function yq(n){return Bt(zI(n))}function vq(n,e){let t=_q(e.purpose);return t==null?null:{"goog-listen-tags":t}}function _q(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return G()}}function bq(n,e){let t,r=e.target;if(oh(r)?t={documents:qI(n,r)}:t={query:UI(n,r).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=NI(n,e.resumeToken);let i=gv(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo(J.min())>0){t.readTime=ra(n,e.snapshotVersion.toTimestamp());let i=gv(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function Cq(n){if(n.length!==0)return jI(Se.create(n,"and"))}function Sq(n){let e=GI(n);return e instanceof Se&&K_(e)?e.getFilters():[e]}function GI(n){return n.unaryFilter!==void 0?Vq(n):n.fieldFilter!==void 0?qq(n):n.compositeFilter!==void 0?Uq(n):G()}function wq(n){if(n.length!==0)return n.map(e=>Pq(e))}function Tq(n){return n.map(e=>Fq(e))}function Eq(n){return{before:n.inclusive,values:n.position}}function Aq(n){return{before:!n.inclusive,values:n.position}}function Iq(n){let e=!!n.before,t=n.values||[];return new lr(t,e)}function Dq(n){let e=!n.before,t=n.values||[];return new lr(t,e)}function Mq(n){return HV[n]}function Rq(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function xq(n){return QV[n]}function kq(n){return YV[n]}function Oq(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return G();default:return G()}}function Nq(n){switch(n){case"AND":return"and";case"OR":return"or";default:return G()}}function zo(n){return{fieldPath:n.canonicalString()}}function Wo(n){return Je.fromServerFormat(n.fieldPath)}function Pq(n){return{field:zo(n.field),direction:Mq(n.dir)}}function Fq(n){return new vs(Wo(n.field),Rq(n.direction))}function jI(n){return n instanceof oe?Bq(n):n instanceof Se?Lq(n):G()}function Lq(n){let e=n.getFilters().map(t=>jI(t));return e.length===1?e[0]:{compositeFilter:{op:kq(n.op),filters:e}}}function Bq(n){if(n.op==="=="){if(DE(n.value))return{unaryFilter:{field:zo(n.field),op:"IS_NAN"}};if(IE(n.value))return{unaryFilter:{field:zo(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(DE(n.value))return{unaryFilter:{field:zo(n.field),op:"IS_NOT_NAN"}};if(IE(n.value))return{unaryFilter:{field:zo(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:zo(n.field),op:xq(n.op),value:n.value}}}function Vq(n){switch(n.unaryFilter.op){case"IS_NAN":let e=Wo(n.unaryFilter.field);return oe.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=Wo(n.unaryFilter.field);return oe.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=Wo(n.unaryFilter.field);return oe.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=Wo(n.unaryFilter.field);return oe.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return G();default:return G()}}function qq(n){return oe.create(Wo(n.fieldFilter.field),Oq(n.fieldFilter.op),n.fieldFilter.value)}function Uq(n){return Se.create(n.compositeFilter.filters.map(e=>GI(e)),Nq(n.compositeFilter.op))}function zq(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Gq(n){let e=n.fieldPaths||[];return new tn(e.map(t=>Je.fromServerFormat(t)))}function WI(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var ia=class n{constructor(e,t,r,i,s=J.min(),o=J.min(),a=Xe.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var dh=class{constructor(e){this.remoteSerializer=e}};function jq(n,e){let t;if(e.document)t=VI(n.remoteSerializer,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=q.fromSegments(e.noDocument.path),i=Ss(e.noDocument.readTime);t=it.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else if(e.unknownDocument){let r=q.fromSegments(e.unknownDocument.path),i=Ss(e.unknownDocument.version);t=it.newUnknownDocument(r,i)}else return G();return e.readTime&&t.setReadTime(Wq(e.readTime)),t}function qE(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:ef(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=rq(n.remoteSerializer,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Cs(e.version)};else if(e.isUnknownDocument())r.unknownDocument={path:t.path.toArray(),version:Cs(e.version)};else return G();return r}function ef(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Wq(n){let e=new Be(n[0],n[1]);return J.fromTimestamp(e)}function Cs(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ss(n){let e=new Be(n.seconds,n.nanoseconds);return J.fromTimestamp(e)}function Kq(n,e,t){let r=t.baseMutations.map(s=>Ql(n.remoteSerializer,s)),i=t.mutations.map(s=>Ql(n.remoteSerializer,s));return{userId:e,batchId:t.batchId,localWriteTimeMs:t.localWriteTime.toMillis(),baseMutations:r,mutations:i}}function as(n,e){let t=(e.baseMutations||[]).map(s=>_v(n.remoteSerializer,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>_v(n.remoteSerializer,s)),i=Be.fromMillis(e.localWriteTimeMs);return new jl(e.batchId,i,t,r)}function Dl(n){let e=Ss(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Ss(n.lastLimboFreeSnapshotVersion):J.min(),r;return $q(n.query)?r=gq(n.query):r=yq(n.query),new ia(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Xe.fromBase64String(n.resumeToken))}function KI(n,e){let t=Cs(e.snapshotVersion),r=Cs(e.lastLimboFreeSnapshotVersion),i;oh(e.target)?i=qI(n.remoteSerializer,e.target):i=UI(n.remoteSerializer,e.target).queryTarget;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:_s(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function $q(n){return n.documents!==void 0}function Hq(n){return{id:n.bundleId,createTime:Ss(n.createTime),version:n.version}}function Qq(n){return{bundleId:n.id,createTime:Cs(Ye(n.createTime)),version:n.version}}function Yq(n){return{name:n.name,query:X_(n.bundledQuery),readTime:Ss(n.readTime)}}function Jq(n){return{name:n.name,readTime:Cs(Ye(n.readTime)),bundledQuery:n.bundledQuery}}function X_(n){let e=zI({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ah(e,e.limit,"L"):e}function Xq(n){return{name:n.name,query:X_(n.bundledQuery),readTime:Ye(n.readTime)}}function Zq(n){return{id:n.id,version:n.version,createTime:Ye(n.createTime)}}function Ty(n,e){return new Wl(e.largestBatchId,_v(n.remoteSerializer,e.overlayMutation))}function eU(n,e,t){let[r,i,s]=$I(e,t.mutation.key);return{userId:e,collectionPath:i,documentId:s,collectionGroup:t.mutation.key.getCollectionGroup(),largestBatchId:t.largestBatchId,overlayMutation:Ql(n.remoteSerializer,t.mutation)}}function $I(n,e){let t=e.path.lastSegment(),r=Lt(e.path.popLast());return[n,r,t]}function tU(n){return{indexId:n.indexId,collectionGroup:n.collectionGroup,fields:n.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function nU(n,e){let t=e?new Pl(e.sequenceNumber,new yn(Ss(e.readTime),new q(ir(e.documentKey)),e.largestBatchId)):Pl.empty(),r=n.fields.map(([i,s])=>new Ko(Je.fromServerFormat(i),s));return new Uy(n.indexId,n.collectionGroup,r,t)}function UE(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Cs(r.readTime),documentKey:Lt(r.documentKey.path),largestBatchId:r.largestBatchId}}var bv=class{getBundleMetadata(e,t){return zE(e).get(t).next(r=>{if(r)return Hq(r)})}saveBundleMetadata(e,t){return zE(e).put(Qq(t))}getNamedQuery(e,t){return GE(e).get(t).next(r=>{if(r)return Yq(r)})}saveNamedQuery(e,t){return GE(e).put(Jq(t))}};function zE(n){return at(n,Wh)}function GE(n){return at(n,Kh)}var hh=class n{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return wl(e).get($I(this.userId,t)).next(r=>r?Ty(this.serializer,r):null)}getOverlays(e,t){let r=sr();return w.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new Wl(t,o);i.push(this.saveOverlay(e,a))}),w.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(Lt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(wl(e).deleteAll(Qy,a))}),w.waitFor(s)}getOverlaysForCollection(e,t,r){let i=sr(),s=Lt(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return wl(e).loadAll(Qy,o).next(a=>{for(let l of a){let c=Ty(this.serializer,l);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=sr(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return wl(e).iterate({index:WA,range:a},(l,c,u)=>{let d=Ty(this.serializer,c);s.size()<i||d.largestBatchId===o?(s.set(d.getKey(),d),o=d.largestBatchId):u.done()}).next(()=>s)}saveOverlay(e,t){return wl(e).put(eU(this.serializer,this.userId,t))}};function wl(n){return at(n,Qh)}var Cv=class{globalsStore(e){return at(e,q_)}getSessionToken(e){return this.globalsStore(e).get("sessionToken").next(r=>{let i=r?.value;return i?Xe.fromUint8Array(i):Xe.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.globalsStore(e).put({name:"sessionToken",value:t.toUint8Array()})}};var rU=5,iU=10,sU=13,Ey=15,oU=20,aU=25,lU=30,cU=37,uU=45,dU=50,hU=53,fU=55,pU=60,mU=2,Ar=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,rU);else if("booleanValue"in e)this.writeValueTypeLabel(t,iU),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,Ey),t.writeNumber(Ne(e.integerValue));else if("doubleValue"in e){let r=Ne(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,sU):(this.writeValueTypeLabel(t,Ey),Vl(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,oU),typeof r=="string"&&(r=Ir(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,lU),t.writeBytes(Ei(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,uU),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?iI(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):Jh(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):G()}writeIndexString(e,t){this.writeValueTypeLabel(t,aU),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,fU);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexVector(e,t){var r,i;let s=e.fields||{};this.writeValueTypeLabel(t,hU);let o=Jo,a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.writeValueTypeLabel(t,Ey),t.writeNumber(Ne(a)),this.writeIndexString(o,t),this.writeIndexValueAux(s[o],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,dU);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,cU),q.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,pU),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(mU)}};Ar.INSTANCE=new Ar;var jE="\uD800",WE="\uDBFF",Po=0,KE=255,$E=1,Fo=255,HE=255,QE=0,gU=64,yU=8,vU=1024;function _U(n){let e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,!1),new Uint8Array(e.buffer)}function bU(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n=n<<4),n>>6||(e+=2,n=n<<2),n>>7||(e+=1),e}function CU(n){let e=0;for(let t=0;t<8;++t){let r=bU(n[t]&255);if(e+=r,r!==8)break}return e}function YE(n){let e=gU-CU(n);return Math.ceil(e/yU)}var Sv=class{constructor(){this.buffer=new Uint8Array(vU),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteAscending(r);else if(r<2048)this.writeByteAscending(960|r>>>6),this.writeByteAscending(128|63&r);else if(t<jE||WE<t)this.writeByteAscending(480|r>>>12),this.writeByteAscending(128|63&r>>>6),this.writeByteAscending(128|63&r);else{let i=t.codePointAt(0);this.writeByteAscending(240|i>>>18),this.writeByteAscending(128|63&i>>>12),this.writeByteAscending(128|63&i>>>6),this.writeByteAscending(128|63&i)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteDescending(r);else if(r<2048)this.writeByteDescending(960|r>>>6),this.writeByteDescending(128|63&r);else if(t<jE||WE<t)this.writeByteDescending(480|r>>>12),this.writeByteDescending(128|63&r>>>6),this.writeByteDescending(128|63&r);else{let i=t.codePointAt(0);this.writeByteDescending(240|i>>>18),this.writeByteDescending(128|63&i>>>12),this.writeByteDescending(128|63&i>>>6),this.writeByteDescending(128|63&i)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=YE(t);this.ensureAvailable(1+r),this.buffer[this.position++]=r&255;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=t[i]&255}writeNumberDescending(e){let t=this.toOrderedBits(e),r=YE(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(r&255);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(t[i]&255)}writeInfinityAscending(){this.writeEscapedByteAscending(Fo),this.writeEscapedByteAscending(HE)}writeInfinityDescending(){this.writeEscapedByteDescending(Fo),this.writeEscapedByteDescending(HE)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=_U(e),r=(t[0]&128)!==0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}writeByteAscending(e){let t=e&255;t===Po?(this.writeEscapedByteAscending(Po),this.writeEscapedByteAscending(KE)):t===Fo?(this.writeEscapedByteAscending(Fo),this.writeEscapedByteAscending(QE)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=e&255;t===Po?(this.writeEscapedByteDescending(Po),this.writeEscapedByteDescending(KE)):t===Fo?(this.writeEscapedByteDescending(Fo),this.writeEscapedByteDescending(QE)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(Po),this.writeEscapedByteAscending($E)}writeSeparatorDescending(){this.writeEscapedByteDescending(Po),this.writeEscapedByteDescending($E)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=this.buffer.length*2;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},wv=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}},Tv=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}},ls=class{constructor(){this.orderedCode=new Sv,this.ascending=new wv(this.orderedCode),this.descending=new Tv(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return e===0?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}};var cs=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}successor(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function gi(n,e){let t=n.indexId-e.indexId;return t!==0||(t=JE(n.arrayValue,e.arrayValue),t!==0)||(t=JE(n.directionalValue,e.directionalValue),t!==0)?t:q.comparator(n.documentKey,e.documentKey)}function JE(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var fh=class{constructor(e){this.inequalityFilters=new Te((t,r)=>Je.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[];for(let t of e.filters){let r=t;r.isInequality()?this.inequalityFilters=this.inequalityFilters.add(r):this.equalityFilters.push(r)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(H(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=P_(e);if(t!==void 0&&!this.hasMatchingEqualityFilter(t))return!1;let r=ms(e),i=new Set,s=0,o=0;for(;s<r.length&&this.hasMatchingEqualityFilter(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!i.has(a.field.canonicalString())){let l=r[s];if(!this.matchesFilter(a,l)||!this.matchesOrderBy(this.orderBys[o++],l))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[o++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new Te(Je.comparator),t=[];for(let r of this.equalityFilters){if(r.field.isKeyField())continue;if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Ko(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Ko(r.field,0))}}for(let r of this.orderBys)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Ko(r.field,r.dir==="asc"?0:1)));return new Uy(Uy.UNKNOWN_ID,this.collectionId,t,Pl.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}matchesOrderBy(e,t){return e.field.isEqual(t.fieldPath)?t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc":!1}};function HI(n){var e,t;if(H(n instanceof oe||n instanceof Se),n instanceof oe)if(n instanceof sh){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>oe.create(n.field,"==",s)))||[];return Se.create(i,"or")}else return n;let r=n.filters.map(i=>HI(i));return Se.create(r,n.op)}function SU(n){if(n.getFilters().length===0)return[];let e=Ev(HI(n));return H(QI(e)),Z_(e)||e0(e)?[e]:e.getFilters()}function Z_(n){return n instanceof oe}function e0(n){return n instanceof Se&&K_(n)}function QI(n){return Z_(n)||e0(n)||wU(n)}function wU(n){if(n instanceof Se&&Zy(n)){for(let e of n.getFilters())if(!Z_(e)&&!e0(e))return!1;return!0}return!1}function Ev(n){if(H(n instanceof oe||n instanceof Se),n instanceof oe)return n;if(n.filters.length===1)return Ev(n.filters[0]);let e=n.filters.map(r=>Ev(r)),t=Se.create(e,n.op);return t=ph(t),QI(t)?t:(H(t instanceof Se),H(Zo(t)),H(t.filters.length>1),t.filters.reduce((r,i)=>t0(r,i)))}function t0(n,e){H(n instanceof oe||n instanceof Se),H(e instanceof oe||e instanceof Se);let t;return n instanceof oe?e instanceof oe?t=TU(n,e):t=XE(n,e):e instanceof oe?t=XE(e,n):t=EU(n,e),ph(t)}function TU(n,e){return Se.create([n,e],"and")}function EU(n,e){if(H(n.filters.length>0&&e.filters.length>0),Zo(n)&&Zo(e))return uI(n,e.getFilters());let t=Zy(n)?n:e,r=Zy(n)?e:n,i=t.filters.map(s=>t0(s,r));return Se.create(i,"or")}function XE(n,e){if(Zo(e))return uI(e,n.getFilters());{let t=e.filters.map(r=>t0(n,r));return Se.create(t,"or")}}function ph(n){if(H(n instanceof oe||n instanceof Se),n instanceof oe)return n;let e=n.getFilters();if(e.length===1)return ph(e[0]);if(lI(n))return n;let t=e.map(i=>ph(i)),r=[];return t.forEach(i=>{i instanceof oe?r.push(i):i instanceof Se&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:Se.create(r,n.op)}var Av=class{constructor(){this.collectionParentIndex=new Yl}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),w.resolve()}getCollectionParents(e,t){return w.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return w.resolve()}deleteFieldIndex(e,t){return w.resolve()}deleteAllFieldIndexes(e){return w.resolve()}createTargetIndexes(e,t){return w.resolve()}getDocumentsMatchingTarget(e,t){return w.resolve(null)}getIndexType(e,t){return w.resolve(0)}getFieldIndexes(e,t){return w.resolve([])}getNextCollectionGroupToUpdate(e){return w.resolve(null)}getMinOffset(e,t){return w.resolve(yn.min())}getMinOffsetFromCollectionGroup(e,t){return w.resolve(yn.min())}updateCollectionGroup(e,t,r){return w.resolve()}updateIndexEntries(e,t){return w.resolve()}},Yl=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Te(ce.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Te(ce.comparator)).toArray()}};var ZE="IndexedDbIndexManager",zd=new Uint8Array(0),Iv=class{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new Yl,this.targetToDnfSubTargets=new cr(r=>_s(r),(r,i)=>cc(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let s={collectionId:r,parent:Lt(i)};return eA(e).put(s)}return w.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[xA(t),""],!1,!0);return eA(e).loadAll(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(ir(o.parent))}return r})}addFieldIndex(e,t){let r=Tl(e),i=tU(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Bo(e);return s.next(a=>{o.put(UE(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}else return s.next()}deleteFieldIndex(e,t){let r=Tl(e),i=Bo(e),s=Lo(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Tl(e),r=Lo(e),i=Bo(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>i.deleteAll())}createTargetIndexes(e,t){return w.forEach(this.getSubTargets(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let o=new fh(r).buildTargetIndex();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){let r=Lo(e),i=!0,s=new Map;return w.forEach(this.getSubTargets(t),o=>this.getFieldIndex(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=re(),a=[];return w.forEach(s,(l,c)=>{O(ZE,`Using index ${O2(l)} to execute ${_s(t)}`);let u=iV(c,l),d=sV(c,l),f=oV(c,l),v=aV(c,l),T=this.encodeBound(l,c,f),A=this.encodeBound(l,c,v),E=this.encodeValues(l,c,d),P=this.generateIndexRanges(l.indexId,u,T,f.inclusive,A,v.inclusive,E);return w.forEach(P,D=>r.loadFirst(D,t.limit).next(F=>{F.forEach(L=>{let W=q.fromSegments(L.documentKey);o.has(W)||(o=o.add(W),a.push(W))})}))}).next(()=>a)}else return w.resolve(null)})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(e.filters.length===0?t=[e]:t=SU(Se.create(e.filters,"and")).map(i=>lv(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t),t)}generateIndexRanges(e,t,r,i,s,o,a){let l=(t!=null?t.length:1)*Math.max(r.length,s.length),c=l/(t!=null?t.length:1),u=[];for(let d=0;d<l;++d){let f=t?this.encodeSingleElement(t[d/c]):zd,v=this.generateLowerBound(e,f,r[d%c],i),T=this.generateUpperBound(e,f,s[d%c],o),A=a.map(E=>this.generateLowerBound(e,f,E,!0));u.push(...this.createRange(v,T,A))}return u}generateLowerBound(e,t,r,i){let s=new cs(e,q.empty(),t,r);return i?s:s.successor()}generateUpperBound(e,t,r,i){let s=new cs(e,q.empty(),t,r);return i?s.successor():s}getFieldIndex(e,t){let r=new fh(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.servedByIndex(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.getSubTargets(t);return w.forEach(i,s=>this.getFieldIndex(e,s).next(o=>{o?r!==0&&o.fields.length<lV(s)&&(r=1):r=0})).next(()=>cV(t)&&i.length>1&&r===2?1:r)}encodeDirectionalElements(e,t){let r=new ls;for(let i of ms(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.forKind(i.kind);Ar.INSTANCE.writeIndexValue(s,o)}return r.encodedBytes()}encodeSingleElement(e){let t=new ls;return Ar.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new ls;return Ar.INSTANCE.writeIndexValue(ys(this.databaseId,t),r.forKind(k2(e))),r.encodedBytes()}encodeValues(e,t,r){if(r===null)return[];let i=[];i.push(new ls);let s=0;for(let o of ms(e)){let a=r[s++];for(let l of i)if(this.isInFilter(t,o.fieldPath)&&Ul(a))i=this.expandIndexValues(i,o,a);else{let c=l.forKind(o.kind);Ar.INSTANCE.writeIndexValue(a,c)}}return this.getEncodedBytes(i)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let l=new ls;l.seed(a.encodedBytes()),Ar.INSTANCE.writeIndexValue(o,l.forKind(t.kind)),s.push(l)}return s}isInFilter(e,t){return!!e.filters.find(r=>r instanceof oe&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Tl(e),i=Bo(e);return(t?r.loadAll(Hy,IDBKeyRange.bound(t,t)):r.loadAll()).next(s=>{let o=[];return w.forEach(s,a=>i.get([a.indexId,this.uid]).next(l=>{o.push(nU(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:te(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Tl(e),s=Bo(e);return this.getNextSequenceNumber(e).next(o=>i.loadAll(Hy,IDBKeyRange.bound(t,t)).next(a=>w.forEach(a,l=>s.put(UE(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return w.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?w.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),w.forEach(l,c=>this.getExistingIndexEntries(e,i,c).next(u=>{let d=this.computeIndexEntries(s,c);return u.isEqual(d)?w.resolve():this.updateEntries(e,s,c,u,d)}))))})}addIndexEntry(e,t,r,i){return Lo(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(r,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,r,i){return Lo(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.encodeDirectionalKey(r,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,r){let i=Lo(e),s=new Te(gi);return i.iterate({index:jA,range:IDBKeyRange.only([r.indexId,this.uid,this.encodeDirectionalKey(r,t)])},(o,a)=>{s=s.add(new cs(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}computeIndexEntries(e,t){let r=new Te(gi),i=this.encodeDirectionalElements(t,e);if(i==null)return r;let s=P_(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Ul(o))for(let a of o.arrayValue.values||[])r=r.add(new cs(t.indexId,e.key,this.encodeSingleElement(a),i))}else r=r.add(new cs(t.indexId,e.key,zd,i));return r}updateEntries(e,t,r,i,s){O(ZE,"Updating index entries for document '%s'",t.key);let o=[];return vB(i,s,gi,a=>{o.push(this.addIndexEntry(e,t,r,a))},a=>{o.push(this.deleteIndexEntry(e,t,r,a))}),w.waitFor(o)}getNextSequenceNumber(e){let t=1;return Bo(e).iterate({index:GA,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,s,o)=>{o.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>gi(o,a)).filter((o,a,l)=>!a||gi(o,l[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=gi(o,e),l=gi(o,t);if(a===0)i[0]=e.successor();else if(a>0&&l<0)i.push(o),i.push(o.successor());else if(l>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.isRangeMatchable(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,zd,[]],l=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,zd,[]];s.push(IDBKeyRange.bound(a,l))}return s}isRangeMatchable(e,t){return gi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(tA)}getMinOffset(e,t){return w.mapArray(this.getSubTargets(t),r=>this.getFieldIndex(e,r).next(i=>i||G())).next(tA)}};function eA(n){return at(n,Fl)}function Lo(n){return at(n,Hh)}function Tl(n){return at(n,V_)}function Bo(n){return at(n,$h)}function tA(n){H(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;F_(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new yn(e.readTime,e.documentKey,t)}function YI(n,e,t){let r=n.store(Mn),i=n.store(pa),s=[],o=IDBKeyRange.only(t.batchId),a=0,l=r.iterate({range:o},(u,d,f)=>(a++,f.delete()));s.push(l.next(()=>{H(a===1)}));let c=[];for(let u of t.mutations){let d=qA(e,u.key.path,t.batchId);s.push(i.delete(d)),c.push(u.key)}return w.waitFor(s).next(()=>c)}function mh(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else if(n.noDocument)e=n.noDocument;else throw G();return JSON.stringify(e).length}var gh=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.documentKeysByBatchId={}}static forUser(e,t,r,i){H(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return yi(e).iterate({index:us,range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=Go(e),o=yi(e);return o.add({}).next(a=>{H(typeof a=="number");let l=new jl(a,t,r,i),c=Kq(this.serializer,this.userId,l),u=[],d=new Te((f,v)=>te(f.canonicalString(),v.canonicalString()));for(let f of i){let v=qA(this.userId,f.key.path,a);d=d.add(f.key.path.popLast()),u.push(o.put(c)),u.push(s.put(v,U2))}return d.forEach(f=>{u.push(this.indexManager.addToCollectionParentIndex(e,f))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=l.keys()}),w.waitFor(u).next(()=>l)})}lookupMutationBatch(e,t){return yi(e).get(t).next(r=>r?(H(r.userId===this.userId),as(this.serializer,r)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?w.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.documentKeysByBatchId[t]=i,i}else return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return yi(e).iterate({index:us,range:i},(o,a,l)=>{a.userId===this.userId&&(H(a.batchId>=r),s=as(this.serializer,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=Si;return yi(e).iterate({index:us,range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,Si],[this.userId,Number.POSITIVE_INFINITY]);return yi(e).loadAll(us,t).next(r=>r.map(i=>as(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Kd(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Go(e).iterate({range:i},(o,a,l)=>{let[c,u,d]=o,f=ir(u);if(c!==this.userId||!t.path.isEqual(f)){l.done();return}return yi(e).get(d).next(v=>{if(!v)throw G();H(v.userId===this.userId),s.push(as(this.serializer,v))})}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Te(te),i=[];return t.forEach(s=>{let o=Kd(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=Go(e).iterate({range:a},(c,u,d)=>{let[f,v,T]=c,A=ir(v);if(f!==this.userId||!s.path.isEqual(A)){d.done();return}r=r.add(T)});i.push(l)}),w.waitFor(i).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Kd(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new Te(te);return Go(e).iterate({range:o},(l,c,u)=>{let[d,f,v]=l,T=ir(f);if(d!==this.userId||!r.isPrefixOf(T)){u.done();return}T.length===i&&(a=a.add(v))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],i=[];return t.forEach(s=>{i.push(yi(e).get(s).next(o=>{if(o===null)throw G();H(o.userId===this.userId),r.push(as(this.serializer,o))}))}),w.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return YI(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),w.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return w.resolve();let r=IDBKeyRange.lowerBound(q2(this.userId)),i=[];return Go(e).iterate({range:r},(s,o,a)=>{if(s[0]!==this.userId){a.done();return}else{let c=ir(s[1]);i.push(c)}}).next(()=>{H(i.length===0)})})}containsKey(e,t){return JI(e,this.userId,t)}getMutationQueueMetadata(e){return XI(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:Si,lastStreamToken:""})}};function JI(n,e,t){let r=Kd(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Go(n).iterate({range:s,keysOnly:!0},(a,l,c)=>{let[u,d,f]=a;u===e&&d===i&&(o=!0),c.done()}).next(()=>o)}function AU(n,e){let t=!1;return XI(n).iterateSerial(r=>JI(n,r,e).next(i=>(i&&(t=!0),w.resolve(!i)))).next(()=>t)}function yi(n){return at(n,Mn)}function Go(n){return at(n,pa)}function XI(n){return at(n,oc)}var Ay=2,sa=class n{constructor(e){this.lastId=e}next(){return this.lastId+=Ay,this.lastId}static forTargetCache(){return new n(2-Ay)}static forSyncEngine(){return new n(1-Ay)}};var Dv=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new sa(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(t=>J.fromTimestamp(new Be(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.saveMetadata(e,i)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Vo(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(r=>(H(r.targetCount>0),r.targetCount-=1,this.saveMetadata(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Vo(e).iterate((o,a)=>{let l=Dl(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>w.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Vo(e).iterate((r,i)=>{let s=Dl(i);t(s)})}retrieveMetadata(e){return nA(e).get(nh).next(t=>(H(t!==null),t))}saveMetadata(e,t){return nA(e).put(nh,t)}saveTargetData(e,t){return Vo(e).put(KI(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(t=>t.targetCount)}getTargetData(e,t){let r=_s(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Vo(e).iterate({range:i,index:zA},(o,a,l)=>{let c=Dl(a);cc(t,c.target)&&(s=c,l.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=_i(e);return t.forEach(o=>{let a=Lt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),w.waitFor(i)}removeMatchingKeys(e,t,r){let i=_i(e);return w.forEach(t,s=>{let o=Lt(s.path);return w.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=_i(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=_i(e),s=re();return i.iterate({range:r,keysOnly:!0},(o,a,l)=>{let c=ir(o[1]),u=new q(c);s=s.add(u)}).next(()=>s)}containsKey(e,t){let r=Lt(t.path),i=IDBKeyRange.bound([r],[xA(r)],!1,!0),s=0;return _i(e).iterate({index:B_,keysOnly:!0,range:i},([o,a],l,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}getTargetDataForTarget(e,t){return Vo(e).get(t).next(r=>r?Dl(r):null)}};function Vo(n){return at(n,ma)}function nA(n){return at(n,Ds)}function _i(n){return at(n,ga)}var rA={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},hc=-1,ZI=40*1024*1024,gn=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};gn.DEFAULT_COLLECTION_PERCENTILE=10;gn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;gn.DEFAULT=new gn(ZI,gn.DEFAULT_COLLECTION_PERCENTILE,gn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);gn.DISABLED=new gn(hc,0,0);var iA="LruGarbageCollector",sA=1*1024*1024,IU=1*60*1e3,DU=5*60*1e3;function oA([n,e],[t,r]){let i=te(n,t);return i===0?te(e,r):i}var Mv=class{constructor(e){this.maxElements=e,this.buffer=new Te(oA),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();oA(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},Rv=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==hc&&this.scheduleGC(IU)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){O(iA,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>S(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Pi(t)?O(iA,"Ignoring IndexedDB error during garbage collection: ",t):yield Ni(t)}yield this.scheduleGC(DU)}))}},xv=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return w.resolve(en.INVALID);let r=new Mv(t);return this.delegate.forEachTarget(e,i=>r.addElement(i.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,i=>r.addElement(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===hc?(O("LruGarbageCollector","Garbage collection skipped; disabled"),w.resolve(rA)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),rA):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,i,s,o,a,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(O("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),i=this.params.maximumSequenceNumbersToCollect):i=d,o=Date.now(),this.nthSequenceNumber(e,i))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,t))).next(d=>(s=d,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>{if(c=Date.now(),qo()<=qn.DEBUG){let f=`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${i} in ${a-o}ms
	Removed ${s} targets in ${l-a}ms
	Removed ${d} documents in ${c-l}ms
Total Duration: ${c-u}ms`;O("LruGarbageCollector",f)}return w.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:d})})}};function MU(n,e){return new xv(n,e)}var kv=class{constructor(e,t){this.db=e,this.garbageCollector=MU(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(r,i)=>t(i))}addReference(e,t,r){return Gd(e,r)}removeReference(e,t,r){return Gd(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Gd(e,t)}isPinned(e,t){return AU(e,t)}removeOrphanedDocuments(e,t){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],o=0;return this.forEachOrphanedDocument(e,(l,c)=>{if(c<=t){let u=this.isPinned(e,l).next(d=>{if(!d)return o++,i.getEntry(e,l).next(()=>(i.removeEntry(l,J.min()),_i(e).delete(RU(l))))});s.push(u)}}).next(()=>w.waitFor(s)).next(()=>i.apply(e)).next(()=>o)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Gd(e,t)}forEachOrphanedDocument(e,t){let r=_i(e),i=en.INVALID,s;return r.iterate({index:B_},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==en.INVALID&&t(new q(ir(s)),i),i=c,s=l):i=en.INVALID}).next(()=>{i!==en.INVALID&&t(new q(ir(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function RU(n){return[0,Lt(n.path)]}function xU(n,e){return{targetId:0,path:Lt(n.path),sequenceNumber:e}}function Gd(n,e){return _i(n).put(xU(e,n.currentSequenceNumber))}var yh=class{constructor(){this.changes=new cr(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,it.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?w.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Ov=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return is(e).put(r)}removeEntry(e,t,r){return is(e).delete(kU(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=it.newInvalidDocument(t);return is(e).iterate({index:$d,range:IDBKeyRange.only(El(t))},(i,s)=>{r=this.maybeDecodeDocument(t,s)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:it.newInvalidDocument(t)};return is(e).iterate({index:$d,range:IDBKeyRange.only(El(t))},(i,s)=>{r={document:this.maybeDecodeDocument(t,s),size:mh(s)}}).next(()=>r)}getEntries(e,t){let r=$t();return this.forEachDbEntry(e,t,(i,s)=>{let o=this.maybeDecodeDocument(i,s);r=r.insert(i,o)}).next(()=>r)}getSizedEntries(e,t){let r=$t(),i=new xe(q.comparator);return this.forEachDbEntry(e,t,(s,o)=>{let a=this.maybeDecodeDocument(s,o);r=r.insert(s,a),i=i.insert(s,mh(o))}).next(()=>({documents:r,sizeMap:i}))}forEachDbEntry(e,t,r){if(t.isEmpty())return w.resolve();let i=new Te(cA);t.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(El(i.first()),El(i.last())),o=i.getIterator(),a=o.getNext();return is(e).iterate({index:$d,range:s},(l,c,u)=>{let d=q.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&cA(a,d)<0;)r(a,null),a=o.getNext();a&&a.isEqual(d)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?u.skip(El(a)):u.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),ef(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return is(e).loadAll(IDBKeyRange.bound(a,l,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let u=$t();for(let d of c){let f=this.maybeDecodeDocument(q.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);f.isFoundDocument()&&(dc(t,f)||i.has(f.key))&&(u=u.insert(f.key,f))}return u})}getAllFromCollectionGroup(e,t,r,i){let s=$t(),o=lA(t,r),a=lA(t,yn.max());return is(e).iterate({index:UA,range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{let d=this.maybeDecodeDocument(q.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(d.key,d),s.size===i&&u.done()}).next(()=>s)}newChangeBuffer(e){return new Nv(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return aA(e).get($y).next(t=>(H(!!t),t))}setMetadata(e,t){return aA(e).put($y,t)}maybeDecodeDocument(e,t){if(t){let r=jq(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(J.min())))return r}return it.newInvalidDocument(e)}};function eD(n){return new Ov(n)}var Nv=class extends yh{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new cr(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new Te((s,o)=>te(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.documentStates.get(s);if(t.push(this.documentCache.removeEntry(e,s,a.readTime)),o.isValidDocument()){let l=qE(this.documentCache.serializer,o);i=i.add(s.path.popLast());let c=mh(l);r+=c-a.size,t.push(this.documentCache.addEntry(e,s,l))}else if(r-=a.size,this.trackRemovals){let l=qE(this.documentCache.serializer,o.convertToNoDocument(J.min()));t.push(this.documentCache.addEntry(e,s,l))}}),i.forEach(s=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.documentCache.updateMetadata(e,r)),w.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(r=>(this.documentStates.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:r,sizeMap:i})=>(i.forEach((s,o)=>{this.documentStates.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function aA(n){return at(n,ac)}function is(n){return at(n,jh)}function El(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function kU(n,e){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],ef(e),t[t.length-1]]}function lA(n,e){let t=e.documentKey.path.toArray();return[n,ef(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function cA(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=te(t[s],r[s]),i)return i;return i=te(t.length,r.length),i||(i=te(t[t.length-2],r[r.length-2]),i)?i:te(t[t.length-1],r[r.length-1])}var OU=17;var Pv=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var vh=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&kl(r.mutation,i,tn.empty(),Be.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,re()).next(()=>r))}getLocalViewOfDocuments(e,t,r=re()){let i=sr();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Il();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=sr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,re()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=$t(),o=zl(),a=TV();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof On)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),kl(u.mutation,c,u.mutation.getFieldMask(),Be.now())):o.set(c.key,tn.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var d;return a.set(c,new Pv(u,(d=o.get(c))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,t){let r=zl(),i=new xe((o,a)=>o-a),s=re();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||tn.empty();u=a.applyToLocalView(c,u),r.set(l,u);let d=(i.get(a.batchId)||re()).add(l);i=i.insert(a.batchId,d)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,d=CI();u.forEach(f=>{if(!s.has(f)){let v=DI(t.get(f),r.get(f));v!==null&&d.set(f,v),s=s.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,d))}return w.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return fV(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):$_(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):w.resolve(sr()),a=Qo,l=s;return o.next(c=>w.forEach(c,(u,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(u)?w.resolve():this.remoteDocumentCache.getEntry(e,u).next(f=>{l=l.insert(u,f)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,re())).next(u=>({batchId:a,changes:bI(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new q(t)).next(r=>{let i=Il();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Il();return this.indexManager.getCollectionParents(e,s).next(a=>w.forEach(a,l=>{let c=uV(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((d,f)=>{o=o.insert(d,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,it.newInvalidDocument(u)))});let a=Il();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&kl(u.mutation,c,tn.empty(),Be.now()),dc(t,c)&&(a=a.insert(l,c))}),a})}};var Fv=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return w.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,Zq(t)),w.resolve()}getNamedQuery(e,t){return w.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,Xq(t)),w.resolve()}};var Lv=class{constructor(){this.overlays=new xe(q.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return w.resolve(this.overlays.get(t))}getOverlays(e,t){let r=sr();return w.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),w.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),w.resolve()}getOverlaysForCollection(e,t,r){let i=sr(),s=t.length+1,o=new q(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return w.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new xe((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let f=s.get(u.largestBatchId);f===null&&(f=sr(),s=s.insert(u.largestBatchId,f)),f.set(u.getKey(),u)}}let a=sr(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,f)=>a.set(d,f)),!(a.size()>=i)););return w.resolve(a)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Wl(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=re(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var Bv=class{constructor(){this.sessionToken=Xe.EMPTY_BYTE_STRING}getSessionToken(e){return w.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,w.resolve()}};var Jl=class{constructor(){this.refsByKey=new Te(nt.compareByKey),this.refsByTarget=new Te(nt.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new nt(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new nt(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new q(new ce([])),r=new nt(t,e),i=new nt(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new q(new ce([])),r=new nt(t,e),i=new nt(t,e+1),s=re();return this.refsByTarget.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new nt(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},nt=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return q.comparator(e.key,t.key)||te(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return te(e.targetOrBatchId,t.targetOrBatchId)||q.comparator(e.key,t.key)}};var Vv=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new Te(nt.compareByKey)}checkEmpty(e){return w.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new jl(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new nt(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return w.resolve(o)}lookupMutationBatch(e,t){return w.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return w.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return w.resolve(this.mutationQueue.length===0?Si:this.nextBatchId-1)}getAllMutationBatches(e){return w.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new nt(t,0),i=new nt(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),w.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Te(te);return t.forEach(i=>{let s=new nt(i,0),o=new nt(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{r=r.add(a.targetOrBatchId)})}),w.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;q.isDocumentKey(s)||(s=s.child(""));let o=new nt(new q(s),0),a=new Te(te);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(a=a.add(l.targetOrBatchId)),!0):!1},o),w.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");H(r===0),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return w.forEach(t.mutations,s=>{let o=new nt(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new nt(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return w.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,w.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function NU(){return new xe(q.comparator)}var qv=class{constructor(e){this.sizer=e,this.docs=NU(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return w.resolve(r?r.document.mutableCopy():it.newInvalidDocument(t))}getEntries(e,t){let r=$t();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():it.newInvalidDocument(i))}),w.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=$t(),o=t.path,a=new q(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||F_(OA(u),r)<=0||!i.has(u.key)&&!dc(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return w.resolve(s)}getAllFromCollectionGroup(e,t,r,i){G()}forEachDocumentKey(e,t){return w.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Uv(this)}getSize(e){return w.resolve(this.size)}};function PU(n){return new qv(n)}var Uv=class extends yh{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),w.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var zv=class{constructor(e){this.persistence=e,this.targets=new cr(t=>_s(t),cc),this.lastRemoteSnapshotVersion=J.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Jl,this.targetCount=0,this.targetIdGenerator=sa.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),w.resolve()}getLastRemoteSnapshotVersion(e){return w.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return w.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),w.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),w.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new sa(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,w.resolve()}updateTargetData(e,t){return this.saveTargetData(t),w.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,w.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),w.waitFor(s).next(()=>i)}getTargetCount(e){return w.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return w.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),w.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),w.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),w.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return w.resolve(r)}containsKey(e,t){return w.resolve(this.references.containsKey(t))}};var FU="MemoryPersistence",_h=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new en(0),this._started=!1,this._started=!0,this.globalsCache=new Bv,this.referenceDelegate=e(this),this.targetCache=new zv(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new Av,this.remoteDocumentCache=PU(r),this.serializer=new dh(t),this.bundleCache=new Fv(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Lv,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new Vv(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){O(FU,"Starting transaction:",e);let i=new Gv(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return w.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},Gv=class extends eh{constructor(e){super(),this.currentSequenceNumber=e}},bh=class n{constructor(e){this.persistence=e,this.localViewReferences=new Jl,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw G()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),w.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),w.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),w.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return w.forEach(this.orphanedDocuments,i=>{let s=q.fromPath(i);return this.isReferenced(e,s).next(o=>{o||r.removeEntry(s,J.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return w.or([()=>w.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var jv=class{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,i){let s=new th("createOrUpgrade",t);r<1&&i>=1&&(BU(e),VU(e),uA(e),UU(e));let o=w.resolve();return r<3&&i>=3&&(r!==0&&(jU(e),uA(e)),o=o.next(()=>KU(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>qU(e,s))),o=o.next(()=>{$U(e)})),r<5&&i>=5&&(o=o.next(()=>this.removeAcknowledgedMutations(s))),r<6&&i>=6&&(o=o.next(()=>(GU(e),this.addDocumentGlobal(s)))),r<7&&i>=7&&(o=o.next(()=>this.ensureSequenceNumbers(s))),r<8&&i>=8&&(o=o.next(()=>this.createCollectionParentIndex(e,s))),r<9&&i>=9&&(o=o.next(()=>{WU(e)})),r<10&&i>=10&&(o=o.next(()=>this.rewriteCanonicalIds(s))),r<11&&i>=11&&(o=o.next(()=>{HU(e),QU(e)})),r<12&&i>=12&&(o=o.next(()=>{JU(e)})),r<13&&i>=13&&(o=o.next(()=>zU(e)).next(()=>this.rewriteRemoteDocumentCache(e,s)).next(()=>e.deleteObjectStore(os))),r<14&&i>=14&&(o=o.next(()=>this.runOverlayMigration(e,s))),r<15&&i>=15&&(o=o.next(()=>YU(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore($h).clear()}).next(()=>{t.objectStore(Hh).clear()})),r<17&&i>=17&&(o=o.next(()=>{XU(e)})),o}addDocumentGlobal(e){let t=0;return e.store(os).iterate((r,i)=>{t+=mh(i)}).next(()=>{let r={byteSize:t};return e.store(ac).put($y,r)})}removeAcknowledgedMutations(e){let t=e.store(oc),r=e.store(Mn);return t.loadAll().next(i=>w.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,Si],[s.userId,s.lastAcknowledgedBatchId]);return r.loadAll(us,o).next(a=>w.forEach(a,l=>{H(l.userId===s.userId);let c=as(this.serializer,l);return YI(e,s.userId,c).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(ga),r=e.store(os);return e.store(Ds).get(nh).next(s=>{let o=l=>t.put({targetId:0,path:Lt(l),sequenceNumber:s.highestListenSequenceNumber}),a=[];return r.iterate((l,c)=>{let u=new ce(l),d=LU(u);a.push(t.get(d).next(f=>f?w.resolve():o(u)))}).next(()=>w.waitFor(a))})}createCollectionParentIndex(e,t){e.createObjectStore(Fl,{keyPath:Q2});let r=t.store(Fl),i=new Yl,s=o=>{if(i.add(o)){let a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Lt(l)})}};return t.store(os).iterate({keysOnly:!0},(o,a)=>{let l=new ce(o);return s(l.popLast())}).next(()=>t.store(pa).iterate({keysOnly:!0},([o,a,l],c)=>{let u=ir(a);return s(u.popLast())}))}rewriteCanonicalIds(e){let t=e.store(ma);return t.iterate((r,i)=>{let s=Dl(i),o=KI(this.serializer,s);return t.put(o)})}rewriteRemoteDocumentCache(e,t){let r=t.store(os),i=[];return r.iterate((s,o)=>{let a=t.store(jh),l=ZU(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>w.waitFor(i))}runOverlayMigration(e,t){let r=t.store(Mn),i=eD(this.serializer),s=new _h(bh.factory,this.serializer.remoteSerializer);return r.loadAll().next(o=>{let a=new Map;return o.forEach(l=>{var c;let u=(c=a.get(l.userId))!==null&&c!==void 0?c:re();as(this.serializer,l).keys().forEach(f=>u=u.add(f)),a.set(l.userId,u)}),w.forEach(a,(l,c)=>{let u=new st(c),d=hh.forUser(this.serializer,u),f=s.getIndexManager(u),v=gh.forUser(u,this.serializer,f,s.referenceDelegate);return new vh(i,v,d,f).recalculateAndSaveOverlaysForDocumentKeys(new Ll(t,en.INVALID),l).next()})})}};function LU(n){return[0,Lt(n)]}function BU(n){n.createObjectStore(sc)}function VU(n){n.createObjectStore(oc,{keyPath:V2}),n.createObjectStore(Mn,{keyPath:BA,autoIncrement:!0}).createIndex(us,VA,{unique:!0}),n.createObjectStore(pa)}function qU(n,e){return e.store(Mn).loadAll().next(r=>{n.deleteObjectStore(Mn),n.createObjectStore(Mn,{keyPath:BA,autoIncrement:!0}).createIndex(us,VA,{unique:!0});let s=e.store(Mn),o=r.map(a=>s.put(a));return w.waitFor(o)})}function UU(n){n.createObjectStore(os)}function zU(n){let e=n.createObjectStore(jh,{keyPath:z2});e.createIndex($d,G2),e.createIndex(UA,j2)}function GU(n){n.createObjectStore(ac)}function uA(n){n.createObjectStore(ga,{keyPath:$2}).createIndex(B_,H2,{unique:!0}),n.createObjectStore(ma,{keyPath:W2}).createIndex(zA,K2,{unique:!0}),n.createObjectStore(Ds)}function jU(n){n.deleteObjectStore(ga),n.deleteObjectStore(ma),n.deleteObjectStore(Ds)}function WU(n){n.objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges")}function KU(n){let e=n.store(Ds),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:J.min().toTimestamp(),targetCount:0};return e.put(nh,t)}function $U(n){n.createObjectStore(Yo,{keyPath:Y2})}function HU(n){n.createObjectStore(Wh,{keyPath:J2})}function QU(n){n.createObjectStore(Kh,{keyPath:X2})}function YU(n){n.createObjectStore(V_,{keyPath:Z2,autoIncrement:!0}).createIndex(Hy,eB,{unique:!1}),n.createObjectStore($h,{keyPath:tB}).createIndex(GA,nB,{unique:!1}),n.createObjectStore(Hh,{keyPath:rB}).createIndex(jA,iB,{unique:!1})}function JU(n){let e=n.createObjectStore(Qh,{keyPath:sB});e.createIndex(Qy,oB,{unique:!1}),e.createIndex(WA,aB,{unique:!1})}function XU(n){n.createObjectStore(q_,{keyPath:lB})}function ZU(n){return n.document?new q(ce.fromString(n.document.name).popFirst(5)):n.noDocument?q.fromSegments(n.noDocument.path):n.unknownDocument?q.fromSegments(n.unknownDocument.path):G()}var vi="IndexedDbPersistence",Iy=30*60*1e3,Dy=5e3,e3=4e3,My="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",t3="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",n3="firestore_zombie",tD="main",Wv=class n{constructor(e,t,r,i,s,o,a,l,c,u,d=OU){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=s,this.window=o,this.document=a,this.sequenceNumberSyncer=c,this.forceOwningTab=u,this.schemaVersion=d,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=f=>Promise.resolve(),!n.isAvailable())throw new R(I.UNIMPLEMENTED,t3);this.referenceDelegate=new kv(this,i),this.dbName=t+tD,this.serializer=new dh(l),this.simpleDb=new Ti(this.dbName,this.schemaVersion,new jv(this.serializer)),this.globalsCache=new Cv,this.targetCache=new Dv(this.referenceDelegate,this.serializer),this.remoteDocumentCache=eD(this.serializer),this.bundleCache=new bv,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,u===!1&&Le(vi,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new R(I.FAILED_PRECONDITION,My);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new en(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=t=>S(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(t=>S(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(()=>S(this,null,function*(){this.started&&(yield this.updateClientMetadataAndTryBecomePrimary())})))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>jd(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(r=>{r||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(r=>this.isPrimary&&!r?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):r?this.acquireOrExtendPrimaryLease(e).next(()=>!0):!1)).catch(e=>{if(Pi(e))return O(vi,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return O(vi,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return Al(e).get(Oo).next(r=>w.resolve(this.isLocalClient(r)))}removeClientMetadata(e){return jd(e).delete(this.clientId)}maybeGarbageCollectMultiClientState(){return S(this,null,function*(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,Iy)){this.lastGarbageCollectionTime=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=at(t,Yo);return r.loadAll().next(i=>{let s=this.filterActiveClients(i,Iy),o=i.filter(a=>s.indexOf(a)===-1);return w.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}})}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",e3,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return e?e.ownerId===this.clientId:!1}canActAsPrimary(e){return this.forceOwningTab?w.resolve(!0):Al(e).get(Oo).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,Dy)&&!this.isClientZombied(r.ownerId)){if(this.isLocalClient(r)&&this.networkEnabled)return!0;if(!this.isLocalClient(r)){if(!r.allowTabSynchronization)throw new R(I.FAILED_PRECONDITION,My);return!1}}return this.networkEnabled&&this.inForeground?!0:jd(e).loadAll().next(s=>this.filterActiveClients(s,Dy).find(a=>{if(this.clientId!==a.clientId){let l=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,u=this.networkEnabled===a.networkEnabled;if(l||c&&u)return!0}return!1})===void 0)}).next(r=>(this.isPrimary!==r&&O(vi,`Client ${r?"is":"is not"} eligible for a primary lease.`),r))}shutdown(){return S(this,null,function*(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),yield this.simpleDb.runTransaction("shutdown","readwrite",[sc,Yo],e=>{let t=new Ll(e,en.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()})}filterActiveClients(e,t){return e.filter(r=>this.isWithinAge(r.updateTimeMs,t)&&!this.isClientZombied(r.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>jd(e).loadAll().next(t=>this.filterActiveClients(t,Iy).map(r=>r.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(e,t){return gh.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Iv(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return hh.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){O(vi,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=yB(this.schemaVersion),o;return this.simpleDb.runTransaction(e,i,s,a=>(o=new Ll(a,this.listenSequence?this.listenSequence.next():en.INVALID),t==="readwrite-primary"?this.verifyPrimaryLease(o).next(l=>l?!0:this.canActAsPrimary(o)).next(l=>{if(!l)throw Le(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new R(I.FAILED_PRECONDITION,NA);return r(o)}).next(l=>this.acquireOrExtendPrimaryLease(o).next(()=>l)):this.verifyAllowTabSynchronization(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(e){return Al(e).get(Oo).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,Dy)&&!this.isClientZombied(r.ownerId)&&!this.isLocalClient(r)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!r.allowTabSynchronization))throw new R(I.FAILED_PRECONDITION,My)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Al(e).put(Oo,t)}static isAvailable(){return Ti.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=Al(e);return t.get(Oo).next(r=>this.isLocalClient(r)?(O(vi,"Releasing primary lease."),t.delete(Oo)):w.resolve())}isWithinAge(e,t){let r=Date.now(),i=r-t,s=r;return e<i?!1:e>s?(Le(`Detected an update time that is in the future: ${e} > ${s}`),!1):!0}attachVisibilityHandler(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground=this.document.visibilityState==="visible")}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.windowUnloadHandler=()=>{this.markClientZombied();let t=/(?:Version|Mobile)\/1[456]/;Uf()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let r=((t=this.webStorage)===null||t===void 0?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return O(vi,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Le(vi,"Failed to get zombied client id.",r),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){Le("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch{}}zombiedClientLocalStorageKey(e){return`${n3}_${this.persistenceKey}_${e}`}};function Al(n){return at(n,sc)}function jd(n){return at(n,Yo)}function n0(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function r3(n){return S(this,null,function*(){if(!Ti.isAvailable())return Promise.resolve();let e=n+tD;yield Ti.delete(e)})}function i3(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}var r0="LocalStore",s3=5*60*1e6,Xl=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new xe(te),this.targetIdByTarget=new cr(s=>_s(s),cc),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new vh(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function nD(n,e,t,r){return new Xl(n,e,t,r)}function rD(n,e){return S(this,null,function*(){let t=U(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{let a=[],l=[],c=re();for(let u of s){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of o){l.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})})}function o3(n,e){let t=U(n),r=Be.now(),i=e.reduce((a,l)=>a.add(l.key),re()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=$t(),c=re();return t.remoteDocuments.getEntries(a,i).next(u=>{l=u,l.forEach((d,f)=>{f.isValidDocument()||(c=c.add(d))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(u=>{s=u;let d=[];for(let f of e){let v=FV(f,s.get(f.key).overlayedDocument);v!=null&&d.push(new On(f.key,v,oI(v.value.mapValue),je.exists(!0)))}return t.mutationQueue.addMutationBatch(a,r,d,e)}).next(u=>{o=u;let d=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(a,u.batchId,d)})}).then(()=>({batchId:o.batchId,changes:bI(s)}))}function a3(n,e){let t=U(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return y3(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,l3(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function l3(n){let e=re();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function c3(n,e){let t=U(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>(H(s!==null),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function u3(n){let e=U(n);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t))}function iD(n){let e=U(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function d3(n,e){let t=U(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,d)=>{let f=i.get(d);if(!f)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,d).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,d)));let v=f.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?v=v.withResumeToken(Xe.EMPTY_BYTE_STRING,J.min()).withLastLimboFreeSnapshotVersion(J.min()):u.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(u.resumeToken,r)),i=i.insert(d,v),h3(f,v,u)&&a.push(t.targetCache.updateTargetData(s,v))});let l=$t(),c=re();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(sD(s,o,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!r.isEqual(J.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(d=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return w.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function sD(n,e,t){let r=re(),i=re();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=$t();return t.forEach((a,l)=>{let c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(J.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):O(r0,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:i}})}function h3(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=s3?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function f3(n,e){return S(this,null,function*(){let t=U(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>w.forEach(e,i=>w.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>w.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(Pi(r))O(r0,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(i,a)}}})}function p3(n,e){let t=U(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Si),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function m3(n,e){let t=U(n);return t.persistence.runTransaction("read document","readonly",r=>t.localDocuments.getDocument(r,e))}function oa(n,e){let t=U(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,w.resolve(i)):t.targetCache.allocateTargetId(r).next(o=>(i=new ia(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function g3(n,e,t){let r=U(n),i=r.targetIdByTarget.get(t);return i!==void 0?w.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function aa(n,e,t){return S(this,null,function*(){let r=U(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(Pi(o))O(r0,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function tf(n,e,t){let r=U(n),i=J.min(),s=re();return r.persistence.runTransaction("Execute query","readwrite",o=>g3(r,o,Bt(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(o,e,t?i:J.min(),t?s:re())).next(a=>(lD(r,yI(e),a),{documents:a,remoteKeys:s})))}function y3(n,e,t,r){let i=t.batch,s=i.keys(),o=w.resolve();return s.forEach(a=>{o=o.next(()=>r.getEntry(e,a)).next(l=>{let c=t.docVersions.get(a);H(c!==null),l.version.compareTo(c)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,i))}function v3(n,e){let t=U(n),r=U(t.mutationQueue);return t.persistence.runTransaction("Lookup mutation documents","readonly",i=>r.lookupMutationKeys(i,e).next(s=>s?t.localDocuments.getDocuments(i,s):w.resolve(null)))}function _3(n,e){U(U(n,Xl).mutationQueue).removeCachedMutationKeys(e)}function b3(n){return U(U(n,Xl).persistence).getActiveClients()}function oD(n,e){let t=U(n),r=U(t.targetCache),i=t.targetDataByTarget.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.getTargetDataForTarget(s,e).next(o=>o?o.target:null))}function aD(n,e){let t=U(n),r=t.collectionGroupReadTime.get(e)||J.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.remoteDocuments.getAllFromCollectionGroup(i,e,kA(r,Qo),Number.MAX_SAFE_INTEGER)).then(i=>(lD(t,e,i),i))}function lD(n,e,t){let r=n.collectionGroupReadTime.get(e)||J.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}function C3(n){return Bt(ya(ce.fromString(`__bundle__/docs/${n}`)))}function S3(n,e,t,r){return S(this,null,function*(){let i=U(n),s=re(),o=$t();for(let c of t){let u=e.toDocumentKey(c.metadata.name);c.document&&(s=s.add(u));let d=e.toMutableDocument(c);d.setReadTime(e.toSnapshotVersion(c.metadata.readTime)),o=o.insert(u,d)}let a=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=yield oa(i,C3(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>sD(c,a,o).next(u=>(a.apply(c),u)).next(u=>i.targetCache.removeMatchingKeysForTargetId(c,l.targetId).next(()=>i.targetCache.addMatchingKeys(c,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,u.changedDocuments,u.existenceChangedKeys)).next(()=>u.changedDocuments)))})}function w3(n,e){let t=U(n),r=Ye(e.createTime);return t.persistence.runTransaction("hasNewerBundle","readonly",i=>t.bundleCache.getBundleMetadata(i,e.id)).then(i=>!!i&&i.createTime.compareTo(r)>=0)}function T3(n,e){let t=U(n);return t.persistence.runTransaction("Save bundle","readwrite",r=>t.bundleCache.saveBundleMetadata(r,e))}function E3(n,e){let t=U(n);return t.persistence.runTransaction("Get named query","readonly",r=>t.bundleCache.getNamedQuery(r,e))}function A3(r,i){return S(this,arguments,function*(n,e,t=re()){let s=yield oa(n,Bt(X_(e.bundledQuery))),o=U(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let l=Ye(e.readTime);if(s.snapshotVersion.compareTo(l)>=0)return o.bundleCache.saveNamedQuery(a,e);let c=s.withResumeToken(Xe.EMPTY_BYTE_STRING,l);return o.targetDataByTarget=o.targetDataByTarget.insert(c.targetId,c),o.targetCache.updateTargetData(a,c).next(()=>o.targetCache.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.targetCache.addMatchingKeys(a,t,s.targetId)).next(()=>o.bundleCache.saveNamedQuery(a,e))})})}var Kv=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var I3=100;function D3(){return Uf()?8:PA(Ba())>0?6:4}var Ch=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=I3,this.relativeIndexReadCostPerDocument=D3()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Kv;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(qo()<=qn.DEBUG&&O("QueryEngine","SDK will not create cache indexes for query:",Uo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),w.resolve()):(qo()<=qn.DEBUG&&O("QueryEngine","Query:",Uo(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(qo()<=qn.DEBUG&&O("QueryEngine","The SDK decides to create cache indexes for query:",Uo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Bt(t))):w.resolve())}performQueryUsingIndex(e,t){if(kE(t))return w.resolve(null);let r=Bt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=ah(t,null,"F"),r=Bt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=re(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,ah(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return kE(t)||i.isEqual(J.min())?w.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,r,i)?w.resolve(null):(qo()<=qn.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Uo(t)),this.appendRemainingResults(e,o,t,kA(i,Qo)).next(a=>a))})}applyQuery(e,t){let r=new Te(vI(e));return t.forEach((i,s)=>{dc(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return qo()<=qn.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",Uo(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,yn.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var cD="firestore_clients";function dA(n,e){return`${cD}_${n}_${e}`}var uD="firestore_mutations";function hA(n,e,t){let r=`${uD}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}var dD="firestore_targets";function Ry(n,e){return`${dD}_${n}_${e}`}var M3="firestore_online_state";function R3(n){return`${M3}_${n}`}var x3="firestore_bundle_loaded_v2";function k3(n){return`${x3}_${n}`}var O3="firestore_sequence_number";function N3(n){return`${O3}_${n}`}var rr="SharedClientState",Sh=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static fromWebStorageEntry(e,t,r){let i=JSON.parse(r),s=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object"),o;return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(o=new R(i.error.code,i.error.message))),s?new n(e,t,i.state,o):(Le(rr,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Ol=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object"),s;return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new R(r.error.code,r.error.message))),i?new n(e,r.state,s):(Le(rr,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},wh=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Q_();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=tI(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(Le(rr,`Failed to parse client data for instance '${e}': ${t}`),null)}},$v=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Le(rr,`Failed to parse online state: ${e}`),null)}},Zl=class{constructor(){this.activeTargetIds=Q_()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Nl=class{constructor(e,t,r,i,s){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new xe(te),this.started=!1,this.earlyEvents=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.localClientStorageKey=dA(this.persistenceKey,this.localClientId),this.sequenceNumberKey=N3(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new Zl),this.clientStateKeyRe=new RegExp(`^${cD}_${o}_([^_]*)$`),this.mutationBatchKeyRe=new RegExp(`^${uD}_${o}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=new RegExp(`^${dD}_${o}_(\\d+)$`),this.onlineStateKey=R3(this.persistenceKey),this.bundleLoadedKey=k3(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}start(){return S(this,null,function*(){let e=yield this.syncEngine.getActiveClients();for(let r of e){if(r===this.localClientId)continue;let i=this.getItem(dA(this.persistenceKey,r));if(i){let s=wh.fromWebStorageEntry(r,i);s&&(this.activeClients=this.activeClients.insert(s.clientId,s))}}this.persistClientState();let t=this.storage.getItem(this.onlineStateKey);if(t){let r=this.fromWebStorageOnlineState(t);r&&this.handleOnlineStateEvent(r)}for(let r of this.earlyEvents)this.handleWebStorageEvent(r);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(Ry(this.persistenceKey,e));if(i){let s=Ol.fromWebStorageEntry(e,i);s&&(r=s.state)}}return t&&this.localClientState.addQueryTarget(e),this.persistClientState(),r}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Ry(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.removeMutationState(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return O(rr,"READ",e,t),t}setItem(e,t){O(rr,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){O(rr,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(O(rr,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){Le("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(()=>S(this,null,function*(){if(!this.started){this.earlyEvents.push(t);return}if(t.key!==null){if(this.clientStateKeyRe.test(t.key))if(t.newValue!=null){let r=this.fromWebStorageClientState(t.key,t.newValue);if(r)return this.handleClientStateEvent(r.clientId,r)}else{let r=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(r,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(r)return this.handleMutationBatchEvent(r)}}else if(this.queryTargetKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(r)return this.handleQueryTargetEvent(r)}}else if(t.key===this.onlineStateKey){if(t.newValue!==null){let r=this.fromWebStorageOnlineState(t.newValue);if(r)return this.handleOnlineStateEvent(r)}}else if(t.key===this.sequenceNumberKey){let r=P3(t.newValue);r!==en.INVALID&&this.sequenceNumberHandler(r)}else if(t.key===this.bundleLoadedKey){let r=this.fromWebStoreBundleLoadedState(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.synchronizeWithChangedDocuments(i)))}}}))}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let i=new Sh(this.currentUser,e,t,r),s=hA(this.persistenceKey,this.currentUser,e);this.setItem(s,i.toWebStorageJSON())}removeMutationState(e){let t=hA(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let i=Ry(this.persistenceKey,e),s=new Ol(e,t,r);this.setItem(i,s.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return wh.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Sh.fromWebStorageEntry(new st(s),i,t)}fromWebStorageQueryTargetMetadata(e,t){let r=this.queryTargetKeyRe.exec(e),i=Number(r[1]);return Ol.fromWebStorageEntry(i,t)}fromWebStorageOnlineState(e){return $v.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}handleMutationBatchEvent(e){return S(this,null,function*(){if(e.user.uid!==this.currentUser.uid){O(rr,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)})}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),i=this.extractActiveQueryTargets(this.activeClients),s=this.extractActiveQueryTargets(r),o=[],a=[];return s.forEach(l=>{i.has(l)||o.push(l)}),i.forEach(l=>{s.has(l)||a.push(l)}),this.syncEngine.applyActiveTargetsChange(o,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=Q_();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}};function P3(n){let e=en.INVALID;if(n!=null)try{let t=JSON.parse(n);H(typeof t=="number"),e=t}catch(t){Le(rr,"Failed to read sequence number from WebStorage",t)}return e}var Th=class{constructor(){this.localState=new Zl,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new Zl,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Hv=class{addCallback(e){}shutdown(){}};var Qv=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var Wd=null;function F3(){return 268435456+Math.round(2147483648*Math.random())}function xy(){return Wd===null?Wd=F3():Wd++,"0x"+Wd.toString(16)}function L3(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var B3="1.9.1",Ft="GrpcConnection",V3=`gl-node/${process.versions.node} fire/${fa} grpc/${B3}`;function ky(n,e,t,r){H(e===null||e.type==="OAuth");let i=new fs.Metadata;return e&&e.headers.forEach((s,o)=>i.set(o,s)),t&&t.headers.forEach((s,o)=>i.set(o,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",V3),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var Yv=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){O(Ft,"Creating Firestore stub.");let e=this.databaseInfo.ssl?fs.credentials.createSsl():fs.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let o=xy(),a=this.ensureActiveStub(),l=ky(this.databasePath,i,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},r);return L3(u=>(O(Ft,`RPC '${e}' ${o} invoked with request:`,r),a[e](c,l,(d,f)=>{d?(O(Ft,`RPC '${e}' ${o} failed with error:`,d),u(new R(Yd(d.code),d.message))):(O(Ft,`RPC '${e}' ${o} completed with response:`,f),u(void 0,f))})))}invokeStreamingRPC(e,t,r,i,s,o){let a=xy(),l=[],c=new rt;O(Ft,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),d=ky(this.databasePath,i,s,this.databaseInfo.appId),f=Object.assign(Object.assign({},r),{database:this.databasePath}),v=u[e](f,d),T=!1;return v.on("data",A=>{O(Ft,`RPC ${e} ${a} received result:`,A),l.push(A),o!==void 0&&l.length===o&&(T=!0,c.resolve(l))}),v.on("end",()=>{O(Ft,`RPC '${e}' ${a} completed.`),T||(T=!0,c.resolve(l))}),v.on("error",A=>{O(Ft,`RPC '${e}' ${a} failed with error:`,A);let E=Yd(A.code);c.reject(new R(E,A.message))}),c.promise}openStream(e,t,r){let i=xy(),s=this.ensureActiveStub(),o=ky(this.databasePath,t,r,this.databaseInfo.appId),a=s[e](o),l=!1,c=f=>{l||(l=!0,u.callOnClose(f),a.end())},u=new Qv({sendFn:f=>{if(l)O(Ft,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,f);else{O(Ft,`RPC '${e}' stream ${i} sending:`,f);try{a.write(f)}catch(v){throw Le("Failure sending:",f),Le("Error:",v),v}}},closeFn:()=>{O(Ft,`RPC '${e}' stream ${i} closed locally via close().`),c()}}),d=!1;return a.on("data",f=>{l||(O(Ft,`RPC '${e}' stream ${i} received:`,f),d||(u.callOnConnected(),d=!0),u.callOnMessage(f))}),a.on("end",()=>{O(Ft,`RPC '${e}' stream ${i} ended.`),c()}),a.on("error",f=>{if(!l){Rn(Ft,`RPC '${e}' stream ${i} error. Code:`,f.code,"Message:",f.message);let v=Yd(f.code);c(new R(v,f.message))}}),O(Ft,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},hD={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},q3={nested:hD},U3=Object.freeze({__proto__:null,nested:hD,default:q3});var z3={longs:String,enums:String,defaults:!0,oneofs:!1};function G3(){let n=DA.fromJSON(U3,z3);return fs.loadPackageDefinition(n)}function j3(n){let e=G3();return new Yv(e,n)}function W3(){return new Hv}function fD(){return process.env.USE_MOCK_PERSISTENCE==="YES"?window:null}function K3(){return null}function fc(n){return new mv(n,!1)}var $3="ExponentialBackoff",H3=1e3,Q3=1.5,Y3=60*1e3,ec=class{constructor(e,t,r=H3,i=Q3,s=Y3){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&O($3,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var fA="PersistentStream",J3=60*1e3,X3=10*1e3,Eh=class{constructor(e,t,r,i,s,o,a,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new ec(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.responseCount=0,this.state===4){this.performBackoff();return}this.auth()}stop(){return S(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,J3,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return S(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return S(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===I.RESOURCE_EXHAUSTED?(Le(t.toString()),Le("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===I.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new R(I.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,X3,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>++this.responseCount===1?this.onFirst(i):this.onNext(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>S(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return O(fA,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(O(fA,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Jv=class extends Eh{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=aq(this.serializer,e),r=cq(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=vv(this.serializer),t.addTarget=bq(this.serializer,e);let r=vq(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=vv(this.serializer),t.removeTarget=e,this.sendRequest(t)}},Xv=class extends Eh{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return H(!!e.streamToken),this.lastStreamToken=e.streamToken,H(!e.writeResults||e.writeResults.length===0),this.listener.onHandshakeComplete()}onNext(e){H(!!e.streamToken),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=fq(e.writeResults,e.commitTime),r=Ye(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){let e={};e.database=vv(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Ql(this.serializer,r))};this.sendRequest(t)}};var Zv=class{},e_=class extends Zv{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new R(I.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeRPC(e,yv(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===I.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new R(I.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,r,i,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.invokeStreamingRPC(e,yv(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===I.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new R(I.UNKNOWN,o.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function Z3(n,e,t,r){return new e_(n,e,t,r)}function e4(n,e){return S(this,null,function*(){let t=U(n),r={writes:e.map(i=>Ql(t.serializer,i))};yield t.invokeRPC("Commit",t.serializer.databaseId,ce.emptyPath(),r)})}function t4(n,e){return S(this,null,function*(){let t=U(n),r={documents:e.map(a=>Hl(t.serializer,a))},i=yield t.invokeStreamingRPC("BatchGetDocuments",t.serializer.databaseId,ce.emptyPath(),r,e.length),s=new Map;i.forEach(a=>{let l=oq(t.serializer,a);s.set(l.key.toString(),l)});let o=[];return e.forEach(a=>{let l=s.get(a.toString());H(!!l),o.push(l)}),o})}function n4(n,e,t){let r=U(n);return r.verifyInitialized(),new Xv(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function r4(n,e,t){let r=U(n);return r.verifyInitialized(),new Jv(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var i4="OnlineStateTracker",pA=1,mA=10*1e3,t_=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",mA,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${mA/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=pA&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${pA} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(Le(t),this.shouldWarnClientIsOffline=!1):O(i4,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var ws="RemoteStore",s4=10,n_=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{r.enqueueAndForget(()=>S(this,null,function*(){Fi(this)&&(O(ws,"Restarting streams for network reachability change."),yield w4(this))}))}),this.onlineStateTracker=new t_(r,i)}};function o4(n,e,t,r,i){return new n_(n,e,t,r,i)}function a4(n){let e=U(n);return e.offlineCauses.delete(0),pc(e)}function pc(n){return S(this,null,function*(){if(Fi(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function l4(n){return S(this,null,function*(){let e=U(n);e.offlineCauses.add(0),yield va(e),e.onlineStateTracker.set("Offline")})}function va(n){return S(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function c4(n){return S(this,null,function*(){let e=U(n);O(ws,"RemoteStore shutting down."),e.offlineCauses.add(5),yield va(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function nf(n,e){let t=U(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),o0(t)?s0(t):Ca(t).isOpen()&&i0(t,e))}function _a(n,e){let t=U(n),r=Ca(t);t.listenTargets.delete(e),r.isOpen()&&pD(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():Fi(t)&&t.onlineStateTracker.set("Unknown"))}function i0(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(J.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ca(n).watch(e)}function pD(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),Ca(n).unwatch(e)}function s0(n){n.watchChangeAggregator=new pv({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),Ca(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function o0(n){return Fi(n)&&!Ca(n).isStarted()&&n.listenTargets.size>0}function Fi(n){return U(n).offlineCauses.size===0}function mD(n){n.watchChangeAggregator=void 0}function u4(n){return S(this,null,function*(){n.onlineStateTracker.set("Online")})}function d4(n){return S(this,null,function*(){n.listenTargets.forEach((e,t)=>{i0(n,e)})})}function h4(n,e){return S(this,null,function*(){mD(n),o0(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),s0(n)):n.onlineStateTracker.set("Unknown")})}function f4(n,e,t){return S(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof ch&&e.state===2&&e.cause){try{yield m4(n,e)}catch(r){O(ws,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Ah(n,r)}return}if(e instanceof Ho?n.watchChangeAggregator.handleDocumentChange(e):e instanceof lh?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(J.min()))try{let r=yield iD(n.localStore);t.compareTo(r)>=0&&(yield p4(n,t))}catch(r){O(ws,"Failed to raise snapshot:",r),yield Ah(n,r)}})}function Ah(n,e,t){return S(this,null,function*(){if(Pi(e))n.offlineCauses.add(1),yield va(n),n.onlineStateTracker.set("Offline"),t||(t=()=>iD(n.localStore)),n.asyncQueue.enqueueRetryable(()=>S(this,null,function*(){O(ws,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield pc(n)}));else throw e})}function gD(n,e){return e().catch(t=>Ah(n,t,e))}function p4(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken(Xe.EMPTY_BYTE_STRING,s.snapshotVersion)),pD(n,r);let o=new ia(s.target,r,i,s.sequenceNumber);i0(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function m4(n,e){return S(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function ba(n){return S(this,null,function*(){let e=U(n),t=Li(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:Si;for(;g4(e);)try{let i=yield p3(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,y4(e,i)}catch(i){yield Ah(e,i)}yD(e)&&vD(e)})}function g4(n){return Fi(n)&&n.writePipeline.length<s4}function y4(n,e){n.writePipeline.push(e);let t=Li(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function yD(n){return Fi(n)&&!Li(n).isStarted()&&n.writePipeline.length>0}function vD(n){Li(n).start()}function v4(n){return S(this,null,function*(){Li(n).writeHandshake()})}function _4(n){return S(this,null,function*(){let e=Li(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function b4(n,e,t){return S(this,null,function*(){let r=n.writePipeline.shift(),i=uv.from(r,e,t);yield gD(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield ba(n)})}function C4(n,e){return S(this,null,function*(){e&&Li(n).handshakeComplete&&(yield S4(n,e)),yD(n)&&vD(n)})}function S4(n,e){return S(this,null,function*(){if(GV(e.code)){let t=n.writePipeline.shift();Li(n).inhibitBackoff(),yield gD(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield ba(n)}})}function w4(n){return S(this,null,function*(){let e=U(n);e.offlineCauses.add(4),yield va(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield pc(e)})}function gA(n,e){return S(this,null,function*(){let t=U(n);t.asyncQueue.verifyOperationInProgress(),O(ws,"RemoteStore received new credentials");let r=Fi(t);t.offlineCauses.add(3),yield va(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield pc(t)})}function r_(n,e){return S(this,null,function*(){let t=U(n);e?(t.offlineCauses.delete(2),yield pc(t)):e||(t.offlineCauses.add(2),yield va(t),t.onlineStateTracker.set("Unknown"))})}function Ca(n){return n.watchStream||(n.watchStream=r4(n.datastore,n.asyncQueue,{onConnected:u4.bind(null,n),onOpen:d4.bind(null,n),onClose:h4.bind(null,n),onWatchChange:f4.bind(null,n)}),n.onNetworkStatusChange.push(e=>S(this,null,function*(){e?(n.watchStream.inhibitBackoff(),o0(n)?s0(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),mD(n))}))),n.watchStream}function Li(n){return n.writeStream||(n.writeStream=n4(n.datastore,n.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:v4.bind(null,n),onClose:C4.bind(null,n),onHandshakeComplete:_4.bind(null,n),onMutationResult:b4.bind(null,n)}),n.onNetworkStatusChange.push(e=>S(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield ba(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(O(ws,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var T4="AsyncQueue",i_=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new rt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new R(I.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Sa(n,e){if(Le(T4,`${e}: ${n}`),Pi(n))return new R(I.UNAVAILABLE,`${e}: ${n}`);throw n}var Ih=class n{constructor(e){e?this.comparator=(t,r)=>e(t,r)||q.comparator(t.key,r.key):this.comparator=(t,r)=>q.comparator(t.key,r.key),this.keyedMap=Il(),this.sortedSet=new xe(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Dh=class{constructor(){this.changeMap=new xe(q.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):G()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},la=class n{constructor(e,t,r,i,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Ih.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!uc(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var s_=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function E4(){return new o_}var o_=class{constructor(){this.queries=_D(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){x4(this,new R(I.ABORTED,"Firestore shutting down"))}};function _D(){return new cr(n=>gI(n),uc)}function a0(n,e){return S(this,null,function*(){let t=U(n),r=3,i=e.query,s=t.queries.get(i);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2):(s=new s_,r=e.listensToRemoteStore()?0:1);try{switch(r){case 0:s.viewSnap=yield t.onListen(i,!0);break;case 1:s.viewSnap=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i);break;default:break}}catch(o){let a=Sa(o,`Initialization of query '${Uo(e.query)}' failed`);e.onError(a);return}t.queries.set(i,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&c0(t)})}function l0(n,e){return S(this,null,function*(){let t=U(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),s.listeners.length===0?i=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function A4(n,e){let t=U(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(i)&&(r=!0);o.viewSnap=i}}r&&c0(t)}function I4(n,e,t){let r=U(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function D4(n,e){let t=U(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(r=!0)}),r&&c0(t)}function M4(n,e){U(n).snapshotsInSyncListeners.add(e),e.next()}function R4(n,e){U(n).snapshotsInSyncListeners.delete(e)}function x4(n,e){let t=U(n),r=t.queries;t.queries=_D(),r.forEach((i,s)=>{for(let o of s.listeners)o.onError(e)})}function c0(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var bD=function(n){return n.Default="default",n.Cache="cache",n}(bD||{}),tc=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new la(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=la.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==bD.Cache}};var a_=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=re(),i=re();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var Mh=class{constructor(e){this.serializer=e}toDocumentKey(e){return or(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?VI(this.serializer,e.document,!1):it.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return Ye(e)}},l_=class{constructor(e,t,r){this.bundleMetadata=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=CD(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;let r=ce.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,r=new Mh(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.toDocumentKey(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||re()).add(s);t.set(o,a)}}return t}complete(){return S(this,null,function*(){let e=yield S3(this.localStore,new Mh(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let r of this.queries)yield A3(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}})}};function CD(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}function k4(n){return{taskState:"Success",documentsLoaded:n.totalDocuments,bytesLoaded:n.totalBytes,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Rh=class{constructor(e){this.key=e}},xh=class{constructor(e){this.key=e}},kh=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=re(),this.mutatedKeys=re(),this.docComparator=vI(e),this.documentSet=new Ih(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new Dh,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,d)=>{let f=i.get(u),v=dc(this.query,d)?d:null,T=f?this.mutatedKeys.has(f.key):!1,A=v?v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations:!1,E=!1;f&&v?f.data.isEqual(v.data)?T!==A&&(r.track({type:3,doc:v}),E=!0):this.shouldWaitForSyncedDocument(f,v)||(r.track({type:2,doc:v}),E=!0,(l&&this.docComparator(v,l)>0||c&&this.docComparator(v,c)<0)&&(a=!0)):!f&&v?(r.track({type:0,doc:v}),E=!0):f&&!v&&(r.track({type:1,doc:f}),E=!0,(l||c)&&(a=!0)),E&&(v?(o=o.add(v),A?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{documentSet:o,changeSet:r,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((d,f)=>O4(d.type,f.type)||this.docComparator(d.doc,f.doc)),this.applyTargetChange(r),i=i??!1;let a=t&&!i?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!i?1:0,u=c!==this.syncState;return this.syncState=c,o.length===0&&!u?{limboChanges:a}:{snapshot:new la(this.query,e.documentSet,s,o,e.mutatedKeys,c===0,u,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new Dh,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=re(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new xh(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new Rh(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=re();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return la.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function O4(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return G()}};return t(n)-t(e)}var Bi="SyncEngine",c_=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},u_=class{constructor(e){this.key=e,this.receivedDocument=!1}},d_=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new cr(a=>gI(a),uc),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new xe(q.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new Jl,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=sa.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function N4(n,e,t,r,i,s,o){let a=new d_(n,e,t,r,i,s);return o&&(a._isPrimaryClient=!0),a}function P4(n,e,t=!0){return S(this,null,function*(){let r=rf(n),i,s=r.queryViewsByQuery.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.computeInitialSnapshot()):i=yield SD(r,e,t,!0),i})}function F4(n,e){return S(this,null,function*(){let t=rf(n);yield SD(t,e,!0,!1)})}function SD(n,e,t,r){return S(this,null,function*(){let i=yield oa(n.localStore,Bt(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return r&&(a=yield u0(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&nf(n.remoteStore,i),a})}function u0(n,e,t,r,i){return S(this,null,function*(){n.applyDocChanges=(d,f,v)=>$4(n,d,f,v);let s=yield tf(n.localStore,e,!0),o=new kh(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=$l.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,l);f0(n,t,c.limboChanges);let u=new c_(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function L4(n,e,t){return S(this,null,function*(){let r=U(n),i=r.queryViewsByQuery.get(e),s=r.queriesByTarget.get(i.targetId);if(s.length>1){r.queriesByTarget.set(i.targetId,s.filter(o=>!uc(o,e))),r.queryViewsByQuery.delete(e);return}r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield aa(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&_a(r.remoteStore,i.targetId),ca(r,i.targetId)}).catch(Ni))):(ca(r,i.targetId),yield aa(r.localStore,i.targetId,!0))})}function B4(n,e){return S(this,null,function*(){let t=U(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),_a(t.remoteStore,r.targetId))})}function V4(n,e,t){return S(this,null,function*(){let r=m0(n);try{let i=yield o3(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),W4(r,i.batchId,t),yield Or(r,i.changes),yield ba(r.remoteStore)}catch(i){let s=Sa(i,"Failed to persist write");t.reject(s)}})}function wD(n,e){return S(this,null,function*(){let t=U(n);try{let r=yield d3(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&(H(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.receivedDocument=!0:i.modifiedDocuments.size>0?H(o.receivedDocument):i.removedDocuments.size>0&&(H(o.receivedDocument),o.receivedDocument=!1))}),yield Or(t,r,e)}catch(r){yield Ni(r)}})}function yA(n,e,t){let r=U(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&i.push(a.snapshot)}),D4(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function q4(n,e,t){return S(this,null,function*(){let r=U(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let o=new xe(q.comparator);o=o.insert(s,it.newNoDocument(s,J.min()));let a=re().add(s),l=new Kl(J.min(),new Map,new xe(te),o,a);yield wD(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),p0(r)}else yield aa(r.localStore,e,!1).then(()=>ca(r,e,t)).catch(Ni)})}function U4(n,e){return S(this,null,function*(){let t=U(n),r=e.batch.batchId;try{let i=yield a3(t.localStore,e);h0(t,r,null),d0(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Or(t,i)}catch(i){yield Ni(i)}})}function z4(n,e,t){return S(this,null,function*(){let r=U(n);try{let i=yield c3(r.localStore,e);h0(r,e,t),d0(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Or(r,i)}catch(i){yield Ni(i)}})}function G4(n,e){return S(this,null,function*(){let t=U(n);Fi(t.remoteStore)||O(Bi,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield u3(t.localStore);if(r===Si){e.resolve();return}let i=t.pendingWritesCallbacks.get(r)||[];i.push(e),t.pendingWritesCallbacks.set(r,i)}catch(r){let i=Sa(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function d0(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function j4(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new R(I.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function W4(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new xe(te)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function h0(n,e,t){let r=U(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function ca(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||TD(n,i)})}function TD(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(_a(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),p0(n))}function f0(n,e,t){for(let r of t)r instanceof Rh?(n.limboDocumentRefs.addReference(r.key,e),K4(n,r)):r instanceof xh?(O(Bi,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||TD(n,r.key)):G()}function K4(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(O(Bi,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),p0(n))}function p0(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new q(ce.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new u_(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),nf(n.remoteStore,new ia(Bt(ya(t.path)),r,"TargetPurposeLimboResolution",en.INVALID))}}function Or(n,e,t){return S(this,null,function*(){let r=U(n),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((a,l)=>{o.push(r.applyDocChanges(l,e,t).then(c=>{var u;if((c||t)&&r.isPrimaryClient){let d=c?!c.fromCache:(u=t?.targetChanges.get(l.targetId))===null||u===void 0?void 0:u.current;r.sharedClientState.updateQueryState(l.targetId,d?"current":"not-current")}if(c){i.push(c);let d=a_.fromSnapshot(l.targetId,c);s.push(d)}}))}),yield Promise.all(o),r.syncEngineListener.onWatchChange(i),yield f3(r.localStore,s))})}function $4(n,e,t,r){return S(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield tf(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),o=r&&r.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(i,n.isPrimaryClient,s,o);return f0(n,e.targetId,a.limboChanges),a.snapshot})}function H4(n,e){return S(this,null,function*(){let t=U(n);if(!t.currentUser.isEqual(e)){O(Bi,"User change. New user:",e.toKey());let i=yield rD(t.localStore,e);t.currentUser=e,j4(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield Or(t,i.affectedDocuments)}})}function Q4(n,e){let t=U(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return re().add(r.key);{let i=re(),s=t.queriesByTarget.get(e);if(!s)return i;for(let o of s){let a=t.queryViewsByQuery.get(o);i=i.unionWith(a.view.syncedDocuments)}return i}}function Y4(n,e){return S(this,null,function*(){let t=U(n),r=yield tf(t.localStore,e.query,!0),i=e.view.synchronizeWithPersistedState(r);return t.isPrimaryClient&&f0(t,e.targetId,i.limboChanges),i})}function J4(n,e){return S(this,null,function*(){let t=U(n);return aD(t.localStore,e).then(r=>Or(t,r))})}function X4(n,e,t,r){return S(this,null,function*(){let i=U(n),s=yield v3(i.localStore,e);if(s===null){O(Bi,"Cannot apply mutation batch with id: "+e);return}t==="pending"?yield ba(i.remoteStore):t==="acknowledged"||t==="rejected"?(h0(i,e,r||null),d0(i,e),_3(i.localStore,e)):G(),yield Or(i,s)})}function Z4(n,e){return S(this,null,function*(){let t=U(n);if(rf(t),m0(t),e===!0&&t._isPrimaryClient!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield vA(t,r.toArray());t._isPrimaryClient=!0,yield r_(t.remoteStore,!0);for(let s of i)nf(t.remoteStore,s)}else if(e===!1&&t._isPrimaryClient!==!1){let r=[],i=Promise.resolve();t.queriesByTarget.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(ca(t,o),aa(t.localStore,o,!0))),_a(t.remoteStore,o)}),yield i,yield vA(t,r),ez(t),t._isPrimaryClient=!1,yield r_(t.remoteStore,!1)}})}function ez(n){let e=U(n);e.activeLimboResolutionsByTarget.forEach((t,r)=>{_a(e.remoteStore,r)}),e.limboDocumentRefs.removeAllReferences(),e.activeLimboResolutionsByTarget=new Map,e.activeLimboTargetsByKey=new xe(q.comparator)}function vA(n,e,t){return S(this,null,function*(){let r=U(n),i=[],s=[];for(let o of e){let a,l=r.queriesByTarget.get(o);if(l&&l.length!==0){a=yield oa(r.localStore,Bt(l[0]));for(let c of l){let u=r.queryViewsByQuery.get(c),d=yield Y4(r,u);d.snapshot&&s.push(d.snapshot)}}else{let c=yield oD(r.localStore,o);a=yield oa(r.localStore,c),yield u0(r,ED(c),o,!1,a.resumeToken)}i.push(a)}return r.syncEngineListener.onWatchChange(s),i})}function ED(n){return mI(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function tz(n){let e=U(n);return b3(e.localStore)}function nz(n,e,t,r){return S(this,null,function*(){let i=U(n);if(i._isPrimaryClient){O(Bi,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield aD(i.localStore,yI(s[0])),a=Kl.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Xe.EMPTY_BYTE_STRING);yield Or(i,o,a);break}case"rejected":{yield aa(i.localStore,e,!0),ca(i,e,r);break}default:G()}})}function rz(n,e,t){return S(this,null,function*(){let r=rf(n);if(r._isPrimaryClient){for(let i of e){if(r.queriesByTarget.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){O(Bi,"Adding an already active target "+i);continue}let o=yield oD(r.localStore,i),a=yield oa(r.localStore,o);yield u0(r,ED(o),a.targetId,!1,a.resumeToken),nf(r.remoteStore,a)}for(let i of t)r.queriesByTarget.has(i)&&(yield aa(r.localStore,i,!1).then(()=>{_a(r.remoteStore,i),ca(r,i)}).catch(Ni))}})}function rf(n){let e=U(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=wD.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Q4.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=q4.bind(null,e),e.syncEngineListener.onWatchChange=A4.bind(null,e.eventManager),e.syncEngineListener.onWatchError=I4.bind(null,e.eventManager),e}function m0(n){let e=U(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=U4.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=z4.bind(null,e),e}function iz(n,e,t){let r=U(n);sz(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}function sz(n,e,t){return S(this,null,function*(){try{let r=yield e.getMetadata();if(yield w3(n.localStore,r))return yield e.close(),t._completeWith(k4(r)),Promise.resolve(new Set);t._updateProgress(CD(r));let s=new l_(r,n.localStore,e.serializer),o=yield e.nextElement();for(;o;){let l=yield s.addSizedElement(o);l&&t._updateProgress(l),o=yield e.nextElement()}let a=yield s.complete();return yield Or(n,a.changedDocs,void 0),yield T3(n.localStore,r),t._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(r){return Rn(Bi,`Loading bundle failed with ${r}`),t._failWith(r),Promise.resolve(new Set)}})}var h_=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return S(this,null,function*(){this.serializer=fc(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,r){return null}createIndexBackfillerScheduler(t,r){return null}createLocalStore(t){return nD(this.persistence,new Ch,t.initialUser,this.serializer)}createPersistence(t){return new _h(bh.factory,this.serializer)}createSharedClientState(t){return new Th}terminate(){return S(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var Oh=class n extends h_{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return S(this,null,function*(){yield Mf(n.prototype,this,"initialize").call(this,e),yield this.onlineComponentProvider.initialize(this,e),yield m0(this.onlineComponentProvider.syncEngine),yield ba(this.onlineComponentProvider.remoteStore),yield this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return nD(this.persistence,new Ch,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new Rv(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new Wy(t,this.persistence);return new jy(e.asyncQueue,r)}createPersistence(e){let t=n0(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?gn.withCacheSize(this.cacheSizeBytes):gn.DEFAULT;return new Wv(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,fD(),K3(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Th}},f_=class n extends Oh{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return S(this,null,function*(){yield Mf(n.prototype,this,"initialize").call(this,e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof Nl&&(this.sharedClientState.syncEngine={applyBatchState:X4.bind(null,t),applyTargetState:nz.bind(null,t),applyActiveTargetsChange:rz.bind(null,t),getActiveClients:tz.bind(null,t),synchronizeWithChangedDocuments:J4.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.setPrimaryStateListener(r=>S(this,null,function*(){yield Z4(this.onlineComponentProvider.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=fD();if(!Nl.isAvailable(t))throw new R(I.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=n0(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Nl(t,e.asyncQueue,r,e.clientId,e.initialUser)}},g0=(()=>{class n{initialize(t,r){return S(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>yA(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=H4.bind(null,this.syncEngine),yield r_(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return E4()}createDatastore(t){let r=fc(t.databaseInfo.databaseId),i=j3(t.databaseInfo);return Z3(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return o4(this.localStore,this.datastore,t.asyncQueue,r=>yA(this.syncEngine,r,0),W3())}createSyncEngine(t,r){return N4(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return S(this,null,function*(){var t,r;yield c4(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}n.provider={build:()=>new n};return n})(),oz=10240;function az(n,e=oz){let t=0;return{read(){return S(this,null,function*(){if(t<n.byteLength){let s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return S(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}function y0(n,e,t){if(!t)throw new R(I.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function v0(n,e,t,r){if(e===!0&&r===!0)throw new R(I.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function _A(n){if(!q.isDocumentKey(n))throw new R(I.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function bA(n){if(q.isDocumentKey(n))throw new R(I.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function lz(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function mc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=cz(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":G()}function cz(n){return n.constructor?n.constructor.name:null}function he(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new R(I.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=mc(n);throw new R(I.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function AD(n,e){if(e<=0)throw new R(I.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function uz(n,e){if(!(n instanceof Uint8Array))throw new R(I.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${mc(n)}`);return az(n,e)}var ua=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):Le("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var p_=class{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}};var m_=class{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new rt,this.buffer=new Uint8Array,this.textDecoder=jV(),this.nextElementImpl().then(r=>{r&&r.isBundleMetadata()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.payload)}`))},r=>this.metadata.reject(r))}close(){return this.reader.cancel()}getMetadata(){return S(this,null,function*(){return this.metadata.promise})}nextElement(){return S(this,null,function*(){return yield this.getMetadata(),this.nextElementImpl()})}nextElementImpl(){return S(this,null,function*(){let e=yield this.readLength();if(e===null)return null;let t=this.textDecoder.decode(e),r=Number(t);isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`);let i=yield this.readJsonString(r);return new p_(JSON.parse(i),e.length+r)})}indexOfOpenBracket(){return this.buffer.findIndex(e=>e===123)}readLength(){return S(this,null,function*(){for(;this.indexOfOpenBracket()<0&&!(yield this.pullMoreDataToBuffer()););if(this.buffer.length===0)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}readJsonString(e){return S(this,null,function*(){for(;this.buffer.length<e;)(yield this.pullMoreDataToBuffer())&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}raiseError(e){throw this.reader.cancel(),new Error(`Invalid bundle format: ${e}`)}pullMoreDataToBuffer(){return S(this,null,function*(){let e=yield this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};function dz(n,e){return new m_(n,e)}var g_=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return S(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new R(I.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield t4(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new xi(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return S(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=q.fromPath(r);this.mutations.push(new Gl(i,this.precondition(i)))}),yield e4(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=J.min();else throw G();let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new R(I.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(J.min())?je.exists(!1):je.updateTime(t):je.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(J.min()))throw new R(I.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return je.updateTime(t)}else return je.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var y_=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.attemptsRemaining=r.maxAttempts,this.backoff=new ec(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(()=>S(this,null,function*(){let e=new g_(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.handleTransactionError(i)}))}).catch(r=>{this.handleTransactionError(r)})}))}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);return lc(t)||!t.catch||!t.then?(this.deferred.reject(Error("Transaction callback must return a Promise")),null):t}catch(t){return this.deferred.reject(t),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!kI(t)}return!1}};var ki="FirestoreClient",hz=100,fz=11,pz=20,mz=22,v_=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=st.UNAUTHENTICATED,this.clientId=Xd.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,o=>S(this,null,function*(){O(ki,"Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(O(ki,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:hz}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new rt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>S(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Sa(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Oy(n,e){return S(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),O(ki,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>S(this,null,function*(){r.isEqual(i)||(yield rD(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function CA(n,e){return S(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield _0(n);O(ki,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>gA(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>gA(e.remoteStore,i)),n._onlineComponents=e})}function gz(n){return n.name==="FirebaseError"?n.code===I.FAILED_PRECONDITION||n.code===I.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===mz||n.code===pz||n.code===fz:!0}function _0(n){return S(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){O(ki,"Using user provided OfflineComponentProvider");try{yield Oy(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!gz(t))throw t;Rn("Error using user provided cache. Falling back to memory cache: "+t),yield Oy(n,new h_)}}else O(ki,"Using default OfflineComponentProvider"),yield Oy(n,new h_);return n._offlineComponents})}function sf(n){return S(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(O(ki,"Using user provided OnlineComponentProvider"),yield CA(n,n._uninitializedComponentsProvider._online)):(O(ki,"Using default OnlineComponentProvider"),yield CA(n,new g0))),n._onlineComponents})}function ID(n){return _0(n).then(e=>e.persistence)}function b0(n){return _0(n).then(e=>e.localStore)}function DD(n){return sf(n).then(e=>e.remoteStore)}function C0(n){return sf(n).then(e=>e.syncEngine)}function yz(n){return sf(n).then(e=>e.datastore)}function da(n){return S(this,null,function*(){let e=yield sf(n),t=e.eventManager;return t.onListen=P4.bind(null,e.syncEngine),t.onUnlisten=L4.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=F4.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=B4.bind(null,e.syncEngine),t})}function vz(n){return n.asyncQueue.enqueue(()=>S(this,null,function*(){let e=yield ID(n),t=yield DD(n);return e.setNetworkEnabled(!0),a4(t)}))}function _z(n){return n.asyncQueue.enqueue(()=>S(this,null,function*(){let e=yield ID(n),t=yield DD(n);return e.setNetworkEnabled(!1),l4(t)}))}function bz(n){let e=new rt;return n.asyncQueue.enqueueAndForget(()=>S(this,null,function*(){let t=yield C0(n);return G4(t,e)})),e.promise}function Cz(n,e,t,r){let i=new ua(r),s=new tc(e,i,t);return n.asyncQueue.enqueueAndForget(()=>S(this,null,function*(){let o=yield da(n);return a0(o,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>S(this,null,function*(){let o=yield da(n);return l0(o,s)}))}}function Sz(n,e){let t=new rt;return n.asyncQueue.enqueueAndForget(()=>S(this,null,function*(){let r=yield b0(n);return Iz(r,e,t)})),t.promise}function MD(n,e,t={}){let r=new rt;return n.asyncQueue.enqueueAndForget(()=>S(this,null,function*(){let i=yield da(n);return Dz(i,n.asyncQueue,e,t,r)})),r.promise}function wz(n,e){let t=new rt;return n.asyncQueue.enqueueAndForget(()=>S(this,null,function*(){let r=yield b0(n);return Mz(r,e,t)})),t.promise}function RD(n,e,t={}){let r=new rt;return n.asyncQueue.enqueueAndForget(()=>S(this,null,function*(){let i=yield da(n);return Rz(i,n.asyncQueue,e,t,r)})),r.promise}function Tz(n,e){let t=new rt;return n.asyncQueue.enqueueAndForget(()=>S(this,null,function*(){let r=yield C0(n);return V4(r,e,t)})),t.promise}function Ez(n,e){let t=new ua(e);return n.asyncQueue.enqueueAndForget(()=>S(this,null,function*(){let r=yield da(n);return M4(r,t)})),()=>{t.mute(),n.asyncQueue.enqueueAndForget(()=>S(this,null,function*(){let r=yield da(n);return R4(r,t)}))}}function Az(n,e,t){let r=new rt;return n.asyncQueue.enqueueAndForget(()=>S(this,null,function*(){let i=yield yz(n);new y_(n.asyncQueue,i,t,e,r).run()})),r.promise}function Iz(n,e,t){return S(this,null,function*(){try{let r=yield m3(n,e);r.isFoundDocument()?t.resolve(r):r.isNoDocument()?t.resolve(null):t.reject(new R(I.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let i=Sa(r,`Failed to get document '${e} from cache`);t.reject(i)}})}function Dz(n,e,t,r,i){let s=new ua({next:a=>{s.mute(),e.enqueueAndForget(()=>l0(n,o));let l=a.docs.has(t);!l&&a.fromCache?i.reject(new R(I.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&r&&r.source==="server"?i.reject(new R(I.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new tc(ya(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return a0(n,o)}function Mz(n,e,t){return S(this,null,function*(){try{let r=yield tf(n,e,!0),i=new kh(e,r.remoteKeys),s=i.computeDocChanges(r.documents),o=i.applyChanges(s,!1);t.resolve(o.snapshot)}catch(r){let i=Sa(r,`Failed to execute query '${e} against cache`);t.reject(i)}})}function Rz(n,e,t,r,i){let s=new ua({next:a=>{s.mute(),e.enqueueAndForget(()=>l0(n,o)),a.fromCache&&r.source==="server"?i.reject(new R(I.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new tc(t,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return a0(n,o)}function xz(n,e,t,r){let i=Oz(t,fc(e));n.asyncQueue.enqueueAndForget(()=>S(this,null,function*(){iz(yield C0(n),i,r)}))}function kz(n,e){return n.asyncQueue.enqueue(()=>S(this,null,function*(){return E3(yield b0(n),e)}))}function Oz(n,e){let t;return typeof n=="string"?t=OI().encode(n):t=n,dz(uz(t),e)}function Nz(n,e){return n.timeoutSeconds===e.timeoutSeconds}function xD(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Pz="ComponentProvider",SA=new Map;function Fz(n){let e=SA.get(n);e&&(O(Pz,"Removing Datastore"),SA.delete(n),e.terminate())}function Lz(n,e,t,r){return new Jy(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,xD(r.experimentalLongPollingOptions),r.useFetchStreams)}var kD="firestore.googleapis.com",wA=!0,TA=5,EA=30,Bz=!0,Nh=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new R(I.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=kD,this.ssl=wA}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:wA;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=ZI;else{if(e.cacheSizeBytes!==hc&&e.cacheSizeBytes<sA)throw new R(I.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${sA}`);this.cacheSizeBytes=e.cacheSizeBytes}v0("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=Bz:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=xD((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),Vz(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&Nz(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function Vz(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new R(I.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<TA)throw new R(I.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${TA})`);if(n.timeoutSeconds>EA)throw new R(I.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${EA})`)}}var Ts=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Nh({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new R(I.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new R(I.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Nh(e),e.credentials!==void 0&&(this._authCredentials=D2(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return S(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return Fz(this),Promise.resolve()}};function OD(n,e,t,r={}){var i;n=he(n,Ts);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==kD&&s.host!==o&&Rn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=st.MOCK_USER;else{a=Cb(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new R(I.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new st(c)}n._authCredentials=new Py(new Jd(a,l))}}var gt=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},De=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ar(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},ar=class n extends gt{constructor(e,t,r){super(e,t,ya(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new De(this.firestore,null,new q(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function S0(n,e,...t){if(n=Fe(n),y0("collection","path",e),n instanceof Ts){let r=ce.fromString(e,...t);return bA(r),new ar(n,null,r)}else{if(!(n instanceof De)&&!(n instanceof ar))throw new R(I.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ce.fromString(e,...t));return bA(r),new ar(n.firestore,null,r)}}function ND(n,e){if(n=he(n,Ts),y0("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new R(I.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new gt(n,null,hV(e))}function gc(n,e,...t){if(n=Fe(n),arguments.length===1&&(e=Xd.newId()),y0("doc","path",e),n instanceof Ts){let r=ce.fromString(e,...t);return _A(r),new De(n,null,new q(r))}else{if(!(n instanceof De)&&!(n instanceof ar))throw new R(I.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ce.fromString(e,...t));return _A(r),new De(n.firestore,n instanceof ar?n.converter:null,new q(r))}}function w0(n,e){return n=Fe(n),e=Fe(e),(n instanceof De||n instanceof ar)&&(e instanceof De||e instanceof ar)?n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter:!1}function T0(n,e){return n=Fe(n),e=Fe(e),n instanceof gt&&e instanceof gt?n.firestore===e.firestore&&uc(n._query,e._query)&&n.converter===e.converter:!1}var qz="AsyncQueue",Ph=class{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new ec(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new rt;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return S(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(Pi(e))O(qz,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=Uz(r);throw Le("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=i_.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&G()}verifyOperationInProgress(){}drain(){return S(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function Uz(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var __=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new rt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var PD=hc,Ve=class extends Ts{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Ph,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return S(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Ph(e),this._firestoreClient=void 0,yield e}})}};function yt(n){if(n._terminated)throw new R(I.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||FD(n),n._firestoreClient}function FD(n){var e,t,r;let i=n._freezeSettings(),s=Lz(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new v_(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&zz(n._componentsProvider))}function zz(n){let e=n?._online.build();return{_offline:n?._offline.build(e),_online:e}}function LD(n,e){Rn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();return VD(n,g0.provider,{build:r=>new Oh(r,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function BD(n){return S(this,null,function*(){Rn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings();VD(n,g0.provider,{build:t=>new f_(t,e.cacheSizeBytes)})})}function VD(n,e,t){if(n=he(n,Ve),n._firestoreClient||n._terminated)throw new R(I.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new R(I.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},FD(n)}function qD(n){if(n._initialized&&!n._terminated)throw new R(I.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new rt;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>S(this,null,function*(){try{yield r3(n0(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function UD(n){n=he(n,Ve);let e=yt(n);return bz(e)}function zD(n){n=he(n,Ve);let e=yt(n);return vz(e)}function GD(n){n=he(n,Ve);let e=yt(n);return _z(e)}function jD(n,e){n=he(n,Ve);let t=yt(n),r=new __;return xz(t,n._databaseId,e,r),r}function WD(n,e){n=he(n,Ve);let t=yt(n);return kz(t,e).then(r=>r?new gt(n,null,r.query):null)}function Gz(n,e=!0){A2(Tb),Va(new ji("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),o=new Ve(new Fy(t.getProvider("auth-internal")),new qy(t.getProvider("app-check-internal")),EB(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),qr(yE,vE,n),qr(yE,vE,"esm2017")}var ur=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Xe.fromBase64String(e))}catch(t){throw new R(I.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Xe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Nn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new R(I.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Je(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Rr=class{constructor(e){this._methodName=e}};var Es=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new R(I.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new R(I.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return te(this._lat,e._lat)||te(this._long,e._long)}};var nc=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return i3(this._values,e._values)}};var jz=/^__.*__$/,b_=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new On(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ri(e,this.data,t,this.fieldTransforms)}},Fh=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new On(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function KD(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw G()}}var Lh=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return Bh(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(KD(this.dataSource)&&jz.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},C_=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||fc(e)}createContext(e,t,r,i=!1){return new Lh({dataSource:e,methodName:t,targetDoc:r,path:Je.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Rs(n){let e=n._freezeSettings(),t=fc(n._databaseId);return new C_(n._databaseId,!!e.ignoreUndefinedProperties,t)}function of(n,e,t,r,i,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);I0("Data must be an object, but it was:",o,r);let a=QD(r,o),l,c;if(s.merge)l=new tn(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let d of s.mergeFields){let f=A_(e,d,t);if(!o.contains(f))throw new R(I.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);JD(u,f)||u.push(f)}l=new tn(u),c=o.fieldTransforms.filter(d=>l.covers(d.field))}else l=null,c=o.fieldTransforms;return new b_(new Dt(a),l,c)}var rc=class n extends Rr{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function $D(n,e,t){return new Lh({dataSource:3,targetDoc:e.settings.targetDoc,methodName:n._methodName,arrayElement:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var S_=class n extends Rr{_toFieldTransform(e){return new bs(e.path,new Di)}isEqual(e){return e instanceof n}},w_=class n extends Rr{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=$D(this,e,!0),r=this._elements.map(s=>xs(s,t)),i=new Dr(r);return new bs(e.path,i)}isEqual(e){return e instanceof n&&zf(this._elements,e._elements)}},T_=class n extends Rr{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=$D(this,e,!0),r=this._elements.map(s=>xs(s,t)),i=new Mr(r);return new bs(e.path,i)}isEqual(e){return e instanceof n&&zf(this._elements,e._elements)}},E_=class n extends Rr{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new Mi(e.serializer,wI(e.serializer,this._operand));return new bs(e.path,t)}isEqual(e){return e instanceof n&&this._operand===e._operand}};function E0(n,e,t,r){let i=n.createContext(1,e,t);I0("Data must be an object, but it was:",i,r);let s=[],o=Dt.empty();Ms(r,(l,c)=>{let u=D0(e,l,t);c=Fe(c);let d=i.childContextForFieldPath(u);if(c instanceof rc)s.push(u);else{let f=xs(c,d);f!=null&&(s.push(u),o.set(u,f))}});let a=new tn(s);return new Fh(o,a,i.fieldTransforms)}function A0(n,e,t,r,i,s){let o=n.createContext(1,e,t),a=[A_(e,r,t)],l=[i];if(s.length%2!==0)throw new R(I.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<s.length;f+=2)a.push(A_(e,s[f])),l.push(s[f+1]);let c=[],u=Dt.empty();for(let f=a.length-1;f>=0;--f)if(!JD(c,a[f])){let v=a[f],T=l[f];T=Fe(T);let A=o.childContextForFieldPath(v);if(T instanceof rc)c.push(v);else{let E=xs(T,A);E!=null&&(c.push(v),u.set(v,E))}}let d=new tn(c);return new Fh(u,d,o.fieldTransforms)}function HD(n,e,t,r=!1){let i=n.createContext(r?4:3,e);return xs(t,i)}function xs(n,e){if(n=Fe(n),YD(n))return I0("Unsupported field value:",e,n),QD(n,e);if(n instanceof Rr)return Kz(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return Wz(n,e)}else return $z(n,e)}function QD(n,e){let t={};return QA(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ms(n,(r,i)=>{let s=xs(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function Wz(n,e){let t=[],r=0;for(let i of n){let s=xs(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function Kz(n,e){if(!KD(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function $z(n,e){if(n=Fe(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return wI(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=Be.fromDate(n);return{timestampValue:ra(e.serializer,t)}}else if(n instanceof Be){let t=new Be(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:ra(e.serializer,t)}}else{if(n instanceof Es)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof ur)return{bytesValue:NI(e.serializer,n._byteString)};if(n instanceof De){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:J_(n.firestore._databaseId||e.databaseId,n._key.path)}}else{if(n instanceof nc)return Hz(n,e);throw e.createError(`Unsupported field value: ${mc(n)}`)}}}function Hz(n,e){return{mapValue:{fields:{[G_]:{stringValue:j_},[Jo]:{arrayValue:{values:n.toArray().map(r=>{if(typeof r!="number")throw e.createError("VectorValues must only contain numeric values.");return Y_(e.serializer,r)})}}}}}}function YD(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof Be)&&!(n instanceof Es)&&!(n instanceof ur)&&!(n instanceof De)&&!(n instanceof Rr)&&!(n instanceof nc)}function I0(n,e,t){if(!YD(t)||!lz(t)){let r=mc(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function A_(n,e,t){if(e=Fe(e),e instanceof Nn)return e._internalPath;if(typeof e=="string")return D0(n,e);throw Bh("Field path arguments must be of type string or ",n,!1,void 0,t)}var Qz=new RegExp("[~\\*/\\[\\]]");function D0(n,e,t){if(e.search(Qz)>=0)throw Bh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Nn(...e.split("."))._internalPath}catch{throw Bh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Bh(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new R(I.INVALID_ARGUMENT,a+n+l)}function JD(n,e){return n.some(t=>t.isEqual(e))}var As=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new De(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new I_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(af("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},I_=class extends As{data(){return super.data()}};function af(n,e){return typeof e=="string"?D0(n,e):e instanceof Nn?e._internalPath:e._delegate._internalPath}function XD(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new R(I.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ic=class{},Is=class extends ic{};function Nr(n,e,...t){let r=[];e instanceof ic&&r.push(e),r=r.concat(t),r6(r);for(let i of r)n=i._apply(n);return n}var Vh=class n extends Is{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return l1(e._query,t),new gt(e.firestore,e.converter,H_(e._query,t))}_parse(e){let t=Rs(e.firestore);return Yz(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function ZD(n,e,t){let r=e,i=af("where",n);return Vh._create(i,r,t)}var D_=class n extends ic{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Se.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(t6(e._query,t),new gt(e.firestore,e.converter,H_(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var M_=class n extends Is{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=Jz(e._query,this._field,this._direction);return new gt(e.firestore,e.converter,mV(e._query,t))}};function e1(n,e="asc"){let t=e,r=af("orderBy",n);return M_._create(r,t)}var qh=class n extends Is{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new gt(e.firestore,e.converter,ah(e._query,this._limit,this._limitType))}};function t1(n){return AD("limit",n),qh._create("limit",n,"F")}function n1(n){return AD("limitToLast",n),qh._create("limitToLast",n,"L")}var Uh=class n extends Is{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=a1(e,this.type,this._docOrFields,this._inclusive);return new gt(e.firestore,e.converter,gV(e._query,t))}};function r1(...n){return Uh._create("startAt",n,!0)}function i1(...n){return Uh._create("startAfter",n,!1)}var zh=class n extends Is{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=a1(e,this.type,this._docOrFields,this._inclusive);return new gt(e.firestore,e.converter,yV(e._query,t))}};function s1(...n){return zh._create("endBefore",n,!1)}function o1(...n){return zh._create("endAt",n,!0)}function a1(n,e,t,r){if(t[0]=Fe(t[0]),t[0]instanceof As)return Xz(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Rs(n.firestore);return Zz(n._query,n.firestore._databaseId,i,e,t,r)}}function Yz(n,e,t,r,i,s,o){let a;if(i.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new R(I.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){IA(o,s);let c=[];for(let u of o)c.push(AA(r,n,u));a={arrayValue:{values:c}}}else a=AA(r,n,o)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&IA(o,s),a=HD(t,e,o,s==="in"||s==="not-in");return oe.create(i,s,a)}function Jz(n,e,t){if(n.startAt!==null)throw new R(I.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new R(I.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new vs(e,t)}function Xz(n,e,t,r,i){if(!r)throw new R(I.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${t}().`);let s=[];for(let o of ea(n))if(o.field.isKeyField())s.push(ys(e,r.key));else{let a=r.data.field(o.field);if(Yh(a))throw new R(I.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(a!==null)s.push(a);else{let l=o.field.canonicalString();throw new R(I.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${l}' (used as the orderBy) does not exist.`)}}return new lr(s,i)}function Zz(n,e,t,r,i,s){let o=n.explicitOrderBy;if(i.length>o.length)throw new R(I.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let l=0;l<i.length;l++){let c=i[l];if(o[l].field.isKeyField()){if(typeof c!="string")throw new R(I.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!$_(n)&&c.indexOf("/")!==-1)throw new R(I.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);let d=n.path.child(ce.fromString(c));if(!q.isDocumentKey(d))throw new R(I.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${d}' is not because it contains an odd number of segments.`);let f=new q(d);a.push(ys(e,f))}else{let d=HD(t,r,c);a.push(d)}}return new lr(a,s)}function AA(n,e,t){if(t=Fe(t),typeof t=="string"){if(t==="")throw new R(I.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!$_(e)&&t.indexOf("/")!==-1)throw new R(I.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(ce.fromString(t));if(!q.isDocumentKey(r))throw new R(I.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ys(n,new q(r))}else{if(t instanceof De)return ys(n,t._key);throw new R(I.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${mc(t)}.`)}}function IA(n,e){if(!Array.isArray(n)||n.length===0)throw new R(I.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function e6(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function l1(n,e){let t=n6(n.filters,e6(e.op));if(t!==null)throw t===e.op?new R(I.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new R(I.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function t6(n,e){let t=n,r=e.getFlattenedFilters();for(let i of r)l1(t,i),t=H_(t,i)}function n6(n,e){for(let t of n)for(let r of t.getFlattenedFilters())if(e.indexOf(r.op)>=0)return r.op;return null}function r6(n){let e=n.filter(r=>r instanceof D_).length,t=n.filter(r=>r instanceof Vh).length;if(e>1||e>0&&t>0)throw new R(I.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}var ha=class{convertValue(e,t="none"){switch(gs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ne(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ei(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw G()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Ms(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Jo].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>Ne(o.doubleValue));return new nc(s)}convertGeoPoint(e){return new Es(Ne(e.latitude),Ne(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=z_(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Bl(e));default:return null}}convertTimestamp(e){let t=Ir(e);return new Be(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ce.fromString(e);H(WI(r));let i=new Ai(r.get(1),r.get(3)),s=new q(r.popFirst(5));return i.isEqual(t)||Le(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function lf(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}var R_=class extends ha{constructor(e){super(),this.firestore=e}convertBytes(e){return new ur(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new De(this.firestore,null,t)}};function x_(n){return i6(n,["next","error","complete"])}function i6(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var xr=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},vn=class extends As{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new Oi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(af("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Oi=class extends vn{data(e={}){return super.data(e)}},Pn=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new xr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Oi(this._firestore,this._userDataWriter,r.key,r,new xr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new R(I.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=s6(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function s6(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new Oi(n._firestore,n._userDataWriter,r.doc.key,r.doc,new xr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new Oi(n._firestore,n._userDataWriter,r.doc.key,r.doc,new xr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),o=t.indexOf(r.doc.key)),{type:o6(r.type),doc:i,oldIndex:s,newIndex:o}})}}function o6(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return G()}}function M0(n,e){return n instanceof vn&&e instanceof vn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Pn&&e instanceof Pn?n._firestore===e._firestore&&T0(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot):!1}function c1(n){n=he(n,De);let e=he(n.firestore,Ve),t=yt(e);return MD(t,n._key).then(r=>O0(e,n,r))}var kr=class extends ha{constructor(e){super(),this.firestore=e}convertBytes(e){return new ur(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new De(this.firestore,null,t)}};function u1(n){n=he(n,De);let e=he(n.firestore,Ve),t=yt(e),r=new kr(e);return Sz(t,n._key).then(i=>new vn(e,r,n._key,i,new xr(i!==null&&i.hasLocalMutations,!0),n.converter))}function d1(n){n=he(n,De);let e=he(n.firestore,Ve),t=yt(e);return MD(t,n._key,{source:"server"}).then(r=>O0(e,n,r))}function h1(n){n=he(n,gt);let e=he(n.firestore,Ve),t=yt(e),r=new kr(e);return XD(n._query),RD(t,n._query).then(i=>new Pn(e,r,n,i))}function f1(n){n=he(n,gt);let e=he(n.firestore,Ve),t=yt(e),r=new kr(e);return wz(t,n._query).then(i=>new Pn(e,r,n,i))}function p1(n){n=he(n,gt);let e=he(n.firestore,Ve),t=yt(e),r=new kr(e);return RD(t,n._query,{source:"server"}).then(i=>new Pn(e,r,n,i))}function R0(n,e,t){n=he(n,De);let r=he(n.firestore,Ve),i=lf(n.converter,e,t),s=Rs(r),a=of(s,"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,je.none());return wa(r,[a])}function x0(n,e,t,...r){n=he(n,De);let i=he(n.firestore,Ve),s=Rs(i);e=Fe(e);let o;typeof e=="string"||e instanceof Nn?o=A0(s,"updateDoc",n._key,e,t,r):o=E0(s,"updateDoc",n._key,e);let a=o.toMutation(n._key,je.exists(!0));return wa(i,[a])}function m1(n){let e=he(n.firestore,Ve),t=[new xi(n._key,je.none())];return wa(e,t)}function g1(n,e){let t=he(n.firestore,Ve),r=gc(n),i=lf(n.converter,e),s=Rs(n.firestore),a=of(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,je.exists(!1));return wa(t,[a]).then(()=>r)}function k0(n,...e){var t,r,i;n=Fe(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]=="object"&&!x_(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(x_(e[o])){let f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(i=f.complete)===null||i===void 0?void 0:i.bind(f)}let l,c,u;if(n instanceof De)c=he(n.firestore,Ve),u=ya(n._key.path),l={next:f=>{e[o]&&e[o](O0(c,n,f))},error:e[o+1],complete:e[o+2]};else{let f=he(n,gt);c=he(f.firestore,Ve),u=f._query;let v=new kr(c);l={next:T=>{e[o]&&e[o](new Pn(c,v,f,T))},error:e[o+1],complete:e[o+2]},XD(n._query)}let d=yt(c);return Cz(d,u,a,l)}function y1(n,e){n=he(n,Ve);let t=yt(n),r=x_(e)?e:{next:e};return Ez(t,r)}function wa(n,e){let t=yt(n);return Tz(t,e)}function O0(n,e,t){let r=t.docs.get(e._key),i=new kr(n);return new vn(n,i,e._key,r,new xr(t.hasPendingWrites,t.fromCache),e.converter)}var a6={maxAttempts:5};function l6(n){if(n.maxAttempts<1)throw new R(I.INVALID_ARGUMENT,"Max attempts must be at least 1")}var Gh=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Rs(e)}set(e,t,r){this._verifyNotCommitted();let i=Ci(e,this._firestore),s=lf(i.converter,t,r),o=of(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,je.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Ci(e,this._firestore);t=Fe(t);let o;return typeof t=="string"||t instanceof Nn?o=A0(this._dataReader,"WriteBatch.update",s._key,t,r,i):o=E0(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,je.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Ci(e,this._firestore);return this._mutations=this._mutations.concat(new xi(t._key,je.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new R(I.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Ci(n,e){if(n=Fe(n),n.firestore!==e)throw new R(I.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var k_=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Rs(e)}get(e){let t=Ci(e,this._firestore),r=new R_(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return G();let s=i[0];if(s.isFoundDocument())return new As(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new As(this._firestore,r,t._key,null,t.converter);throw G()})}set(e,t,r){let i=Ci(e,this._firestore),s=lf(i.converter,t,r),o=of(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){let s=Ci(e,this._firestore);t=Fe(t);let o;return typeof t=="string"||t instanceof Nn?o=A0(this._dataReader,"Transaction.update",s._key,t,r,i):o=E0(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=Ci(e,this._firestore);return this._transaction.delete(t._key),this}};var O_=class extends k_{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Ci(e,this._firestore),r=new kr(this._firestore);return super.get(e).then(i=>new vn(this._firestore,r,t._key,i._document,new xr(!1,!1),t.converter))}};function v1(n,e,t){n=he(n,Ve);let r=Object.assign(Object.assign({},a6),t);l6(r);let i=yt(n);return Az(i,s=>e(new O_(n,s)),r)}function _1(){return new rc("deleteField")}function b1(){return new S_("serverTimestamp")}function C1(...n){return new w_("arrayUnion",n)}function S1(...n){return new T_("arrayRemove",n)}function w1(n){return new E_("increment",n)}Gz("node");var c6="@firebase/firestore-compat",u6="0.3.38";function V0(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new R("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function T1(){if(typeof Uint8Array>"u")throw new R("unimplemented","Uint8Arrays are not available in this environment.")}function E1(){if(!YA())throw new R("unimplemented","Blobs are unavailable in Firestore in this environment.")}var cf=class n{constructor(e){this._delegate=e}static fromBase64String(e){return E1(),new n(ur.fromBase64String(e))}static fromUint8Array(e){return T1(),new n(ur.fromUint8Array(e))}toBase64(){return E1(),this._delegate.toBase64()}toUint8Array(){return T1(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function N0(n){return d6(n,["next","error","complete"])}function d6(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var P0=class{enableIndexedDbPersistence(e,t){return LD(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return BD(e._delegate)}clearIndexedDbPersistence(e){return qD(e._delegate)}},uf=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Ai||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Rn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){OD(this._delegate,e,t,r)}enableNetwork(){return zD(this._delegate)}disableNetwork(){return GD(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,v0("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return UD(this._delegate)}onSnapshotsInSync(e){return y1(this._delegate,e)}get app(){if(!this._appCompat)throw new R("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Aa(this,S0(this._delegate,e))}catch(t){throw Vt(t,"collection()","Firestore.collection()")}}doc(e){try{return new dr(this,gc(this._delegate,e))}catch(t){throw Vt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Ps(this,ND(this._delegate,e))}catch(t){throw Vt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return v1(this._delegate,t=>e(new df(this,t)))}batch(){return yt(this._delegate),new hf(new Gh(this._delegate,e=>wa(this._delegate,e)))}loadBundle(e){return jD(this._delegate,e)}namedQuery(e){return WD(this._delegate,e).then(t=>t?new Ps(this,t):null)}},Ta=class extends ha{constructor(e){super(),this.firestore=e}convertBytes(e){return new cf(new ur(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return dr.forKey(t,this.firestore,null)}};function h6(n){MA(n)}var df=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Ta(e)}get(e){let t=ks(e);return this._delegate.get(t).then(r=>new Os(this._firestore,new vn(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=ks(e);return r?(V0("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=ks(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=ks(e);return this._delegate.delete(t),this}},hf=class{constructor(e){this._delegate=e}set(e,t,r){let i=ks(e);return r?(V0("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=ks(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=ks(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Ea=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new Oi(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Ns(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new Ta(e),t),i.set(t,s)),s}};Ea.INSTANCES=new WeakMap;var dr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ta(e)}static forPath(e,t,r){if(e.length%2!==0)throw new R("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new De(t._delegate,r,new q(e)))}static forKey(e,t,r){return new n(t,new De(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Aa(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Aa(this.firestore,S0(this._delegate,e))}catch(t){throw Vt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=Fe(e),e instanceof De?w0(this._delegate,e):!1}set(e,t){t=V0("DocumentReference.set",t);try{return t?R0(this._delegate,e,t):R0(this._delegate,e)}catch(r){throw Vt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?x0(this._delegate,e):x0(this._delegate,e,t,...r)}catch(i){throw Vt(i,"updateDoc()","DocumentReference.update()")}}delete(){return m1(this._delegate)}onSnapshot(...e){let t=A1(e),r=I1(e,i=>new Os(this.firestore,new vn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return k0(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=u1(this._delegate):e?.source==="server"?t=d1(this._delegate):t=c1(this._delegate),t.then(r=>new Os(this.firestore,new vn(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ea.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Vt(n,e,t){return n.message=n.message.replace(e,t),n}function A1(n){for(let e of n)if(typeof e=="object"&&!N0(e))return e;return{}}function I1(n,e){var t,r;let i;return N0(n[0])?i=n[0]:N0(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Os=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new dr(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return M0(this._delegate,e._delegate)}},Ns=class extends Os{data(e){let t=this._delegate.data(e);return this._delegate._converter||RA(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Ps=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ta(e)}where(e,t,r){try{return new n(this.firestore,Nr(this._delegate,ZD(e,t,r)))}catch(i){throw Vt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,Nr(this._delegate,e1(e,t)))}catch(r){throw Vt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,Nr(this._delegate,t1(e)))}catch(t){throw Vt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,Nr(this._delegate,n1(e)))}catch(t){throw Vt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,Nr(this._delegate,r1(...e)))}catch(t){throw Vt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,Nr(this._delegate,i1(...e)))}catch(t){throw Vt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,Nr(this._delegate,s1(...e)))}catch(t){throw Vt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,Nr(this._delegate,o1(...e)))}catch(t){throw Vt(t,"endAt()","Query.endAt()")}}isEqual(e){return T0(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=f1(this._delegate):e?.source==="server"?t=p1(this._delegate):t=h1(this._delegate),t.then(r=>new yc(this.firestore,new Pn(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=A1(e),r=I1(e,i=>new yc(this.firestore,new Pn(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return k0(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ea.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},F0=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Ns(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},yc=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Ps(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Ns(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new F0(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Ns(this._firestore,r))})}isEqual(e){return M0(this._delegate,e._delegate)}},Aa=class n extends Ps{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new dr(this.firestore,e):null}doc(e){try{return e===void 0?new dr(this.firestore,gc(this._delegate)):new dr(this.firestore,gc(this._delegate,e))}catch(t){throw Vt(t,"doc()","CollectionReference.doc()")}}add(e){return g1(this._delegate,e).then(t=>new dr(this.firestore,t))}isEqual(e){return w0(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ea.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function ks(n){return he(n,De)}var L0=class n{constructor(...e){this._delegate=new Nn(...e)}static documentId(){return new n(Je.keyField().canonicalString())}isEqual(e){return e=Fe(e),e instanceof Nn?this._delegate._internalPath.isEqual(e._internalPath):!1}};var B0=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=b1();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=_1();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=C1(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=S1(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=w1(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var f6={Firestore:uf,GeoPoint:Es,Timestamp:Be,Blob:cf,Transaction:df,WriteBatch:hf,DocumentReference:dr,DocumentSnapshot:Os,Query:Ps,QueryDocumentSnapshot:Ns,QuerySnapshot:yc,CollectionReference:Aa,FieldPath:L0,FieldValue:B0,setLogLevel:h6,CACHE_SIZE_UNLIMITED:PD};function p6(n,e){n.INTERNAL.registerComponent(new ji("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},f6)))}function m6(n){p6(n,(e,t)=>new uf(e,t,new P0)),n.registerVersion(c6,u6,"node")}m6(Ot);function g6(n,e=Rc){return new Qt(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function D1(n,e){return g6(n,e)}function y6(n,e){return D1(n,e).pipe(Oc(void 0),xc(),pt(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function z0(n,e){return D1(n,e).pipe(pt(t=>({payload:t,type:"query"})))}var ff=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=O1(r,t);return new mf(i,s,this.afs)}snapshotChanges(){return y6(this.ref,this.afs.schedulers.outsideAngular).pipe(zt)}valueChanges(e={}){return this.snapshotChanges().pipe(pt(({payload:t})=>e.idField?Me(ge({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Fn(this.ref.get(e)).pipe(zt)}};function pf(n,e){return z0(n,e).pipe(Oc(void 0),xc(),pt(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,l)=>{let c=s.find(d=>d.doc.ref.isEqual(a.ref)),u=r?.payload.docs.find(d=>d.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&u&&JSON.stringify(u.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:a}})}),o}))}function M1(n,e,t){return pf(n,t).pipe(kc((r,i)=>v6(r,i.map(s=>s.payload),e),[]),nb(),pt(r=>r.map(i=>({type:i.type,payload:i}))))}function v6(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=_6(n,r))}),n}function q0(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function _6(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return q0(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return q0(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return q0(n,e.oldIndex,1);break}return n}function R1(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var mf=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=pf(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(pt(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(Oc(void 0),xc(),ka(([r,i])=>i.length>0||!r),pt(([,r])=>r),zt)}auditTrail(e){return this.stateChanges(e).pipe(kc((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=R1(e);return M1(this.query,t,this.afs.schedulers.outsideAngular).pipe(zt)}valueChanges(e={}){return z0(this.query,this.afs.schedulers.outsideAngular).pipe(pt(t=>t.payload.docs.map(r=>e.idField?Me(ge({},r.data()),{[e.idField]:r.id}):r.data())),zt)}get(e){return Fn(this.query.get(e)).pipe(zt)}add(e){return this.ref.add(e)}doc(e){return new ff(this.ref.doc(e),this.afs)}},U0=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?pf(this.query,this.afs.schedulers.outsideAngular).pipe(zt):pf(this.query,this.afs.schedulers.outsideAngular).pipe(pt(t=>t.filter(r=>e.indexOf(r.type)>-1)),ka(t=>t.length>0),zt)}auditTrail(e){return this.stateChanges(e).pipe(kc((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=R1(e);return M1(this.query,t,this.afs.schedulers.outsideAngular).pipe(zt)}valueChanges(e={}){return z0(this.query,this.afs.schedulers.outsideAngular).pipe(pt(r=>r.payload.docs.map(i=>e.idField?ge({[e.idField]:i.id},i.data()):i.data())),zt)}get(e){return Fn(this.query.get(e)).pipe(zt)}},x1=new Ke("angularfire2.enableFirestorePersistence"),k1=new Ke("angularfire2.firestore.persistenceSettings"),b6=new Ke("angularfire2.firestore.settings"),C6=new Ke("angularfire2.firestore.use-emulator");function O1(n,e=t=>t){return{query:e(n),ref:n}}var vc=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,l,c,u,d,f,v,T,A,E,P,D){this.schedulers=l;let F=Ua(t,a,r),L=u;d&&rp(F,a,f,T,A,E,v,P),[this.firestore,this.persistenceEnabled$]=$c(`${F.name}.firestore`,"AngularFirestore",F.name,()=>{let W=a.runOutsideAngular(()=>F.firestore());if(s&&W.settings(s),L&&W.useEmulator(...L),i&&!Bc(o)){let Z=()=>{try{return Fn(W.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(b){return typeof console<"u"&&console.warn(b),Fr(!1)}};return[W,a.runOutsideAngular(Z)]}else return[W,Fr(!1)]},[s,L,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=O1(i,r),a=this.schedulers.ngZone.run(()=>s);return new mf(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new U0(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new ff(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(ae(js),ae(Ws,8),ae(x1,8),ae(b6,8),ae(Vs),ae(Lr),ae(jc),ae(k1,8),ae(C6,8),ae($i,8),ae(Jf,8),ae(Xf,8),ae(Zf,8),ae(ep,8),ae(tp,8),ae(np,8),ae(Wi,8))};static \u0275prov=_n({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),N1=(()=>{class n{constructor(){Ot.registerVersion("angularfire",Ki.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:x1,useValue:!0},{provide:k1,useValue:t}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=pr({type:n});static \u0275inj=fr({providers:[vc]})}return n})();var Vi=(()=>{class n{isAuthenticated(){return this.currentUserSubject.value!==null}constructor(){this.afAuth=pe($i),this.currentUserSubject=new X0(null),this.afAuth.authState.subscribe(t=>{this.currentUserSubject.next(t)})}register(t,r){return this.afAuth.createUserWithEmailAndPassword(t,r)}login(t,r){return this.afAuth.signInWithEmailAndPassword(t,r)}logout(){return this.afAuth.signOut()}getCurrentUser(){return this.currentUserSubject.asObservable()}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=_n({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var T6=()=>["/summary"],E6=()=>["/"];function A6(n,e){if(n&1){let t=rn();B(0,"div",3)(1,"p"),$(2),N(),B(3,"button",5),ne("click",function(){_t(t);let i=be();return bt(i.logout())}),$(4,"Wyloguj"),N()()}n&2&&(j(2),St("Witaj, ",e.email,""))}function I6(n,e){if(n&1){let t=rn();B(0,"div",4)(1,"button",6),ne("click",function(){_t(t);let i=be();return bt(i.navigateToLogin())}),$(2," Zaloguj si\u0119 "),N(),B(3,"button",6),ne("click",function(){_t(t);let i=be();return bt(i.navigateToRegister())}),$(4," Zarejestruj si\u0119 "),N()()}}var P1=(()=>{class n{constructor(){this.authService=pe(Vi),this.router=pe(Gs),this.formChange=new $e,this.currentForm="login",this.user$=this.authService.getCurrentUser()}logout(){this.authService.logout(),this.router.navigate(["/login"])}showForm(t){this.formChange.emit(t)}navigateToLogin(){this.formChange.emit("login"),this.router.navigate(["/login"])}navigateToRegister(){this.formChange.emit("register"),this.router.navigate(["/register"])}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=ye({type:n,selectors:[["app-navbar"]],outputs:{formChange:"formChange"},standalone:!0,features:[ve],decls:10,vars:10,consts:[[1,"navbar"],[1,"nav-links"],[1,"btn","btn-primary",3,"routerLink"],[1,"user-info"],[1,"auth-buttons"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-light",3,"click"]],template:function(r,i){if(r&1&&(B(0,"div",0)(1,"div",1)(2,"button",2),$(3,"Summary"),N(),B(4,"button",2),$(5,"Home"),N()(),gr(6,A6,5,1,"div",3),Vn(7,"async"),gr(8,I6,5,0,"div",4),Vn(9,"async"),N()),r&2){let s;j(2),Ue("routerLink",Pf(8,T6)),j(2),Ue("routerLink",Pf(9,E6)),j(2),kt((s=Pa(7,4,i.user$))?6:-1,s),j(2),kt(Pa(9,6,i.user$)?-1:8)}},dependencies:[zs,Lc,qc,Vc],styles:[".navbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;background:linear-gradient(135deg,#e0f7fa,#254636);color:#fff;border-radius:10px}.navbar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 20px;font-size:16px;border:none;border-radius:20px;transition:background-color .3s ease,transform .3s ease}.navbar[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{background-color:#254636;color:#fff}.navbar[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%]{background-color:#e0f7fa;color:#254636}.navbar[_ngcontent-%COMP%]   .btn-light[_ngcontent-%COMP%]{background-color:transparent;color:#fff;border:2px solid #254636}.navbar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{transform:translateY(-3px)}.navbar[_ngcontent-%COMP%]   .btn-light[_ngcontent-%COMP%]:hover{background-color:#e0f7fa}.user-info[_ngcontent-%COMP%], .auth-buttons[_ngcontent-%COMP%]{display:flex;align-items:center}.user-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-right:10px;font-size:16px}.auth-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:10px}.auth-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-left:0}.navbar[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{margin-right:10px}.navbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}@media (max-width: 768px){.navbar[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;padding:15px 10px}.user-info[_ngcontent-%COMP%], .auth-buttons[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;margin-top:10px}.navbar[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{margin-right:0}}"]})}}return n})();var D6=(n,e)=>e.id;function M6(n,e){if(n&1&&(B(0,"li"),$(1),N()),n&2){let t=e.$implicit;j(),lt(t.fitness)}}var F1=(()=>{class n{constructor(){this.client=pe(vc),this.products$=this.getProducts(),this.currentForm="login"}getProducts(){return this.client.collection("products").valueChanges()}showForm(t){this.currentForm=t}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=ye({type:n,selectors:[["app-root"]],standalone:!0,features:[ve],decls:7,vars:2,consts:[[3,"formChange"],[1,"welcome-container"]],template:function(r,i){r&1&&(B(0,"app-navbar",0),ne("formChange",function(o){return i.showForm(o)}),N(),B(1,"div",1),Br(2,"router-outlet"),N(),B(3,"ul"),Ln(4,M6,2,1,"li",null,D6),Vn(6,"async"),N()),r&2&&(j(4),Bn(Pa(6,0,i.products$)))},dependencies:[vb,zs,Lc,P1],styles:[".welcome-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:20px}button[_ngcontent-%COMP%]{margin:10px;padding:10px 20px;font-size:16px;cursor:pointer}ul[_ngcontent-%COMP%]{list-style-type:none;padding:0}li[_ngcontent-%COMP%]{font-size:18px;margin:5px 0}"]})}}return n})();var hr=(()=>{class n{constructor(){this.client=pe(vc),this.afAuth=pe($i)}getTrainings(){return new Qt(t=>{this.afAuth.currentUser.then(r=>{let i=r?.uid;i?this.client.collection("Training",s=>s.where("uid","==",i)).valueChanges().subscribe(s=>{t.next(s)}):t.next([])}).catch(()=>t.next([]))})}getMeals(){return new Qt(t=>{this.afAuth.currentUser.then(r=>{let i=r?.uid;i?this.client.collection("Meal",s=>s.where("uid","==",i)).valueChanges().subscribe(s=>{console.log("Pobrane posi\u0142ki:",s),t.next(s)}):t.next([])}).catch(r=>{console.error("B\u0142\u0105d podczas pobierania posi\u0142k\xF3w:",r),t.next([])})})}addTraining(t){t.id||(t.id=this.client.createId()),this.afAuth.currentUser.then(r=>{let i=r?.uid;i&&this.client.collection("Training").doc(t.id).set(Me(ge({},t),{uid:i,date:t.date.toISOString()})).then(()=>console.log("Training added/updated successfully")).catch(s=>console.error("Error adding/updating training:",s))}).catch(r=>console.error("Error getting user:",r))}addMeal(t){t.id||(t.id=this.client.createId()),this.afAuth.currentUser.then(r=>{if(r){let i=t.id||this.client.createId();this.client.collection("Meal").doc(i).set(Me(ge({},t),{uid:r.uid,date:t.date.toISOString()})).then(()=>console.log("Meal added/updated successfully")).catch(s=>console.error("Error adding/updating meal:",s))}}).catch(r=>console.error("Error getting user:",r))}updateMeal(t){return this.afAuth.currentUser.then(r=>r?this.client.collection("Meal").doc(t.id).update(Me(ge({},t),{date:t.date.toISOString()})):Promise.reject("User not authenticated"))}updateTraining(t){return this.afAuth.currentUser.then(r=>r?this.client.collection("Training").doc(t.id).update(Me(ge({},t),{date:t.date.toISOString()})):Promise.reject("User not authenticated"))}getTrainingsByDate(t){return console.log("Pobieranie trening\xF3w dla daty:",t),new Qt(r=>{this.afAuth.currentUser.then(i=>{let s=i?.uid;if(s){let o=new Date(t);o.setHours(0,0,0,0);let a=new Date(t);a.setHours(23,59,59,999),console.log("Start dnia:",o),console.log("Koniec dnia:",a),this.client.collection("Training",l=>l.where("uid","==",s).where("date",">=",o.toISOString()).where("date","<=",a.toISOString())).valueChanges().subscribe(l=>{console.log("Pobrane treningi:",l),r.next(l)},l=>{console.error("B\u0142\u0105d podczas pobierania trening\xF3w:",l),r.next([])})}else r.next([])}).catch(()=>r.next([]))})}getMealsByDate(t){return console.log("Pobieranie posi\u0142k\xF3w dla daty:",t),new Qt(r=>{this.afAuth.currentUser.then(i=>{let s=i?.uid;if(s){let o=new Date(t);o.setHours(0,0,0,0);let a=new Date(t);a.setHours(23,59,59,999),console.log("Start dnia:",o),console.log("Koniec dnia:",a),this.client.collection("Meal",l=>l.where("uid","==",s).where("date",">=",o.toISOString()).where("date","<=",a.toISOString())).valueChanges().subscribe(l=>{console.log("Pobrane posi\u0142ki:",l),r.next(l)},l=>{console.error("B\u0142\u0105d podczas pobierania posi\u0142k\xF3w:",l),r.next([])})}else r.next([])}).catch(()=>r.next([]))})}getMealsByDateRange(t,r){return new Qt(i=>{this.afAuth.currentUser.then(s=>{let o=s?.uid;o?this.client.collection("Meal",a=>a.where("uid","==",o).where("date",">=",t.toISOString()).where("date","<=",r.toISOString())).valueChanges().subscribe(a=>{i.next(a)},a=>{console.error("B\u0142\u0105d podczas pobierania posi\u0142k\xF3w:",a),i.next([])}):i.next([])}).catch(()=>i.next([]))})}getTrainingsByDateRange(t,r){return new Qt(i=>{this.afAuth.currentUser.then(s=>{let o=s?.uid;o?this.client.collection("Training",a=>a.where("uid","==",o).where("date",">=",t.toISOString()).where("date","<=",r.toISOString())).valueChanges().subscribe(a=>{i.next(a)},a=>{console.error("B\u0142\u0105d podczas pobierania trening\xF3w:",a),i.next([])}):i.next([])}).catch(()=>i.next([]))})}deleteTraining(t){return this.afAuth.currentUser.then(r=>r?.uid?this.client.collection("Training").doc(t).delete().then(()=>console.log("Training deleted successfully")).catch(s=>console.error("Error deleting training:",s)):Promise.reject("User not authenticated")).catch(r=>(console.error("Error getting user:",r),Promise.reject(r)))}deleteMeal(t){return this.afAuth.currentUser.then(r=>r?.uid?this.client.collection("Meal").doc(t).delete().then(()=>console.log("Meal deleted successfully")).catch(s=>console.error("Error deleting meal:",s)):Promise.reject("User not authenticated")).catch(r=>(console.error("Error getting user:",r),Promise.reject(r)))}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=_n({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var W1=(()=>{class n{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=i=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static{this.\u0275fac=function(r){return new(r||n)(mt(Of),mt(kf))}}static{this.\u0275dir=nn({type:n})}}return n})(),K1=(()=>{class n extends W1{static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Pc(n)))(i||n)}})()}static{this.\u0275dir=nn({type:n,features:[mr]})}}return n})(),j0=new Ke("");var R6={provide:j0,useExisting:Bs(()=>xa),multi:!0};function x6(){let n=Vf()?Vf().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var k6=new Ke(""),xa=(()=>{class n extends W1{constructor(t,r,i){super(t,r),this._compositionMode=i,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!x6())}writeValue(t){let r=t??"";this.setProperty("value",r)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static{this.\u0275fac=function(r){return new(r||n)(mt(Of),mt(kf),mt(k6,8))}}static{this.\u0275dir=nn({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,i){r&1&&ne("input",function(o){return i._handleInput(o.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(o){return i._compositionEnd(o.target.value)})},features:[qs([R6]),mr]})}}return n})();function O6(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}var W0=new Ke(""),$1=new Ke("");function N6(n){return O6(n.value)?{required:!0}:null}function L1(n){return null}function H1(n){return n!=null}function Q1(n){return hb(n)?Fn(n):n}function Y1(n){let e={};return n.forEach(t=>{e=t!=null?ge(ge({},e),t):e}),Object.keys(e).length===0?null:e}function J1(n,e){return e.map(t=>t(n))}function P6(n){return!n.validate}function X1(n){return n.map(e=>P6(e)?e:t=>e.validate(t))}function F6(n){if(!n)return null;let e=n.filter(H1);return e.length==0?null:function(t){return Y1(J1(t,e))}}function K0(n){return n!=null?F6(X1(n)):null}function L6(n){if(!n)return null;let e=n.filter(H1);return e.length==0?null:function(t){let r=J1(t,e).map(Q1);return eb(r).pipe(pt(Y1))}}function $0(n){return n!=null?L6(X1(n)):null}function B1(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function B6(n){return n._rawValidators}function V6(n){return n._rawAsyncValidators}function G0(n){return n?Array.isArray(n)?n:[n]:[]}function yf(n,e){return Array.isArray(n)?n.includes(e):n===e}function V1(n,e){let t=G0(e);return G0(n).forEach(i=>{yf(t,i)||t.push(i)}),t}function q1(n,e){return G0(e).filter(t=>!yf(n,t))}var vf=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=K0(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=$0(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},Ma=class extends vf{get formDirective(){return null}get path(){return null}},Tc=class extends vf{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},_f=class{constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},q6={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},nK=Me(ge({},q6),{"[class.ng-submitted]":"isSubmitted"}),wf=(()=>{class n extends _f{constructor(t){super(t)}static{this.\u0275fac=function(r){return new(r||n)(mt(Tc,2))}}static{this.\u0275dir=nn({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,i){r&2&&Oa("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[mr]})}}return n})(),Tf=(()=>{class n extends _f{constructor(t){super(t)}static{this.\u0275fac=function(r){return new(r||n)(mt(Ma,10))}}static{this.\u0275dir=nn({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,i){r&2&&Oa("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)("ng-submitted",i.isSubmitted)},features:[mr]})}}return n})();var _c="VALID",gf="INVALID",Ia="PENDING",bc="DISABLED",Ra=class{},bf=class extends Ra{constructor(e,t){super(),this.value=e,this.source=t}},Sc=class extends Ra{constructor(e,t){super(),this.pristine=e,this.source=t}},wc=class extends Ra{constructor(e,t){super(),this.touched=e,this.source=t}},Da=class extends Ra{constructor(e,t){super(),this.status=e,this.source=t}};function Z1(n){return(Ef(n)?n.validators:n)||null}function U6(n){return Array.isArray(n)?K0(n):n||null}function eM(n,e){return(Ef(e)?e.asyncValidators:n)||null}function z6(n){return Array.isArray(n)?$0(n):n||null}function Ef(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function G6(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new Nc(1e3,"");if(!r[t])throw new Nc(1001,"")}function j6(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new Nc(1002,"")})}var Cf=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=La(()=>this.statusReactive()),this.statusReactive=Ct(void 0),this._pristine=La(()=>this.pristineReactive()),this.pristineReactive=Ct(!0),this._touched=La(()=>this.touchedReactive()),this.touchedReactive=Ct(!1),this._events=new Mc,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return Vr(this.statusReactive)}set status(e){Vr(()=>this.statusReactive.set(e))}get valid(){return this.status===_c}get invalid(){return this.status===gf}get pending(){return this.status==Ia}get disabled(){return this.status===bc}get enabled(){return this.status!==bc}get pristine(){return Vr(this.pristineReactive)}set pristine(e){Vr(()=>this.pristineReactive.set(e))}get dirty(){return!this.pristine}get touched(){return Vr(this.touchedReactive)}set touched(e){Vr(()=>this.touchedReactive.set(e))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(V1(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(V1(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(q1(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(q1(e,this._rawAsyncValidators))}hasValidator(e){return yf(this._rawValidators,e)}hasAsyncValidator(e){return yf(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(Me(ge({},e),{sourceControl:r})),t&&e.emitEvent!==!1&&this._events.next(new wc(!0,r))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let r=e.sourceControl??this;this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:r})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,r),t&&e.emitEvent!==!1&&this._events.next(new wc(!1,r))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(Me(ge({},e),{sourceControl:r})),t&&e.emitEvent!==!1&&this._events.next(new Sc(!1,r))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let r=e.sourceControl??this;this._forEachChild(i=>{i.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,r),t&&e.emitEvent!==!1&&this._events.next(new Sc(!0,r))}markAsPending(e={}){this.status=Ia;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Da(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(Me(ge({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=bc,this.errors=null,this._forEachChild(i=>{i.disable(Me(ge({},e),{onlySelf:!0}))}),this._updateValue();let r=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new bf(this.value,r)),this._events.next(new Da(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Me(ge({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=_c,this._forEachChild(r=>{r.enable(Me(ge({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Me(ge({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===_c||this.status===Ia)&&this._runAsyncValidator(r,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new bf(this.value,t)),this._events.next(new Da(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(Me(ge({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?bc:_c}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=Ia,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1};let r=Q1(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(i=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(i,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,r){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||r)&&this._events.next(new Da(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,r)}_initObservables(){this.valueChanges=new $e,this.statusChanges=new $e}_calculateStatus(){return this._allControlsDisabled()?bc:this.errors?gf:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Ia)?Ia:this._anyControlsHaveStatus(gf)?gf:_c}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let r=!this._anyControlsDirty(),i=this.pristine!==r;this.pristine=r,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),i&&this._events.next(new Sc(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new wc(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Ef(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=U6(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=z6(this._rawAsyncValidators)}},Sf=class extends Cf{constructor(e,t,r){super(Z1(t),eM(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){j6(this,!0,e),Object.keys(e).forEach(r=>{G6(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var H0=new Ke("CallSetDisabledState",{providedIn:"root",factory:()=>Q0}),Q0="always";function W6(n,e){return[...e.path,n]}function tM(n,e,t=Q0){nM(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),$6(n,e),Q6(n,e),H6(n,e),K6(n,e)}function U1(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function K6(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function nM(n,e){let t=B6(n);e.validator!==null?n.setValidators(B1(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=V6(n);e.asyncValidator!==null?n.setAsyncValidators(B1(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();U1(e._rawValidators,i),U1(e._rawAsyncValidators,i)}function $6(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&rM(n,e)})}function H6(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&rM(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function rM(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function Q6(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function Y6(n,e){n==null,nM(n,e)}function J6(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function X6(n){return Object.getPrototypeOf(n.constructor)===K1}function Z6(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function e9(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===xa?t=s:X6(s)?r=s:i=s}),i||r||t||null}var t9={provide:Ma,useExisting:Bs(()=>Ec)},Cc=Promise.resolve(),Ec=(()=>{class n extends Ma{get submitted(){return Vr(this.submittedReactive)}constructor(t,r,i){super(),this.callSetDisabledState=i,this._submitted=La(()=>this.submittedReactive()),this.submittedReactive=Ct(!1),this._directives=new Set,this.ngSubmit=new $e,this.form=new Sf({},K0(t),$0(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){Cc.then(()=>{let r=this._findContainer(t.path);t.control=r.registerControl(t.name,t.control),tM(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){Cc.then(()=>{let r=this._findContainer(t.path);r&&r.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){Cc.then(()=>{let r=this._findContainer(t.path),i=new Sf({});Y6(i,t),r.registerControl(t.name,i),i.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){Cc.then(()=>{let r=this._findContainer(t.path);r&&r.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,r){Cc.then(()=>{this.form.get(t.path).setValue(r)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submittedReactive.set(!0),Z6(this.form,this._directives),this.ngSubmit.emit(t),t?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static{this.\u0275fac=function(r){return new(r||n)(mt(W0,10),mt($1,10),mt(H0,8))}}static{this.\u0275dir=nn({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,i){r&1&&ne("submit",function(o){return i.onSubmit(o)})("reset",function(){return i.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[qs([t9]),mr]})}}return n})();function z1(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function G1(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var n9=class extends Cf{constructor(e=null,t,r){super(Z1(t),eM(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Ef(t)&&(t.nonNullable||t.initialValueIsDefault)&&(G1(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){z1(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){z1(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){G1(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var r9={provide:Tc,useExisting:Bs(()=>Ac)},j1=Promise.resolve(),Ac=(()=>{class n extends Tc{constructor(t,r,i,s,o,a){super(),this._changeDetectorRef=o,this.callSetDisabledState=a,this.control=new n9,this._registered=!1,this.name="",this.update=new $e,this._parent=t,this._setValidators(r),this._setAsyncValidators(i),this.valueAccessor=e9(this,s)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let r=t.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),J6(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){tM(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){j1.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let r=t.isDisabled.currentValue,i=r!==0&&Bf(r);j1.then(()=>{i&&!this.control.disabled?this.control.disable():!i&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?W6(t,this._parent):[t]}static{this.\u0275fac=function(r){return new(r||n)(mt(Ma,9),mt(W0,10),mt($1,10),mt(j0,10),mt(Fc,8),mt(H0,8))}}static{this.\u0275dir=nn({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[qs([r9]),mr,Gi]})}}return n})(),Af=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275dir=nn({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}}return n})(),i9={provide:j0,useExisting:Bs(()=>Y0),multi:!0},Y0=(()=>{class n extends K1{writeValue(t){let r=t??"";this.setProperty("value",r)}registerOnChange(t){this.onChange=r=>{t(r==""?null:parseFloat(r))}}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Pc(n)))(i||n)}})()}static{this.\u0275dir=nn({type:n,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(r,i){r&1&&ne("input",function(o){return i.onChange(o.target.value)})("blur",function(){return i.onTouched()})},features:[qs([i9]),mr]})}}return n})();var s9=(()=>{class n{constructor(){this._validator=L1}ngOnChanges(t){if(this.inputName in t){let r=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):L1,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return t!=null}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275dir=nn({type:n,features:[Gi]})}}return n})();var o9={provide:W0,useExisting:Bs(()=>Ic),multi:!0};var Ic=(()=>{class n extends s9{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Bf,this.createValidator=t=>N6}enabled(t){return t}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=Pc(n)))(i||n)}})()}static{this.\u0275dir=nn({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(r,i){r&2&&lb("required",i._enabled?"":null)},inputs:{required:"required"},features:[qs([o9]),mr]})}}return n})();var a9=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=pr({type:n})}static{this.\u0275inj=fr({})}}return n})();var Mt=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:H0,useValue:t.callSetDisabledState??Q0}]}}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=pr({type:n})}static{this.\u0275inj=fr({imports:[a9]})}}return n})();function l9(n,e){if(n&1){let t=rn();B(0,"div",5)(1,"label",9),$(2),N(),B(3,"input",10),Ut("ngModelChange",function(i){_t(t);let s=be();return wt(s.model.calories,i)||(s.model.calories=i),bt(i)}),N()()}if(n&2){let t=be();j(2),lt(t.caloriesLabel),j(),qt("ngModel",t.model.calories)}}function c9(n,e){if(n&1){let t=rn();B(0,"div",5)(1,"label",11),$(2),N(),B(3,"input",12),Ut("ngModelChange",function(i){_t(t);let s=be();return wt(s.model.burnedKcal,i)||(s.model.burnedKcal=i),bt(i)}),N()()}if(n&2){let t=be();j(2),lt(t.burnedCalories),j(),qt("ngModel",t.model.burnedKcal)}}function u9(n,e){if(n&1){let t=rn();B(0,"div",5)(1,"label",13),$(2),N(),B(3,"input",14),Ut("ngModelChange",function(i){_t(t);let s=be();return wt(s.model.weight,i)||(s.model.weight=i),bt(i)}),N()()}if(n&2){let t=be();j(2),lt(t.weightLabel),j(),qt("ngModel",t.model.weight)}}function d9(n,e){if(n&1){let t=rn();B(0,"div",5)(1,"label",15),$(2),N(),B(3,"input",16),Ut("ngModelChange",function(i){_t(t);let s=be();return wt(s.model.time,i)||(s.model.time=i),bt(i)}),N()()}if(n&2){let t=be();j(2),lt(t.timeLabel),j(),qt("ngModel",t.model.time)}}function h9(n,e){if(n&1){let t=rn();B(0,"div",5)(1,"label",17),$(2),N(),B(3,"input",18),Ut("ngModelChange",function(i){_t(t);let s=be();return wt(s.model.date,i)||(s.model.date=i),bt(i)}),ne("ngModelChange",function(i){_t(t);let s=be();return bt(s.onDateChange(i))}),N()()}if(n&2){let t=be();j(2),lt(t.dateLabel),j(),qt("ngModel",t.model.date)}}var sM=(()=>{class n{constructor(){this.title="",this.nameLabel="",this.caloriesLabel="",this.weightLabel="",this.burnedCalories="",this.dateLabel="",this.timeLabel="",this.model={},this.save=new $e}onSubmit(){this.save.emit(this.model)}onDateChange(t){this.model.date=new Date(t+"T00:00:00")}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=ye({type:n,selectors:[["app-form"]],inputs:{title:"title",nameLabel:"nameLabel",caloriesLabel:"caloriesLabel",weightLabel:"weightLabel",burnedCalories:"burnedCalories",dateLabel:"dateLabel",timeLabel:"timeLabel",model:"model"},outputs:{save:"save"},standalone:!0,features:[ve],decls:17,vars:8,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Zamknij",1,"btn-close"],[1,"modal-body"],[3,"ngSubmit"],[1,"mb-3"],["for","name",1,"form-label"],["type","text","id","name","name","name","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","submit","data-bs-dismiss","modal",1,"btn","btn-primary"],["for","calories",1,"form-label"],["type","number","id","calories","name","calories","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","burnedKcal",1,"form-label"],["type","number","id","burnedKcal","name","burnedKcal","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","weight",1,"form-label"],["type","number","id","weight","name","weight","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","time",1,"form-label"],["type","number","id","time","name","time","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","date",1,"form-label"],["type","date","id","date","name","date","required","",1,"form-control",3,"ngModelChange","ngModel"]],template:function(r,i){r&1&&(B(0,"div",0)(1,"h5",1),$(2),N(),Br(3,"button",2),N(),B(4,"div",3)(5,"form",4),ne("ngSubmit",function(){return i.onSubmit()}),B(6,"div",5)(7,"label",6),$(8),N(),B(9,"input",7),Ut("ngModelChange",function(o){return wt(i.model.name,o)||(i.model.name=o),o}),N()(),gr(10,l9,4,2,"div",5)(11,c9,4,2,"div",5)(12,u9,4,2,"div",5)(13,d9,4,2,"div",5)(14,h9,4,2,"div",5),B(15,"button",8),$(16," Zapisz zmiany "),N()()()),r&2&&(j(2),lt(i.title),j(6),lt(i.nameLabel),j(),qt("ngModel",i.model.name),j(),kt(i.caloriesLabel?10:-1),j(),kt(i.burnedCalories?11:-1),j(),kt(i.weightLabel?12:-1),j(),kt(i.timeLabel?13:-1),j(),kt(i.dateLabel?14:-1))},dependencies:[Mt,Af,xa,Y0,wf,Tf,Ic,Ac,Ec],styles:[".form-group[_ngcontent-%COMP%]{margin-bottom:15px}label[_ngcontent-%COMP%]{font-size:16px;font-weight:700;color:#333}input.form-control[_ngcontent-%COMP%]{font-size:16px;padding:10px;border-radius:5px;border:1px solid #ccc;width:100%;margin-top:5px}input.form-control[_ngcontent-%COMP%]:focus{border-color:#28a745;box-shadow:0 0 5px #28a74580}button[type=submit][_ngcontent-%COMP%]{background-color:#254636;border:none;color:#fff;padding:12px 25px;border-radius:5px;font-size:16px;cursor:pointer;transition:background-color .3s;width:100%;text-align:center}button[type=submit][_ngcontent-%COMP%]:hover{background-color:#2f5957}"]})}}return n})();var qi=(()=>{class n{constructor(){this.modalId="",this.title="",this.nameLabel="",this.caloriesLabel="",this.burnedCaloriesLabel="",this.weightLabel="",this.timeLabel="",this.dateLabel="",this.model={},this.save=new $e}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=ye({type:n,selectors:[["app-modal"]],inputs:{modalId:"modalId",title:"title",nameLabel:"nameLabel",caloriesLabel:"caloriesLabel",burnedCaloriesLabel:"burnedCaloriesLabel",weightLabel:"weightLabel",timeLabel:"timeLabel",dateLabel:"dateLabel",model:"model"},outputs:{save:"save"},standalone:!0,features:[ve],decls:5,vars:9,consts:[["tabindex","-1","aria-labelledby","modalLabel","aria-hidden","true",1,"modal","fade",3,"id"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-body"],[3,"save","title","nameLabel","caloriesLabel","burnedCalories","weightLabel","timeLabel","dateLabel","model"]],template:function(r,i){r&1&&(B(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"app-form",4),ne("save",function(o){return i.save.emit(o)}),N()()()()()),r&2&&(Ue("id",i.modalId),j(4),Ue("title",i.title)("nameLabel",i.nameLabel)("caloriesLabel",i.caloriesLabel)("burnedCalories",i.burnedCaloriesLabel)("weightLabel",i.weightLabel)("timeLabel",i.timeLabel)("dateLabel",i.dateLabel)("model",i.model))},dependencies:[sM],styles:[".modal-dialog[_ngcontent-%COMP%]{max-width:600px;margin:30px auto;border-radius:8px}.modal-content[_ngcontent-%COMP%]{background:linear-gradient(135deg,#e0f7fa,#254636);border-radius:8px;box-shadow:0 4px 15px #0000001a;padding:20px;color:#333}.modal-header[_ngcontent-%COMP%]{border-bottom:1px solid #ddd;padding-bottom:10px}.modal-title[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#333}.btn-close[_ngcontent-%COMP%]{background:none;border:none;font-size:24px;color:#333;cursor:pointer}.btn-close[_ngcontent-%COMP%]:hover{color:#28a745}.modal-body[_ngcontent-%COMP%]{padding:15px 0}"]})}}return n})();var oM=(()=>{class n{constructor(){this.trainingAndMealService=pe(hr),this.meals=[],this.model={name:"",calories:0,weight:"",day:0,date:new Date,id:""}}addMeal(t){this.trainingAndMealService.addMeal(t),this.meals.push(t),console.log("Meal added:",t)}onDateChange(t){this.model.date=new Date(t+"T00:00:00")}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=ye({type:n,selectors:[["app-meal-modal"]],standalone:!0,features:[ve],decls:1,vars:7,consts:[[3,"save","modalId","title","nameLabel","caloriesLabel","weightLabel","dateLabel","model"]],template:function(r,i){r&1&&(B(0,"app-modal",0),ne("save",function(o){return i.addMeal(o)}),N()),r&2&&Ue("modalId","mealModal")("title","Dodaj posi\u0142ek")("nameLabel","Nazwa posi\u0142ku")("caloriesLabel","Kalorie")("weightLabel","Waga (g)")("dateLabel","Data")("model",i.model)},dependencies:[Mt,qi]})}}return n})();var aM=(()=>{class n{constructor(){this.trainingAndMealService=pe(hr),this.training=[],this.traingns=[],this.model={name:"",burnedKcal:0,time:"",date:new Date,id:""}}addMeal(t){throw new Error("Method not implemented.")}addTraining(t){this.trainingAndMealService.addTraining(t),this.training.push(t),console.log("Meal added:",t)}onDateChange(t){this.model.date=new Date(`${t}T00:00:00`)}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=ye({type:n,selectors:[["app-training-modal"]],standalone:!0,features:[ve],decls:1,vars:7,consts:[[3,"save","modalId","title","nameLabel","burnedCaloriesLabel","timeLabel","dateLabel","model"]],template:function(r,i){r&1&&(B(0,"app-modal",0),ne("save",function(o){return i.addTraining(o)}),N()),r&2&&Ue("modalId","trainingModal")("title","Dodaj trening")("nameLabel","Nazwa treningu")("burnedCaloriesLabel","Spalone kalorie")("timeLabel","Czas trwania (min)")("dateLabel","Data")("model",i.model)},dependencies:[Mt,qi]})}}return n})();var lM=(()=>{class n{constructor(){this.meal=null,this.Save=new $e,this.close=new $e,this.model={name:"",calories:0,weight:"",day:0,date:new Date,id:""}}ngOnChanges(t){t.meal&&this.meal&&(this.model=Me(ge({},this.meal),{date:new Date(this.meal.date)}))}saveMeal(t){this.model.name&&this.model.calories>0&&this.model.weight?this.Save.emit(this.model):console.error("Model jest niekompletny lub zawiera b\u0142\u0119dy:",this.model)}closeModal(){this.close.emit()}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=ye({type:n,selectors:[["app-edit"]],inputs:{meal:"meal"},outputs:{Save:"Save",close:"close"},standalone:!0,features:[Gi,ve],decls:1,vars:6,consts:[[3,"save","modalId","title","nameLabel","caloriesLabel","weightLabel","model"]],template:function(r,i){r&1&&(B(0,"app-modal",0),ne("save",function(o){return i.saveMeal(o)}),N()),r&2&&Ue("modalId","meal2Modal")("title","Dodaj posi\u0142ek")("nameLabel","Nazwa posi\u0142ku")("caloriesLabel","Kalorie")("weightLabel","Waga (g)")("model",i.model)},dependencies:[Mt,qi]})}}return n})();var cM=(()=>{class n{constructor(){this.training=null,this.Save=new $e,this.close=new $e,this.model={name:"",burnedKcal:0,time:"",date:new Date,id:""}}ngOnChanges(t){t.training&&this.training&&(this.model=Me(ge({},this.training),{date:new Date(this.training.date)}))}saveTraining(){this.model.name&&this.model.burnedKcal>0&&this.model.time?this.Save.emit(this.model):console.error("Model jest niekompletny lub zawiera b\u0142\u0119dy:",this.model)}closeModal(){this.close.emit()}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=ye({type:n,selectors:[["app-edit-training"]],inputs:{training:"training"},outputs:{Save:"Save",close:"close"},standalone:!0,features:[Gi,ve],decls:1,vars:6,consts:[[3,"save","modalId","title","nameLabel","burnedCaloriesLabel","timeLabel","model"]],template:function(r,i){r&1&&(B(0,"app-modal",0),ne("save",function(){return i.saveTraining()}),N()),r&2&&Ue("modalId","meal3Modal")("title","Edytuj trening")("nameLabel","Nazwa treningu")("burnedCaloriesLabel","Spalone kalorie")("timeLabel","Czas trwania (min)")("model",i.model)},dependencies:[Mt,qi]})}}return n})();var f9=(n,e)=>e.date,uM=(n,e)=>e.id,p9=n=>["/day-details",n];function m9(n,e){if(n&1&&(B(0,"div",7),$(1),N()),n&2){let t=e.$implicit;j(),lt(t)}}function g9(n,e){if(n&1){let t=rn();B(0,"li"),$(1),B(2,"div",14)(3,"button",15),ne("click",function(){let i=_t(t).$implicit,s=be(3);return bt(s.editMeal(i))}),$(4," Edytuj "),N(),B(5,"button",16),ne("click",function(){let i=_t(t).$implicit,s=be(3);return bt(s.deleteMeal(i.id))}),$(6," Usu\u0144 "),N()()()}if(n&2){let t=e.$implicit;j(),Nf(" ",t.name," - ",t.calories," kcal (",t.weight," g) ")}}function y9(n,e){if(n&1&&(B(0,"div")(1,"h4"),$(2,"Posi\u0142ki:"),N(),B(3,"ul"),Ln(4,g9,7,3,"li",null,uM),N()()),n&2){let t=be().$implicit,r=be();j(4),Bn(r.getMealsForDay(t.date))}}function v9(n,e){if(n&1){let t=rn();B(0,"li"),$(1),B(2,"div",14)(3,"button",17),ne("click",function(){let i=_t(t).$implicit,s=be(3);return bt(s.editTraining(i))}),$(4," Edytuj "),N(),B(5,"button",16),ne("click",function(){let i=_t(t).$implicit,s=be(3);return bt(s.deleteTraining(i.id))}),$(6," Usu\u0144 "),N()()()}if(n&2){let t=e.$implicit;j(),Nf(" ",t.name," - ",t.burnedKcal," kcal (",t.time,") ")}}function _9(n,e){if(n&1&&(B(0,"div")(1,"h4"),$(2,"Treningi:"),N(),B(3,"ul"),Ln(4,v9,7,3,"li",null,uM),N()()),n&2){let t=be().$implicit,r=be();j(4),Bn(r.getTrainingsForDay(t.date))}}function b9(n,e){if(n&1&&(B(0,"div",11)(1,"h3",12)(2,"a",13),$(3),N()(),gr(4,y9,6,0,"div")(5,_9,6,0,"div"),N()),n&2){let t=e.$implicit,r=be();Oa("other-month",t.isOtherMonth),j(2),Ue("routerLink",ub(6,p9,t.date.toISOString())),j(),St(" ",t.date.getDate()," "),j(),kt(r.getMealsForDay(t.date).length>0?4:-1),j(),kt(r.getTrainingsForDay(t.date).length>0?5:-1)}}var dM=(()=>{class n{constructor(){this.TrainingAndMealService=pe(hr),this.meals=Ct([]),this.trainings=Ct([]),this.calendarDays=[],this.currentDate=new Date,this.currentMonth=this.currentDate.getMonth(),this.currentYear=this.currentDate.getFullYear(),this.selectedMeal=null,this.selectedTraining=null,this.showModal=Ct(!1),this.dayNames=["Pn","Wt","\u015Ar","Czw","Pt","Sb","Nd"],this.months=["Stycze\u0144","Luty","Marzec","Kwiecie\u0144","Maj","Czerwiec","Lipiec","Sierpie\u0144","Wrzesie\u0144","Pa\u017Adziernik","Listopad","Grudzie\u0144"],this.loadData(),this.generateCalendar()}loadData(){this.TrainingAndMealService.getTrainings().subscribe(t=>{let r=t.map((i,s)=>Me(ge({},i),{id:i.id||`training-${s}-${new Date().getTime()}`,date:new Date(i.date)}));this.trainings.set(r)}),this.TrainingAndMealService.getMeals().subscribe(t=>{let r=t.map((i,s)=>Me(ge({},i),{id:i.id||`meal-${s}-${new Date().getTime()}`,date:new Date(i.date)}));this.meals.set(r)})}getMealsForDay(t){return this.meals().filter(r=>r.date.getDate()===t.getDate()&&r.date.getMonth()===t.getMonth()&&r.date.getFullYear()===t.getFullYear())}getTrainingsForDay(t){return this.trainings().filter(r=>r.date.getDate()===t.getDate()&&r.date.getMonth()===t.getMonth()&&r.date.getFullYear()===t.getFullYear())}generateCalendar(){let t=new Date(this.currentYear,this.currentMonth,1),r=new Date(this.currentYear,this.currentMonth+1,0),i=r.getDate(),o=(t.getDay()||7)-1,l=7-(r.getDay()||7);this.calendarDays=[];for(let c=o;c>0;c--){let u=new Date(this.currentYear,this.currentMonth,-c+1);this.calendarDays.push({date:u,isOtherMonth:!0})}for(let c=1;c<=i;c++){let u=new Date(this.currentYear,this.currentMonth,c);this.calendarDays.push({date:u,isOtherMonth:!1})}for(let c=1;c<=l;c++){let u=new Date(this.currentYear,this.currentMonth+1,c);this.calendarDays.push({date:u,isOtherMonth:!0})}}prevMonth(){this.currentMonth--,this.currentMonth<0&&(this.currentMonth=11,this.currentYear--),this.generateCalendar()}nextMonth(){this.currentMonth++,this.currentMonth>11&&(this.currentMonth=0,this.currentYear++),this.generateCalendar()}saveEditedMeal(t){this.TrainingAndMealService.updateMeal(t).then(()=>{this.meals.set(this.meals().map(r=>r.id===t.id?t:r))}).catch(r=>{console.error("Error saving edited meal:",r),alert("Nie uda\u0142o si\u0119 zapisa\u0107 posi\u0142ku. Spr\xF3buj ponownie.")})}editMeal(t){this.selectedMeal=ge({},t)}closeModal(){this.showModal.set(!1)}saveEditedTraining(t){this.TrainingAndMealService.updateTraining(t).then(()=>{this.trainings.set(this.trainings().map(r=>r.id===t.id?t:r))}).catch(r=>{console.error("Error saving edited meal:",r),alert("Nie uda\u0142o si\u0119 zapisa\u0107 posi\u0142ku. Spr\xF3buj ponownie.")})}editTraining(t){this.selectedTraining=ge({},t)}deleteMeal(t){this.TrainingAndMealService.deleteMeal(t).then(()=>{this.meals.set(this.meals().filter(r=>r.id!==t))}).catch(r=>{console.error("Error deleting meal:",r),alert("Nie uda\u0142o si\u0119 usun\u0105\u0107 posi\u0142ku. Spr\xF3buj ponownie.")})}deleteTraining(t){this.TrainingAndMealService.deleteTraining(t).then(()=>{this.trainings.set(this.trainings().filter(r=>r.id!==t))}).catch(r=>{console.error("Error deleting training:",r),alert("Nie uda\u0142o si\u0119 usun\u0105\u0107 treningu. Spr\xF3buj ponownie.")})}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=ye({type:n,selectors:[["app-calendar"]],standalone:!0,features:[ve],decls:22,vars:4,consts:[[1,"button-container"],["type","button","data-bs-toggle","modal","data-bs-target","#mealModal",1,"btn","btn-success"],["type","button","data-bs-toggle","modal","data-bs-target","#trainingModal",1,"btn","btn-success"],[1,"calendar-container"],[1,"calendar-header"],[1,"btn","btn-primary",3,"click"],[1,"calendar-days"],[1,"day-name"],[1,"day",3,"other-month"],[3,"Save","close","meal"],[3,"Save","close","training"],[1,"day"],[1,"day-number"],[3,"routerLink"],[1,"buttons-container"],["data-bs-toggle","modal","data-bs-target","#meal2Modal",1,"btn","btn-link","btn-sm",2,"font-size","0.8rem","text-decoration","none",3,"click"],[1,"btn","btn-link","btn-sm",2,"font-size","0.8rem","text-decoration","none",3,"click"],["data-bs-toggle","modal","data-bs-target","#meal3Modal",1,"btn","btn-link","btn-sm",2,"font-size","0.8rem","text-decoration","none",3,"click"]],template:function(r,i){r&1&&(B(0,"div",0)(1,"button",1),$(2," Dodaj Posi\u0142ek "),N(),B(3,"button",2),$(4," Dodaj Trening "),N()(),B(5,"div",3)(6,"div",4)(7,"button",5),ne("click",function(){return i.prevMonth()}),$(8,"\u2190 Poprzedni"),N(),B(9,"h2"),$(10),N(),B(11,"button",5),ne("click",function(){return i.nextMonth()}),$(12,"Nast\u0119pny \u2192"),N()(),B(13,"div",6),Ln(14,m9,2,1,"div",7,Na),Ln(16,b9,6,8,"div",8,f9),N()(),Br(18,"app-meal-modal")(19,"app-training-modal"),B(20,"app-edit",9),ne("Save",function(o){return i.saveEditedMeal(o)})("close",function(){return i.closeModal()}),N(),B(21,"app-edit-training",10),ne("Save",function(o){return i.saveEditedTraining(o)})("close",function(){return i.closeModal()}),N()),r&2&&(j(10),cb("",i.months[i.currentMonth]," ",i.currentYear,""),j(4),Bn(i.dayNames),j(2),Bn(i.calendarDays),j(4),Ue("meal",i.selectedMeal),j(),Ue("training",i.selectedTraining))},dependencies:[zs,oM,qc,Vc,aM,lM,cM],styles:[".calendar-container[_ngcontent-%COMP%]{padding:20px;display:flex;flex-direction:column;align-items:center;background:linear-gradient(135deg,#e0f7fa,#254636);border-radius:10px;color:#333}.calendar-header[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:20px;margin-bottom:20px}.calendar-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:linear-gradient(135deg,#6e7dff,#3d4bff);border:none;color:#fff;padding:10px 15px;border-radius:5px;font-size:16px;cursor:pointer;transition:background .3s}.calendar-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#3d4bff,#6e7dff)}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:20px;margin-bottom:20px}.btn-success[_ngcontent-%COMP%]{background-color:#254636;border:none;color:#fff;padding:10px 20px;border-radius:5px;font-size:16px;cursor:pointer;transition:background-color .3s ease}.btn-success[_ngcontent-%COMP%]:hover{background-color:#2f5957}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#6e7dff,#3d4bff);border:none;color:#fff;padding:12px 20px;font-size:16px;border-radius:5px;cursor:pointer}.btn-primary[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#3d4bff,#6e7dff)}.calendar-days[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(7,1fr);gap:10px}.day[_ngcontent-%COMP%]{background:#f0f0f0;border-radius:8px;padding:15px;text-align:center;cursor:pointer;transition:transform .2s;color:#333}.day[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.day-name[_ngcontent-%COMP%]{font-weight:700;padding:10px 0;color:#333}.day.other-month[_ngcontent-%COMP%]{background:#e0e0e0;color:#888}.calendar-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;font-weight:700;text-align:center;color:#333}.day-number[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#006400;text-decoration:none}.day-number[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}"]})}}return n})();var hM=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=ye({type:n,selectors:[["app-home"]],standalone:!0,features:[ve],decls:1,vars:0,template:function(r,i){r&1&&Br(0,"app-calendar")},dependencies:[dM]})}}return n})();var If=(()=>{class n{constructor(){this.isLogin=!0,this.buttonText="",this.email="",this.password="",this.emailChange=new $e,this.passwordChange=new $e,this.formSubmit=new $e}onEmailChange(){this.emailChange.emit(this.email)}onPasswordChange(){this.passwordChange.emit(this.password)}onSubmit(){this.email&&this.password?this.formSubmit.emit({email:this.email,password:this.password}):console.log("Prosz\u0119 poda\u0107 e-mail i has\u0142o.")}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=ye({type:n,selectors:[["app-auth-form"]],inputs:{isLogin:"isLogin",buttonText:"buttonText",email:"email",password:"password"},outputs:{emailChange:"emailChange",passwordChange:"passwordChange",formSubmit:"formSubmit"},standalone:!0,features:[ve],decls:14,vars:4,consts:[[1,"auth-form-container"],[3,"ngSubmit"],[1,"input-container"],["for","email"],["id","email","type","email","name","email","required","","placeholder","Wpisz e-mail",3,"ngModelChange","ngModel"],["for","password"],["id","password","type","password","name","password","required","","placeholder","Wpisz has\u0142o",3,"ngModelChange","ngModel"],["type","submit",1,"btn"]],template:function(r,i){r&1&&(B(0,"div",0)(1,"h2"),$(2),N(),B(3,"form",1),ne("ngSubmit",function(){return i.onSubmit()}),B(4,"div",2)(5,"label",3),$(6,"E-mail"),N(),B(7,"input",4),Ut("ngModelChange",function(o){return wt(i.email,o)||(i.email=o),o}),ne("ngModelChange",function(){return i.onEmailChange()}),N()(),B(8,"div",2)(9,"label",5),$(10,"Has\u0142o"),N(),B(11,"input",6),Ut("ngModelChange",function(o){return wt(i.password,o)||(i.password=o),o}),ne("ngModelChange",function(){return i.onPasswordChange()}),N()(),B(12,"button",7),$(13),N()()()),r&2&&(j(2),lt(i.isLogin?"Logowanie":"Rejestracja"),j(5),qt("ngModel",i.email),j(4),qt("ngModel",i.password),j(2),lt(i.buttonText))},dependencies:[Mt,Af,xa,wf,Tf,Ic,Ac,Ec],styles:[".auth-form-container[_ngcontent-%COMP%]{width:100%;max-width:400px;margin:0 auto;padding:30px;border-radius:10px;box-shadow:0 4px 8px #0000001a;background:linear-gradient(135deg,#e0f7fa,#254636);color:#fff}h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px;font-size:24px;color:#fff}.input-container[_ngcontent-%COMP%]{margin-bottom:20px}.input-container[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:14px;margin-bottom:5px;color:#fff}.input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:12px;font-size:16px;border-radius:8px;border:1px solid #ccc;background-color:#fffc;color:#333}.input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#00796b;background-color:#fff}.btn[_ngcontent-%COMP%]{width:100%;padding:12px;background-color:#00796b;color:#fff;font-size:16px;border:none;border-radius:8px;cursor:pointer;transition:background-color .3s ease;margin-top:10px}.btn[_ngcontent-%COMP%]:hover{background-color:#004d40}@media (max-width: 768px){.auth-form-container[_ngcontent-%COMP%]{padding:20px}h2[_ngcontent-%COMP%]{font-size:20px}.input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:10px}.btn[_ngcontent-%COMP%]{font-size:14px;padding:10px}}"]})}}return n})();var fM=(()=>{class n{constructor(){this.router=pe(Gs),this.authService=pe(Vi),this.email="",this.password="",this.isLogin=!0}login({email:t,password:r}){t&&r?this.authService.login(t,r).then(()=>{this.router.navigate(["/home"])}).catch(i=>{console.error("B\u0142\u0105d logowania:",i.message)}):console.log("Prosz\u0119 poda\u0107 e-mail i has\u0142o.")}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=ye({type:n,selectors:[["app-login"]],standalone:!0,features:[ve],decls:1,vars:4,consts:[[3,"emailChange","passwordChange","formSubmit","isLogin","buttonText","email","password"]],template:function(r,i){r&1&&(B(0,"app-auth-form",0),Ut("emailChange",function(o){return wt(i.email,o)||(i.email=o),o})("passwordChange",function(o){return wt(i.password,o)||(i.password=o),o}),ne("formSubmit",function(o){return i.login(o)}),N()),r&2&&(Ue("isLogin",!0)("buttonText","Zaloguj si\u0119"),qt("email",i.email)("password",i.password))},dependencies:[Mt,If]})}}return n})();var pM=(()=>{class n{constructor(){this.email="",this.password="",this.authService=pe(Vi)}register({email:t,password:r}){t&&r?this.authService.register(t,r).then(()=>{console.log("Zarejestrowano pomy\u015Blnie")}).catch(i=>{console.error("B\u0142\u0105d rejestracji:",i.message)}):console.log("Prosz\u0119 poda\u0107 e-mail i has\u0142o.")}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=ye({type:n,selectors:[["app-register"]],standalone:!0,features:[ve],decls:1,vars:4,consts:[[3,"emailChange","passwordChange","formSubmit","isLogin","buttonText","email","password"]],template:function(r,i){r&1&&(B(0,"app-auth-form",0),Ut("emailChange",function(o){return wt(i.email,o)||(i.email=o),o})("passwordChange",function(o){return wt(i.password,o)||(i.password=o),o}),ne("formSubmit",function(o){return i.register(o)}),N()),r&2&&(Ue("isLogin",!1)("buttonText","Zarejestruj si\u0119"),qt("email",i.email)("password",i.password))},dependencies:[Mt,If]})}}return n})();var mM=()=>{let n=pe(Vi),e=pe(Gs);return n.isAuthenticated()?!0:(e.navigate(["/login"]),!1)};var gM=(()=>{class n{transform(t,r){console.log("Meals:",t),console.log("Trainings:",r);let i=t.reduce((o,a)=>{let l=parseInt(a.calories,10);return console.log("Meal:",a,"Calories:",l),o+(isNaN(l)?0:l)},0),s=r.reduce((o,a)=>{let l=parseInt(a.burnedKcal,10);return console.log("Training:",a,"BurnedKcal:",l),o+(isNaN(l)?0:l)},0);return console.log("Total Calories:",i),console.log("Total Burned Calories:",s),i-s}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275pipe=ob({name:"caloriesBalance",type:n,pure:!0,standalone:!0})}}return n})();function C9(n,e){if(n&1&&(B(0,"li",7)(1,"span",8),$(2),N(),$(3," - "),B(4,"span",9),$(5),N(),$(6),N()),n&2){let t=e.$implicit;j(2),lt(t.name),j(3),St("",t.calories," kcal"),j(),St(" (",t.weight," g) ")}}function S9(n,e){if(n&1&&(B(0,"div",4)(1,"h3"),$(2,"Meals:"),N(),B(3,"ul",6),Ln(4,C9,7,3,"li",7,Na),N()()),n&2){let t=be();j(4),Bn(t.meals())}}function w9(n,e){if(n&1&&(B(0,"li",11)(1,"span",12),$(2),N(),$(3," - "),B(4,"span",13),$(5),N(),$(6),N()),n&2){let t=e.$implicit;j(2),lt(t.name),j(3),St("",t.burnedKcal," kcal"),j(),St(" (",t.time," min) ")}}function T9(n,e){if(n&1&&(B(0,"div",5)(1,"h3"),$(2,"Trainings:"),N(),B(3,"ul",10),Ln(4,w9,7,3,"li",11,Na),N()()),n&2){let t=be();j(4),Bn(t.trainings())}}var yM=(()=>{class n{constructor(){this.day=Ct(null),this.meals=Ct([]),this.trainings=Ct([]),this.route=pe(yb),this.trainingAndMealService=pe(hr),this.route.paramMap.subscribe(t=>{let r=t.get("day");if(console.log("Dzie\u0144 z parametru URL:",r),r){let i=new Date(r);this.day.set(i),this.loadDetails(i)}})}loadDetails(t){this.trainingAndMealService.getMealsByDate(t).subscribe(r=>{console.log("Pobrane posi\u0142ki:",r),this.meals.set(r)}),this.trainingAndMealService.getTrainingsByDate(t).subscribe(r=>{console.log("Pobrane treningi:",r),this.trainings.set(r)})}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=ye({type:n,selectors:[["app-day-details"]],standalone:!0,features:[ve],decls:12,vars:10,consts:[[1,"day-details"],[1,"day-title"],[1,"calories-balance"],[1,"balance-value"],[1,"meals"],[1,"trainings"],[1,"meal-list"],[1,"meal-item"],[1,"meal-name"],[1,"meal-calories"],[1,"training-list"],[1,"training-item"],[1,"training-name"],[1,"training-burned"]],template:function(r,i){r&1&&(B(0,"div",0)(1,"h2",1),$(2),Vn(3,"date"),N(),B(4,"div",2)(5,"h3"),$(6,"Calories balance:"),N(),B(7,"p",3),$(8),Vn(9,"caloriesBalance"),N()(),gr(10,S9,6,0,"div",4)(11,T9,6,0,"div",5),N()),r&2&&(j(2),St("Details for ",Fa(3,4,i.day(),"fullDate"),""),j(6),St(" ",Fa(9,7,i.meals(),i.trainings())," kcal "),j(2),kt(i.meals().length>0?10:-1),j(),kt(i.trainings().length>0?11:-1))},dependencies:[Us,gM],styles:[".day-details[_ngcontent-%COMP%]{background:linear-gradient(135deg,#e0f7fa,#254636);padding:20px;border-radius:10px;box-shadow:0 4px 8px #0000001a;max-width:800px;margin:30px auto;color:#fff;/}.day-title[_ngcontent-%COMP%]{font-size:2rem;color:#fff;text-align:center;margin-bottom:20px}.calories-balance[_ngcontent-%COMP%]{background-color:#0006;padding:15px;border-radius:8px;margin-bottom:20px;color:#fff}.balance-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#fff}.meals[_ngcontent-%COMP%], .trainings[_ngcontent-%COMP%]{background-color:#fffc;padding:15px;border-radius:8px;margin-bottom:20px;box-shadow:0 4px 6px #0000000d}.meal-list[_ngcontent-%COMP%], .training-list[_ngcontent-%COMP%]{list-style-type:none;padding:0}.meal-item[_ngcontent-%COMP%], .training-item[_ngcontent-%COMP%]{font-size:1.1rem;margin:10px 0;color:#333}.meal-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .training-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700}.meal-name[_ngcontent-%COMP%], .training-name[_ngcontent-%COMP%]{color:#006400}.meal-calories[_ngcontent-%COMP%], .training-burned[_ngcontent-%COMP%]{color:#d32f2f}@media (max-width: 768px){.day-details[_ngcontent-%COMP%]{padding:15px}.day-title[_ngcontent-%COMP%]{font-size:1.8rem}.balance-value[_ngcontent-%COMP%]{font-size:1.3rem}.meal-item[_ngcontent-%COMP%], .training-item[_ngcontent-%COMP%]{font-size:1rem}}"]})}}return n})();var vM=(()=>{class n{constructor(){this.meals=Ct([]),this.trainings=Ct([]),this.currentMonth=new Date,this.trainingAndMealService=pe(hr),this.cdr=pe(Fc),this.loadMonthlyDetails()}changeMonth(t){let r=new Date(this.currentMonth);r.setMonth(this.currentMonth.getMonth()+t),this.currentMonth=r,this.loadMonthlyDetails(),this.cdr.markForCheck()}loadMonthlyDetails(){let t=new Date(this.currentMonth.getFullYear(),this.currentMonth.getMonth(),1),r=new Date(this.currentMonth.getFullYear(),this.currentMonth.getMonth()+1,0);this.trainingAndMealService.getMealsByDateRange(t,r).subscribe(i=>{this.meals.set(i||[])}),this.trainingAndMealService.getTrainingsByDateRange(t,r).subscribe(i=>{this.trainings.set(i||[])})}totalCalories(){return this.meals().reduce((r,i)=>r+(i.calories?Number(i.calories):0),0)}totalBurnedCalories(){return this.trainings().reduce((r,i)=>r+(i.burnedKcal?Number(i.burnedKcal):0),0)}totalTrainingTime(){return this.trainings().reduce((r,i)=>r+(i.time?Number(i.time):0),0)}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=ye({type:n,selectors:[["app-monthly-summary"]],standalone:!0,features:[ve],decls:27,vars:7,consts:[[1,"monthly-summary"],[1,"summary"],[1,"month-navigation"],[1,"nav-button",3,"click"],[1,"summary-title"],[1,"calories-summary"]],template:function(r,i){r&1&&(B(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),ne("click",function(){return i.changeMonth(-1)}),B(4,"span"),$(5,"<"),N(),$(6," Poprzedni miesi\u0105c "),N(),B(7,"h2",4),$(8),Vn(9,"date"),N(),B(10,"button",3),ne("click",function(){return i.changeMonth(1)}),$(11," Nast\u0119pny miesi\u0105c "),B(12,"span"),$(13,">"),N()()(),B(14,"div",5)(15,"p")(16,"strong"),$(17,"\u0141\u0105czna liczba kalorii:"),N(),$(18),N(),B(19,"p")(20,"strong"),$(21,"\u0141\u0105czna liczba spalonych kalorii:"),N(),$(22),N(),B(23,"p")(24,"strong"),$(25,"\u0141\u0105czny czas trening\xF3w:"),N(),$(26),N()()()()),r&2&&(j(8),St(" Zestawienie miesi\u0119czne dla miesi\u0105ca: ",Fa(9,4,i.currentMonth,"MMMM yyyy")," "),j(10),St(" ",i.totalCalories()," kcal"),j(4),St(" ",i.totalBurnedCalories()," kcal "),j(4),St(" ",i.totalTrainingTime()," min "))},dependencies:[Us],styles:[".monthly-summary[_ngcontent-%COMP%]{padding:30px;display:flex;flex-direction:column;align-items:center;background:linear-gradient(135deg,#e0f7fa,#254636);border-radius:8px;box-shadow:0 4px 8px #0000001a;width:80%;margin:0 auto;color:#fff}.summary-title[_ngcontent-%COMP%]{font-size:24px;font-weight:600;margin-bottom:20px;color:#fff;text-align:center}.month-navigation[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;margin-bottom:20px;align-items:center}.nav-button[_ngcontent-%COMP%]{padding:8px 16px;background-color:#00796b;color:#fff;font-size:14px;font-weight:500;border:2px solid #00796b;border-radius:12px;cursor:pointer;transition:all .3s ease;text-transform:uppercase;letter-spacing:.5px;min-width:100px;text-align:center}.nav-button[_ngcontent-%COMP%]:hover{background-color:#fff;color:#00796b;border-color:#00796b;transform:translateY(-2px)}.calories-summary[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:8px;width:100%;box-shadow:0 2px 4px #0000001a;color:#333}.calories-summary[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:18px;margin:10px 0}.calories-summary[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:600}.nav-button[_ngcontent-%COMP%]:active{transform:translateY(1px)}.nav-button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:16px}"]})}}return n})();var _M=[{path:"",redirectTo:"/home",pathMatch:"full"},{path:"home",component:hM,canActivate:[mM]},{path:"login",component:fM},{path:"register",component:pM},{path:"day-details/:day",component:yM},{path:"summary",component:vM}];var bM={production:!1,firebaseConfig:{apiKey:"AIzaSyA27S8WmqVrZFFO9epniU6KwbjmzmEAt44",authDomain:"fitness-7d0de.firebaseapp.com",projectId:"fitness-7d0de",storageBucket:"fitness-7d0de.firebasestorage.app",messagingSenderId:"868055861373",appId:"1:868055861373:web:681f1ad485b72ebc338914"}};var CM={providers:[_b(_M),mb(),ab([N1,zb,Ub.initializeApp(bM.firebaseConfig)]),Us]};var E9={providers:[gb()]},SM=fb(CM,E9);var A9=()=>pb(F1,SM),fH=A9;export{fH as a};
